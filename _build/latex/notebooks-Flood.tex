%% Generated by Sphinx.
\def\sphinxdocclass{jupyterBook}
\documentclass[letterpaper,10pt,english]{jupyterBook}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}
%% turn off hyperref patch of \index as sphinx.xdy xindy module takes care of
%% suitable \hyperpage mark-up, working around hyperref-xindy incompatibility
\PassOptionsToPackage{hyperindex=false}{hyperref}
%% memoir class requires extra handling
\makeatletter\@ifclassloaded{memoir}
{\ifdefined\memhyperindexfalse\memhyperindexfalse\fi}{}\makeatother


\PassOptionsToPackage{warn}{textcomp}

\catcode`^^^^00a0\active\protected\def^^^^00a0{\leavevmode\nobreak\ }
\usepackage{cmap}
\usepackage{fontspec}
\defaultfontfeatures[\rmfamily,\sffamily,\ttfamily]{}
\usepackage{amsmath,amssymb,amstext}
\usepackage{polyglossia}
\setmainlanguage{english}



\setmainfont{FreeSerif}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Italic,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldItalic
]
\setsansfont{FreeSans}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]
\setmonofont{FreeMono}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]



\usepackage[Bjarne]{fncychap}
\usepackage[,numfigreset=1,mathnumfig]{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}


\usepackage{sphinxmessages}



        % Start of preamble defined in sphinx-jupyterbook-latex %
         \usepackage[Latin,Greek]{ucharclasses}
        \usepackage{unicode-math}
        % fixing title of the toc
        \addto\captionsenglish{\renewcommand{\contentsname}{Contents}}
        \hypersetup{
            pdfencoding=auto,
            psdextra
        }
        % End of preamble defined in sphinx-jupyterbook-latex %
        

\title{Minor Flood Frequency and Duration}
\date{Jun 03, 2024}
\release{}
\author{Playground Coordinator}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{notebooks/Flood::doc}}

\begin{itemize}
\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{notebooks/FloodFrequency::doc}]{\sphinxcrossref{Minor Flood Frequency}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{notebooks/FloodDuration::doc}]{\sphinxcrossref{Flood Duration}}}

\end{itemize}

\sphinxstepscope


\part{Minor Flood Frequency}
\label{\detokenize{notebooks/FloodFrequency:minor-flood-frequency}}\label{\detokenize{notebooks/FloodFrequency::doc}}

\begin{wrapfigure}{l}{0pt}
\centering
\noindent\sphinxincludegraphics[scale=0.5]{{d4d9009f81887fbb93bf22c8fa0e3cd3567be58f76b5e9313d693212f257ad45}.png}
\end{wrapfigure}

\sphinxAtStartPar
In this notebook we will plot two indicators concerning flooding at the Hawaii tide gauges, after first taking a general look at the type of data we are able to plot from the UHSLC. These indicators are based on a ‘flooding’ threshold, using \sphinxhref{https://tidesandcurrents.noaa.gov/sltrends/faq.html}{relative sea level}.

\sphinxAtStartPar
Download Files:
\DUrole{xref,download,myst}{Map} |
\DUrole{xref,download,myst}{Time Series Plot} |
\DUrole{xref,download,myst}{Table}


\chapter{Setup}
\label{\detokenize{notebooks/FloodFrequency:setup}}
\sphinxAtStartPar
We first need to import the necessary libraries, establish our input/output directories, and set up some basic plotting rules. We’ll do this by running another notebook called “setup.”

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\end{sphinxuseclass}
\end{sphinxuseclass}

\chapter{Retrieve the Tide Station(s) Data Set(s)}
\label{\detokenize{notebooks/FloodFrequency:retrieve-the-tide-station-s-data-set-s}}
\sphinxAtStartPar
We stored this previously in our data directory as “rsl\_hawaii.nc”

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} load the data}
\PYG{n}{rsl} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
and we’ll save a few variables that will come up later for report generation.


\section{Set the Datum to MHHW}
\label{\detokenize{notebooks/FloodFrequency:set-the-datum-to-mhhw}}
\begin{sphinxShadowBox}
\sphinxstylesidebartitle{A Note on Datums}

\sphinxAtStartPar
The sea level variable in the netcdf file is sea level \sphinxstylestrong{relative to the station datum}. For more information on the data processing of this gauge, see the \sphinxhref{https://uhslc.soest.hawaii.edu/rqds/pacific/doc/qa007b.dmt}{station metdata}.
\end{sphinxShadowBox}

\sphinxAtStartPar
In this example, we will set the datum to MHHW. This can be hard coded, or we can read in the \sphinxhref{https://uhslc.soest.hawaii.edu/stations/?stn=007\#datums}{station datum information} from UHSLC. I’m not going to do this, because there’s no elegant way to parse the datum table at the moment as far as I can tell. It’s a simple call to the NOAA COOPS API if that’s the data source, though. Instead I have a saved datums\_007.csv file that we’ll call from.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}MHHW\PYGZus{}uhslc\PYGZus{}datums}\PYG{p}{(}\PYG{n+nb}{id}\PYG{p}{,} \PYG{n}{datumname}\PYG{p}{)}\PYG{p}{:} 
    
    \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{https://uhslc.soest.hawaii.edu/stations/TIDES\PYGZus{}DATUMS/fd/LST/fd}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n+nb}{id}\PYG{p}{)}\PYG{l+s+si}{:}\PYG{l+s+s1}{03}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/datumTable\PYGZus{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n+nb}{id}\PYG{p}{)}\PYG{l+s+si}{:}\PYG{l+s+s1}{03}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZus{}m.html}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{response} \PYG{o}{=} \PYG{n}{requests}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{soup} \PYG{o}{=} \PYG{n}{BeautifulSoup}\PYG{p}{(}\PYG{n}{response}\PYG{o}{.}\PYG{n}{text}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{html.parser}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{table} \PYG{o}{=} \PYG{n}{soup}\PYG{o}{.}\PYG{n}{find}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{table}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{table} \PYG{o}{=} \PYG{n}{table}\PYG{o}{.}\PYG{n}{find\PYGZus{}all}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tr}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{p}{]} \PYG{c+c1}{\PYGZsh{} skip header row}
    \PYG{n}{table} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZlt{}table\PYGZgt{}}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{p}{[}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)} \PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n}{table}\PYG{p}{]}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} add back the table tag}
    \PYG{n}{table\PYGZus{}io} \PYG{o}{=} \PYG{n}{io}\PYG{o}{.}\PYG{n}{StringIO}\PYG{p}{(}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{table}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{datumtable} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{read\PYGZus{}html}\PYG{p}{(}\PYG{n}{table\PYGZus{}io}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
    \PYG{n}{datum} \PYG{o}{=} \PYG{n}{datumtable}\PYG{p}{[}\PYG{n}{datumtable}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Datum}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{==} \PYG{n}{datumname}\PYG{p}{]}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Value}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
    \PYG{c+c1}{\PYGZsh{} ensure datum is a float}
    \PYG{n}{datum} \PYG{o}{=} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{datum}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{datum}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} add MHHW to the dataset}
\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{DataArray}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mi}{1000}\PYG{o}{*}\PYG{n}{get\PYGZus{}MHHW\PYGZus{}uhslc\PYGZus{}datums}\PYG{p}{(}\PYG{n+nb}{id}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{k}{for} \PYG{n+nb}{id} \PYG{o+ow}{in} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{uhslc\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{]}\PYG{p}{,} \PYG{n}{dims}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{coords}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mm}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Mean Higher High Water, rel. to station datum}\PYG{l+s+s1}{\PYGZsq{}}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rsl} \PYG{o}{=} \PYG{n}{rsl}\PYG{o}{.}\PYG{n}{sortby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} convert sea level to MHHW}
\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mm}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level, relative to MHHW}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{n}{rsl}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 146MB
Dimensions:               (time: 1043870, record\PYGZus{}id: 11)
Coordinates:
  * time                  (time) datetime64[ns] 8MB 1905\PYGZhy{}01\PYGZhy{}01T10:00:00.02880...
  * record\PYGZus{}id             (record\PYGZus{}id) int16 22B 520 600 5520 ... 580 140 500
Data variables:
    sea\PYGZus{}level             (record\PYGZus{}id, time) float32 46MB ...
    lat                   (record\PYGZus{}id) float32 44B ...
    lon                   (record\PYGZus{}id) float32 44B ...
    station\PYGZus{}name          (record\PYGZus{}id) \PYGZlt{}U17 748B ...
    station\PYGZus{}country       (record\PYGZus{}id) \PYGZlt{}U30 1kB ...
    station\PYGZus{}country\PYGZus{}code  (record\PYGZus{}id) float32 44B ...
    uhslc\PYGZus{}id              (record\PYGZus{}id) float32 44B 52.0 60.0 552.0 ... 14.0 50.0
    gloss\PYGZus{}id              (record\PYGZus{}id) float32 44B ...
    ssc\PYGZus{}id                (record\PYGZus{}id) \PYGZlt{}U4 176B ...
    last\PYGZus{}rq\PYGZus{}date          (record\PYGZus{}id) datetime64[ns] 88B ...
    MHHW                  (record\PYGZus{}id) float64 88B 1.225e+03 ... 1.204e+03
    sea\PYGZus{}level\PYGZus{}MHHW        (record\PYGZus{}id, time) float64 92MB nan nan ... \PYGZhy{}210.0
Attributes:
    title:                  UHSLC Fast Delivery Tide Gauge Data (hourly)
    ncei\PYGZus{}template\PYGZus{}version:  NCEI\PYGZus{}NetCDF\PYGZus{}TimeSeries\PYGZus{}Orthogonal\PYGZus{}Template\PYGZus{}v2.0
    featureType:            timeSeries
    Conventions:            CF\PYGZhy{}1.6, ACDD\PYGZhy{}1.3
    date\PYGZus{}created:           2024\PYGZhy{}03\PYGZhy{}07T14:27:49Z
    publisher\PYGZus{}name:         University of Hawaii Sea Level Center (UHSLC)
    publisher\PYGZus{}email:        philiprt@hawaii.edu, markm@soest.hawaii.edu
    publisher\PYGZus{}url:          http://uhslc.soest.hawaii.edu
    summary:                The UHSLC assembles and distributes the Fast Deli...
    processing\PYGZus{}level:       Fast Delivery (FD) data undergo a level 1 quality...
    acknowledgment:         The UHSLC Fast Delivery database is supported by ...
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Assess Station Data Quality for the POR (1983\sphinxhyphen{}2022)}
\label{\detokenize{notebooks/FloodFrequency:assess-station-data-quality-for-the-por-1983-2022}}
\sphinxAtStartPar
To do this, we’ll plot all the sea level data to make sure our data looks correct, and then we’ll truncate the data set to the time period of record (POR).

\begin{sphinxShadowBox}
\sphinxstylesidebartitle{Watch the units!}

\begin{sphinxadmonition}{caution}{Caution:}
\sphinxAtStartPar
Note that the sea\_level variable here is in millimeters (mm)! If we want to plot things on a centimeter (cm) scale, we have to divide by 10.
\end{sphinxadmonition}
\end{sphinxShadowBox}

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{n}{sharex}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{autofmt\PYGZus{}xdate}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} ax.plot(rsl.time.values,rsl.sea\PYGZus{}level\PYGZus{}MHHW.T.values/10)}

\PYG{c+c1}{\PYGZsh{} ax.set\PYGZus{}ylabel(rsl[\PYGZsq{}sea\PYGZus{}level\PYGZus{}MHHW\PYGZsq{}].long\PYGZus{}name) \PYGZsh{}divide by 10 to convert to cm}

\PYG{c+c1}{\PYGZsh{} \PYGZsh{} add legend to bottom of plot}
\PYG{c+c1}{\PYGZsh{} ax.legend(rsl[\PYGZsq{}station\PYGZus{}name\PYGZsq{}].values, bbox\PYGZus{}to\PYGZus{}anchor=(0.5, \PYGZhy{}0.2), loc=\PYGZsq{}upper center\PYGZsq{}, ncol=3)  }


\PYG{c+c1}{\PYGZsh{} Initial offset}
\PYG{n}{offset} \PYG{o}{=} \PYG{l+m+mi}{0}
\PYG{c+c1}{\PYGZsh{} The amount to offset each successive line}
\PYG{n}{offset\PYGZus{}increment} \PYG{o}{=} \PYG{l+m+mi}{150}  \PYG{c+c1}{\PYGZsh{} Adjust this value based on your data scale and visual preference}

\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{record\PYGZus{}id} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Extract the series for this station}
    \PYG{n}{sea\PYGZus{}level\PYGZus{}data} \PYG{o}{=} \PYG{n}{rsl}\PYG{o}{.}\PYG{n}{sea\PYGZus{}level\PYGZus{}MHHW}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{i}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values} \PYG{o}{/} \PYG{l+m+mi}{10}  \PYG{c+c1}{\PYGZsh{} Convert to cm}
    \PYG{c+c1}{\PYGZsh{} Plot, adding the offset}
    \PYG{c+c1}{\PYGZsh{}add horizontal line for each station}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{axhline}\PYG{p}{(}\PYG{n}{offset}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{n}{linestyle}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{rsl}\PYG{o}{.}\PYG{n}{time}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}data} \PYG{o}{+} \PYG{n}{offset}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{n}{rsl}\PYG{o}{.}\PYG{n}{time}\PYG{o}{.}\PYG{n}{values}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{offset}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{fontsize}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{ha}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{left}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{va}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{top}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} Increment the offset for the next series}
    \PYG{n}{offset} \PYG{o}{+}\PYG{o}{=} \PYG{n}{offset\PYGZus{}increment}

\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{long\PYGZus{}name} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ (cm, offset by 150cm per station)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} take only a subset of the data: Hilo, Kawaihae, Kahului, Mokuoloe, Honolulu, Nawiliwili, Johnston and Midway Island}
\PYG{n}{subset} \PYG{o}{=} \PYG{n}{rsl}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{500}\PYG{p}{,}\PYG{l+m+mi}{520}\PYG{p}{,}\PYG{l+m+mi}{570}\PYG{p}{,}\PYG{l+m+mi}{580}\PYG{p}{,}\PYG{l+m+mi}{590}\PYG{p}{,}\PYG{l+m+mi}{600}\PYG{p}{,}\PYG{l+m+mi}{610}\PYG{p}{,}\PYG{l+m+mi}{5520}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{subset} \PYG{o}{=} \PYG{n}{subset}\PYG{o}{.}\PYG{n}{sortby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{n}{sharex}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{autofmt\PYGZus{}xdate}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} ax.plot(rsl.time.values,rsl.sea\PYGZus{}level\PYGZus{}MHHW.T.values/10)}
\PYG{c+c1}{\PYGZsh{} ax.set\PYGZus{}ylabel(rsl[\PYGZsq{}sea\PYGZus{}level\PYGZus{}MHHW\PYGZsq{}].long\PYGZus{}name) \PYGZsh{}divide by 10 to convert to cm}
\PYG{c+c1}{\PYGZsh{} \PYGZsh{} add legend to bottom of plot}
\PYG{c+c1}{\PYGZsh{} ax.legend(rsl[\PYGZsq{}station\PYGZus{}name\PYGZsq{}].values, bbox\PYGZus{}to\PYGZus{}anchor=(0.5, \PYGZhy{}0.2), loc=\PYGZsq{}upper center\PYGZsq{}, ncol=3)  }
\PYG{c+c1}{\PYGZsh{} Initial offset}
\PYG{n}{offset} \PYG{o}{=} \PYG{l+m+mi}{0}
\PYG{c+c1}{\PYGZsh{} The amount to offset each successive line}
\PYG{n}{offset\PYGZus{}increment} \PYG{o}{=} \PYG{l+m+mi}{150}  \PYG{c+c1}{\PYGZsh{} Adjust this value based on your data scale and visual preference}

\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{record\PYGZus{}id} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Extract the series for this station}
    \PYG{n}{sea\PYGZus{}level\PYGZus{}data} \PYG{o}{=} \PYG{n}{subset}\PYG{o}{.}\PYG{n}{sea\PYGZus{}level\PYGZus{}MHHW}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{i}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values} \PYG{o}{/} \PYG{l+m+mi}{10}  \PYG{c+c1}{\PYGZsh{} Convert to cm}
    \PYG{c+c1}{\PYGZsh{} Plot, adding the offset}
    \PYG{c+c1}{\PYGZsh{}add horizontal line for each station}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{axhline}\PYG{p}{(}\PYG{n}{offset}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{n}{linestyle}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{subset}\PYG{o}{.}\PYG{n}{time}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}data} \PYG{o}{+} \PYG{n}{offset}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{n}{subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{n}{subset}\PYG{o}{.}\PYG{n}{time}\PYG{o}{.}\PYG{n}{values}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{offset}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{20}\PYG{p}{,} \PYG{n}{subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{fontsize}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{n}{ha}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{left}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{va}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{top}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} Increment the offset for the next series}
    \PYG{n}{offset} \PYG{o}{+}\PYG{o}{=} \PYG{n}{offset\PYGZus{}increment}

\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{n}{subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{long\PYGZus{}name} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ (cm, offset by 150cm per station)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Text(0, 0.5, \PYGZsq{}Sea Level, relative to MHHW (cm, offset by 150cm per station)\PYGZsq{})
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{6ec9055158eb0a2d49e237a949a37ebf5555ce3610ffc9a58c4bc9ee11df6205}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\subsection{Identify epoch for the flood frequency analysis}
\label{\detokenize{notebooks/FloodFrequency:identify-epoch-for-the-flood-frequency-analysis}}
\sphinxAtStartPar
Now, we’ll calculate trend starting from the beginning of the tidal datum analysis period epoch to the last time processed. The  epoch information is given in the datums table.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} make epoch\PYGZus{}start equal to Jan 1 1983 in datetime format}
\PYG{n}{epoch\PYGZus{}start} \PYG{o}{=} \PYG{n}{dt}\PYG{o}{.}\PYG{n}{datetime}\PYG{p}{(}\PYG{l+m+mi}{1983}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} and for now, end time will be the end of 2023}
\PYG{n}{epoch\PYGZus{}end} \PYG{o}{=} \PYG{n}{dt}\PYG{o}{.}\PYG{n}{datetime}\PYG{p}{(}\PYG{l+m+mi}{2023}\PYG{p}{,} \PYG{l+m+mi}{12}\PYG{p}{,}\PYG{l+m+mi}{31}\PYG{p}{)}


\PYG{n}{hourly\PYGZus{}data} \PYG{o}{=} \PYG{n}{subset}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{n}{epoch\PYGZus{}start}\PYG{p}{,} \PYG{n}{epoch\PYGZus{}end}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{hourly\PYGZus{}data} \PYG{o}{=} \PYG{n}{hourly\PYGZus{}data}\PYG{o}{.}\PYG{n}{sortby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{startEpochDateTime}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{epoch\PYGZus{}start}\PYG{o}{.}\PYG{n}{strftime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{Y\PYGZhy{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{m\PYGZhy{}}\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{endEpochDateTime}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{epoch\PYGZus{}end}\PYG{o}{.}\PYG{n}{strftime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{Y\PYGZhy{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{m\PYGZhy{}}\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
and plot the hourly time series

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} fig, ax = plt.subplots(sharex=True)}
\PYG{c+c1}{\PYGZsh{} fig.autofmt\PYGZus{}xdate()}
\PYG{c+c1}{\PYGZsh{} ax.plot(hourly\PYGZus{}data.time.values,hourly\PYGZus{}data.sea\PYGZus{}level\PYGZus{}MHHW.T.values/10) \PYGZsh{}divide by 10 to convert to cm}
\PYG{c+c1}{\PYGZsh{} }
\PYG{n}{hourly\PYGZus{}data}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}MHHW\PYGZus{}cm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{hourly\PYGZus{}data}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{/} \PYG{l+m+mi}{10}

\PYG{n}{hourly\PYGZus{}data}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}MHHW\PYGZus{}cm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cm}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{hourly\PYGZus{}data}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}MHHW\PYGZus{}cm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level, relative to MHHW}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{n}{hourly\PYGZus{}data}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}MHHW\PYGZus{}cm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{o}{.}\PYG{n}{line}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{label}\PYG{o}{=}\PYG{n}{hourly\PYGZus{}data}\PYG{o}{.}\PYG{n}{station\PYGZus{}name}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}put the legend outside the plot}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{n}{loc}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center left}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{bbox\PYGZus{}to\PYGZus{}anchor}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} set xlimits}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{xlim}\PYG{p}{(}\PYG{p}{[}\PYG{n}{epoch\PYGZus{}start}\PYG{p}{,} \PYG{n}{epoch\PYGZus{}end}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} set title }
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Tide Gauges (1993\PYGZhy{}2023)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}


\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{TS\PYGZus{}full\PYGZus{}fig}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{fig}\PYG{p}{,}\PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{6ec9055158eb0a2d49e237a949a37ebf5555ce3610ffc9a58c4bc9ee11df6205}.png}
\caption{Full time series at the \sphinxcode{\sphinxupquote{'Hawaiian Islands'}} tide gauges for the entire record from \DUrole{pasted-text}{1983\sphinxhyphen{}01\sphinxhyphen{}01} to \DUrole{pasted-text}{2023\sphinxhyphen{}12\sphinxhyphen{}31}. Note that the sea level is plotted in units of cm, relative to \sphinxcode{\sphinxupquote{'MHHW'}}.}\label{\detokenize{notebooks/FloodFrequency:fig-ts-full}}\end{figure}


\section{Adjust the data from calendar year to storm year}
\label{\detokenize{notebooks/FloodFrequency:adjust-the-data-from-calendar-year-to-storm-year}}
\sphinxAtStartPar
Storm year goes from May\sphinxhyphen{}April. Need to consult with Ayesha about this.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}IGNORING FOR NOW, DOES HAWAII DO STORM YEAR?}

\PYG{c+c1}{\PYGZsh{} hourly\PYGZus{}data[\PYGZsq{}day\PYGZsq{}] = ((\PYGZsq{}time\PYGZsq{}), hourly\PYGZus{}data.time.dt.dayofyear.data)}
\PYG{c+c1}{\PYGZsh{} hourly\PYGZus{}data[\PYGZsq{}month\PYGZsq{}] = ((\PYGZsq{}time\PYGZsq{}), hourly\PYGZus{}data.time.dt.month.data)    }
\PYG{c+c1}{\PYGZsh{} hourly\PYGZus{}data[\PYGZsq{}year\PYGZsq{}] = ((\PYGZsq{}time\PYGZsq{}), hourly\PYGZus{}data.time.dt.year.data)}

\PYG{c+c1}{\PYGZsh{} \PYGZsh{} adjust year to storm year, where the storm year starts on May 1st}
\PYG{c+c1}{\PYGZsh{} \PYGZsh{} if the month is less than 5, subtract a year}
\PYG{c+c1}{\PYGZsh{} hourly\PYGZus{}data[\PYGZsq{}year\PYGZus{}storm\PYGZsq{}] = ((\PYGZsq{}time\PYGZsq{}), hourly\PYGZus{}data.year.data \PYGZhy{} (hourly\PYGZus{}data.month.data \PYGZlt{} 5))}

\PYG{c+c1}{\PYGZsh{} hourly\PYGZus{}data[\PYGZsq{}year\PYGZus{}storm\PYGZsq{}] = hourly\PYGZus{}data[\PYGZsq{}year\PYGZus{}storm\PYGZsq{}].astype(int)}

\PYG{c+c1}{\PYGZsh{} hourly\PYGZus{}data[\PYGZsq{}year\PYGZus{}storm\PYGZsq{}].values}

\PYG{c+c1}{\PYGZsh{} \PYGZsh{} get the year\PYGZus{}storm value for April 15, 1997}
\PYG{c+c1}{\PYGZsh{} hourly\PYGZus{}data.sel(time=\PYGZsq{}1997\PYGZhy{}04\PYGZhy{}15\PYGZsq{})}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Assign a Threshold}
\label{\detokenize{notebooks/FloodFrequency:assign-a-threshold}}
\sphinxAtStartPar
The threshold used here to determine a flood event is 30 cm above MHHW.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{threshold} \PYG{o}{=} \PYG{l+m+mi}{30} \PYG{c+c1}{\PYGZsh{} in cm}
\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{threshold}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{threshold}\PYG{p}{,}\PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}

\PYG{n}{hourly\PYGZus{}data}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 60MB
Dimensions:               (time: 359377, record\PYGZus{}id: 8)
Coordinates:
  * time                  (time) datetime64[ns] 3MB 1983\PYGZhy{}01\PYGZhy{}01 ... 2023\PYGZhy{}12\PYGZhy{}31
  * record\PYGZus{}id             (record\PYGZus{}id) int16 16B 520 600 5520 590 570 610 580 500
Data variables: (12/13)
    sea\PYGZus{}level             (record\PYGZus{}id, time) float32 12MB ...
    lat                   (record\PYGZus{}id) float32 32B ...
    lon                   (record\PYGZus{}id) float32 32B ...
    station\PYGZus{}name          (record\PYGZus{}id) \PYGZlt{}U17 544B \PYGZsq{}Johnston\PYGZsq{} ... \PYGZsq{}Midway\PYGZsq{}
    station\PYGZus{}country       (record\PYGZus{}id) \PYGZlt{}U30 960B ...
    station\PYGZus{}country\PYGZus{}code  (record\PYGZus{}id) float32 32B ...
    ...                    ...
    gloss\PYGZus{}id              (record\PYGZus{}id) float32 32B ...
    ssc\PYGZus{}id                (record\PYGZus{}id) \PYGZlt{}U4 128B ...
    last\PYGZus{}rq\PYGZus{}date          (record\PYGZus{}id) datetime64[ns] 64B ...
    MHHW                  (record\PYGZus{}id) float64 64B 1.225e+03 ... 1.204e+03
    sea\PYGZus{}level\PYGZus{}MHHW        (record\PYGZus{}id, time) float64 23MB \PYGZhy{}920.0 \PYGZhy{}764.0 ... \PYGZhy{}36.0
    sea\PYGZus{}level\PYGZus{}MHHW\PYGZus{}cm     (record\PYGZus{}id, time) float64 23MB \PYGZhy{}92.0 \PYGZhy{}76.4 ... \PYGZhy{}3.6
Attributes:
    title:                  UHSLC Fast Delivery Tide Gauge Data (hourly)
    ncei\PYGZus{}template\PYGZus{}version:  NCEI\PYGZus{}NetCDF\PYGZus{}TimeSeries\PYGZus{}Orthogonal\PYGZus{}Template\PYGZus{}v2.0
    featureType:            timeSeries
    Conventions:            CF\PYGZhy{}1.6, ACDD\PYGZhy{}1.3
    date\PYGZus{}created:           2024\PYGZhy{}03\PYGZhy{}07T14:27:49Z
    publisher\PYGZus{}name:         University of Hawaii Sea Level Center (UHSLC)
    publisher\PYGZus{}email:        philiprt@hawaii.edu, markm@soest.hawaii.edu
    publisher\PYGZus{}url:          http://uhslc.soest.hawaii.edu
    summary:                The UHSLC assembles and distributes the Fast Deli...
    processing\PYGZus{}level:       Fast Delivery (FD) data undergo a level 1 quality...
    acknowledgment:         The UHSLC Fast Delivery database is supported by ...
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Assuming year\PYGZus{}storm is created from the \PYGZsq{}time\PYGZsq{} column}
\PYG{n}{hourly\PYGZus{}data}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year\PYGZus{}storm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{hourly\PYGZus{}data}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{dt}\PYG{o}{.}\PYG{n}{year}
\PYG{n}{hourly\PYGZus{}data}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year\PYGZus{}storm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{hourly\PYGZus{}data}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year\PYGZus{}storm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\chapter{Calculate and Plot Flood Frequency}
\label{\detokenize{notebooks/FloodFrequency:calculate-and-plot-flood-frequency}}
\sphinxAtStartPar
To analyze flood frequency, we will look for daily maximum sea levels for each day in our dataset, following Thompson \sphinxstyleemphasis{et al.} {[}\hyperlink{cite.notebooks/FloodFrequency:id4}{TWM+19}{]} and others. Then, we can group our data by year and month to visualize temporal patterns in daily SWL exceedance.

\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{3e14d2e8705329c44d39acd2da7bf7e1fe06c7379c9d15d0eda6439bec527fdd}.png}
\caption{Histogram of daily maximum water levels at the \sphinxcode{\sphinxupquote{'Hawaiian Islands'}} tide gauges for the entire record from \DUrole{pasted-text}{1983\sphinxhyphen{}01\sphinxhyphen{}01} to \DUrole{pasted-text}{2023\sphinxhyphen{}12\sphinxhyphen{}31}, relative to \sphinxcode{\sphinxupquote{'MHHW'}}. The dashed red line indicates the chosen threshold of \DUrole{pasted-text}{30} cm.}\label{\detokenize{notebooks/FloodFrequency:fig-histogram}}
\begin{sphinxlegend}
\sphinxAtStartPar
s
\end{sphinxlegend}
\end{figure}

\begin{sphinxShadowBox}
\sphinxstylesidebartitle{}

\sphinxAtStartPar
Note this next code block takes a bit of time. Patience!
\end{sphinxShadowBox}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Resample the hourly data to daily maximum sea level}
\PYG{n}{SL\PYGZus{}daily\PYGZus{}max} \PYG{o}{=} \PYG{n}{hourly\PYGZus{}data}\PYG{o}{.}\PYG{n}{resample}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{D}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{SL\PYGZus{}daily\PYGZus{}max}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 31MB
Dimensions:               (record\PYGZus{}id: 8, time: 14975)
Coordinates:
  * record\PYGZus{}id             (record\PYGZus{}id) int16 16B 520 600 5520 590 570 610 580 500
  * time                  (time) datetime64[ns] 120kB 1983\PYGZhy{}01\PYGZhy{}01 ... 2023\PYGZhy{}12\PYGZhy{}31
Data variables: (12/14)
    sea\PYGZus{}level             (time, record\PYGZus{}id) float32 479kB 1.228e+03 ... 1.168...
    lat                   (time, record\PYGZus{}id) float32 479kB 16.75 19.73 ... 28.22
    lon                   (time, record\PYGZus{}id) float32 479kB 190.5 204.9 ... 182.6
    station\PYGZus{}name          (time, record\PYGZus{}id) \PYGZlt{}U17 8MB \PYGZsq{}Johnston\PYGZsq{} ... \PYGZsq{}Midway\PYGZsq{}
    station\PYGZus{}country       (time, record\PYGZus{}id) \PYGZlt{}U30 14MB \PYGZsq{}United States of Ameri...
    station\PYGZus{}country\PYGZus{}code  (time, record\PYGZus{}id) float32 479kB 840.0 840.0 ... 840.0
    ...                    ...
    ssc\PYGZus{}id                (time, record\PYGZus{}id) \PYGZlt{}U4 2MB \PYGZsq{}john\PYGZsq{} \PYGZsq{}hilo\PYGZsq{} ... \PYGZsq{}midx\PYGZsq{}
    last\PYGZus{}rq\PYGZus{}date          (time, record\PYGZus{}id) datetime64[ns] 958kB 2018\PYGZhy{}12\PYGZhy{}31T2...
    MHHW                  (time, record\PYGZus{}id) float64 958kB 1.225e+03 ... 1.204...
    sea\PYGZus{}level\PYGZus{}MHHW        (time, record\PYGZus{}id) float64 958kB 3.0 307.0 ... \PYGZhy{}36.0
    sea\PYGZus{}level\PYGZus{}MHHW\PYGZus{}cm     (time, record\PYGZus{}id) float64 958kB 0.3 30.7 ... \PYGZhy{}3.6
    year\PYGZus{}storm            (time) int64 120kB 1983 1983 1983 ... 2023 2023 2023
Attributes:
    title:                  UHSLC Fast Delivery Tide Gauge Data (hourly)
    ncei\PYGZus{}template\PYGZus{}version:  NCEI\PYGZus{}NetCDF\PYGZus{}TimeSeries\PYGZus{}Orthogonal\PYGZus{}Template\PYGZus{}v2.0
    featureType:            timeSeries
    Conventions:            CF\PYGZhy{}1.6, ACDD\PYGZhy{}1.3
    date\PYGZus{}created:           2024\PYGZhy{}03\PYGZhy{}07T14:27:49Z
    publisher\PYGZus{}name:         University of Hawaii Sea Level Center (UHSLC)
    publisher\PYGZus{}email:        philiprt@hawaii.edu, markm@soest.hawaii.edu
    publisher\PYGZus{}url:          http://uhslc.soest.hawaii.edu
    summary:                The UHSLC assembles and distributes the Fast Deli...
    processing\PYGZus{}level:       Fast Delivery (FD) data undergo a level 1 quality...
    acknowledgment:         The UHSLC Fast Delivery database is supported by ...
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} make a new figure that is 15 x 5}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{n}{sharex}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{SL\PYGZus{}daily\PYGZus{}max}\PYG{o}{.}\PYG{n}{time}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{SL\PYGZus{}daily\PYGZus{}max}\PYG{o}{.}\PYG{n}{sea\PYGZus{}level\PYGZus{}MHHW}\PYG{o}{.}\PYG{n}{values}\PYG{o}{/}\PYG{l+m+mi}{10}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date (Calendar Year)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level (cm)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level Daily Maximum Time Series}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} \PYGZsh{} add a horizontal line at the threshold}
\PYG{c+c1}{\PYGZsh{} plt.axhline(threshold, color=\PYGZsq{}r\PYGZsq{}, linestyle=\PYGZsq{}\PYGZhy{}\PYGZhy{}\PYGZsq{}, label=\PYGZsq{}Threshold\PYGZsq{})}


\PYG{c+c1}{\PYGZsh{} \PYGZsh{} Correcting the threshold to find days when sea\PYGZus{}level\PYGZus{}MHHW is greater than 300 mm}
\PYG{c+c1}{\PYGZsh{} days\PYGZus{}above\PYGZus{}threshold = SL\PYGZus{}daily\PYGZus{}max.where(SL\PYGZus{}daily\PYGZus{}max.sea\PYGZus{}level\PYGZus{}MHHW/10 \PYGZgt{} threshold, drop=True)}

\PYG{c+c1}{\PYGZsh{} \PYGZsh{} Highlighting the days above the threshold for each record\PYGZus{}id}
\PYG{c+c1}{\PYGZsh{} for record\PYGZus{}id in days\PYGZus{}above\PYGZus{}threshold.record\PYGZus{}id.values:}
\PYG{c+c1}{\PYGZsh{}     above\PYGZus{}threshold\PYGZus{}per\PYGZus{}record = days\PYGZus{}above\PYGZus{}threshold.sea\PYGZus{}level\PYGZus{}MHHW.sel(record\PYGZus{}id=record\PYGZus{}id)}
\PYG{c+c1}{\PYGZsh{}     ax.scatter(above\PYGZus{}threshold\PYGZus{}per\PYGZus{}record.time.values, above\PYGZus{}threshold\PYGZus{}per\PYGZus{}record.values / 10)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Text(0.5, 1.0, \PYGZsq{}Sea Level Daily Maximum Time Series\PYGZsq{})
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{8a5e46df7183c908bc349ac491df6fbe160d72c2690a609f9b0ca9dfa4827ac7}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}cm} \PYG{o}{=} \PYG{n}{hourly\PYGZus{}data}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{o}{/}\PYG{l+m+mi}{10} \PYG{c+c1}{\PYGZsh{} convert to cm}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{8}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{sharex}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{)}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{ax} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{axs}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{hist}\PYG{p}{(}\PYG{n}{hourly\PYGZus{}data}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}MHHW\PYGZus{}cm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,}\PYG{p}{:}\PYG{p}{]}\PYG{p}{,} \PYG{n}{bins}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,} \PYG{n}{density}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level Data}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{axvline}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{nanpercentile}\PYG{p}{(}\PYG{n}{hourly\PYGZus{}data}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}MHHW\PYGZus{}cm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,}\PYG{p}{:}\PYG{p}{]}\PYG{p}{,} \PYG{l+m+mi}{99}\PYG{p}{)}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{linestyle}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{dashed}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{97.5th Percentile}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} remove y\PYGZhy{}axis label for all}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}yticklabels}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{axs}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level (cm)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots\PYGZus{}adjust}\PYG{p}{(}\PYG{n}{hspace}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} set xlim to \PYGZhy{}150,75}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{xlim}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{100}\PYG{p}{,}\PYG{l+m+mi}{50}\PYG{p}{)}

\PYG{n}{threshold\PYGZus{}percentile} \PYG{o}{=} \PYG{l+m+mi}{99}
\PYG{c+c1}{\PYGZsh{}make threshold for (XX))th percentile on each gauge}
\PYG{n}{thresholds} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{nanpercentile}\PYG{p}{(}\PYG{n}{hourly\PYGZus{}data}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}MHHW\PYGZus{}cm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{threshold\PYGZus{}percentile}\PYG{p}{,} \PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{threshold\PYGZus{}percentile}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{threshold\PYGZus{}percentile}\PYG{p}{,}\PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{6c44b4673f68373330ba71d0af80a7f3e6beed5f7e99b083cbc37590a9284666}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{thresholds}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
array([18.3, 20.6, 27.7, 23.7, 19.5, 18.3, 19.5, 20.8])
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Make a pdf of the data with 95th percentile threshold}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{8}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{sharex}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{ax} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{axs}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{hist}\PYG{p}{(}\PYG{n}{hourly\PYGZus{}data}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}MHHW\PYGZus{}cm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{[}\PYG{n}{i}\PYG{p}{,}\PYG{p}{:}\PYG{p}{]}\PYG{p}{,} \PYG{n}{bins}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,} \PYG{n}{density}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level Data}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{axvline}\PYG{p}{(}\PYG{n}{threshold}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{linestyle}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Threshold: }\PYG{l+s+si}{\PYGZob{}:.4f\PYGZcb{}}\PYG{l+s+s1}{ cm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{threshold}\PYG{p}{)}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} remove y\PYGZhy{}axis label for all}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}yticklabels}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{axs}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level (cm)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots\PYGZus{}adjust}\PYG{p}{(}\PYG{n}{hspace}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}


\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level (cm)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Probability Density}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} make the title two lines}
\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level Histogram}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{with Defined Threshold}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add label to dashed line}
\PYG{c+c1}{\PYGZsh{} get value of middle of y\PYGZhy{}axis for label placement}
\PYG{n}{ymin}\PYG{p}{,} \PYG{n}{ymax} \PYG{o}{=} \PYG{n}{ax}\PYG{o}{.}\PYG{n}{get\PYGZus{}ylim}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{yrange} \PYG{o}{=} \PYG{n}{ymax} \PYG{o}{\PYGZhy{}} \PYG{n}{ymin}
\PYG{n}{y\PYGZus{}middle} \PYG{o}{=} \PYG{n}{ymin} \PYG{o}{+} \PYG{n}{yrange}\PYG{o}{/}\PYG{l+m+mi}{2}

\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{n}{threshold}\PYG{p}{,} \PYG{n}{y\PYGZus{}middle}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}:.1f\PYGZcb{}}\PYG{l+s+s1}{ cm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{n}{threshold}\PYG{p}{)}\PYG{p}{,} \PYG{n}{rotation}\PYG{o}{=}\PYG{l+m+mi}{90}\PYG{p}{,} \PYG{n}{va}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ha}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{left}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{histogram\PYGZus{}fig}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{fig}\PYG{p}{,} \PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{flood\PYGZus{}day} \PYG{o}{=} \PYG{p}{(}\PYG{n}{SL\PYGZus{}daily\PYGZus{}max}\PYG{o}{.}\PYG{n}{sea\PYGZus{}level\PYGZus{}MHHW\PYGZus{}cm}\PYG{o}{.}\PYG{n}{values} \PYG{o}{\PYGZgt{}} \PYG{n}{thresholds}\PYG{p}{)}
\PYG{n}{SL\PYGZus{}daily\PYGZus{}max}

\PYG{n}{flood\PYGZus{}hour} \PYG{o}{=} \PYG{p}{(}\PYG{n}{hourly\PYGZus{}data}\PYG{o}{.}\PYG{n}{sea\PYGZus{}level\PYGZus{}MHHW\PYGZus{}cm}\PYG{o}{.}\PYG{n}{values} \PYG{o}{\PYGZgt{}} \PYG{n}{thresholds}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{k+kc}{None}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{flood\PYGZus{}hour}

\PYG{c+c1}{\PYGZsh{} flip the array so that the first dimension is time}
\PYG{n}{flood\PYGZus{}hour} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{transpose}\PYG{p}{(}\PYG{n}{flood\PYGZus{}hour}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Add the \PYGZsq{}flood\PYGZus{}day\PYGZsq{} variable to the dataset}
\PYG{n}{SL\PYGZus{}daily\PYGZus{}max}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{flood\PYGZus{}day}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{p}{(}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{flood\PYGZus{}day}\PYG{o}{.}\PYG{n}{data}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Filtering for flood days again now that \PYGZsq{}flood\PYGZus{}day\PYGZsq{} has been correctly added}
\PYG{n}{flood\PYGZus{}days\PYGZus{}data} \PYG{o}{=} \PYG{n}{SL\PYGZus{}daily\PYGZus{}max}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{SL\PYGZus{}daily\PYGZus{}max}\PYG{o}{.}\PYG{n}{flood\PYGZus{}day}\PYG{p}{,} \PYG{n}{drop}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Initialize an empty DataFrame again for the loop}
\PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{record\PYGZus{}id} \PYG{o+ow}{in} \PYG{n}{SL\PYGZus{}daily\PYGZus{}max}\PYG{o}{.}\PYG{n}{record\PYGZus{}id}\PYG{o}{.}\PYG{n}{values}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Extracting flood days for each record\PYGZus{}id}
    \PYG{n}{flood\PYGZus{}days\PYGZus{}df} \PYG{o}{=} \PYG{n}{flood\PYGZus{}days\PYGZus{}data}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{record\PYGZus{}id}\PYG{p}{)}\PYG{o}{.}\PYG{n}{dropna}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{all}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}dataframe}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{reset\PYGZus{}index}\PYG{p}{(}\PYG{p}{)}
    
    \PYG{c+c1}{\PYGZsh{} Extract year from the \PYGZsq{}time\PYGZsq{} column and count flood days}
    \PYG{n}{flood\PYGZus{}days\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{flood\PYGZus{}days\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{dt}\PYG{o}{.}\PYG{n}{year}
    \PYG{n}{flood\PYGZus{}days\PYGZus{}count} \PYG{o}{=} \PYG{n}{flood\PYGZus{}days\PYGZus{}df}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{size}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{reset\PYGZus{}index}\PYG{p}{(}\PYG{n}{name}\PYG{o}{=}\PYG{n}{record\PYGZus{}id}\PYG{p}{)}
    
    \PYG{c+c1}{\PYGZsh{} Merge this count with the main DataFrame}
    \PYG{k}{if} \PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{empty}\PYG{p}{:}
        \PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year} \PYG{o}{=} \PYG{n}{flood\PYGZus{}days\PYGZus{}count}\PYG{o}{.}\PYG{n}{set\PYGZus{}index}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year} \PYG{o}{=} \PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{flood\PYGZus{}days\PYGZus{}count}\PYG{o}{.}\PYG{n}{set\PYGZus{}index}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{outer}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Replace missing values with 0}
\PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{fillna}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{inplace}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
\PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{DataArray}\PYG{p}{(}\PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{dims}\PYG{o}{=}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{coords}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{columns}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.DataArray (year: 41, record\PYGZus{}id: 8)\PYGZgt{} Size: 3kB
array([[ 37.,  30.,   0.,  19.,  13.,  16.,  19.,   9.],
       [ 36.,  40.,   0.,  41.,  61.,  51.,  43.,  13.],
       [ 14.,  14.,   0.,  27.,  25.,  24.,  48.,   5.],
       [ 15.,  11.,   0.,   4.,   5.,   3.,   6.,  16.],
       [ 12.,  33.,   0.,  27.,  17.,  13.,   6.,  12.],
       [ 53.,  32.,   0.,  77.,  61.,  59.,  51.,   7.],
       [ 22.,  17.,   3.,   9.,  19.,  20.,  21.,   6.],
       [ 12.,   6.,   1.,   7.,   3.,  10.,  21.,   4.],
       [ 11.,  23.,   3.,  21.,  23.,   8.,  24.,   2.],
       [ 33.,  38.,   0.,  42.,  30.,  37.,  29.,   8.],
       [ 19.,  39.,   3.,  28.,   8.,  17.,  25.,  11.],
       [ 24.,   4.,   0.,  16.,  15.,   9.,  13.,   2.],
       [ 31.,  14.,   2.,  35.,  42.,  35.,  25.,  13.],
       [ 49.,  43.,   3.,  47.,  34.,  34.,  36.,   8.],
       [ 21.,  29.,   1.,  16.,  11.,  14.,  12.,   4.],
       [ 30.,   9.,   0.,   5.,   1.,   4.,   0.,  29.],
       [ 22.,  15.,   4.,  16.,  11.,   8.,  11.,   8.],
       [  4.,   3.,   0.,  13.,   7.,   7.,   6.,  14.],
       [ 44.,  29.,  10.,  33.,  19.,  25.,   7.,  10.],
       [ 27.,  22.,   0.,  15.,   7.,   6.,  10.,   9.],
...
       [ 23.,  91.,  33.,  87.,  76.,  85.,  37.,  27.],
       [  0.,  53.,  13.,  61.,  43.,  42.,  31.,  16.],
       [  0.,  46.,  31.,  79.,  67.,  73.,  63.,  10.],
       [  0.,  45.,  56.,  49.,  43.,  57.,  30.,  12.],
       [ 25.,  36.,  53.,  42.,  44.,  37.,  43.,  18.],
       [  4.,  30.,  30.,  21.,  13.,  15.,  11.,  28.],
       [ 54.,  38.,  48.,  41.,  31.,  38.,  29.,  38.],
       [ 63.,  20.,  32.,  32.,  17.,  21.,  21.,  11.],
       [ 31.,   7.,  12.,  11.,   8.,   8.,  16.,  69.],
       [ 41.,  18.,  30.,  29.,  14.,  17.,  35.,  35.],
       [ 20.,  49.,  49.,  47.,  29.,  35.,  46.,  44.],
       [ 32.,  46.,  63.,  42.,  12.,  15.,  35.,  20.],
       [ 69.,  72.,  82.,  69.,  66.,  62.,  73.,   7.],
       [ 84., 129., 144., 122., 118., 130., 112.,  31.],
       [ 31.,  80.,  92.,  60.,  52.,  50.,  46.,  31.],
       [ 36.,  98., 123.,  84.,  81.,  72.,  73.,  39.],
       [ 47., 140., 163., 147., 173., 155.,  98.,   8.],
       [ 58.,  52.,  45.,  53.,  74.,  54.,  67.,  46.],
       [ 32.,  43.,  15.,  51.,  44.,  31.,  62.,  55.],
       [ 67.,  72.,  54.,  77.,  69.,  72., 126.,  58.]])
Coordinates:
  * year       (year) int32 164B 1983 1984 1985 1986 ... 2020 2021 2022 2023
  * record\PYGZus{}id  (record\PYGZus{}id) int64 64B 520 600 5520 590 570 610 580 500
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Add the \PYGZsq{}flood\PYGZus{}day\PYGZsq{} variable to the dataset}
\PYG{n}{hourly\PYGZus{}data}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{flood\PYGZus{}hour}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{p}{(}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{flood\PYGZus{}hour}\PYG{o}{.}\PYG{n}{data}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Filtering for flood days again now that \PYGZsq{}flood\PYGZus{}hour\PYGZsq{} has been correctly added}
\PYG{n}{flood\PYGZus{}hours\PYGZus{}data} \PYG{o}{=} \PYG{n}{hourly\PYGZus{}data}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{hourly\PYGZus{}data}\PYG{o}{.}\PYG{n}{flood\PYGZus{}hour}\PYG{p}{,} \PYG{n}{drop}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Initialize an empty DataFrame again for the loop}
\PYG{n}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{)}
\PYG{k}{for} \PYG{n}{record\PYGZus{}id} \PYG{o+ow}{in} \PYG{n}{hourly\PYGZus{}data}\PYG{o}{.}\PYG{n}{record\PYGZus{}id}\PYG{o}{.}\PYG{n}{values}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Extracting flood days for each record\PYGZus{}id}
    \PYG{n}{flood\PYGZus{}hours\PYGZus{}df} \PYG{o}{=} \PYG{n}{flood\PYGZus{}hours\PYGZus{}data}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{record\PYGZus{}id}\PYG{p}{)}\PYG{o}{.}\PYG{n}{dropna}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{all}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}dataframe}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{reset\PYGZus{}index}\PYG{p}{(}\PYG{p}{)}
  
    \PYG{c+c1}{\PYGZsh{} Extract year from the \PYGZsq{}time\PYGZsq{} column and count flood days}
    \PYG{n}{flood\PYGZus{}hours\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{flood\PYGZus{}hours\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{dt}\PYG{o}{.}\PYG{n}{year}
    \PYG{n}{flood\PYGZus{}hours\PYGZus{}count} \PYG{o}{=} \PYG{n}{flood\PYGZus{}hours\PYGZus{}df}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{size}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{reset\PYGZus{}index}\PYG{p}{(}\PYG{n}{name}\PYG{o}{=}\PYG{n}{record\PYGZus{}id}\PYG{p}{)}
  
    \PYG{c+c1}{\PYGZsh{} Merge this count with the main DataFrame}
    \PYG{k}{if} \PYG{n}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{empty}\PYG{p}{:}
        \PYG{n}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year} \PYG{o}{=} \PYG{n}{flood\PYGZus{}hours\PYGZus{}count}\PYG{o}{.}\PYG{n}{set\PYGZus{}index}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year} \PYG{o}{=} \PYG{n}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{flood\PYGZus{}hours\PYGZus{}count}\PYG{o}{.}\PYG{n}{set\PYGZus{}index}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{outer}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Replace missing values with 0}
\PYG{n}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{fillna}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{inplace}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
\PYG{n}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{DataArray}\PYG{p}{(}\PYG{n}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{dims}\PYG{o}{=}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{coords}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{columns}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}make new xarray dataset with attributes from SL\PYGZus{}daily\PYGZus{}max}
\PYG{n}{ds} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{Dataset}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{p}{(}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}

\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{p}{(}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}

\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Number of flood days per year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{days}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Number of flood hours per year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{hours}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}

\PYG{c+c1}{\PYGZsh{} set year and record\PYGZus{}id as coordinates}
\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{year}
\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{record\PYGZus{}id}

\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{calendar year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}
\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Record ID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}


\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{SL\PYGZus{}daily\PYGZus{}max}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}
\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{degrees\PYGZus{}north}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}

\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{SL\PYGZus{}daily\PYGZus{}max}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}
\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{degrees\PYGZus{}east}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}

\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{SL\PYGZus{}daily\PYGZus{}max}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}
\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Station Name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}

\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}country}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{SL\PYGZus{}daily\PYGZus{}max}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}country}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}
\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}country}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Station Country}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}

\PYG{c+c1}{\PYGZsh{}remove time as coordinate}
\PYG{n}{ds} \PYG{o}{=} \PYG{n}{ds}\PYG{o}{.}\PYG{n}{reset\PYGZus{}coords}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{drop}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{ds}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 7kB
Dimensions:               (year: 41, record\PYGZus{}id: 8)
Coordinates:
  * year                  (year) int32 164B 1983 1984 1985 ... 2021 2022 2023
  * record\PYGZus{}id             (record\PYGZus{}id) int16 16B 520 600 5520 590 570 610 580 500
Data variables:
    flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year  (year, record\PYGZus{}id) float64 3kB 71.0 56.0 ... 221.0
    flood\PYGZus{}days\PYGZus{}per\PYGZus{}year   (year, record\PYGZus{}id) float64 3kB 37.0 30.0 ... 126.0 58.0
    lat                   (record\PYGZus{}id) float32 32B 16.75 19.73 ... 21.97 28.22
    lon                   (record\PYGZus{}id) float32 32B 190.5 204.9 ... 200.6 182.6
    station\PYGZus{}name          (record\PYGZus{}id) \PYGZlt{}U17 544B \PYGZsq{}Johnston\PYGZsq{} ... \PYGZsq{}Midway\PYGZsq{}
    station\PYGZus{}country       (record\PYGZus{}id) \PYGZlt{}U30 960B \PYGZsq{}United States of America (th...
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}find minimum value in flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}
\PYG{n}{min\PYGZus{}flood\PYGZus{}days} \PYG{o}{=} \PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{max\PYGZus{}flood\PYGZus{}days} \PYG{o}{=} \PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Plot Flood Frequency Counts}
\label{\detokenize{notebooks/FloodFrequency:plot-flood-frequency-counts}}
\sphinxAtStartPar
The flood frequency counts are defined as the number of time periods that exceed a given threshold within a year. This plot follows Sweet \sphinxstyleemphasis{et al.} {[}\hyperlink{cite.notebooks/FloodFrequency:id5}{SPM+14}{]}.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Adjusting the heatmap palette to improve readability}
\PYG{n}{adjusted\PYGZus{}heatmap\PYGZus{}palette} \PYG{o}{=} \PYG{n}{sns}\PYG{o}{.}\PYG{n}{color\PYGZus{}palette}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{YlOrRd}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{as\PYGZus{}cmap}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
\PYG{n}{norm} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{Normalize}\PYG{p}{(}\PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{colors} \PYG{o}{=} \PYG{p}{[}\PYG{n}{adjusted\PYGZus{}heatmap\PYGZus{}palette}\PYG{p}{(}\PYG{n}{norm}\PYG{p}{(}\PYG{n}{value}\PYG{p}{)}\PYG{p}{)} \PYG{k}{for} \PYG{n}{value} \PYG{o+ow}{in} \PYG{n}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{values}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{} do a pcolormesh plot}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{pcolormesh}\PYG{p}{(}\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{flood\PYGZus{}days\PYGZus{}per\PYGZus{}year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{T}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{adjusted\PYGZus{}heatmap\PYGZus{}palette}\PYG{p}{,} \PYG{n}{norm}\PYG{o}{=}\PYG{n}{norm}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add a colorbar}
\PYG{n}{cax} \PYG{o}{=} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}axes}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.92}\PYG{p}{,} \PYG{l+m+mf}{0.15}\PYG{p}{,} \PYG{l+m+mf}{0.02}\PYG{p}{,} \PYG{l+m+mf}{0.7}\PYG{p}{]}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} adjust the position and size of the colorbar}
\PYG{n}{sm} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{ScalarMappable}\PYG{p}{(}\PYG{n}{cmap}\PYG{o}{=}\PYG{n}{adjusted\PYGZus{}heatmap\PYGZus{}palette}\PYG{p}{,} \PYG{n}{norm}\PYG{o}{=}\PYG{n}{norm}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{colorbar}\PYG{p}{(}\PYG{n}{sm}\PYG{p}{,} \PYG{n}{cax}\PYG{o}{=}\PYG{n}{cax}\PYG{p}{,}\PYG{n}{label}\PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Number of Flood Days}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Number of Flood Days Per Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}             

\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{threshold\PYGZus{}counts\PYGZus{}days\PYGZus{}fig}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{fig}\PYG{p}{,} \PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save the figure}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{savefig}\PYG{p}{(}\PYG{n}{output\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SL\PYGZus{}FloodFrequency\PYGZus{}threshold\PYGZus{}counts\PYGZus{}days.png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{bbox\PYGZus{}inches}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tight}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{d4d9009f81887fbb93bf22c8fa0e3cd3567be58f76b5e9313d693212f257ad45}.png}
\caption{Flood frequency counts above \DUrole{pasted-text}{99.000}th percentile threshold per year at \sphinxcode{\sphinxupquote{'Hawaiian Islands'}} tide gauges from \DUrole{pasted-text}{1983\sphinxhyphen{}01\sphinxhyphen{}01} to \DUrole{pasted-text}{2023\sphinxhyphen{}12\sphinxhyphen{}31}.}\label{\detokenize{notebooks/FloodFrequency:fig-threshold-counts}}\end{figure}


\section{Plot Flood Duration}
\label{\detokenize{notebooks/FloodFrequency:plot-flood-duration}}
\sphinxAtStartPar
This next plot examines the average duration of flooding events as defined by the threshold.
I have a few issues with this plot being “duration,” as it’s just counts of hours above the threshold. These hours need not be continuous…which to me is what duration is all about. Anyway, we carry on.

\begin{sphinxShadowBox}
\sphinxstylesidebartitle{}

\sphinxAtStartPar
There are some dissimilarities here that give me pause. Going to look into it.
\end{sphinxShadowBox}

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Adjusting the heatmap palette to improve readability}
\PYG{n}{adjusted\PYGZus{}heatmap\PYGZus{}palette} \PYG{o}{=} \PYG{n}{sns}\PYG{o}{.}\PYG{n}{color\PYGZus{}palette}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{YlOrRd}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{as\PYGZus{}cmap}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
\PYG{n}{norm} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{Normalize}\PYG{p}{(}\PYG{n}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{colors} \PYG{o}{=} \PYG{p}{[}\PYG{n}{adjusted\PYGZus{}heatmap\PYGZus{}palette}\PYG{p}{(}\PYG{n}{norm}\PYG{p}{(}\PYG{n}{value}\PYG{p}{)}\PYG{p}{)} \PYG{k}{for} \PYG{n}{value} \PYG{o+ow}{in} \PYG{n}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year}\PYG{o}{.}\PYG{n}{values}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{} do a pcolormesh plot}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{pcolormesh}\PYG{p}{(}\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{T}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{adjusted\PYGZus{}heatmap\PYGZus{}palette}\PYG{p}{,} \PYG{n}{norm}\PYG{o}{=}\PYG{n}{norm}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add a colorbar}
\PYG{n}{cax} \PYG{o}{=} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}axes}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.92}\PYG{p}{,} \PYG{l+m+mf}{0.15}\PYG{p}{,} \PYG{l+m+mf}{0.02}\PYG{p}{,} \PYG{l+m+mf}{0.7}\PYG{p}{]}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} adjust the position and size of the colorbar}
\PYG{n}{sm} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{cm}\PYG{o}{.}\PYG{n}{ScalarMappable}\PYG{p}{(}\PYG{n}{cmap}\PYG{o}{=}\PYG{n}{adjusted\PYGZus{}heatmap\PYGZus{}palette}\PYG{p}{,} \PYG{n}{norm}\PYG{o}{=}\PYG{n}{norm}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{colorbar}\PYG{p}{(}\PYG{n}{sm}\PYG{p}{,} \PYG{n}{cax}\PYG{o}{=}\PYG{n}{cax}\PYG{p}{,}\PYG{n}{label}\PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Number of Flood Hours}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Number of Flood Hours Per Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}             
\PYG{c+c1}{\PYGZsh{} ax.set\PYGZus{}yticklabels(SL\PYGZus{}daily\PYGZus{}max[\PYGZsq{}station\PYGZus{}name\PYGZsq{}].values[0])}

\PYG{c+c1}{\PYGZsh{} save the figure}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{savefig}\PYG{p}{(}\PYG{n}{output\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SL\PYGZus{}FloodFrequency\PYGZus{}threshold\PYGZus{}counts\PYGZus{}hours.png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{bbox\PYGZus{}inches}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tight}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}



\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{duration\PYGZus{}fig}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{fig}\PYG{p}{,} \PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{240f88f9b04efe9686c3a0fd3aa59d45f2f0490ec1c8cc41659c348183b1155e}.png}
\caption{Average flood duration in hours above a threshold of \DUrole{pasted-text}{30} cm per year for \sphinxcode{\sphinxupquote{'Hawaiian Islands'}} region tide gauges from \DUrole{pasted-text}{1983\sphinxhyphen{}01\sphinxhyphen{}01} to \DUrole{pasted-text}{2023\sphinxhyphen{}12\sphinxhyphen{}31}.}\label{\detokenize{notebooks/FloodFrequency:fig-duration}}\end{figure}


\chapter{Calculate the percent change over time}
\label{\detokenize{notebooks/FloodFrequency:calculate-the-percent-change-over-time}}
\sphinxAtStartPar
Next we’ll calculate the percent change over the POR at the tide station/s, for both Frequency and Duration.

\sphinxAtStartPar
The next code cell fits a trend line to the flood days per year data and calculates the trend line.
It then plots the data and the trend line in a figure, and calculates the percent change in flood days per year using the trend line. The same process is repeated for flood hours per year.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 13kB
Dimensions:               (year: 41, record\PYGZus{}id: 8)
Coordinates:
  * year                  (year) int32 164B 1983 1984 1985 ... 2021 2022 2023
  * record\PYGZus{}id             (record\PYGZus{}id) int16 16B 520 600 5520 590 570 610 580 500
Data variables: (12/14)
    flood\PYGZus{}hours\PYGZus{}per\PYGZus{}year  (year, record\PYGZus{}id) float64 3kB 71.0 56.0 ... 221.0
    flood\PYGZus{}days\PYGZus{}per\PYGZus{}year   (year, record\PYGZus{}id) float64 3kB 37.0 30.0 ... 126.0 58.0
    lat                   (record\PYGZus{}id) float32 32B 16.75 19.73 ... 21.97 28.22
    lon                   (record\PYGZus{}id) float32 32B 190.5 204.9 ... 200.6 182.6
    station\PYGZus{}name          (record\PYGZus{}id) \PYGZlt{}U17 544B \PYGZsq{}Johnston\PYGZsq{} ... \PYGZsq{}Midway\PYGZsq{}
    station\PYGZus{}country       (record\PYGZus{}id) \PYGZlt{}U30 960B \PYGZsq{}United States of America (th...
    ...                    ...
    percent\PYGZus{}change\PYGZus{}days   (record\PYGZus{}id) float64 64B 151.8 567.1 ... 2.452e+03
    trend\PYGZus{}days            (year, record\PYGZus{}id) float64 3kB 17.85 10.68 ... 38.68
    slope\PYGZus{}hours           (record\PYGZus{}id) float64 64B 2.194 3.795 ... 3.883 3.555
    intercept\PYGZus{}hours       (record\PYGZus{}id) float64 64B \PYGZhy{}4.318e+03 ... \PYGZhy{}7.035e+03
    percent\PYGZus{}change\PYGZus{}hours  (record\PYGZus{}id) float64 64B 278.6 1.368e+03 ... 953.2
    trend\PYGZus{}hours           (year, record\PYGZus{}id) float64 3kB 31.49 11.09 ... 157.1
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\end{sphinxuseclass}

\section{Plot time series of all stations}
\label{\detokenize{notebooks/FloodFrequency:plot-time-series-of-all-stations}}
\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{de5f2061f3a74ce36308361833a04f4b6af29f5fa74c47b7ab68391bef0f1049}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\end{sphinxuseclass}

\section{Create a Table}
\label{\detokenize{notebooks/FloodFrequency:create-a-table}}
\sphinxAtStartPar
Now we’ll generate a table with this information, which will be saved as a .csv in the output directory specified at the top of this notebook.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} make a dataframe with the percent change in flood days and hours per year, with given threshold}
\PYG{n}{percent\PYGZus{}change\PYGZus{}df} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{percent\PYGZus{}change\PYGZus{}days}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{percent\PYGZus{}change\PYGZus{}days}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{percent\PYGZus{}change\PYGZus{}hours}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{percent\PYGZus{}change\PYGZus{}hours}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{threshold}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{thresholds}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add the station name and country}
\PYG{n}{percent\PYGZus{}change\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}
\PYG{n}{percent\PYGZus{}change\PYGZus{}df}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{country}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}country}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}

\PYG{c+c1}{\PYGZsh{} reorder the columns}
\PYG{n}{percent\PYGZus{}change\PYGZus{}df} \PYG{o}{=} \PYG{n}{percent\PYGZus{}change\PYGZus{}df}\PYG{p}{[}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{country}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{threshold}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{percent\PYGZus{}change\PYGZus{}days}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{percent\PYGZus{}change\PYGZus{}hours}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{} Define your attributes}
\PYG{n}{attributes} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Station name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{country}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Country name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{threshold}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Threshold in cm above MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{percent\PYGZus{}change\PYGZus{}days}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Percent change in flood days per year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{percent\PYGZus{}change\PYGZus{}hours}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Percent change in flood hours per year}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{p}{\PYGZcb{}}

\PYG{c+c1}{\PYGZsh{} Open the file in write mode}
\PYG{k}{with} \PYG{n+nb}{open}\PYG{p}{(}\PYG{n}{output\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SL\PYGZus{}FloodFrequency\PYGZus{}percent\PYGZus{}change.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{w}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{k}{as} \PYG{n}{f}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Write the attributes as comments}
    \PYG{k}{for} \PYG{n}{column}\PYG{p}{,} \PYG{n}{attribute} \PYG{o+ow}{in} \PYG{n}{attributes}\PYG{o}{.}\PYG{n}{items}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{f}\PYG{o}{.}\PYG{n}{write}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{} }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{column}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{attribute}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Write the DataFrame to the file}
    \PYG{n}{percent\PYGZus{}change\PYGZus{}df}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{n}{f}\PYG{p}{,} \PYG{n}{index}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}

\PYG{n}{percent\PYGZus{}change\PYGZus{}df}  
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
            station                         country  threshold  \PYGZbs{}
0          Johnston  United States of America (the)       18.3   
1      Hilo, Hawaii  United States of America (the)       20.6   
2          Kawaihae  United States of America (the)       27.7   
3           Kahului  United States of America (the)       23.7   
4  Honolulu, Hawaii  United States of America (the)       19.5   
5          Mokuoloe  United States of America (the)       18.3   
6        Nawiliwili  United States of America (the)       19.5   
7            Midway  United States of America (the)       20.8   

   percent\PYGZus{}change\PYGZus{}days  percent\PYGZus{}change\PYGZus{}hours  
0           151.776650            278.592765  
1           567.123288           1368.404523  
2          7926.132404          19354.355401  
3           371.584451            764.890525  
4           503.115067           1153.753754  
5           439.929947            976.160843  
6           665.054414           1832.387998  
7          2451.954023            953.152732  
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\chapter{Create a map}
\label{\detokenize{notebooks/FloodFrequency:create-a-map}}
\sphinxAtStartPar
In this next section we’ll create a map with an icon depicting the percent change over the Period of Record at the tide station/s, for both Frequency and Duration.

\sphinxAtStartPar
The following cell defines a function that creates a “zebra stripe” pattern for the map borders.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
The following cell defines a function to implement the zebra stripes on a given axis.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
The following cell defines a function to add arrow icons denoting percent change.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
And here is our final plotting code:

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}
\begin{sphinxuseclass}{tag_hide-input}
\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{5d2ced76e312a8e6cb97ad2a1dde49cdbabb48c4c3dfc88194d18fa1f56665b3}.png}
\caption{Map of the rate of change in average flood (a) days and (b) hours per year above the \DUrole{pasted-text}{99.000}th threshold of water levels at at \sphinxcode{\sphinxupquote{'Hawaiian Islands'}} tide gauges from \DUrole{pasted-text}{1983\sphinxhyphen{}01\sphinxhyphen{}01} to \DUrole{pasted-text}{2023\sphinxhyphen{}12\sphinxhyphen{}31}}\label{\detokenize{notebooks/FloodFrequency:mag-fig}}\end{figure}


\bigskip\hrule\bigskip



\chapter{Citations}
\label{\detokenize{notebooks/FloodFrequency:citations}}
\sphinxstepscope


\part{Flood Duration}
\label{\detokenize{notebooks/FloodDuration:flood-duration}}\label{\detokenize{notebooks/FloodDuration::doc}}
\sphinxAtStartPar
Tralala

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}code here.}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
There will be more. This is a placeholder.

\begin{sphinxthebibliography}{SPM+14}
\bibitem[SPM+14]{notebooks/FloodFrequency:id5}
\sphinxAtStartPar
William Sweet, Joseph Park, John Marra, Chris Zervas, and Stephen Gill. Sea level rise and nuisance flood frequency changes around the United States. Technical Report, NOAA, 2014. URL: \sphinxurl{https://repository.library.noaa.gov/view/noaa/30823}.

\sphinxAtStartPar
William Sweet, Joseph Park, John Marra, Chris Zervas, and Stephen Gill. Sea level rise and nuisance flood frequency changes around the United States. Technical Report, NOAA, 2014. URL: \sphinxurl{https://repository.library.noaa.gov/view/noaa/30823}.
\bibitem[TWM+19]{notebooks/FloodFrequency:id4}
\sphinxAtStartPar
Philip R. Thompson, Matthew J. Widlansky, Mark A. Merrifield, Janet M. Becker, and John J. Marra. A Statistical Model for Frequency of Coastal Flooding in Honolulu, Hawaii, During the 21st Century. \sphinxstyleemphasis{Journal of Geophysical Research: Oceans}, 124(4):2787–2802, 2019. URL: \sphinxurl{https://onlinelibrary.wiley.com/doi/abs/10.1029/2018JC014741}, \sphinxhref{https://doi.org/10.1029/2018JC014741}{doi:10.1029/2018JC014741}.

\sphinxAtStartPar
Philip R. Thompson, Matthew J. Widlansky, Mark A. Merrifield, Janet M. Becker, and John J. Marra. A Statistical Model for Frequency of Coastal Flooding in Honolulu, Hawaii, During the 21st Century. \sphinxstyleemphasis{Journal of Geophysical Research: Oceans}, 124(4):2787–2802, 2019. URL: \sphinxurl{https://onlinelibrary.wiley.com/doi/abs/10.1029/2018JC014741}, \sphinxhref{https://doi.org/10.1029/2018JC014741}{doi:10.1029/2018JC014741}.
\end{sphinxthebibliography}







\renewcommand{\indexname}{Index}
\printindex
\end{document}