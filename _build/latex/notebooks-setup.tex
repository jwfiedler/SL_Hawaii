%% Generated by Sphinx.
\def\sphinxdocclass{jupyterBook}
\documentclass[letterpaper,10pt,english]{jupyterBook}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}
%% turn off hyperref patch of \index as sphinx.xdy xindy module takes care of
%% suitable \hyperpage mark-up, working around hyperref-xindy incompatibility
\PassOptionsToPackage{hyperindex=false}{hyperref}
%% memoir class requires extra handling
\makeatletter\@ifclassloaded{memoir}
{\ifdefined\memhyperindexfalse\memhyperindexfalse\fi}{}\makeatother


\PassOptionsToPackage{warn}{textcomp}

\catcode`^^^^00a0\active\protected\def^^^^00a0{\leavevmode\nobreak\ }
\usepackage{cmap}
\usepackage{fontspec}
\defaultfontfeatures[\rmfamily,\sffamily,\ttfamily]{}
\usepackage{amsmath,amssymb,amstext}
\usepackage{polyglossia}
\setmainlanguage{english}



\setmainfont{FreeSerif}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Italic,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldItalic
]
\setsansfont{FreeSans}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]
\setmonofont{FreeMono}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]



\usepackage[Bjarne]{fncychap}
\usepackage[,numfigreset=1,mathnumfig]{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}


\usepackage{sphinxmessages}



        % Start of preamble defined in sphinx-jupyterbook-latex %
         \usepackage[Latin,Greek]{ucharclasses}
        \usepackage{unicode-math}
        % fixing title of the toc
        \addto\captionsenglish{\renewcommand{\contentsname}{Contents}}
        \hypersetup{
            pdfencoding=auto,
            psdextra
        }
        % End of preamble defined in sphinx-jupyterbook-latex %
        

\title{Setup}
\date{Jun 03, 2024}
\release{}
\author{Playground Coordinator}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{notebooks/setup::doc}}


\sphinxAtStartPar
We first need to import the necessary libraries, access the data, and make a quick plot to ensure we will be analyzing the right thing.


\part{Import necessary libraries.}
\label{\detokenize{notebooks/setup:import-necessary-libraries}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Standard libraries}
\PYG{k+kn}{import} \PYG{n+nn}{os}\PYG{o}{,} \PYG{n+nn}{io}\PYG{o}{,} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{datetime} \PYG{k}{as} \PYG{n+nn}{dt}
\PYG{k+kn}{from} \PYG{n+nn}{pathlib} \PYG{k+kn}{import} \PYG{n}{Path}

\PYG{c+c1}{\PYGZsh{} Data manipulation libraries}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{xarray} \PYG{k}{as} \PYG{n+nn}{xr}

\PYG{c+c1}{\PYGZsh{} Data retrieval libraries}
\PYG{k+kn}{from} \PYG{n+nn}{urllib}\PYG{n+nn}{.}\PYG{n+nn}{request} \PYG{k+kn}{import} \PYG{n}{urlretrieve}
\PYG{k+kn}{import} \PYG{n+nn}{requests}

\PYG{c+c1}{\PYGZsh{} Data analysis libraries}
\PYG{k+kn}{import} \PYG{n+nn}{scipy}\PYG{n+nn}{.}\PYG{n+nn}{stats} \PYG{k}{as} \PYG{n+nn}{stats}

\PYG{c+c1}{\PYGZsh{} HTML parsing library}
\PYG{k+kn}{from} \PYG{n+nn}{bs4} \PYG{k+kn}{import} \PYG{n}{BeautifulSoup}

\PYG{c+c1}{\PYGZsh{} Visualization libraries}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{import} \PYG{n+nn}{seaborn} \PYG{k}{as} \PYG{n+nn}{sns}
\PYG{k+kn}{import} \PYG{n+nn}{cartopy}\PYG{n+nn}{.}\PYG{n+nn}{crs} \PYG{k}{as} \PYG{n+nn}{ccrs}
\PYG{k+kn}{import} \PYG{n+nn}{cartopy}\PYG{n+nn}{.}\PYG{n+nn}{feature} \PYG{k}{as} \PYG{n+nn}{cfeature}

\PYG{c+c1}{\PYGZsh{} Miscellaneous}
\PYG{k+kn}{from} \PYG{n+nn}{myst\PYGZus{}nb} \PYG{k+kn}{import} \PYG{n}{glue}  \PYG{c+c1}{\PYGZsh{} used for figure numbering when exporting to LaTeX}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\part{Set up Plotting}
\label{\detokenize{notebooks/setup:set-up-plotting}}
\sphinxAtStartPar
Then weâ€™ll establish some basic plotting rules for this notebook to keep everything looking uniform.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}\PYGZsh{} Set up Plotting}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{figure.figsize}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}  \PYG{c+c1}{\PYGZsh{} Set a default figure size for the notebook}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{figure.dpi}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{100}  \PYG{c+c1}{\PYGZsh{} Set default resolution for inline figures}

\PYG{c+c1}{\PYGZsh{} Set the default font size for axes labels, titles and ticks}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{axes.titlesize}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{16}  \PYG{c+c1}{\PYGZsh{} Set the font size for axes titles}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{axes.labelsize}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{14}  \PYG{c+c1}{\PYGZsh{} Set the font size for x and y labels}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{xtick.labelsize}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{12} \PYG{c+c1}{\PYGZsh{} Set the font size for x\PYGZhy{}axis tick labels}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ytick.labelsize}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{12} \PYG{c+c1}{\PYGZsh{} Set the font size for y\PYGZhy{}axis tick labels}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{font.size}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{14} \PYG{c+c1}{\PYGZsh{} Set the font size for the text in the figure (can affect legend)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\part{Define some functions}
\label{\detokenize{notebooks/setup:define-some-functions}}
\sphinxAtStartPar
These will come up across different notebooks.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{p}{,}\PYG{n}{weighted}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Flatten the data and get a time index}
    \PYG{c+c1}{\PYGZsh{} first ensure time is the first dimension regardless of other dimensions}
    \PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{transpose}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{p}{)}
    \PYG{n}{sla\PYGZus{}flat} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{values}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{time\PYGZus{}index} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{time}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}julian\PYGZus{}date}\PYG{p}{(}\PYG{p}{)}

    \PYG{n}{detrended\PYGZus{}flat} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{full\PYGZus{}like}\PYG{p}{(}\PYG{n}{sla\PYGZus{}flat}\PYG{p}{,} \PYG{n}{fill\PYGZus{}value}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{nan}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Loop over each grid point}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{sla\PYGZus{}flat}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
        \PYG{c+c1}{\PYGZsh{} Get the time series for this grid point}
        \PYG{n}{y} \PYG{o}{=} \PYG{n}{sla\PYGZus{}flat}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{n}{i}\PYG{p}{]}
        \PYG{n}{mask} \PYG{o}{=} \PYG{o}{\PYGZti{}}\PYG{n}{np}\PYG{o}{.}\PYG{n}{isnan}\PYG{p}{(}\PYG{n}{y}\PYG{p}{)}

        \PYG{k}{if} \PYG{n}{np}\PYG{o}{.}\PYG{n}{any}\PYG{p}{(}\PYG{n}{mask}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{time\PYGZus{}masked} \PYG{o}{=} \PYG{n}{time\PYGZus{}index}\PYG{p}{[}\PYG{n}{mask}\PYG{p}{]}
            \PYG{n}{y\PYGZus{}masked} \PYG{o}{=} \PYG{n}{y}\PYG{p}{[}\PYG{n}{mask}\PYG{p}{]}

            \PYG{n}{slope}\PYG{p}{,} \PYG{n}{intercept}\PYG{p}{,} \PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{n}{\PYGZus{}} \PYG{o}{=} \PYG{n}{stats}\PYG{o}{.}\PYG{n}{linregress}\PYG{p}{(}\PYG{n}{time\PYGZus{}masked}\PYG{p}{,} \PYG{n}{y\PYGZus{}masked}\PYG{p}{)}
            \PYG{n}{trend} \PYG{o}{=} \PYG{n}{slope} \PYG{o}{*} \PYG{n}{time\PYGZus{}index} \PYG{o}{+} \PYG{n}{intercept}

            \PYG{n}{detrended\PYGZus{}flat}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{n}{i}\PYG{p}{]} \PYG{o}{=} \PYG{n}{y} \PYG{o}{\PYGZhy{}} \PYG{n}{trend}

    \PYG{n}{detrended} \PYG{o}{=} \PYG{n}{detrended\PYGZus{}flat}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Calculate trend magnitude}
    \PYG{n}{sea\PYGZus{}level\PYGZus{}trend} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly} \PYG{o}{\PYGZhy{}} \PYG{n}{detrended}
    \PYG{n}{trend\PYGZus{}mag} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}

    \PYG{n}{times} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
    \PYG{n}{time\PYGZus{}mag} \PYG{o}{=} \PYG{p}{(}\PYG{n}{times}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{times}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{days}\PYG{o}{/}\PYG{l+m+mf}{365.25} \PYG{c+c1}{\PYGZsh{} in years}

    \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{n}{trend\PYGZus{}mag} \PYG{o}{/} \PYG{n}{time\PYGZus{}mag}

    \PYG{k}{if} \PYG{n}{weighted}\PYG{o}{==}\PYG{k+kc}{True}\PYG{p}{:}
        \PYG{c+c1}{\PYGZsh{} Calculate the weights}
        \PYG{n}{weights} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{cos}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{deg2rad}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{latitude}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{weights}\PYG{o}{.}\PYG{n}{name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{weights}\PYG{l+s+s1}{\PYGZsq{}}

        \PYG{c+c1}{\PYGZsh{} Calculate the weighted mean}
        \PYG{n}{trend\PYGZus{}mag} \PYG{o}{=} \PYG{p}{(}\PYG{n}{trend\PYGZus{}mag} \PYG{o}{*} \PYG{n}{weights}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{p}{(}\PYG{n}{trend\PYGZus{}rate} \PYG{o}{*} \PYG{n}{weights}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{sea\PYGZus{}level\PYGZus{}trend} \PYG{o}{=} \PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}trend} \PYG{o}{*} \PYG{n}{weights}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}



    \PYG{k}{return} \PYG{n}{trend\PYGZus{}mag}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate}  
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}






\renewcommand{\indexname}{Index}
\printindex
\end{document}