%% Generated by Sphinx.
\def\sphinxdocclass{jupyterBook}
\documentclass[letterpaper,10pt,english]{jupyterBook}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}
%% turn off hyperref patch of \index as sphinx.xdy xindy module takes care of
%% suitable \hyperpage mark-up, working around hyperref-xindy incompatibility
\PassOptionsToPackage{hyperindex=false}{hyperref}
%% memoir class requires extra handling
\makeatletter\@ifclassloaded{memoir}
{\ifdefined\memhyperindexfalse\memhyperindexfalse\fi}{}\makeatother


\PassOptionsToPackage{warn}{textcomp}

\catcode`^^^^00a0\active\protected\def^^^^00a0{\leavevmode\nobreak\ }
\usepackage{cmap}
\usepackage{fontspec}
\defaultfontfeatures[\rmfamily,\sffamily,\ttfamily]{}
\usepackage{amsmath,amssymb,amstext}
\usepackage{polyglossia}
\setmainlanguage{english}



\setmainfont{FreeSerif}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Italic,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldItalic
]
\setsansfont{FreeSans}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]
\setmonofont{FreeMono}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]



\usepackage[Bjarne]{fncychap}
\usepackage[,numfigreset=1,mathnumfig]{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}


\usepackage{sphinxmessages}



        % Start of preamble defined in sphinx-jupyterbook-latex %
         \usepackage[Latin,Greek]{ucharclasses}
        \usepackage{unicode-math}
        % fixing title of the toc
        \addto\captionsenglish{\renewcommand{\contentsname}{Contents}}
        \hypersetup{
            pdfencoding=auto,
            psdextra
        }
        % End of preamble defined in sphinx-jupyterbook-latex %
        

\title{Annual Sea Level Anomalies}
\date{Jun 03, 2024}
\release{}
\author{Playground Coordinator}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual::doc}}


\sphinxAtStartPar
Annual mean sea level anomalies. This page is very much in development!!

\begin{sphinxadmonition}{caution}{Caution:}
\sphinxAtStartPar
Major updates are needed for this page. Don’t look at it too hard…
\end{sphinxadmonition}


\part{Setup}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:setup}}
\sphinxAtStartPar
As with previous sections, we first need to import the necessary libraries, establish our input/output directories, and set up some basic plotting rules. We’ll do this by running another notebook called “setup” and “plotting functions,” and then we’ll set our data and output paths. If you have not run the datawrangling notebook, you will need to do this before running this notebook.

\begin{sphinxShadowBox}
\sphinxstylesidebartitle{}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
\sphinxstylestrong{TODO}
\begin{itemize}
\item {} 
\sphinxAtStartPar
Trend dates?

\item {} 
\sphinxAtStartPar
Confirm numbers match

\item {} 
\sphinxAtStartPar
Figure captions

\item {} 
\sphinxAtStartPar
Figure labels

\item {} 
\sphinxAtStartPar
Text

\item {} 
\sphinxAtStartPar
Check with John’s master plan

\item {} 
\sphinxAtStartPar
Clean up code

\item {} 
\sphinxAtStartPar
add commentary

\end{itemize}
\end{sphinxadmonition}
\end{sphinxShadowBox}

\begin{sphinxVerbatim}[commandchars=\\\{\}]

\end{sphinxVerbatim}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{\PYGZpc{}}\PYG{k}{run} ../setup.ipynb
\PYG{o}{\PYGZpc{}}\PYG{k}{run} ../plotting\PYGZus{}functions.ipynb
\PYG{n}{data\PYGZus{}dir} \PYG{o}{=} \PYG{n}{Path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../../data}\PYG{l+s+s1}{\PYGZsq{}} \PYG{p}{)}
\PYG{n}{output\PYGZus{}dir} \PYG{o}{=} \PYG{n}{Path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../../output}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} 

\PYG{c+c1}{\PYGZsh{} check to make sure that data\PYGZus{}dir/rsl\PYGZus{}daily\PYGZus{}hawaii.nc exists, if not, make warning to run datawrangling notebook}
\PYG{k}{if} \PYG{o+ow}{not} \PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{exists}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc not found in ../../data. Please run the data wrangling notebook first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{k}{else}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc found in ../../data. Proceed.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
rsl\PYGZus{}daily\PYGZus{}hawaii.nc found in ../../data. Proceed.
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\chapter{Import the tide gauge data}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:import-the-tide-gauge-data}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}import rsl\PYGZus{}daily}
\PYG{n}{rsl\PYGZus{}daily} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir}\PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}make rsl\PYGZus{}daily a subset \PYGZhy{} do not include TGs with more than 25\PYGZpc{} NaNs}
\PYG{c+c1}{\PYGZsh{} get percent Nans in rsl\PYGZus{}daily[\PYGZsq{}sea\PYGZus{}level\PYGZsq{}]}

\PYG{n}{rsl\PYGZus{}daily}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 2MB
Dimensions:       (record\PYGZus{}id: 11, time: 10957)
Coordinates:
  * record\PYGZus{}id     (record\PYGZus{}id) int16 22B 140 500 520 570 ... 610 5470 5480 5520
  * time          (time) datetime64[ns] 88kB 1993\PYGZhy{}01\PYGZhy{}01 ... 2022\PYGZhy{}12\PYGZhy{}31
    lat           (record\PYGZus{}id) float32 44B ...
    lon           (record\PYGZus{}id) float32 44B ...
    station\PYGZus{}name  (record\PYGZus{}id) \PYGZlt{}U17 748B ...
    storm\PYGZus{}time    (time) datetime64[ns] 88kB ...
Data variables:
    rsl\PYGZus{}anomaly   (record\PYGZus{}id, time) float32 482kB ...
    rsl\PYGZus{}mhhw      (record\PYGZus{}id, time) float64 964kB ...
Attributes:
    long\PYGZus{}name:  Sea Level Anomaly
    units:      m
    source:     in situ tide gauge water level observations
    platform:   station\PYGZus{}name, station\PYGZus{}country, station\PYGZus{}country\PYGZus{}code, uhslc\PYGZus{}id...
    epoch:      1993\PYGZhy{}2001
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\chapter{Do some data wrangling again.}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:do-some-data-wrangling-again}}

\section{1. Check the data and drop all stations with less than 80\% coverage}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:check-the-data-and-drop-all-stations-with-less-than-80-coverage}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data\PYGZus{}coverage} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{rsl\PYGZus{}mhhw}\PYG{o}{.}\PYG{n}{count}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{/}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{time}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}drop all locations with data\PYGZus{}coverage less than 80\PYGZpc{}}
\PYG{n}{rsl\PYGZus{}subset} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{data\PYGZus{}coverage}\PYG{o}{\PYGZgt{}}\PYG{l+m+mf}{0.80}\PYG{p}{,}\PYG{n}{drop}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{rsl\PYGZus{}subset}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 1MB
Dimensions:       (record\PYGZus{}id: 8, time: 10957)
Coordinates:
  * record\PYGZus{}id     (record\PYGZus{}id) int16 16B 500 520 570 580 590 600 610 5520
  * time          (time) datetime64[ns] 88kB 1993\PYGZhy{}01\PYGZhy{}01 ... 2022\PYGZhy{}12\PYGZhy{}31
    lat           (record\PYGZus{}id) float32 32B 28.22 16.75 21.31 ... 21.43 20.03
    lon           (record\PYGZus{}id) float32 32B 182.6 190.5 202.1 ... 202.2 204.2
    station\PYGZus{}name  (record\PYGZus{}id) \PYGZlt{}U17 544B \PYGZsq{}Midway\PYGZsq{} \PYGZsq{}Johnston\PYGZsq{} ... \PYGZsq{}Kawaihae\PYGZsq{}
    storm\PYGZus{}time    (time) datetime64[ns] 88kB ...
Data variables:
    rsl\PYGZus{}anomaly   (record\PYGZus{}id, time) float32 351kB \PYGZhy{}0.05425 \PYGZhy{}0.022 ... \PYGZhy{}0.1367
    rsl\PYGZus{}mhhw      (record\PYGZus{}id, time) float64 701kB \PYGZhy{}0.2078 \PYGZhy{}0.1756 ... \PYGZhy{}0.446
Attributes:
    long\PYGZus{}name:  Sea Level Anomaly
    units:      m
    source:     in situ tide gauge water level observations
    platform:   station\PYGZus{}name, station\PYGZus{}country, station\PYGZus{}country\PYGZus{}code, uhslc\PYGZus{}id...
    epoch:      1993\PYGZhy{}2001
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{2. Now we’ll remove the trend (over the entire record) from this subset of stations.}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:now-we-ll-remove-the-trend-over-the-entire-record-from-this-subset-of-stations}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{trend\PYGZus{}mag}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}anomaly}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}anomaly\PYGZus{}detrended}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}anomaly}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{3. Resample to monthly time series of anomalies.}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:resample-to-monthly-time-series-of-anomalies}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} resample to monthly time series }
\PYG{n}{rsl\PYGZus{}monthly} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{resample}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1M}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{right}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} get climatology (annual cycle) by grouping by month}
\PYG{n}{rsl\PYGZus{}climatology} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}monthly}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.month}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} get anomalies by subtracting climatology from monthly data}
\PYG{n}{rsl\PYGZus{}anomalies} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}monthly}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.month}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{n}{rsl\PYGZus{}climatology}

\PYG{n}{rsl\PYGZus{}anomalies}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
/opt/anaconda3/envs/SLI39/lib/python3.9/site\PYGZhy{}packages/xarray/core/groupby.py:668: FutureWarning: \PYGZsq{}M\PYGZsq{} is deprecated and will be removed in a future version, please use \PYGZsq{}ME\PYGZsq{} instead.
  index\PYGZus{}grouper = pd.Grouper(
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 52kB
Dimensions:                (record\PYGZus{}id: 8, time: 360)
Coordinates:
  * record\PYGZus{}id              (record\PYGZus{}id) int16 16B 500 520 570 ... 600 610 5520
    lat                    (record\PYGZus{}id) float32 32B 28.22 16.75 ... 21.43 20.03
    lon                    (record\PYGZus{}id) float32 32B 182.6 190.5 ... 202.2 204.2
    station\PYGZus{}name           (record\PYGZus{}id) \PYGZlt{}U17 544B \PYGZsq{}Midway\PYGZsq{} ... \PYGZsq{}Kawaihae\PYGZsq{}
  * time                   (time) datetime64[ns] 3kB 1993\PYGZhy{}01\PYGZhy{}31 ... 2022\PYGZhy{}12\PYGZhy{}31
    month                  (time) int64 3kB 1 2 3 4 5 6 7 8 ... 6 7 8 9 10 11 12
Data variables:
    rsl\PYGZus{}anomaly            (time, record\PYGZus{}id) float32 12kB \PYGZhy{}0.09168 ... \PYGZhy{}0.07986
    rsl\PYGZus{}mhhw               (time, record\PYGZus{}id) float64 23kB \PYGZhy{}0.09168 ... \PYGZhy{}0.07986
    rsl\PYGZus{}anomaly\PYGZus{}detrended  (time, record\PYGZus{}id) float32 12kB \PYGZhy{}0.03686 ... \PYGZhy{}0.1795
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{4. Now sort the subset on “storm year” instead of calendar year for yearly means.}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:now-sort-the-subset-on-storm-year-instead-of-calendar-year-for-yearly-means}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} change the index to be on storm\PYGZus{}time instead of time}
\PYG{n}{rsl\PYGZus{}subset} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{set\PYGZus{}index}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} rename the time dimension to storm\PYGZus{}time}
\PYG{n}{rsl\PYGZus{}subset} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{rename}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{rsl\PYGZus{}subset}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 1MB
Dimensions:                (record\PYGZus{}id: 8, storm\PYGZus{}time: 10957)
Coordinates:
  * record\PYGZus{}id              (record\PYGZus{}id) int16 16B 500 520 570 ... 600 610 5520
  * storm\PYGZus{}time             (storm\PYGZus{}time) datetime64[ns] 88kB 1992\PYGZhy{}01\PYGZhy{}01 ... 20...
    lat                    (record\PYGZus{}id) float32 32B 28.22 16.75 ... 21.43 20.03
    lon                    (record\PYGZus{}id) float32 32B 182.6 190.5 ... 202.2 204.2
    station\PYGZus{}name           (record\PYGZus{}id) \PYGZlt{}U17 544B \PYGZsq{}Midway\PYGZsq{} ... \PYGZsq{}Kawaihae\PYGZsq{}
Data variables:
    rsl\PYGZus{}anomaly            (record\PYGZus{}id, storm\PYGZus{}time) float32 351kB \PYGZhy{}0.05425 ......
    rsl\PYGZus{}mhhw               (record\PYGZus{}id, storm\PYGZus{}time) float64 701kB \PYGZhy{}0.2078 ... ...
    rsl\PYGZus{}anomaly\PYGZus{}detrended  (record\PYGZus{}id, storm\PYGZus{}time) float32 351kB \PYGZhy{}0.01937 ......
Attributes:
    long\PYGZus{}name:  Sea Level Anomaly
    units:      m
    source:     in situ tide gauge water level observations
    platform:   station\PYGZus{}name, station\PYGZus{}country, station\PYGZus{}country\PYGZus{}code, uhslc\PYGZus{}id...
    epoch:      1993\PYGZhy{}2001
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} reorder to that storm\PYGZus{}time is monotonicly increasing}
\PYG{n}{rsl\PYGZus{}subset} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{sortby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Group by storm\PYGZus{}year and record\PYGZus{}id}
\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} give year dimension a name}
\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{o}{.}\PYG{n}{rename}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 5kB
Dimensions:                (storm\PYGZus{}year: 31, record\PYGZus{}id: 8)
Coordinates:
  * record\PYGZus{}id              (record\PYGZus{}id) int16 16B 500 520 570 ... 600 610 5520
    lat                    (record\PYGZus{}id) float32 32B 28.22 16.75 ... 21.43 20.03
    lon                    (record\PYGZus{}id) float32 32B 182.6 190.5 ... 202.2 204.2
    station\PYGZus{}name           (record\PYGZus{}id) \PYGZlt{}U17 544B \PYGZsq{}Midway\PYGZsq{} ... \PYGZsq{}Kawaihae\PYGZsq{}
  * storm\PYGZus{}year             (storm\PYGZus{}year) int64 248B 1992 1993 1994 ... 2021 2022
Data variables:
    rsl\PYGZus{}anomaly            (storm\PYGZus{}year, record\PYGZus{}id) float32 992B \PYGZhy{}0.05539 ... ...
    rsl\PYGZus{}mhhw               (storm\PYGZus{}year, record\PYGZus{}id) float64 2kB \PYGZhy{}0.209 ... \PYGZhy{}0....
    rsl\PYGZus{}anomaly\PYGZus{}detrended  (storm\PYGZus{}year, record\PYGZus{}id) float32 992B \PYGZhy{}0.02112 ... ...
Attributes:
    long\PYGZus{}name:  Sea Level Anomaly
    units:      m
    source:     in situ tide gauge water level observations
    platform:   station\PYGZus{}name, station\PYGZus{}country, station\PYGZus{}country\PYGZus{}code, uhslc\PYGZus{}id...
    epoch:      1993\PYGZhy{}2001
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\part{Absolute Value: satellite (trend removed)}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:absolute-value-satellite-trend-removed}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} open the cmems data}
\PYG{n}{cmems} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cmems\PYGZus{}L4\PYGZus{}SSH\PYGZus{}0.25deg\PYGZus{}1993\PYGZus{}2023.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\chapter{Plot an area\sphinxhyphen{}wide map, with stations}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:plot-an-area-wide-map-with-stations}}
\sphinxAtStartPar
First we’ll need to make sure that our data is detrended properly in order to look at yearly anomalies.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} concentrating on decadal trends}
\PYG{c+c1}{\PYGZsh{} let\PYGZsq{}s look at 1993\PYGZhy{}2003 and 2003\PYGZhy{}2013}

\PYG{n}{trend\PYGZus{}mag}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{cmems}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1993}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2023}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{n}{weighted}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} define vmin and vmax variables}
\PYG{n}{vmin} \PYG{o}{=} \PYG{l+m+mi}{0}
\PYG{n}{vmax} \PYG{o}{=} \PYG{l+m+mf}{0.5}
\PYG{n}{xlims} \PYG{o}{=} \PYG{p}{[}\PYG{n}{cmems}\PYG{o}{.}\PYG{n}{longitude}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmems}\PYG{o}{.}\PYG{n}{longitude}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}
\PYG{n}{ylims} \PYG{o}{=} \PYG{p}{[}\PYG{n}{cmems}\PYG{o}{.}\PYG{n}{latitude}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmems}\PYG{o}{.}\PYG{n}{latitude}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}

\PYG{n}{trend\PYGZus{}rate\PYGZus{}cm} \PYG{o}{=} \PYG{n}{trend\PYGZus{}rate} \PYG{o}{*} \PYG{l+m+mi}{100} \PYG{c+c1}{\PYGZsh{} convert to cm/yr}

\PYG{c+c1}{\PYGZsh{} make ax,fig}
\PYG{n}{crs} \PYG{o}{=} \PYG{n}{ccrs}\PYG{o}{.}\PYG{n}{PlateCarree}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{cmap} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{YlOrRd}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax}\PYG{p}{,} \PYG{n}{crs} \PYG{o}{=} \PYG{n}{plot\PYGZus{}map}\PYG{p}{(}\PYG{n}{vmin}\PYG{p}{,}\PYG{n}{vmax}\PYG{p}{,}\PYG{n}{cmap}\PYG{p}{,}\PYG{n}{xlims}\PYG{p}{,}\PYG{n}{ylims}\PYG{p}{)}
\PYG{n}{trend\PYGZus{}rate\PYGZus{}cm}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{,}
                         \PYG{n}{vmin}\PYG{o}{=}\PYG{n}{vmin}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{n}{vmax}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{cmap}\PYG{p}{,} \PYG{n}{add\PYGZus{}colorbar}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} 
                         \PYG{n}{cbar\PYGZus{}kwargs}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level Trend rate (cm/yr, 1993\PYGZhy{}2023)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}
\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Call the function to add the zebra frame}
\PYG{n}{plot\PYGZus{}zebra\PYGZus{}frame}\PYG{p}{(}\PYG{n}{ax}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{segment\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{crs}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{498f9bb9acde41e5c3a4f143d6c617e56fc5df5a65e5169d71f91a028b9c8a28}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\chapter{Area\sphinxhyphen{}weighted average trend}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:area-weighted-average-trend}}
\sphinxAtStartPar
Is this something we want to do for the region? I don’t think so? I suppose we’ll use the entire grid for this? For example:

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{startYear} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1993}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{endYear} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2023}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{trend\PYGZus{}mag}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{cmems}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{n}{startYear}\PYG{p}{,}\PYG{n}{endYear}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{n}{weighted}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{The trend rate for }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{startYear}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZhy{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{endYear}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ in the entire grid is }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{trend\PYGZus{}rate}\PYG{o}{*}\PYG{l+m+mi}{100}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ cm/yr}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
The trend rate for 1993\PYGZhy{}2023 in the entire grid is 0.22 cm/yr
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} concentrating on decadal trends}
\PYG{c+c1}{\PYGZsh{} let\PYGZsq{}s look at 1993\PYGZhy{}2003 and 2003\PYGZhy{}2013}
\PYG{n}{cmems1993\PYGZus{}2003} \PYG{o}{=} \PYG{n}{cmems}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1993}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2003}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} get the overall trend (full time series)}
\PYG{n}{trend\PYGZus{}mag}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{cmems}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{trend\PYGZus{}mag\PYGZus{}area\PYGZus{}weighted}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend\PYGZus{}area\PYGZus{}weighted}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate\PYGZus{}area\PYGZus{}weighted} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{cmems}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}\PYG{n}{weighted}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{}remove the trend from the data}
\PYG{n}{sla\PYGZus{}detrended} \PYG{o}{=} \PYG{n}{cmems1993\PYGZus{}2003}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1993}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2003}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{sla\PYGZus{}detrended\PYGZus{}area\PYGZus{}weighted} \PYG{o}{=} \PYG{n}{cmems1993\PYGZus{}2003}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend\PYGZus{}area\PYGZus{}weighted}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1993}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2003}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
Let’s check this for a random station in our list.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rid} \PYG{o}{=} \PYG{l+m+mi}{3}
\PYG{n}{lat} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{lat}
\PYG{n}{lon} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{lon}
\PYG{n}{sla\PYGZus{}detrended}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{latitude}\PYG{o}{=}\PYG{n}{lat}\PYG{p}{,} \PYG{n}{longitude}\PYG{o}{=}\PYG{n}{lon}\PYG{p}{,} \PYG{n}{method}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nearest}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level Anomaly (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{sla\PYGZus{}detrended\PYGZus{}area\PYGZus{}weighted}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{latitude}\PYG{o}{=}\PYG{n}{lat}\PYG{p}{,} \PYG{n}{longitude}\PYG{o}{=}\PYG{n}{lon}\PYG{p}{,} \PYG{n}{method}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nearest}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Area Weighted Sea Level Anomaly (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} change the title to station name}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Text(0.5, 1.0, \PYGZsq{}Nawiliwili\PYGZsq{})
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{9870e9f738625fb7781cf5105245471f0d70fa96777afa83ee07f421215723ac}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
There are slight differences between removing the grid\sphinxhyphen{}level trend versus the area\sphinxhyphen{}weighted trend in this plot. Nothing too major here.


\chapter{Create a map}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:create-a-map}}
\sphinxAtStartPar
Concentrating on decadal trends.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} concentrating on decadal trends}
\PYG{c+c1}{\PYGZsh{} let\PYGZsq{}s look at 1993\PYGZhy{}2003 and 2003\PYGZhy{}2013}

\PYG{n}{yr\PYGZus{}start} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{1993}\PYG{p}{,}\PYG{l+m+mi}{2003}\PYG{p}{,}\PYG{l+m+mi}{2013}\PYG{p}{,}\PYG{l+m+mi}{1993}\PYG{p}{]}
\PYG{n}{yr\PYGZus{}stop} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{2003}\PYG{p}{,}\PYG{l+m+mi}{2013}\PYG{p}{,}\PYG{l+m+mi}{2023}\PYG{p}{,}\PYG{l+m+mi}{2023}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{}do storm year instead of calendar year}

\PYG{n}{yr\PYGZus{}start\PYGZus{}str} \PYG{o}{=} \PYG{p}{[}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{yr}\PYG{p}{)}\PYG{p}{)}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}05\PYGZhy{}01}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{for} \PYG{n}{yr} \PYG{o+ow}{in} \PYG{n}{yr\PYGZus{}start}\PYG{p}{]}
\PYG{n}{yr\PYGZus{}stop\PYGZus{}str} \PYG{o}{=} \PYG{p}{[}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{yr}\PYG{p}{)}\PYG{p}{)}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}04\PYGZhy{}30}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{for} \PYG{n}{yr} \PYG{o+ow}{in} \PYG{n}{yr\PYGZus{}stop}\PYG{p}{]}

\PYG{n}{trend\PYGZus{}mag}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{cmems}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{n}{yr\PYGZus{}start\PYGZus{}str}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}\PYG{n}{yr\PYGZus{}stop\PYGZus{}str}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{n}{weighted}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}remove the trend from the data}
\PYG{n}{sla\PYGZus{}detrended} \PYG{o}{=} \PYG{n}{cmems}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}


\PYG{c+c1}{\PYGZsh{} make 4 subplots for each year range}
\PYG{n}{crs} \PYG{o}{=} \PYG{n}{ccrs}\PYG{o}{.}\PYG{n}{PlateCarree}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{8}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{,} \PYG{n}{subplot\PYGZus{}kw}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{projection}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{crs}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Variable to hold the colorbar handle}
\PYG{n}{cbar\PYGZus{}ax} \PYG{o}{=} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}axes}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.92}\PYG{p}{,} \PYG{l+m+mf}{0.15}\PYG{p}{,} \PYG{l+m+mf}{0.03}\PYG{p}{,} \PYG{l+m+mf}{0.7}\PYG{p}{]}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} Adjust these values to fit your layout}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{subplots\PYGZus{}adjust}\PYG{p}{(}\PYG{n}{right}\PYG{o}{=}\PYG{l+m+mf}{0.9}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} Make space for the colorbar}
 

\PYG{n}{vmin} \PYG{o}{=} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.03}
\PYG{n}{vmax} \PYG{o}{=} \PYG{l+m+mf}{0.03}
\PYG{c+c1}{\PYGZsh{} Loop through each period}
\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{ax} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{flat}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Select the data for the current period and calculate the mean over time}
    \PYG{n}{sla\PYGZus{}mean} \PYG{o}{=} \PYG{n}{sla\PYGZus{}detrended}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{n}{yr\PYGZus{}start\PYGZus{}str}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,}\PYG{n}{yr\PYGZus{}stop\PYGZus{}str}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{skipna}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} sla\PYGZus{}mean = sla\PYGZus{}mean \PYGZhy{} sea\PYGZus{}level\PYGZus{}trend.sel(time=slice(str(yr\PYGZus{}start[i]), str(yr\PYGZus{}stop[i]))).mean(dim=\PYGZsq{}time\PYGZsq{})}

    \PYG{c+c1}{\PYGZsh{}subtract the}
    
    \PYG{c+c1}{\PYGZsh{} Plot the mean sea level anomaly}
    \PYG{n}{c} \PYG{o}{=} \PYG{n}{sla\PYGZus{}mean}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{,} \PYG{n}{add\PYGZus{}colorbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{RdBu\PYGZus{}r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    
    \PYG{c+c1}{\PYGZsh{} Set the title to the current period}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{yr\PYGZus{}start}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZhy{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{yr\PYGZus{}stop}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Add coastlines and land  }
    \PYG{n}{palette} \PYG{o}{=} \PYG{n}{sns}\PYG{o}{.}\PYG{n}{color\PYGZus{}palette}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{RdBu\PYGZus{}r}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{as\PYGZus{}cmap}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
    \PYG{n}{cmap} \PYG{o}{=} \PYG{n}{palette}

    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{add\PYGZus{}feature}\PYG{p}{(}\PYG{n}{cfeature}\PYG{o}{.}\PYG{n}{COASTLINE}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{add\PYGZus{}feature}\PYG{p}{(}\PYG{n}{cfeature}\PYG{o}{.}\PYG{n}{LAND}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lightgrey}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    
    \PYG{c+c1}{\PYGZsh{} Optionally, adjust color limits for consistency across plots}
    \PYG{n}{c}\PYG{o}{.}\PYG{n}{set\PYGZus{}clim}\PYG{p}{(}\PYG{n}{vmin}\PYG{p}{,}\PYG{n}{vmax}\PYG{p}{)}

    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{,} \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{50}\PYG{p}{,}
              \PYG{n}{c}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{white}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{n}{edgecolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{zorder}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{)}
    
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{,} \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,} 
           \PYG{n}{c}\PYG{o}{=}\PYG{n}{rsl\PYGZus{}anomalies}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{n}{yr\PYGZus{}start\PYGZus{}str}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,}\PYG{n}{yr\PYGZus{}stop\PYGZus{}str}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{rsl\PYGZus{}anomaly\PYGZus{}detrended}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{time}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{vmin}\PYG{o}{=}\PYG{n}{vmin}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{n}{vmax}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{cmap}\PYG{p}{,}
           \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{n}{edgecolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{zorder}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{)}
    
    \PYG{c+c1}{\PYGZsh{}add grid}
    \PYG{n}{gl} \PYG{o}{=} \PYG{n}{ax}\PYG{o}{.}\PYG{n}{gridlines}\PYG{p}{(}\PYG{n}{draw\PYGZus{}labels}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{linestyle}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                      \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,}\PYG{n}{xlocs}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{get\PYGZus{}xticks}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}\PYG{n}{ylocs}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{get\PYGZus{}yticks}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
    
    \PYG{k}{if} \PYG{n}{i}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{1}\PYG{p}{:}
        \PYG{n}{gl}\PYG{o}{.}\PYG{n}{bottom\PYGZus{}labels} \PYG{o}{=} \PYG{k+kc}{True}

    \PYG{k}{if} \PYG{n}{i}\PYG{o}{==}\PYG{l+m+mi}{0}\PYG{p}{:}
        \PYG{n}{gl}\PYG{o}{.}\PYG{n}{left\PYGZus{}labels} \PYG{o}{=} \PYG{k+kc}{True}

    \PYG{k}{if} \PYG{n}{i}\PYG{o}{==}\PYG{l+m+mi}{2}\PYG{p}{:}
        \PYG{n}{gl}\PYG{o}{.}\PYG{n}{left\PYGZus{}labels} \PYG{o}{=} \PYG{k+kc}{True}

    \PYG{c+c1}{\PYGZsh{}make all labels tiny}
    \PYG{n}{gl}\PYG{o}{.}\PYG{n}{xlabel\PYGZus{}style} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{size}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+m+mi}{8}\PYG{p}{\PYGZcb{}}
    \PYG{n}{gl}\PYG{o}{.}\PYG{n}{ylabel\PYGZus{}style} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{size}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+m+mi}{8}\PYG{p}{\PYGZcb{}}
    



\PYG{c+c1}{\PYGZsh{} Add the colorbar}
\PYG{n}{cbar} \PYG{o}{=} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{colorbar}\PYG{p}{(}\PYG{n}{c}\PYG{p}{,} \PYG{n}{cax}\PYG{o}{=}\PYG{n}{cbar\PYGZus{}ax}\PYG{p}{)}
\PYG{n}{cbar}\PYG{o}{.}\PYG{n}{set\PYGZus{}label}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level Anomaly (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}


\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SL\PYGZus{}YMA\PYGZus{}decadal}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{fig}\PYG{p}{,}\PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{d68ece3b7ef7a584a24f82db05849a0ea01aeb003b5841d417c9cd797b5e0fba}.png}
\caption{Decadal (or bidecadal, is that a word) mean anomalies of the Hawaiian Islands region, background trend (Storm Years 1993\sphinxhyphen{}2023) removed. Note that the sea level is plotted in units of m. The mean anomaly is near zero when using the full timeseries and grid\sphinxhyphen{}level trends (i.e. no area\sphinxhyphen{}weighted averaging). Mean monthly anomalies at the stations are plotted as well, showing similar\sphinxhyphen{}ish patterns, with some weirdness at Kawaihae that I should check on.}\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:sl-yma-decadal}}\end{figure}


\part{Relative Value: tide station (trend removed)}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:relative-value-tide-station-trend-removed}}

\chapter{area\sphinxhyphen{}wide map with stations}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:area-wide-map-with-stations}}

\chapter{station plots: time series}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:station-plots-time-series}}
\sphinxAtStartPar
These should have ONI/ENSO phase included on them

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{plot\PYGZus{}TG\PYGZus{}rsl\PYGZus{}anomaly\PYGZus{}annual}\PYG{p}{(}\PYG{n}{rid}\PYG{p}{,} \PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}anomalies}\PYG{p}{,}\PYG{n}{oni}\PYG{p}{,} \PYG{n}{oniPlot}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}\PYG{p}{:}

    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlim}\PYG{p}{(}\PYG{l+m+mi}{1993}\PYG{p}{,}\PYG{l+m+mi}{2022}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.3}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{grid}\PYG{p}{(}\PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.2}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lightgray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{k}{if} \PYG{n}{oniPlot}\PYG{p}{:}
        \PYG{n}{ymin}\PYG{p}{,} \PYG{n}{ymax} \PYG{o}{=} \PYG{n}{ax}\PYG{o}{.}\PYG{n}{get\PYGZus{}ylim}\PYG{p}{(}\PYG{p}{)}
        \PYG{c+c1}{\PYGZsh{} Shading El Niño events}
        \PYG{n}{ax}\PYG{o}{.}\PYG{n}{fill\PYGZus{}between}\PYG{p}{(}\PYG{n}{oni}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{n}{ymin}\PYG{p}{,}\PYG{n}{ymax}\PYG{p}{,} 
                        \PYG{n}{where}\PYG{o}{=}\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{El Nino}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{==} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{red}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{El Niño}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{c+c1}{\PYGZsh{} Shading La Niña events}
        \PYG{n}{ax}\PYG{o}{.}\PYG{n}{fill\PYGZus{}between}\PYG{p}{(}\PYG{n}{oni}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,}  \PYG{n}{ymin}\PYG{p}{,}\PYG{n}{ymax}\PYG{p}{,}
                        \PYG{n}{where}\PYG{o}{=}\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{La Nina}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{==} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{blue}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{La Niña}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    
    \PYG{c+c1}{\PYGZsh{} get min and max for each year}
    \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}min} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}max} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{}make a fill from max to min for each month}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{fill\PYGZus{}between}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{o}{.}\PYG{n}{storm\PYGZus{}year}\PYG{o}{+}\PYG{l+m+mf}{0.5}\PYG{p}{,} 
                     \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}min}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}anomaly\PYGZus{}detrended}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{p}{,} 
                     \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}max}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}anomaly\PYGZus{}detrended}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{p}{,} 
                     \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.2}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Range (Annual SLA Min\PYGZhy{}Max)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{o}{.}\PYG{n}{storm\PYGZus{}year}\PYG{o}{+}\PYG{l+m+mf}{0.5}\PYG{p}{,} 
            \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}anomaly\PYGZus{}detrended}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{p}{,} 
            \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Annual Mean Sea Level Anomaly (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} convert rsl\PYGZus{}monthly[\PYGZsq{}time\PYGZsq{}] to float}
    \PYG{n}{storm\PYGZus{}time\PYGZus{}float} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}monthly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{+} \PYG{p}{(}\PYG{n}{rsl\PYGZus{}monthly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.month}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{5}\PYG{p}{)}\PYG{o}{/}\PYG{l+m+mi}{12} \PYG{c+c1}{\PYGZsh{}subtract 5 months to go with \PYGZsq{}storm year\PYGZsq{} convention (May\PYGZhy{}April)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{storm\PYGZus{}time\PYGZus{}float}\PYG{p}{,} 
            \PYG{n}{rsl\PYGZus{}anomalies}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}anomaly\PYGZus{}detrended}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{p}{,} 
            \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Monthly Mean Sea Level Anomaly (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mf}{0.75}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} add rsl\PYGZus{}yearly\PYGZus{}mean[\PYGZsq{}station\PYGZus{}name\PYGZsq{}].isel(record\PYGZus{}id=rid).values to upper center of plot}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+m+mf}{0.9}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{horizontalalignment}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{verticalalignment}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{transAxes}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
First, we’ll plot one gauge

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,}\PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} add ENSO to the plots}
\PYG{c+c1}{\PYGZsh{} import oni.csv}
\PYG{n}{oni} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{read\PYGZus{}csv}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir}\PYG{o}{/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{oni.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} change oni index to Date column}
\PYG{n}{oni}\PYG{o}{.}\PYG{n}{index} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}adjust the index to be float value of fractional year}
\PYG{n}{oni}\PYG{o}{.}\PYG{n}{index} \PYG{o}{=} \PYG{n}{oni}\PYG{o}{.}\PYG{n}{index}\PYG{o}{.}\PYG{n}{year} \PYG{o}{+} \PYG{p}{(}\PYG{n}{oni}\PYG{o}{.}\PYG{n}{index}\PYG{o}{.}\PYG{n}{month} \PYG{o}{\PYGZhy{}} \PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{/}\PYG{l+m+mi}{12} \PYG{o}{\PYGZhy{}} \PYG{l+m+mi}{5}\PYG{o}{/}\PYG{l+m+mi}{12}

\PYG{n}{plot\PYGZus{}TG\PYGZus{}rsl\PYGZus{}anomaly\PYGZus{}annual}\PYG{p}{(}\PYG{n}{i}\PYG{p}{,} \PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax}\PYG{p}{,}  \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}anomalies}\PYG{p}{,}\PYG{n}{oni}\PYG{p}{,}\PYG{n}{oniPlot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{n}{loc}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{upper right}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ncol}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{bbox\PYGZus{}to\PYGZus{}anchor}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mf}{1.6}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Save the plot to a file}
\PYG{n}{filename} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SL\PYGZus{}MMA\PYGZus{}annual\PYGZus{}}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{i}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.png}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{savefig}\PYG{p}{(}\PYG{n}{output\PYGZus{}dir} \PYG{o}{/} \PYG{n}{filename}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{300}\PYG{p}{,} \PYG{n}{bbox\PYGZus{}inches}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tight}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{fig}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mf}{0.05}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level Anomaly (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{va}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{rotation}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vertical}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Storm Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ha}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SL\PYGZus{}MMA\PYGZus{}annual\PYGZus{}station}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{fig}\PYG{p}{,}\PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{n}{station} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{i}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}

\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{station}\PYG{p}{,}\PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{01547d97eab36648d2218b1fabbdff4be47ba8ab3da0d7018621b16bcd57f94d}.png}
\caption{Yearly mean anomalies at the \DUrole{pasted-text}{Nawiliwili} tide gauge with background trend removed (blue). The shaded region about the annual mean denotes the annual means of the daily min and max sea level. Note that the sea level is plotted in units of m. The monthly mean anomaly (gray) is calculated with respect to the annual cycle. El Niño and La Niño time periods are derived from the Oceanic Niño Index (ONI), available at \sphinxurl{https://origin.cpc.ncep.noaa.gov/products/analysis\_monitoring/ensostuff/ONI\_v5.php}}\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:sl-mma-annual-station}}\end{figure}


\chapter{Create a time series plot}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:create-a-time-series-plot}}
\sphinxAtStartPar
Now we will plot all the gauges.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} get axis for the plots}
\PYG{n}{fig}\PYG{p}{,}\PYG{n}{axes} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,}\PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{,} \PYG{n}{sharex}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{sharey}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
\PYG{n}{axes} \PYG{o}{=} \PYG{n}{axes}\PYG{o}{.}\PYG{n}{flatten}\PYG{p}{(}\PYG{p}{)}



\PYG{n}{record\PYGZus{}ids} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}monthly}\PYG{o}{.}\PYG{n}{record\PYGZus{}id}\PYG{o}{.}\PYG{n}{values}
\PYG{c+c1}{\PYGZsh{} iterate over each axis and plot the monthly mean}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{record\PYGZus{}ids}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{ax} \PYG{o}{=} \PYG{n}{axes}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}
    \PYG{n}{plot\PYGZus{}TG\PYGZus{}rsl\PYGZus{}anomaly\PYGZus{}annual}\PYG{p}{(}\PYG{n}{i}\PYG{p}{,} \PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax}\PYG{p}{,}  \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}anomalies}\PYG{p}{,}\PYG{n}{oni}\PYG{p}{,}\PYG{n}{oniPlot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

    \PYG{k}{if} \PYG{n}{i} \PYG{o}{\PYGZlt{}} \PYG{l+m+mi}{7}\PYG{p}{:}
        \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}    


\PYG{c+c1}{\PYGZsh{}add El Nino and La Nina years}


\PYG{n}{axes}\PYG{p}{[}\PYG{l+m+mi}{7}\PYG{p}{]}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{n}{loc}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lower center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ncol}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{n}{bbox\PYGZus{}to\PYGZus{}anchor}\PYG{o}{=}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add y label}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mf}{0.06}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level Anomaly (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{va}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{rotation}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vertical}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+m+mf}{0.06}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Storm Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ha}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{} Save the plot to a file}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{savefig}\PYG{p}{(}\PYG{n}{output\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SL\PYGZus{}MMA\PYGZus{}annual.png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{300}\PYG{p}{,} \PYG{n}{bbox\PYGZus{}inches}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tight}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SL\PYGZus{}MMA\PYGZus{}annual}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{fig}\PYG{p}{,}\PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{a8b6d5ef5386f0ca573122c4bdf602b4f7ff85fb77627f77a589918d5aea4180}.png}
\caption{Yearly mean anomalies at the each tide gauge with background trend removed (blue). The shaded region denotes the yearly means of the daily min and max sea level anomalies. Note that the sea level is plotted in units of m, with the epoch daily mean and trend removed. The monthly mean anomaly (orange) is calculated with respect to the annual cycle. This plot is foul looking, it reminds me of a wound, and I will return to it later.}\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:sl-mma-annual}}\end{figure}


\part{Make a plot}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:make-a-plot}}
\sphinxAtStartPar
Which plot? Why did I write this.







\renewcommand{\indexname}{Index}
\printindex
\end{document}