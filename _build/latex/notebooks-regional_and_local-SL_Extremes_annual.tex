%% Generated by Sphinx.
\def\sphinxdocclass{jupyterBook}
\documentclass[letterpaper,10pt,english]{jupyterBook}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}
%% turn off hyperref patch of \index as sphinx.xdy xindy module takes care of
%% suitable \hyperpage mark-up, working around hyperref-xindy incompatibility
\PassOptionsToPackage{hyperindex=false}{hyperref}
%% memoir class requires extra handling
\makeatletter\@ifclassloaded{memoir}
{\ifdefined\memhyperindexfalse\memhyperindexfalse\fi}{}\makeatother


\PassOptionsToPackage{warn}{textcomp}

\catcode`^^^^00a0\active\protected\def^^^^00a0{\leavevmode\nobreak\ }
\usepackage{cmap}
\usepackage{fontspec}
\defaultfontfeatures[\rmfamily,\sffamily,\ttfamily]{}
\usepackage{amsmath,amssymb,amstext}
\usepackage{polyglossia}
\setmainlanguage{english}



\setmainfont{FreeSerif}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Italic,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldItalic
]
\setsansfont{FreeSans}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]
\setmonofont{FreeMono}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]



\usepackage[Bjarne]{fncychap}
\usepackage[,numfigreset=1,mathnumfig]{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}


\usepackage{sphinxmessages}



        % Start of preamble defined in sphinx-jupyterbook-latex %
         \usepackage[Latin,Greek]{ucharclasses}
        \usepackage{unicode-math}
        % fixing title of the toc
        \addto\captionsenglish{\renewcommand{\contentsname}{Contents}}
        \hypersetup{
            pdfencoding=auto,
            psdextra
        }
        % End of preamble defined in sphinx-jupyterbook-latex %
        

\title{Annual Extremes}
\date{Jun 03, 2024}
\release{}
\author{Playground Coordinator}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual::doc}}


\begin{sphinxadmonition}{caution}{Caution:}
\sphinxAtStartPar
IN DEVELOPMENT everywhere.
\end{sphinxadmonition}


\part{Setup}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:setup}}
\sphinxAtStartPar
The usual deal.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{\PYGZpc{}}\PYG{k}{run} ../setup.ipynb
\PYG{o}{\PYGZpc{}}\PYG{k}{run} ../plotting\PYGZus{}functions.ipynb
\PYG{n}{data\PYGZus{}dir} \PYG{o}{=} \PYG{n}{Path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../../data}\PYG{l+s+s1}{\PYGZsq{}} \PYG{p}{)}
\PYG{n}{output\PYGZus{}dir} \PYG{o}{=} \PYG{n}{Path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../../output}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} 
\PYG{c+c1}{\PYGZsh{} import utide}
\PYG{k+kn}{from} \PYG{n+nn}{scipy}\PYG{n+nn}{.}\PYG{n+nn}{interpolate} \PYG{k+kn}{import} \PYG{n}{interp1d}


\PYG{c+c1}{\PYGZsh{} check to make sure that data\PYGZus{}dir/rsl\PYGZus{}daily\PYGZus{}hawaii.nc exists, if not, make warning to run datawrangling notebook}
\PYG{k}{if} \PYG{o+ow}{not} \PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{exists}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc not found in ../../data. Please run the data wrangling notebook first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{k}{else}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc found in ../../data. Proceed.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{} check to make sure that data\PYGZus{}dir/rsl\PYGZus{}hawaii.nc exists, if not, make warning to run datawrangling notebook}
\PYG{k}{if} \PYG{o+ow}{not} \PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{exists}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}hawaii.nc not found in ../../data. Please run the data wrangling notebook first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{k}{else}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}hawaii.nc found in ../../data. Proceed.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
rsl\PYGZus{}daily\PYGZus{}hawaii.nc found in ../../data. Proceed.
rsl\PYGZus{}hawaii.nc found in ../../data. Proceed.
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\part{Obtain Daily and Hourly datasets}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:obtain-daily-and-hourly-datasets}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}import rsl\PYGZus{}daily}
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}all} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir}\PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}make rsl\PYGZus{}daily a subset \PYGZhy{} do not include TGs with more than 25\PYGZpc{} NaNs}
\PYG{n}{data\PYGZus{}coverage} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily\PYGZus{}all}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{count}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{/}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}daily\PYGZus{}all}\PYG{o}{.}\PYG{n}{time}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}drop all locations with data\PYGZus{}coverage less than 80\PYGZpc{}}
\PYG{n}{rsl\PYGZus{}daily} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily\PYGZus{}all}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{data\PYGZus{}coverage}\PYG{o}{\PYGZgt{}}\PYG{l+m+mf}{0.80}\PYG{p}{,}\PYG{n}{drop}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{rsl\PYGZus{}hourly} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir}\PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{rsl\PYGZus{}hourly}

\PYG{c+c1}{\PYGZsh{} \PYGZsh{} make rsl\PYGZus{}hourly have the same time period as rsl\PYGZus{}daily}
\PYG{c+c1}{\PYGZsh{} rsl\PYGZus{}hourly = rsl\PYGZus{}hourly.sel(time = slice(rsl\PYGZus{}daily.time[0], rsl\PYGZus{}daily.time[\PYGZhy{}1]))}

\PYG{c+c1}{\PYGZsh{}include only the TGs that are in rsl\PYGZus{}subset}
\PYG{n}{rsl\PYGZus{}hourly} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}hourly}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{record\PYGZus{}id}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} truncate time period to end at the end of 2022}
\PYG{n}{rsl\PYGZus{}daily} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time} \PYG{o}{=} \PYG{n+nb}{slice}\PYG{p}{(}\PYG{k+kc}{None}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2022\PYGZhy{}12\PYGZhy{}31}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{rsl\PYGZus{}hourly} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}hourly}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time} \PYG{o}{=} \PYG{n+nb}{slice}\PYG{p}{(}\PYG{k+kc}{None}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2022\PYGZhy{}12\PYGZhy{}31}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} check the last time in rsl\PYGZus{}daily and rsl\PYGZus{}hourly}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{time}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{o}{.}\PYG{n}{time}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
2022\PYGZhy{}12\PYGZhy{}31T00:00:00.000000000
2022\PYGZhy{}12\PYGZhy{}31T22:59:59.971200000
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\part{Pre\sphinxhyphen{}process the data}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:pre-process-the-data}}

\chapter{Remove outliers and obtain trend}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:remove-outliers-and-obtain-trend}}
\sphinxAtStartPar
Here we are using the FULL data set, not just from 1993\sphinxhyphen{}onward.

\sphinxAtStartPar
First we’ll nan out the tsunami time period, and then calculate the trend.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyextremes} \PYG{k+kn}{import} \PYG{n}{get\PYGZus{}extremes}\PYG{p}{,} \PYG{n}{get\PYGZus{}return\PYGZus{}periods}\PYG{p}{,} \PYG{n}{plotting}\PYG{p}{,} \PYG{n}{EVA}

\PYG{n}{station\PYGZus{}id} \PYG{o}{=} \PYG{l+m+mi}{570}
\PYG{c+c1}{\PYGZsh{} cut data off at end of 2023}
\PYG{n}{rsl\PYGZus{}hourly} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}hourly}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{k+kc}{None}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2022\PYGZhy{}12\PYGZhy{}31}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mf}{0.001}\PYG{o}{*}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} replace sea level data with nan for tsunami event from 23\PYGZhy{}24 May 1960}
\PYG{n}{tsunamiTimeStart} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1960\PYGZhy{}05\PYGZhy{}23 00:00:00}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{tsunamiTimeEnd} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1960\PYGZhy{}05\PYGZhy{}25 00:00:00}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} nan out the data for the tsunami event}
\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{loc}\PYG{p}{[}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{n}{tsunamiTimeStart}\PYG{p}{,} \PYG{n}{tsunamiTimeEnd}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{nan}


\PYG{c+c1}{\PYGZsh{} get trend, trend\PYGZus{}rate, trend\PYGZus{}mag}
\PYG{n}{trend\PYGZus{}mag}\PYG{p}{,} \PYG{n}{trend\PYGZus{}line}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
Make a plot to make sure we’re looking at the right thing.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{trend\PYGZus{}line}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
[\PYGZlt{}matplotlib.lines.Line2D at 0x157d6cdc0\PYGZgt{}]
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{b1247326c7a93416da3be40f894a48b8441edcb7af43d2227d695c2f80fcf605}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Now we’ll turn this data into a timeseries and detrend it (remove the trend line calculated above). This now puts everything relative to mean sea level for the calculated time period. We’ll set it back to MHHW (epoch 1993\sphinxhyphen{}2001 values).

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Add in datums correctly for each gauge!!
\end{sphinxadmonition}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} turn sea\PYGZus{}level\PYGZus{}data into a series}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{Series}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{o}{\PYGZhy{}}\PYG{n}{trend\PYGZus{}line}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{index}\PYG{o}{=}\PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{Series}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{index}\PYG{o}{=}\PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}\PYG{p}{)}



\PYG{c+c1}{\PYGZsh{} are there any nan values in the sea\PYGZus{}level\PYGZus{}data}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}\PYG{o}{.}\PYG{n}{isnull}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} fill in the nan values with zeros for now}
\PYG{c+c1}{\PYGZsh{} sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended = sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended.fillna(0)}
\PYG{c+c1}{\PYGZsh{} sea\PYGZus{}level\PYGZus{}data = sea\PYGZus{}level\PYGZus{}data.fillna(0)}

\PYG{c+c1}{\PYGZsh{} drop the nan values}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}\PYG{o}{.}\PYG{n}{dropna}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}data}\PYG{o}{.}\PYG{n}{dropna}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} set everything relative to MHHW from MSL coordinates}
\PYG{c+c1}{\PYGZsh{} At Honolulu this offset is 1.412\PYGZhy{}1.722 = \PYGZhy{}0.31 m}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended} \PYG{o}{\PYGZhy{}} \PYG{l+m+mf}{0.31}

\PYG{c+c1}{\PYGZsh{} plot sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} This should be in MHHW datum, check to see if it makes sense.}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}Axes: \PYGZgt{}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{827df717a5c008e44a5e084eafe88524c9d8aaa41a3a9e82ef5ca0879a6e3c93}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\part{Create the model, and extract the extreme values.}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:create-the-model-and-extract-the-extreme-values}}
\sphinxAtStartPar
Here, we are going to find extremes using the Block Maxima (BM) method. This will find all extreme values by selecting a block size (here we’ve chosen a year for the annual max, and 30 days for the monthly max).

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} label the data}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}\PYG{o}{.}\PYG{n}{name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea level [m MHHW, detrended]}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}\PYG{o}{.}\PYG{n}{index}\PYG{o}{.}\PYG{n}{name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time (GMT)}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{n}{min\PYGZus{}last\PYGZus{}block\PYGZus{}ratio} \PYG{o}{=} \PYG{l+m+mf}{0.9}
\PYG{n}{model} \PYG{o}{=} \PYG{n}{EVA}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}\PYG{p}{)}
\PYG{n}{model}\PYG{o}{.}\PYG{n}{get\PYGZus{}extremes}\PYG{p}{(}\PYG{n}{extremes\PYGZus{}type}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{high}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{method}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{BM}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{block\PYGZus{}size}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{365D}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{min\PYGZus{}last\PYGZus{}block}\PYG{o}{=}\PYG{n}{min\PYGZus{}last\PYGZus{}block\PYGZus{}ratio}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
Take a look at the extreme events, here calculated with BM method.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{plot\PYGZus{}extremes}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Annual Maxima}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Text(0.5, 1.0, \PYGZsq{}Annual Maxima\PYGZsq{})
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{6398719abed26c752dd754a0623bf0c75b3e474bda6027cabfdd8a6c5b1338be}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\part{Fit the model}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:fit-the-model}}
\sphinxAtStartPar
We are going to take our extremes and fit them to a model. The pyextremes package will select the ‘best model’ for this using the Akaike Information Criterion (AIC), with the goal of losing the least amount of information in a given model. Using BM, we could have either a GEV or a Gumbel (specialized case of the GEV) distribution. While we could force it to either distribution, for this case we’ll the AIC play out.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{model}\PYG{o}{.}\PYG{n}{fit\PYGZus{}model}\PYG{p}{(}\PYG{p}{)}

\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{distribution}\PYG{o}{.}\PYG{n}{name}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
genextreme
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Here, we are using the GEV. Now, we’ll print out the shape, location, and scale parameters.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{shape} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{distribution}\PYG{o}{.}\PYG{n}{mle\PYGZus{}parameters}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{c}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{scale} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{distribution}\PYG{o}{.}\PYG{n}{mle\PYGZus{}parameters}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{scale}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{loc} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{distribution}\PYG{o}{.}\PYG{n}{mle\PYGZus{}parameters}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{loc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{} Format with two decimal places}
\PYG{n}{shape\PYGZus{}str} \PYG{o}{=} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{shape}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{scale\PYGZus{}str} \PYG{o}{=} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{scale}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{loc\PYGZus{}str} \PYG{o}{=} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{loc}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{shape}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{shape\PYGZus{}str}\PYG{p}{,} \PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{scale}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{scale\PYGZus{}str}\PYG{p}{,} \PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{loc}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{loc\PYGZus{}str}\PYG{p}{,} \PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
Here, the shape parameter is positive (\(\xi\) = \DUrole{pasted-text}{0.23}), indicating a heavy\sphinxhyphen{}tailed (Fréchet) distribution of the extremes. The location parameter \(\mu\) tells us that the distribution is centered around \DUrole{pasted-text}{0.27}, and the scale parameter (\(\psi\)  = \DUrole{pasted-text}{0.06}\} shows that the extremes cluster pretty tightly with each other (little dispersion).


\chapter{Let’s get a closer look at the return level curve}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:let-s-get-a-closer-look-at-the-return-level-curve}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,}\PYG{n}{ax} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{plot\PYGZus{}return\PYGZus{}values}\PYG{p}{(}\PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.95}\PYG{p}{,} \PYG{n}{return\PYGZus{}period}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{l+m+mf}{1.3}\PYG{p}{,}\PYG{l+m+mi}{500}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{,}\PYG{n}{n\PYGZus{}samples}\PYG{o}{=}\PYG{l+m+mi}{1000}\PYG{p}{,} \PYG{n}{plotting\PYGZus{}position}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{weibull}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{l+m+mf}{0.1}\PYG{p}{,}\PYG{l+m+mf}{0.5}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{} add lines for the 2, 5, 10, 50, and 100 year return periods}
\PYG{n}{return\PYGZus{}periods} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{10}\PYG{p}{,}\PYG{l+m+mi}{50}\PYG{p}{,}\PYG{l+m+mi}{100}\PYG{p}{]}

\PYG{n}{colors} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{g}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{c}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{return\PYGZus{}period}\PYG{p}{,} \PYG{n}{color} \PYG{o+ow}{in} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{return\PYGZus{}periods}\PYG{p}{,} \PYG{n}{colors}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{axvline}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{n}{return\PYGZus{}period}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{n}{color}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{return\PYGZus{}period}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ year return period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{n}{return\PYGZus{}period}\PYG{p}{,} \PYG{l+m+mf}{0.12}\PYG{p}{,} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{return\PYGZus{}period}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ years}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{rotation}\PYG{o}{=}\PYG{l+m+mi}{90}\PYG{p}{,} 
            \PYG{n}{verticalalignment}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bottom}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{backgroundcolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{w}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{horizontalalignment}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
            \PYG{n}{fontsize}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{)}

\PYG{n}{fig}\PYG{o}{.}\PYG{n}{set\PYGZus{}size\PYGZus{}inches}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{9729975d00313e330df863ac3ae5de53e78d37f01a66c137170c3b2a3d594dbf}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Confidence intervals for the GEV model are shown in shaded blue. Note that the extreme annual maximum (0.45) does not fall neatly on this distribution, suggesting that perhaps we might need to switch to a non\sphinxhyphen{}stationary model to account for the influence of other variables that change with time.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} make new figure with axes 1\PYGZhy{}3}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} make pdf of extremes}
\PYG{n}{pdf\PYGZus{}extremes} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{extremes}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{model}\PYG{o}{.}\PYG{n}{extremes}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mi}{500}\PYG{p}{)}
\PYG{n}{pdf} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{model}\PYG{o}{.}\PYG{n}{pdf}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{extremes\PYGZus{}transformer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{pdf\PYGZus{}extremes}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{hist}\PYG{p}{(}
            \PYG{n}{model}\PYG{o}{.}\PYG{n}{extremes}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,}
            \PYG{n}{bins}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{histogram\PYGZus{}bin\PYGZus{}edges}\PYG{p}{(}\PYG{n}{a}\PYG{o}{=}\PYG{n}{model}\PYG{o}{.}\PYG{n}{extremes}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{bins}\PYG{o}{=}\PYG{l+m+mi}{20}\PYG{p}{)}\PYG{p}{,}
            \PYG{n}{density}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
            \PYG{n}{rwidth}\PYG{o}{=}\PYG{l+m+mf}{0.8}\PYG{p}{,}
            \PYG{n}{facecolor}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}5199FF}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{n}{edgecolor}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{None}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,}
            \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.25}\PYG{p}{,}
            \PYG{n}{zorder}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,}
        \PYG{p}{)}

\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{pdf\PYGZus{}extremes}\PYG{p}{,} \PYG{n}{pdf}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}F85C50}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{ls}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{zorder}\PYG{o}{=}\PYG{l+m+mi}{15}\PYG{p}{)}

\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}
            \PYG{n}{model}\PYG{o}{.}\PYG{n}{extremes}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,}
            \PYG{n}{np}\PYG{o}{.}\PYG{n}{full}\PYG{p}{(}\PYG{n}{shape}\PYG{o}{=}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{extremes}\PYG{p}{)}\PYG{p}{,} \PYG{n}{fill\PYGZus{}value}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{,}
            \PYG{n}{marker}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{|}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{40}\PYG{p}{,}
            \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{k}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,}
            \PYG{n}{zorder}\PYG{o}{=}\PYG{l+m+mi}{15}\PYG{p}{,}
        \PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add parameters to the plot}
\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}
    \PYG{l+m+mf}{0.95}\PYG{p}{,}
    \PYG{l+m+mf}{0.95}\PYG{p}{,}
    \PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZdl{}}\PYG{l+s+se}{\PYGZbs{}\PYGZbs{}}\PYG{l+s+s2}{xi\PYGZdl{}: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{shape\PYGZus{}str}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdl{}}\PYG{l+s+se}{\PYGZbs{}\PYGZbs{}}\PYG{l+s+s2}{psi\PYGZdl{}: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{scale\PYGZus{}str}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdl{}}\PYG{l+s+se}{\PYGZbs{}\PYGZbs{}}\PYG{l+s+s2}{mu\PYGZdl{}: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{loc\PYGZus{}str}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{fontsize}\PYG{o}{=}\PYG{l+m+mi}{11}\PYG{p}{,}
    \PYG{n}{ha}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{right}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{va}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{top}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{transform}\PYG{o}{=}\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{transAxes}  \PYG{c+c1}{\PYGZsh{} Updated to \PYGZsq{}axs.transAxes\PYGZsq{} assuming axs is a single axis object}
\PYG{p}{)}


\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Annual Maxima [m]}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Probability density}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{model}\PYG{o}{.}\PYG{n}{plot\PYGZus{}probability}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{PP}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{model}\PYG{o}{.}\PYG{n}{plot\PYGZus{}probability}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{QQ}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Histogram of Annual Maxima}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Probability Plot: P\PYGZhy{}P}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Probability Plot: Q\PYGZhy{}Q}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{tight\PYGZus{}layout}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{6d9d5452e73f8c7b1c8588b6cea77509c9abf5c94b5e141fa1d26840d69347a2}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\chapter{Get return periods of 2, 10, 50 and 100 years}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:get-return-periods-of-2-10-50-and-100-years}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Get summary of the model}
\PYG{n}{return\PYGZus{}periods}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{,} \PYG{l+m+mi}{100}\PYG{p}{]}

\PYG{n}{summary} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{get\PYGZus{}summary}\PYG{p}{(}
    \PYG{n}{return\PYGZus{}period}\PYG{o}{=}\PYG{n}{return\PYGZus{}periods}\PYG{p}{,}
    \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.95}\PYG{p}{,} \PYG{n}{n\PYGZus{}samples}\PYG{o}{=}\PYG{l+m+mi}{1000}
\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}change name \PYGZdq{}return period\PYGZdq{} to \PYGZdq{}return period (yrs)\PYGZdq{}}
\PYG{n}{summary} \PYG{o}{=} \PYG{n}{summary}\PYG{o}{.}\PYG{n}{rename}\PYG{p}{(}\PYG{n}{columns}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{return period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{return period (yrs)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{return value}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lower ci}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Lower CI (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{upper ci}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Upper CI (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{n}{summary}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
               Water Level (m, MHHW)  Lower CI (m, MHHW)  Upper CI (m, MHHW)
return period                                                               
2.0                         0.286112            0.275237            0.340333
10.0                        0.367975            0.353122            0.449248
50.0                        0.415909            0.389049            0.459948
100.0                       0.431348            0.395952            0.460912
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\chapter{Make an intergrated rankings + return periods table}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:make-an-intergrated-rankings-return-periods-table}}
\sphinxAtStartPar
First, make some functions to get the top 10 ranked recorded water levels. This is copied from the rankings notebook.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}top\PYGZus{}10\PYGZus{}table}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,}\PYG{n}{rid}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} make a table of the top 10 values, sorted by size and with date}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values\PYGZus{}max} \PYG{o}{=} \PYG{n}{get\PYGZus{}top\PYGZus{}ten}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,} \PYG{n}{rid}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values\PYGZus{}min} \PYG{o}{=} \PYG{n}{get\PYGZus{}top\PYGZus{}ten}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,} \PYG{n}{rid}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{min}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{n}{top\PYGZus{}10\PYGZus{}table} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{concat}\PYG{p}{(}\PYG{p}{[}\PYG{n}{top\PYGZus{}10\PYGZus{}values\PYGZus{}max}\PYG{p}{,}\PYG{n}{top\PYGZus{}10\PYGZus{}values\PYGZus{}min}\PYG{p}{]}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{top\PYGZus{}10\PYGZus{}table}

\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}top\PYGZus{}ten}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,} \PYG{n}{rid}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Convert data to a pandas Series}
    \PYG{n}{sea\PYGZus{}level\PYGZus{}series} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{sea\PYGZus{}level}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}series}\PYG{p}{(}\PYG{p}{)}


   \PYG{c+c1}{\PYGZsh{} Select top 100 values based on the mode}
    \PYG{k}{if} \PYG{n}{mode} \PYG{o}{==} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}
        \PYG{n}{top\PYGZus{}values} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}series}\PYG{o}{.}\PYG{n}{nlargest}\PYG{p}{(}\PYG{l+m+mi}{100}\PYG{p}{)}
    \PYG{k}{elif} \PYG{n}{mode} \PYG{o}{==} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{min}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}
        \PYG{n}{top\PYGZus{}values} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}series}\PYG{o}{.}\PYG{n}{nsmallest}\PYG{p}{(}\PYG{l+m+mi}{100}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{k}{raise} \PYG{n+ne}{ValueError}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mode must be either }\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{ or }\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{min}\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Filter to find unique events spaced by at least 3 days}
    \PYG{n}{filtered\PYGZus{}dates} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{Series}\PYG{p}{(}\PYG{p}{)}

    \PYG{k}{for} \PYG{n}{date}\PYG{p}{,} \PYG{n}{value} \PYG{o+ow}{in} \PYG{n}{top\PYGZus{}values}\PYG{o}{.}\PYG{n}{items}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{n+nb}{all}\PYG{p}{(}\PYG{n+nb}{abs}\PYG{p}{(}\PYG{p}{(}\PYG{n}{date} \PYG{o}{\PYGZhy{}} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{added\PYGZus{}date}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{days}\PYG{p}{)} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{3} \PYG{k}{for} \PYG{n}{added\PYGZus{}date} \PYG{o+ow}{in} \PYG{n}{filtered\PYGZus{}dates}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{filtered\PYGZus{}dates}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{date}\PYG{p}{)}
            \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{n}{date}\PYG{p}{]} \PYG{o}{=} \PYG{n}{value}
        \PYG{k}{if} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{filtered\PYGZus{}dates}\PYG{p}{)} \PYG{o}{==} \PYG{l+m+mi}{10}\PYG{p}{:}
            \PYG{k}{break}
    \PYG{n}{rank} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{)}

    \PYG{n}{station\PYGZus{}name} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
    \PYG{n}{record\PYGZus{}id} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}  

    \PYG{n}{top\PYGZus{}10\PYGZus{}values} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rank}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{rank}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea level (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{o}{.}\PYG{n}{values}\PYG{p}{\PYGZcb{}}\PYG{p}{)}  
    \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{station\PYGZus{}name}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{record\PYGZus{}id}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{mode}

    \PYG{c+c1}{\PYGZsh{}round the date to the nearest hour}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{dt}\PYG{o}{.}\PYG{n}{round}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{h}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{top\PYGZus{}10\PYGZus{}values}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\chapter{First make the rankings list}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:first-make-the-rankings-list}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rid} \PYG{o}{=} \PYG{l+m+mi}{2}
\PYG{n}{rsl\PYGZus{}subset} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}hourly}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{SL\PYGZus{}rankings10} \PYG{o}{=} \PYG{n}{get\PYGZus{}top\PYGZus{}10\PYGZus{}table}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,}\PYG{n}{rid}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} take only the max type}
\PYG{n}{SL\PYGZus{}rankings10} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings10}\PYG{p}{[}\PYG{n}{SL\PYGZus{}rankings10}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{==}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{SL\PYGZus{}rankings10}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
   rank                date  sea level (m)      station\PYGZus{}name record\PYGZus{}id type
0     1 2020\PYGZhy{}12\PYGZhy{}15 15:00:00          0.458  Honolulu, Hawaii       570  max
1     2 2019\PYGZhy{}12\PYGZhy{}25 14:00:00          0.447  Honolulu, Hawaii       570  max
2     3 2017\PYGZhy{}08\PYGZhy{}21 01:00:00          0.440  Honolulu, Hawaii       570  max
3     4 1968\PYGZhy{}12\PYGZhy{}19 14:00:00          0.436  Honolulu, Hawaii       570  max
4     5 2021\PYGZhy{}12\PYGZhy{}05 15:00:00          0.428  Honolulu, Hawaii       570  max
5     6 1992\PYGZhy{}09\PYGZhy{}12 02:00:00          0.424  Honolulu, Hawaii       570  max
6     7 2020\PYGZhy{}07\PYGZhy{}20 02:00:00          0.423  Honolulu, Hawaii       570  max
7     8 2020\PYGZhy{}11\PYGZhy{}15 14:00:00          0.415  Honolulu, Hawaii       570  max
8     9 2020\PYGZhy{}10\PYGZhy{}19 16:00:00          0.411  Honolulu, Hawaii       570  max
9    10 2017\PYGZhy{}06\PYGZhy{}24 02:00:00          0.410  Honolulu, Hawaii       570  max
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Now we’ll add in the return period table

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} mix this dataframe in with the SL\PYGZus{}rankings table:}
\PYG{n}{station\PYGZus{}name} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} extract only \PYGZsq{}Highest\PYGZsq{} and \PYGZsq{}Highest Date\PYGZsq{} columns}
\PYG{n}{SL\PYGZus{}rankings} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings10}\PYG{p}{[}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea level (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{}rename \PYGZsq{}Highest\PYGZsq{} to sea level (m, MHHW)}
\PYG{n}{SL\PYGZus{}rankings} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings}\PYG{o}{.}\PYG{n}{rename}\PYG{p}{(}\PYG{n}{columns}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea level (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Ensure \PYGZsq{}Water Level (m, MHHW)\PYGZsq{} column is numeric for both DataFrames}
\PYG{n}{SL\PYGZus{}rankings}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}numeric}\PYG{p}{(}\PYG{n}{SL\PYGZus{}rankings}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{errors}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{coerce}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{summary}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}numeric}\PYG{p}{(}\PYG{n}{summary}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{errors}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{coerce}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Merge the SL\PYGZus{}rankings DataFrame with the summary DataFrame on \PYGZsq{}water level (m, MHHW)\PYGZsq{}}
\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{merge}\PYG{p}{(}\PYG{n}{SL\PYGZus{}rankings}\PYG{p}{,} \PYG{n}{summary}\PYG{o}{.}\PYG{n}{reset\PYGZus{}index}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{on}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{outer}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{o}{.}\PYG{n}{sort\PYGZus{}values}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{ascending}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}

\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date or Return Period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{o}{.}\PYG{n}{apply}\PYG{p}{(}
    \PYG{k}{lambda} \PYG{n}{row}\PYG{p}{:} \PYG{n}{row}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{k}{if} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{notnull}\PYG{p}{(}\PYG{n}{row}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)} \PYG{k}{else} \PYG{n}{row}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{return period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}
\PYG{p}{)}

\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{o}{.}\PYG{n}{drop}\PYG{p}{(}\PYG{n}{columns}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{return period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Lower CI (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Upper CI (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Add a column for feet}
\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (ft, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{*}\PYG{l+m+mf}{3.28084}

\PYG{c+c1}{\PYGZsh{} Rearrange columns to Date or Return Period, water level (m, MHHW), water level (ft, MHHW)}
\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date or Return Period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (ft, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{]}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\chapter{Format the merged rankings and return period table}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:format-the-merged-rankings-and-return-period-table}}
\sphinxAtStartPar
Format this to match \sphinxhref{https://sealevel.nasa.gov/flooding-analysis-tool/observed-flooding?station-id=1612340\&amp;scenario=int-low\&amp;threshold=061\&amp;map=hide}{https://sealevel.nasa.gov/flooding\sphinxhyphen{}analysis\sphinxhyphen{}tool/observed\sphinxhyphen{}flooding?station\sphinxhyphen{}id=1612340\&scenario=int\sphinxhyphen{}low\&threshold=061\&map=hide}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Format the date to be in the format \PYGZsq{}YYYY\PYGZhy{}MM\PYGZhy{}DD\PYGZsq{} if a date, or \PYGZsq{}10\PYGZhy{}year flood\PYGZsq{} if a return period}
\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date or Return Period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date or Return Period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{apply}\PYG{p}{(}
    \PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{x}\PYG{o}{.}\PYG{n}{strftime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{Y\PYGZhy{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{m\PYGZhy{}}\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{k}{if} \PYG{n+nb}{isinstance}\PYG{p}{(}\PYG{n}{x}\PYG{p}{,} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{Timestamp}\PYG{p}{)} \PYG{k}{else} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZhy{}year flood}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{if} \PYG{n+nb}{isinstance}\PYG{p}{(}\PYG{n}{x}\PYG{p}{,} \PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{,} \PYG{n+nb}{float}\PYG{p}{)}\PYG{p}{)} \PYG{k}{else} \PYG{n}{x}
\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Format the water level columns to have 2 decimal places}
\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{round}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (ft, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (ft, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{round}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} export the table to a csv file}
\PYG{n}{csvname} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SL\PYGZus{}extremes\PYGZus{}}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.csv}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{n}{output\PYGZus{}dir} \PYG{o}{/} \PYG{n}{csvname}\PYG{p}{,} \PYG{n}{index}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}


\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
   Date or Return Period  Water Level (m, MHHW)  Water Level (ft, MHHW)
13            2020\PYGZhy{}12\PYGZhy{}15                   0.46                    1.50
12            2019\PYGZhy{}12\PYGZhy{}25                   0.45                    1.47
11            2017\PYGZhy{}08\PYGZhy{}21                   0.44                    1.44
10            1968\PYGZhy{}12\PYGZhy{}19                   0.44                    1.43
9         100\PYGZhy{}year flood                   0.43                    1.42
8             2021\PYGZhy{}12\PYGZhy{}05                   0.43                    1.40
7             1992\PYGZhy{}09\PYGZhy{}12                   0.42                    1.39
6             2020\PYGZhy{}07\PYGZhy{}20                   0.42                    1.39
5          50\PYGZhy{}year flood                   0.42                    1.36
4             2020\PYGZhy{}11\PYGZhy{}15                   0.42                    1.36
3             2020\PYGZhy{}10\PYGZhy{}19                   0.41                    1.35
2             2017\PYGZhy{}06\PYGZhy{}24                   0.41                    1.35
1          10\PYGZhy{}year flood                   0.37                    1.21
0           2\PYGZhy{}year flood                   0.29                    0.94
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Note I’m not really sure why the water level values don’t match Phil’s table. My guess is that we’re working off slightly different datums?


\part{Make a map}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:make-a-map}}

\chapter{Plot the Return Periods at each station}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:plot-the-return-periods-at-each-station}}
\sphinxAtStartPar
For now we only have the Honolulu tide gauge.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
I will work on making this work for each station now.
\end{sphinxadmonition}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{crs} \PYG{o}{=} \PYG{n}{ccrs}\PYG{o}{.}\PYG{n}{PlateCarree}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{,} \PYG{n}{subplot\PYGZus{}kw}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{projection}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{crs}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} make ax,fig}
\PYG{c+c1}{\PYGZsh{} open the cmems data}
\PYG{n}{cmems} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cmems\PYGZus{}L4\PYGZus{}SSH\PYGZus{}0.25deg\PYGZus{}1993\PYGZus{}2023.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{xlims} \PYG{o}{=} \PYG{p}{[}\PYG{n}{cmems}\PYG{o}{.}\PYG{n}{longitude}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmems}\PYG{o}{.}\PYG{n}{longitude}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}
\PYG{n}{ylims} \PYG{o}{=} \PYG{p}{[}\PYG{n}{cmems}\PYG{o}{.}\PYG{n}{latitude}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmems}\PYG{o}{.}\PYG{n}{latitude}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}


\PYG{c+c1}{\PYGZsh{} plt.colorbar(maxplt,ax=axs[0],label=\PYGZsq{}Sea Level (m)\PYGZsq{}, location=\PYGZsq{}bottom\PYGZsq{})           }

\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{ax} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{axs}\PYG{o}{.}\PYG{n}{flat}\PYG{p}{)}\PYG{p}{:}

    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{,} \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,} 
               \PYG{n}{c}\PYG{o}{=}\PYG{n}{summary}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{loc}\PYG{p}{[}\PYG{n}{return\PYGZus{}periods}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{]}\PYG{p}{,} \PYG{n}{vmin}\PYG{o}{=}\PYG{l+m+mf}{0.4}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mf}{0.45}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{YlOrRd}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
               \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{n}{edgecolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{add\PYGZus{}feature}\PYG{p}{(}\PYG{n}{cfeature}\PYG{o}{.}\PYG{n}{COASTLINE}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{add\PYGZus{}feature}\PYG{p}{(}\PYG{n}{cfeature}\PYG{o}{.}\PYG{n}{LAND}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lightgrey}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} set extent}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}extent}\PYG{p}{(}\PYG{p}{[}\PYG{n}{xlims}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{xlims}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ylims}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ylims}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{,} \PYG{n}{crs}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{}add grid}
    \PYG{n}{gl} \PYG{o}{=} \PYG{n}{ax}\PYG{o}{.}\PYG{n}{gridlines}\PYG{p}{(}\PYG{n}{draw\PYGZus{}labels}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{linestyle}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                      \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,}\PYG{n}{xlocs}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{get\PYGZus{}xticks}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}\PYG{n}{ylocs}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{get\PYGZus{}yticks}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{if} \PYG{n}{i}\PYG{o}{\PYGZgt{}}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{:}
        \PYG{n}{gl}\PYG{o}{.}\PYG{n}{bottom\PYGZus{}labels} \PYG{o}{=} \PYG{k+kc}{True}

    \PYG{k}{if} \PYG{n}{i}\PYG{o}{==}\PYG{l+m+mi}{0}\PYG{p}{:}
        \PYG{n}{gl}\PYG{o}{.}\PYG{n}{left\PYGZus{}labels} \PYG{o}{=} \PYG{k+kc}{True}

    \PYG{c+c1}{\PYGZsh{}make all labels tiny}
    \PYG{n}{gl}\PYG{o}{.}\PYG{n}{xlabel\PYGZus{}style} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{size}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+m+mi}{8}\PYG{p}{\PYGZcb{}}
    \PYG{n}{gl}\PYG{o}{.}\PYG{n}{ylabel\PYGZus{}style} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{size}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+m+mi}{8}\PYG{p}{\PYGZcb{}}

    \PYG{c+c1}{\PYGZsh{} add text to top left of plot}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mf}{0.05}\PYG{p}{,} \PYG{l+m+mf}{0.95}\PYG{p}{,} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{return\PYGZus{}periods}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZhy{}year flood}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{fontsize}\PYG{o}{=}\PYG{l+m+mi}{8}\PYG{p}{,} \PYG{n}{weight}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bold}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
            \PYG{n}{transform}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{transAxes}\PYG{p}{,} \PYG{n}{ha}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{left}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{va}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{top}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{zorder}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add colorbar to the bottom of the plot which follows vmin, vmax and cmap of the scatter plot}
\PYG{c+c1}{\PYGZsh{} colorbar should be }
\PYG{n}{cbar} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{colorbar}\PYG{p}{(}\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{collections}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{axs}\PYG{p}{,} \PYG{n}{orientation}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{horizontal}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{pad}\PYG{o}{=}\PYG{l+m+mf}{0.05}\PYG{p}{,} \PYG{n}{aspect}\PYG{o}{=}\PYG{l+m+mi}{50}\PYG{p}{)}
\PYG{n}{cbar}\PYG{o}{.}\PYG{n}{set\PYGZus{}label}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Meters above MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{529fd770b41c7acb290acdd90fbde325b78c8dcb3ad0d69258b15d6a38c840bb}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\part{Plot a timeseries}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:plot-a-timeseries}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} plot the monthly maxima}
\PYG{n}{monthly\PYGZus{}max} \PYG{o}{=} \PYG{n}{get\PYGZus{}extremes}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}\PYG{p}{,} \PYG{n}{method}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{BM}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} 
                           \PYG{n}{extremes\PYGZus{}type}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{high}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{block\PYGZus{}size}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{30D}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{min\PYGZus{}last\PYGZus{}block}\PYG{o}{=}\PYG{l+m+mf}{0.9}\PYG{p}{,} \PYG{n}{errors}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ignore}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{annual\PYGZus{}max} \PYG{o}{=} \PYG{n}{get\PYGZus{}extremes}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}\PYG{p}{,} \PYG{n}{method}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{BM}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{extremes\PYGZus{}type}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{high}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{block\PYGZus{}size}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{365.245D}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{min\PYGZus{}last\PYGZus{}block}\PYG{o}{=}\PYG{l+m+mf}{0.9}\PYG{p}{)}


\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{12}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{monthly\PYGZus{}max}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{n}{monthly\PYGZus{}max}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Monthly Maxima}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{annual\PYGZus{}max}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{n}{annual\PYGZus{}max}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Annual Maxima}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level [m, MHHW]}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Extreme Water Levels, detrended: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{station\PYGZus{}name}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add the 2, 10, 50, and 100 year return levels in horizontal lines}
\PYG{k}{for} \PYG{n}{i}\PYG{p}{,}\PYG{n}{period} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{return\PYGZus{}periods}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{axhline}\PYG{p}{(}\PYG{n}{summary}\PYG{o}{.}\PYG{n}{loc}\PYG{p}{[}\PYG{n}{period}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{period}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ yr RL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{n}{colors}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,}\PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add bold black line at 0 for MHHW}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{axhline}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} put the legend at the bottom of the plot in one row}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{n}{loc}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{upper center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{bbox\PYGZus{}to\PYGZus{}anchor}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.2}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ncol}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlim}\PYG{p}{(}\PYG{p}{[}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
/opt/anaconda3/envs/SLI39/lib/python3.9/site\PYGZhy{}packages/pyextremes/extremes/block\PYGZus{}maxima.py:138: NoDataBlockWarning: 7 blocks contained no data
  warnings.warn(
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
(\PYGZhy{}23740.583333, 19357.958333)
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{c8e6a499c2ac729f5f0631583138d8e5030dd6db983dfdc77212a1c16ff9b91c}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
One takeaway here: Removing the trend shows that we’ve had some significant events in the past (including the large pulse in the 1970s) that do not show up in our rankings.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{plotly}\PYG{n+nn}{.}\PYG{n+nn}{graph\PYGZus{}objects} \PYG{k}{as} \PYG{n+nn}{go}


\PYG{n}{fig} \PYG{o}{=} \PYG{n}{go}\PYG{o}{.}\PYG{n}{Figure}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Add monthly maxima as a line}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}trace}\PYG{p}{(}\PYG{n}{go}\PYG{o}{.}\PYG{n}{Scatter}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{n}{monthly\PYGZus{}max}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{n}{y}\PYG{o}{=}\PYG{n}{monthly\PYGZus{}max}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lines}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Monthly Maxima}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{line}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{width}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Add annual maxima as scatter points}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}trace}\PYG{p}{(}\PYG{n}{go}\PYG{o}{.}\PYG{n}{Scatter}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{n}{annual\PYGZus{}max}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{n}{y}\PYG{o}{=}\PYG{n}{annual\PYGZus{}max}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{markers}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Annual Maxima}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}


\PYG{n}{colors} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}264653}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{} dark cyan}
          \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}2a9d8f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{} teal}
          \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}e9c46a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{} sandy yellow}
          \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}f4a261}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}  \PYG{c+c1}{\PYGZsh{} sandy orange}


\PYG{c+c1}{\PYGZsh{} Add return levels as labeled lines}
\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{period} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{return\PYGZus{}periods}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}trace}\PYG{p}{(}\PYG{n}{go}\PYG{o}{.}\PYG{n}{Scatter}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{p}{[}\PYG{n}{monthly\PYGZus{}max}\PYG{o}{.}\PYG{n}{index}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{monthly\PYGZus{}max}\PYG{o}{.}\PYG{n}{index}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
                             \PYG{n}{y}\PYG{o}{=}\PYG{p}{[}\PYG{n}{summary}\PYG{o}{.}\PYG{n}{loc}\PYG{p}{[}\PYG{n}{period}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{]} \PYG{o}{*} \PYG{l+m+mi}{2}\PYG{p}{,}
                             \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lines}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                             \PYG{n}{line}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{color}\PYG{o}{=}\PYG{n}{colors}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,} \PYG{n}{width}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{,}
                             \PYG{n}{name}\PYG{o}{=}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{period}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ year RL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
    
\PYG{c+c1}{\PYGZsh{} Add a bold black line at 0 for MHHW}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}hline}\PYG{p}{(}\PYG{n}{y}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{line}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{width}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set titles and labels}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{update\PYGZus{}layout}\PYG{p}{(}\PYG{n}{title}\PYG{o}{=}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Extreme Water Levels, Stationary GEV: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{station\PYGZus{}name}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                  \PYG{n}{xaxis\PYGZus{}title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                  \PYG{n}{yaxis\PYGZus{}title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level [m, MHHW, detrended]}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                  \PYG{n}{legend}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{n}{xanchor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{y}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.2}\PYG{p}{,} \PYG{n}{orientation}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{h}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{bgcolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rgba(255,255,255,0.8)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
                  \PYG{n}{plot\PYGZus{}bgcolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{white}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{} Set plot background to white}
                  \PYG{n}{paper\PYGZus{}bgcolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{white}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} Set overall background to white}

\PYG{c+c1}{\PYGZsh{} Set x\PYGZhy{}axis limits if needed}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{update\PYGZus{}xaxes}\PYG{p}{(}\PYG{n+nb}{range}\PYG{o}{=}\PYG{p}{[}\PYG{n}{monthly\PYGZus{}max}\PYG{o}{.}\PYG{n}{index}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{monthly\PYGZus{}max}\PYG{o}{.}\PYG{n}{index}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Show the figure}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}






\renewcommand{\indexname}{Index}
\printindex
\end{document}