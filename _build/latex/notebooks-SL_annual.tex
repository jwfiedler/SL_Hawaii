%% Generated by Sphinx.
\def\sphinxdocclass{jupyterBook}
\documentclass[letterpaper,10pt,english]{jupyterBook}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}
%% turn off hyperref patch of \index as sphinx.xdy xindy module takes care of
%% suitable \hyperpage mark-up, working around hyperref-xindy incompatibility
\PassOptionsToPackage{hyperindex=false}{hyperref}
%% memoir class requires extra handling
\makeatletter\@ifclassloaded{memoir}
{\ifdefined\memhyperindexfalse\memhyperindexfalse\fi}{}\makeatother


\PassOptionsToPackage{warn}{textcomp}

\catcode`^^^^00a0\active\protected\def^^^^00a0{\leavevmode\nobreak\ }
\usepackage{cmap}
\usepackage{fontspec}
\defaultfontfeatures[\rmfamily,\sffamily,\ttfamily]{}
\usepackage{amsmath,amssymb,amstext}
\usepackage{polyglossia}
\setmainlanguage{english}



\setmainfont{FreeSerif}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Italic,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldItalic
]
\setsansfont{FreeSans}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]
\setmonofont{FreeMono}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]



\usepackage[Bjarne]{fncychap}
\usepackage[,numfigreset=1,mathnumfig]{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}


\usepackage{sphinxmessages}



        % Start of preamble defined in sphinx-jupyterbook-latex %
         \usepackage[Latin,Greek]{ucharclasses}
        \usepackage{unicode-math}
        % fixing title of the toc
        \addto\captionsenglish{\renewcommand{\contentsname}{Contents}}
        \hypersetup{
            pdfencoding=auto,
            psdextra
        }
        % End of preamble defined in sphinx-jupyterbook-latex %
        

\title{Sea Level Magnitude}
\date{Jun 03, 2024}
\release{}
\author{Playground Coordinator}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{notebooks/SL_annual::doc}}

\begin{itemize}
\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{notebooks/regional_and_local/SL_Trend::doc}]{\sphinxcrossref{Sea Level Trend}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{notebooks/regional_and_local/SL_anomaly_annual::doc}]{\sphinxcrossref{Annual Sea Level Anomalies}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{notebooks/regional_and_local/SL_Rankings_annual::doc}]{\sphinxcrossref{Annual Sea Level Rankings}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{notebooks/regional_and_local/SL_Extremes_annual::doc}]{\sphinxcrossref{Annual Extremes}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{notebooks/regional_and_local/SL_Components_annual::doc}]{\sphinxcrossref{Components of Sea Level}}}

\end{itemize}

\sphinxstepscope


\part{Sea Level Trend}
\label{\detokenize{notebooks/regional_and_local/SL_Trend:sea-level-trend}}\label{\detokenize{notebooks/regional_and_local/SL_Trend::doc}}

\begin{wrapfigure}{r}{0pt}
\centering
\noindent\sphinxincludegraphics[scale=0.25]{{e8f225b94fb7f185d6a73f7c486490baf3d1d23d003eb80998af80be40a8c1ef}.png}
\end{wrapfigure}

\sphinxAtStartPar
In this notebook, we’ll be creating a {\hyperref[\detokenize{notebooks/regional_and_local/SL_Trend:create-a-table}]{\sphinxcrossref{\DUrole{std,std-ref}{table}}}}, a {\hyperref[\detokenize{notebooks/regional_and_local/SL_Trend:fig-mag}]{\sphinxcrossref{\DUrole{std,std-ref}{map}}}}, and a time series {\hyperref[\detokenize{notebooks/regional_and_local/SL_Trend:trend-fig}]{\sphinxcrossref{\DUrole{std,std-ref}{plot}}}} of absolute and regional sea level change at Hawaiian Islands tide gauge stations from 1993\sphinxhyphen{}2022. Absolute sea level, typically measured by satellite altimetry, refers to the height of the sea surface relative to a reference ellipsoid. Here, we’ll use the global ocean gridded L4 Sea Level Anomalies (SLA) available from Copernicus CLS (France) {[}\hyperlink{cite.notebooks/regional_and_local/SL_Trend:id10}{CLSFrance}{]}, which is the sea surface height (SSH) minus the mean sea surface (MSS), where the MSS is the temporal mean of SSH over a given period. Relative sea level is measured by a tide gauge, and is the sea level relative to land at that location. Differences between the two measurements can arise from vertical land motion, regional oceanographic conditions like currents, and changes to the gravitational field (affecting the geoid).

\sphinxAtStartPar
Download Files:
\DUrole{xref,download,myst}{Map} |
\DUrole{xref,download,myst}{Time Series Plot} |
\DUrole{xref,download,myst}{Table}


\chapter{Setup}
\label{\detokenize{notebooks/regional_and_local/SL_Trend:setup}}
\sphinxAtStartPar
We’ll run our initial setup for libraries, plotting, and directories.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{\PYGZpc{}}\PYG{k}{run} ../setup.ipynb  
\PYG{o}{\PYGZpc{}}\PYG{k}{run} ../plotting\PYGZus{}functions.ipynb
\PYG{n}{data\PYGZus{}dir} \PYG{o}{=} \PYG{n}{Path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../../data}\PYG{l+s+s1}{\PYGZsq{}} \PYG{p}{)}
\PYG{n}{output\PYGZus{}dir} \PYG{o}{=} \PYG{n}{Path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../../output}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} 
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\chapter{Retrieve Data Sources}
\label{\detokenize{notebooks/regional_and_local/SL_Trend:retrieve-data-sources}}
\sphinxAtStartPar
Please see the Data Wrangling notebook, where we source everything from UHSLC and CMEMS. In this notebook, we saved three xarray datasets: a sea level altimetry product for the area around the Hawaiian Islands (asl\_hawaii.nc), an hourly tide gauge record for the stations in that region (rsl\_hawaii.nc), and a de\sphinxhyphen{}meaned daily average tide gauge record (rsl\_daily\_hawaii.nc).

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Next, let\PYGZsq{}s establish a period of record from 1993\PYGZhy{}2022.}
\PYG{c+c1}{\PYGZsh{} establish the time period of interest}
\PYG{n}{start\PYGZus{}date} \PYG{o}{=} \PYG{n}{dt}\PYG{o}{.}\PYG{n}{datetime}\PYG{p}{(}\PYG{l+m+mi}{1993}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{end\PYGZus{}date} \PYG{o}{=} \PYG{n}{dt}\PYG{o}{.}\PYG{n}{datetime}\PYG{p}{(}\PYG{l+m+mi}{2022}\PYG{p}{,}\PYG{l+m+mi}{12}\PYG{p}{,}\PYG{l+m+mi}{31}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Normalize the data relative to the 1993\PYGZhy{}2012 epoch}
\PYG{n}{epoch\PYGZus{}start}\PYG{p}{,} \PYG{n}{epoch\PYGZus{}end} \PYG{o}{=} \PYG{n}{start\PYGZus{}date}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2012\PYGZhy{}01\PYGZhy{}01}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{c+c1}{\PYGZsh{}}
\PYG{c+c1}{\PYGZsh{} also save them as strings, for plotting}
\PYG{n}{start\PYGZus{}date\PYGZus{}str} \PYG{o}{=} \PYG{n}{start\PYGZus{}date}\PYG{o}{.}\PYG{n}{strftime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{Y\PYGZhy{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{m\PYGZhy{}}\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{end\PYGZus{}date\PYGZus{}str} \PYG{o}{=} \PYG{n}{end\PYGZus{}date}\PYG{o}{.}\PYG{n}{strftime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{Y\PYGZhy{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{m\PYGZhy{}}\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} glue these variables}
\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{start\PYGZus{}date}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{start\PYGZus{}date}\PYG{p}{)}
\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{end\PYGZus{}date}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{end\PYGZus{}date}\PYG{p}{)}
\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{start\PYGZus{}date\PYGZus{}str}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{start\PYGZus{}date\PYGZus{}str}\PYG{p}{)}
\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{end\PYGZus{}date\PYGZus{}str}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{end\PYGZus{}date\PYGZus{}str}\PYG{p}{)}
\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{station\PYGZus{}group}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Hawaiian Islands}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
datetime.datetime(1993, 1, 1, 0, 0)
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
datetime.datetime(2022, 12, 31, 0, 0)
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZsq{}1993\PYGZhy{}01\PYGZhy{}01\PYGZsq{}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZsq{}2022\PYGZhy{}12\PYGZhy{}31\PYGZsq{}
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZsq{}Hawaiian Islands\PYGZsq{}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}import datasets}
\PYG{n}{rsl\PYGZus{}daily} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{rsl} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{sla\PYGZus{}tg} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{asl\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{sla} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cmems\PYGZus{}L4\PYGZus{}SSH\PYGZus{}0.25deg\PYGZus{}1993\PYGZus{}2023.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{g} \PYG{o}{=} \PYG{n}{sla\PYGZus{}tg}\PYG{o}{.}\PYG{n}{sla}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{col}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{col\PYGZus{}wrap}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{sharey}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{sharex}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Use g.axs to iterate over the axes in the FacetGrid}
\PYG{k}{for} \PYG{n}{ax}\PYG{p}{,} \PYG{n}{rid} \PYG{o+ow}{in} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{g}\PYG{o}{.}\PYG{n}{axs}\PYG{o}{.}\PYG{n}{flat}\PYG{p}{,} \PYG{n}{sla\PYGZus{}tg}\PYG{o}{.}\PYG{n}{record\PYGZus{}id}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Accessing the station\PYGZus{}name coordinate for the current record\PYGZus{}id directly}
    \PYG{n}{station\PYGZus{}name} \PYG{o}{=} \PYG{n}{sla\PYGZus{}tg}\PYG{o}{.}\PYG{n}{station\PYGZus{}name}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{item}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{n}{station\PYGZus{}name}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+m+mf}{0.7}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{4738a7053e3d1f7f03fbfd3a45e0820bad994017bd4eb55d6973e59a581731a1}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rsl\PYGZus{}daily}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 2MB
Dimensions:       (record\PYGZus{}id: 11, time: 10957)
Coordinates:
  * record\PYGZus{}id     (record\PYGZus{}id) int16 22B 140 500 520 570 ... 610 5470 5480 5520
  * time          (time) datetime64[ns] 88kB 1993\PYGZhy{}01\PYGZhy{}01 ... 2022\PYGZhy{}12\PYGZhy{}31
    lat           (record\PYGZus{}id) float32 44B ...
    lon           (record\PYGZus{}id) float32 44B ...
    station\PYGZus{}name  (record\PYGZus{}id) \PYGZlt{}U17 748B ...
    storm\PYGZus{}time    (time) datetime64[ns] 88kB ...
Data variables:
    rsl\PYGZus{}anomaly   (record\PYGZus{}id, time) float32 482kB ...
    rsl\PYGZus{}mhhw      (record\PYGZus{}id, time) float64 964kB ...
Attributes:
    long\PYGZus{}name:  Sea Level Anomaly
    units:      m
    source:     in situ tide gauge water level observations
    platform:   station\PYGZus{}name, station\PYGZus{}country, station\PYGZus{}country\PYGZus{}code, uhslc\PYGZus{}id...
    epoch:      1993\PYGZhy{}2001
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{g} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{rsl\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{col}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{col\PYGZus{}wrap}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{sharey}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{sharex}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Use g.axs to iterate over the axes in the FacetGrid}
\PYG{k}{for} \PYG{n}{ax}\PYG{p}{,} \PYG{n}{rid} \PYG{o+ow}{in} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{g}\PYG{o}{.}\PYG{n}{axs}\PYG{o}{.}\PYG{n}{flat}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{record\PYGZus{}id}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Accessing the station\PYGZus{}name coordinate for the current record\PYGZus{}id directly}
    \PYG{n}{station\PYGZus{}name} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{station\PYGZus{}name}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{item}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{n}{station\PYGZus{}name}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+m+mf}{0.7}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{8cab19ec35f0c95770af36ae81828c8d180c4ee4e9163eb07012e09c91b3ae49}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
How many nan values are there in rsl{[}‘sea\_level’{]}?

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} first we\PYGZsq{}ll truncate the data to the period of record}
\PYG{n}{sla\PYGZus{}epoch} \PYG{o}{=} \PYG{n}{sla\PYGZus{}tg}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{n}{epoch\PYGZus{}start}\PYG{p}{,} \PYG{n}{epoch\PYGZus{}end}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} \PYGZsh{}print(\PYGZsq{}Number of NaN values in the tide gauge data: \PYGZsq{}, tide\PYGZus{}gauge\PYGZus{}data\PYGZus{}POR.isnull().sum().values)}
\PYG{c+c1}{\PYGZsh{}Run a quick check to see if the Ab SL from CMEMS is in fact zeroed about the 1993\PYGZhy{}2012 epoch. Curse the details.}
\PYG{c+c1}{\PYGZsh{} Extract the data for the period of record (POR)}
\PYG{c+c1}{\PYGZsh{}check if the mean is zero}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{The mean for the [1993,2012] epoch of the SLA is}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{sla\PYGZus{}epoch}\PYG{o}{.}\PYG{n}{sla}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{skipna}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m. Re\PYGZhy{}check source data to make sure this is correct.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
The mean for the [1993,2012] epoch of the SLA is [0.02338939 0.02242252 0.02665729 0.02673529 0.02434594 0.02427523
 0.02620254 0.02673529 0.02515467 0.02468215 0.02189661] m. Re\PYGZhy{}check source data to make sure this is correct.
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxShadowBox}
\sphinxstylesidebartitle{}

\sphinxAtStartPar
OLD NOTE FROM PALAU, UPDATE TO HI:
It should be noted that the coordinates from \sphinxurl{https://ccar.colorado.edu/altimetry/} for the altimetry product are: Lat: 7.2500°N, Lon: 134.4167°E, using \sphinxurl{https://podaac.jpl.nasa.gov/dataset/SEA\_SURFACE\_HEIGHT\_ALT\_GRIDS\_L4\_2SATS\_5DAY\_6THDEG\_V\_JPL1812} as their data source. This data is gridded at 1/6th of a degree as supposed to 1/4th of a degree in the source we are using.
\end{sphinxShadowBox}

\sphinxAtStartPar
Let’s make a map to determine exactly where these points are in space. First we’ll define a function to prettify the map, which we’ll use for the rest of the notebook.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{add\PYGZus{}zebra\PYGZus{}frame}\PYG{p}{(}\PYG{n}{ax}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{segment\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{n}{crs}\PYG{o}{=}\PYG{n}{ccrs}\PYG{o}{.}\PYG{n}{PlateCarree}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Get the current extent of the map}
    \PYG{n}{left}\PYG{p}{,} \PYG{n}{right}\PYG{p}{,} \PYG{n}{bot}\PYG{p}{,} \PYG{n}{top} \PYG{o}{=} \PYG{n}{ax}\PYG{o}{.}\PYG{n}{get\PYGZus{}extent}\PYG{p}{(}\PYG{n}{crs}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Calculate the nearest 0 or 0.5 degree mark within the current extent}
    \PYG{n}{left\PYGZus{}start} \PYG{o}{=} \PYG{n}{left} \PYG{o}{\PYGZhy{}} \PYG{n}{left} \PYG{o}{\PYGZpc{}} \PYG{n}{segment\PYGZus{}length}
    \PYG{n}{bot\PYGZus{}start} \PYG{o}{=} \PYG{n}{bot} \PYG{o}{\PYGZhy{}} \PYG{n}{bot} \PYG{o}{\PYGZpc{}} \PYG{n}{segment\PYGZus{}length}

    \PYG{c+c1}{\PYGZsh{} Adjust the start if it does not align with the desired segment start}
    \PYG{k}{if} \PYG{n}{left} \PYG{o}{\PYGZpc{}} \PYG{n}{segment\PYGZus{}length} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{n}{segment\PYGZus{}length} \PYG{o}{/} \PYG{l+m+mi}{2}\PYG{p}{:}
        \PYG{n}{left\PYGZus{}start} \PYG{o}{+}\PYG{o}{=} \PYG{n}{segment\PYGZus{}length}
    \PYG{k}{if} \PYG{n}{bot} \PYG{o}{\PYGZpc{}} \PYG{n}{segment\PYGZus{}length} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{n}{segment\PYGZus{}length} \PYG{o}{/} \PYG{l+m+mi}{2}\PYG{p}{:}
        \PYG{n}{bot\PYGZus{}start} \PYG{o}{+}\PYG{o}{=} \PYG{n}{segment\PYGZus{}length}

    \PYG{c+c1}{\PYGZsh{} Extend the frame slightly beyond the map extent to ensure full coverage}
    \PYG{n}{right\PYGZus{}end} \PYG{o}{=} \PYG{n}{right} \PYG{o}{+} \PYG{p}{(}\PYG{n}{segment\PYGZus{}length} \PYG{o}{\PYGZhy{}} \PYG{n}{right} \PYG{o}{\PYGZpc{}} \PYG{n}{segment\PYGZus{}length}\PYG{p}{)}
    \PYG{n}{top\PYGZus{}end} \PYG{o}{=} \PYG{n}{top} \PYG{o}{+} \PYG{p}{(}\PYG{n}{segment\PYGZus{}length} \PYG{o}{\PYGZhy{}} \PYG{n}{top} \PYG{o}{\PYGZpc{}} \PYG{n}{segment\PYGZus{}length}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Calculate the number of segments needed for each side}
    \PYG{n}{num\PYGZus{}segments\PYGZus{}x} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{ceil}\PYG{p}{(}\PYG{p}{(}\PYG{n}{right\PYGZus{}end} \PYG{o}{\PYGZhy{}} \PYG{n}{left\PYGZus{}start}\PYG{p}{)} \PYG{o}{/} \PYG{n}{segment\PYGZus{}length}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{num\PYGZus{}segments\PYGZus{}y} \PYG{o}{=} \PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{ceil}\PYG{p}{(}\PYG{p}{(}\PYG{n}{top\PYGZus{}end} \PYG{o}{\PYGZhy{}} \PYG{n}{bot\PYGZus{}start}\PYG{p}{)} \PYG{o}{/} \PYG{n}{segment\PYGZus{}length}\PYG{p}{)}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Draw horizontal stripes at the top and bottom}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{num\PYGZus{}segments\PYGZus{}x}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{color} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{if} \PYG{p}{(}\PYG{n}{left\PYGZus{}start} \PYG{o}{+} \PYG{n}{i} \PYG{o}{*} \PYG{n}{segment\PYGZus{}length}\PYG{p}{)} \PYG{o}{\PYGZpc{}} \PYG{p}{(}\PYG{l+m+mi}{2} \PYG{o}{*} \PYG{n}{segment\PYGZus{}length}\PYG{p}{)} \PYG{o}{==} \PYG{l+m+mi}{0} \PYG{k}{else} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{white}\PYG{l+s+s1}{\PYGZsq{}}
        \PYG{n}{start\PYGZus{}x} \PYG{o}{=} \PYG{n}{left\PYGZus{}start} \PYG{o}{+} \PYG{n}{i} \PYG{o}{*} \PYG{n}{segment\PYGZus{}length}
        \PYG{n}{end\PYGZus{}x} \PYG{o}{=} \PYG{n}{start\PYGZus{}x} \PYG{o}{+} \PYG{n}{segment\PYGZus{}length}
        \PYG{n}{ax}\PYG{o}{.}\PYG{n}{hlines}\PYG{p}{(}\PYG{p}{[}\PYG{n}{bot}\PYG{p}{,} \PYG{n}{top}\PYG{p}{]}\PYG{p}{,} \PYG{n}{start\PYGZus{}x}\PYG{p}{,} \PYG{n}{end\PYGZus{}x}\PYG{p}{,} \PYG{n}{colors}\PYG{o}{=}\PYG{n}{color}\PYG{p}{,} \PYG{n}{linewidth}\PYG{o}{=}\PYG{n}{lw}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Draw vertical stripes on the left and right}
    \PYG{k}{for} \PYG{n}{j} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{num\PYGZus{}segments\PYGZus{}y}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{color} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{if} \PYG{p}{(}\PYG{n}{bot\PYGZus{}start} \PYG{o}{+} \PYG{n}{j} \PYG{o}{*} \PYG{n}{segment\PYGZus{}length}\PYG{p}{)} \PYG{o}{\PYGZpc{}} \PYG{p}{(}\PYG{l+m+mi}{2} \PYG{o}{*} \PYG{n}{segment\PYGZus{}length}\PYG{p}{)} \PYG{o}{==} \PYG{l+m+mi}{0} \PYG{k}{else} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{white}\PYG{l+s+s1}{\PYGZsq{}}
        \PYG{n}{start\PYGZus{}y} \PYG{o}{=} \PYG{n}{bot\PYGZus{}start} \PYG{o}{+} \PYG{n}{j} \PYG{o}{*} \PYG{n}{segment\PYGZus{}length}
        \PYG{n}{end\PYGZus{}y} \PYG{o}{=} \PYG{n}{start\PYGZus{}y} \PYG{o}{+} \PYG{n}{segment\PYGZus{}length}
        \PYG{n}{ax}\PYG{o}{.}\PYG{n}{vlines}\PYG{p}{(}\PYG{p}{[}\PYG{n}{left}\PYG{p}{,} \PYG{n}{right}\PYG{p}{]}\PYG{p}{,} \PYG{n}{start\PYGZus{}y}\PYG{p}{,} \PYG{n}{end\PYGZus{}y}\PYG{p}{,} \PYG{n}{colors}\PYG{o}{=}\PYG{n}{color}\PYG{p}{,} \PYG{n}{linewidth}\PYG{o}{=}\PYG{n}{lw}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Set up the map projection}
\PYG{n}{crs} \PYG{o}{=} \PYG{n}{ccrs}\PYG{o}{.}\PYG{n}{PlateCarree}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set up the figure and axis}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,}\PYG{l+m+mi}{6}\PYG{p}{)}\PYG{p}{,} \PYG{n}{subplot\PYGZus{}kw}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{projection}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{crs}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Set map limits}

\PYG{c+c1}{\PYGZsh{}\PYGZsh{}get min and max longitude and latitude from sla}
\PYG{n}{minlon} \PYG{o}{=} \PYG{n}{sla}\PYG{o}{.}\PYG{n}{longitude}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}
\PYG{n}{maxlon} \PYG{o}{=} \PYG{n}{sla}\PYG{o}{.}\PYG{n}{longitude}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}
\PYG{n}{minlat} \PYG{o}{=} \PYG{n}{sla}\PYG{o}{.}\PYG{n}{latitude}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}
\PYG{n}{maxlat} \PYG{o}{=} \PYG{n}{sla}\PYG{o}{.}\PYG{n}{latitude}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}
\PYG{c+c1}{\PYGZsh{}}
\PYG{n}{xmin}\PYG{p}{,} \PYG{n}{xmax}\PYG{p}{,} \PYG{n}{ymin}\PYG{p}{,} \PYG{n}{ymax} \PYG{o}{=} \PYG{n}{minlon}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{n}{maxlon}\PYG{o}{+}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{n}{minlat}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{n}{maxlat}\PYG{o}{+}\PYG{l+m+mi}{2}

\PYG{k}{if} \PYG{n}{xmin}\PYG{o}{\PYGZlt{}}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{180}\PYG{p}{:}
    \PYG{n}{xmin} \PYG{o}{=} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{180}


\PYG{c+c1}{\PYGZsh{}ax.set\PYGZus{}xlim([xmin, xmax])}
\PYG{c+c1}{\PYGZsh{}ax.set\PYGZus{}ylim([ymin, ymax])}

\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}extent}\PYG{p}{(}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{180}\PYG{p}{,} \PYG{n}{xmax}\PYG{p}{,} \PYG{n}{ymin}\PYG{p}{,} \PYG{n}{ymax}\PYG{p}{]}\PYG{p}{,} \PYG{n}{crs}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}}
\PYG{c+c1}{\PYGZsh{}\PYGZsh{} add the land and ocean features}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{add\PYGZus{}feature}\PYG{p}{(}\PYG{n}{cfeature}\PYG{o}{.}\PYG{n}{LAND}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{add\PYGZus{}feature}\PYG{p}{(}\PYG{n}{cfeature}\PYG{o}{.}\PYG{n}{OCEAN}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{c+c1}{\PYGZsh{} Add the tide gauge location}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{marker}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{o}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{red}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Add the altimetry grid point}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{sla\PYGZus{}tg}\PYG{o}{.}\PYG{n}{longitude}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{360}\PYG{p}{,} \PYG{n}{sla\PYGZus{}tg}\PYG{o}{.}\PYG{n}{latitude}\PYG{p}{,} \PYG{n}{marker}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{o}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} 
        \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{blue}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Create 2D arrays of the longitude and latitude values}
\PYG{c+c1}{\PYGZsh{}lon2d, lat2d = np.meshgrid(ds[\PYGZsq{}sla\PYGZsq{}].longitude, ds[\PYGZsq{}sla\PYGZsq{}].latitude)}

\PYG{c+c1}{\PYGZsh{} plot the latitude and longitude values}
\PYG{c+c1}{\PYGZsh{}ax.scatter(lon2d, lat2d, transform=crs)}

\PYG{c+c1}{\PYGZsh{} Set custom ticks for the zebra frame}
\PYG{n}{degree\PYGZus{}interval} \PYG{o}{=} \PYG{l+m+mf}{2.5}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xticks}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n}{xmin}\PYG{p}{,}\PYG{n}{xmax}\PYG{p}{,}\PYG{n}{degree\PYGZus{}interval}\PYG{p}{)}\PYG{p}{,} \PYG{n}{crs}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}yticks}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{n}{ymin}\PYG{p}{,}\PYG{n}{ymax}\PYG{p}{,}\PYG{n}{degree\PYGZus{}interval}\PYG{p}{)}\PYG{p}{,} \PYG{n}{crs}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xticklabels}\PYG{p}{(}\PYG{p}{[}\PYG{p}{]}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}yticklabels}\PYG{p}{(}\PYG{p}{[}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Call the function to add the zebra frame}
\PYG{n}{add\PYGZus{}zebra\PYGZus{}frame}\PYG{p}{(}\PYG{n}{ax}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{segment\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mf}{2.5}\PYG{p}{,} \PYG{n}{crs}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add map grid}
\PYG{n}{gl} \PYG{o}{=} \PYG{n}{ax}\PYG{o}{.}\PYG{n}{gridlines}\PYG{p}{(}\PYG{n}{draw\PYGZus{}labels}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{linestyle}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                  \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,}\PYG{n}{xlocs}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{get\PYGZus{}xticks}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}\PYG{n}{ylocs}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{get\PYGZus{}yticks}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Add the tide gauge location with callout text}
\PYG{c+c1}{\PYGZsh{}tide\PYGZus{}gauge\PYGZus{}label = \PYGZdq{}Tide Gauge\PYGZdq{}}
\PYG{c+c1}{\PYGZsh{}ax.text(rsl[\PYGZsq{}lon\PYGZsq{}]+0.05, rsl[\PYGZsq{}lat\PYGZsq{}]\PYGZhy{}0.05, tide\PYGZus{}gauge\PYGZus{}label, }
\PYG{c+c1}{\PYGZsh{}        transform=crs, ha=\PYGZsq{}left\PYGZsq{},va = \PYGZsq{}top\PYGZsq{}, fontsize=12)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{c+c1}{\PYGZsh{} Add the altimetry grid point with callout text}
\PYG{c+c1}{\PYGZsh{}altimetry\PYGZus{}label = \PYGZdq{}Nearest Altimetry \PYGZbs{}n Grid Point\PYGZdq{}}
\PYG{c+c1}{\PYGZsh{}ax.text(sla\PYGZus{}nearest\PYGZus{}lon, sla\PYGZus{}nearest\PYGZus{}lat+0.05, altimetry\PYGZus{}label, }
\PYG{c+c1}{\PYGZsh{}        transform=crs, ha=\PYGZsq{}center\PYGZsq{}, va = \PYGZsq{}bottom\PYGZsq{}, fontsize=12)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{a0f91dfa1c19e942378028958de7792ab5c9c6fc5853efd52ede096cd6ae5f87}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Plot the timeseries}
\label{\detokenize{notebooks/regional_and_local/SL_Trend:plot-the-timeseries}}
\sphinxAtStartPar
Here, we’ll plot the time series of the altimetry data at the nearest location to the tide gauge (aka ‘sla\_tg’). The units of sla\_tg are in meters, so we’ll multiply by 100 to plot in centimeters.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}make a new variable in sla\PYGZus{}tg for cm instead of m}
\PYG{n}{sla\PYGZus{}tg}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla\PYGZus{}cm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{sla\PYGZus{}tg}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{*}\PYG{l+m+mi}{100}
\PYG{n}{sla\PYGZus{}tg}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla\PYGZus{}cm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cm}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{sla\PYGZus{}tg}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla\PYGZus{}cm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level Anomaly}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{}plot the timeseries in sla\PYGZus{}tg}

\PYG{n}{sla\PYGZus{}tg}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla\PYGZus{}cm}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{o}{.}\PYG{n}{line}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{label}\PYG{o}{=}\PYG{n}{sla\PYGZus{}tg}\PYG{o}{.}\PYG{n}{station\PYGZus{}name}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}put the legend outside the plot}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{n}{loc}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center left}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{bbox\PYGZus{}to\PYGZus{}anchor}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} set xlimits}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{xlim}\PYG{p}{(}\PYG{p}{[}\PYG{n}{start\PYGZus{}date}\PYG{p}{,} \PYG{n}{end\PYGZus{}date}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} set title }
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Altimetry (1993\PYGZhy{}2023)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Text(0.5, 1.0, \PYGZsq{}Altimetry (1993\PYGZhy{}2023)\PYGZsq{})
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{be0683c93aa6562cb789bca758302780ed22df0b2ccaaa3278dbb211dbc8bcbe}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Calculate change}
\label{\detokenize{notebooks/regional_and_local/SL_Trend:calculate-change}}
\sphinxAtStartPar
Now we have all of our data sources, we’ll calculate the absolute and relative sea level change (magnitude in cm) at this location for the Period of Record (1993\sphinxhyphen{}2022).

\sphinxAtStartPar
To do this, we’ll first define a function that calculates the sea level change magnitude.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Flatten the data and get a time index}
    \PYG{c+c1}{\PYGZsh{} first ensure time is the first dimension regardless of other dimensions}
    \PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{transpose}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{p}{)}
    \PYG{n}{sla\PYGZus{}flat} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{values}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{time\PYGZus{}index} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{time}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}julian\PYGZus{}date}\PYG{p}{(}\PYG{p}{)}

    \PYG{n}{detrended\PYGZus{}flat} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{full\PYGZus{}like}\PYG{p}{(}\PYG{n}{sla\PYGZus{}flat}\PYG{p}{,} \PYG{n}{fill\PYGZus{}value}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{nan}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Loop over each grid point}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{sla\PYGZus{}flat}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
        \PYG{c+c1}{\PYGZsh{} Get the time series for this grid point}
        \PYG{n}{y} \PYG{o}{=} \PYG{n}{sla\PYGZus{}flat}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{n}{i}\PYG{p}{]}
        \PYG{n}{mask} \PYG{o}{=} \PYG{o}{\PYGZti{}}\PYG{n}{np}\PYG{o}{.}\PYG{n}{isnan}\PYG{p}{(}\PYG{n}{y}\PYG{p}{)}

        \PYG{k}{if} \PYG{n}{np}\PYG{o}{.}\PYG{n}{any}\PYG{p}{(}\PYG{n}{mask}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{time\PYGZus{}masked} \PYG{o}{=} \PYG{n}{time\PYGZus{}index}\PYG{p}{[}\PYG{n}{mask}\PYG{p}{]}
            \PYG{n}{y\PYGZus{}masked} \PYG{o}{=} \PYG{n}{y}\PYG{p}{[}\PYG{n}{mask}\PYG{p}{]}

            \PYG{n}{slope}\PYG{p}{,} \PYG{n}{intercept}\PYG{p}{,} \PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{n}{\PYGZus{}} \PYG{o}{=} \PYG{n}{stats}\PYG{o}{.}\PYG{n}{linregress}\PYG{p}{(}\PYG{n}{time\PYGZus{}masked}\PYG{p}{,} \PYG{n}{y\PYGZus{}masked}\PYG{p}{)}
            \PYG{n}{trend} \PYG{o}{=} \PYG{n}{slope} \PYG{o}{*} \PYG{n}{time\PYGZus{}index} \PYG{o}{+} \PYG{n}{intercept}

            \PYG{n}{detrended\PYGZus{}flat}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{n}{i}\PYG{p}{]} \PYG{o}{=} \PYG{n}{y} \PYG{o}{\PYGZhy{}} \PYG{n}{trend}

    \PYG{n}{detrended} \PYG{o}{=} \PYG{n}{detrended\PYGZus{}flat}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Calculate trend magnitude}
    \PYG{n}{sea\PYGZus{}level\PYGZus{}trend} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly} \PYG{o}{\PYGZhy{}} \PYG{n}{detrended}
    \PYG{n}{trend\PYGZus{}mag} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}

    \PYG{n}{times} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
    \PYG{n}{time\PYGZus{}mag} \PYG{o}{=} \PYG{p}{(}\PYG{n}{times}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{times}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{days}\PYG{o}{/}\PYG{l+m+mf}{365.25} \PYG{c+c1}{\PYGZsh{} in years}

    \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{n}{trend\PYGZus{}mag} \PYG{o}{/} \PYG{n}{time\PYGZus{}mag}

    \PYG{k}{return} \PYG{n}{trend\PYGZus{}mag}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate}  
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
Now we’ll run that function for every grid point in our dataset, and make special variables for our proxy tide gauge location.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{trend\PYGZus{}mag\PYGZus{}cmems}\PYG{p}{,} \PYG{n}{trend\PYGZus{}line\PYGZus{}cmems}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate\PYGZus{}cmems} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{sla}\PYG{o}{.}\PYG{n}{sla}\PYG{p}{)}
\PYG{n}{trend\PYGZus{}mag\PYGZus{}asl}\PYG{p}{,} \PYG{n}{trend\PYGZus{}line\PYGZus{}asl}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate\PYGZus{}asl} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{sla\PYGZus{}tg}\PYG{o}{.}\PYG{n}{sla}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
Calculate the weighted mean for the region of interest.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} calculate the area weights as cosine of latitude}
\PYG{c+c1}{\PYGZsh{} For a rectangular grid, this is equivalent to multiplying by the grid cell area}
\PYG{n}{weights} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{cos}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{deg2rad}\PYG{p}{(}\PYG{n}{sla}\PYG{o}{.}\PYG{n}{latitude}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{weights}\PYG{o}{.}\PYG{n}{name} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{weights}\PYG{l+s+s2}{\PYGZdq{}}

\PYG{c+c1}{\PYGZsh{} apply weights to the trend data}
\PYG{n}{trend\PYGZus{}mag\PYGZus{}weighted} \PYG{o}{=} \PYG{n}{trend\PYGZus{}mag\PYGZus{}cmems}\PYG{o}{.}\PYG{n}{weighted}\PYG{p}{(}\PYG{n}{weights}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} calculate the regional mean}
\PYG{n}{trend\PYGZus{}mag\PYGZus{}regional} \PYG{o}{=} \PYG{n}{trend\PYGZus{}mag\PYGZus{}weighted}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} prepare the output string}
\PYG{n}{output} \PYG{o}{=} \PYG{p}{(}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{The regional magnitude of sea level change is }\PYG{l+s+si}{\PYGZob{}:.2f\PYGZcb{}}\PYG{l+s+s1}{ cm for the time }\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{period bounded by }\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{ and }\PYG{l+s+si}{\PYGZob{}\PYGZcb{}}\PYG{l+s+s1}{.}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{p}{)}\PYG{o}{.}\PYG{n}{format}\PYG{p}{(}\PYG{l+m+mi}{100}\PYG{o}{*}\PYG{n}{trend\PYGZus{}mag\PYGZus{}regional}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{start\PYGZus{}date\PYGZus{}str}\PYG{p}{,} \PYG{n}{end\PYGZus{}date\PYGZus{}str}\PYG{p}{)}

\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{output}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
The regional magnitude of sea level change is 7.39 cm for the time period bounded by 1993\PYGZhy{}01\PYGZhy{}01 and 2022\PYGZhy{}12\PYGZhy{}31.
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Plot a map}
\label{\detokenize{notebooks/regional_and_local/SL_Trend:plot-a-map}}
\sphinxAtStartPar
Plot the Results – MAP

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{xlims} \PYG{o}{=} \PYG{p}{[}\PYG{n}{minlon}\PYG{p}{,} \PYG{n}{maxlon}\PYG{p}{]}
\PYG{n}{ylims} \PYG{o}{=} \PYG{p}{[}\PYG{n}{minlat}\PYG{p}{,}\PYG{n}{maxlat}\PYG{p}{]}
\PYG{n}{vmin}\PYG{p}{,} \PYG{n}{vmax} \PYG{o}{=} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{15}\PYG{p}{,} \PYG{l+m+mi}{15}
\PYG{n}{cmap} \PYG{o}{=} \PYG{n}{sns}\PYG{o}{.}\PYG{n}{palettes}\PYG{o}{.}\PYG{n}{color\PYGZus{}palette}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{RdBu\PYGZus{}r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{as\PYGZus{}cmap}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax}\PYG{p}{,} \PYG{n}{crs} \PYG{o}{=} \PYG{n}{plot\PYGZus{}map}\PYG{p}{(}\PYG{n}{vmin}\PYG{p}{,}\PYG{n}{vmax}\PYG{p}{,}\PYG{n}{cmap}\PYG{p}{,}\PYG{n}{xlims}\PYG{p}{,}\PYG{n}{ylims}\PYG{p}{)}







\PYG{c+c1}{\PYGZsh{} plot the trend*100 for centimeters}
\PYG{n}{trend\PYGZus{}mag\PYGZus{}cmems\PYGZus{}cm} \PYG{o}{=} \PYG{n}{trend\PYGZus{}mag\PYGZus{}cmems} \PYG{o}{*} \PYG{l+m+mi}{100}

\PYG{c+c1}{\PYGZsh{} plot a map of the magnitude of SL change in centimeters}
\PYG{n}{trend\PYGZus{}mag\PYGZus{}cmems\PYGZus{}cm}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{,}
                         \PYG{n}{vmin}\PYG{o}{=}\PYG{n}{vmin}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{n}{vmax}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{cmap}\PYG{p}{,} \PYG{n}{add\PYGZus{}colorbar}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} 
                         \PYG{n}{cbar\PYGZus{}kwargs}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Δ Sea Level (cm, 1993\PYGZhy{}2022)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{,}
\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Call the function to add the zebra frame}
\PYG{n}{plot\PYGZus{}zebra\PYGZus{}frame}\PYG{p}{(}\PYG{n}{ax}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{segment\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{crs}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{8acaddd6c06e7efb4c05929b62b005a12970f11d9a46dabf6e0b1abc9ed19806}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Plot time series}
\label{\detokenize{notebooks/regional_and_local/SL_Trend:plot-time-series}}\label{\detokenize{notebooks/regional_and_local/SL_Trend:asltimeseries}}
\sphinxAtStartPar
Now we’ll plot a time series that includes a trend line, the Absolute Sea Level Change (magnitude in cm) within area/s in proximity to the Tide Station/s. For now, we’ll plot only one station at a time. The possible list of stations are:

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}make a dataframe with station\PYGZus{}name and record\PYGZus{}id}
\PYG{n}{df} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{sla\PYGZus{}tg}\PYG{o}{.}\PYG{n}{station\PYGZus{}name}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{sla\PYGZus{}tg}\PYG{o}{.}\PYG{n}{record\PYGZus{}id}\PYG{o}{.}\PYG{n}{values}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{n}{df}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
         station\PYGZus{}name  record\PYGZus{}id
0      French Frigate        140
1              Midway        500
2            Johnston        520
3    Honolulu, Hawaii        570
4          Nawiliwili        580
5             Kahului        590
6        Hilo, Hawaii        600
7            Mokuoloe        610
8   Barbers Point, HI       5470
9      Kaumalapau, HI       5480
10           Kawaihae       5520
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Select which station you’d like to plot here:

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} EDIT THIS CELL}
\PYG{n}{recordID} \PYG{o}{=} \PYG{l+m+mi}{3}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Set the style of the plot}
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{set\PYGZus{}style}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{whitegrid}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Create a color palette}
\PYG{n}{palette} \PYG{o}{=} \PYG{n}{sns}\PYG{o}{.}\PYG{n}{color\PYGZus{}palette}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Set1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Plot the timeseries}
\PYG{c+c1}{\PYGZsh{} Create the figure and the axes}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} plot altimetry data from sla\PYGZus{}tg, using the first record\PYGZus{}id}


\PYG{n}{sla\PYGZus{}tg}\PYG{o}{.}\PYG{n}{sla}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id} \PYG{o}{=} \PYG{n}{recordID}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Altimetry}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{n}{palette}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.2}\PYG{p}{,} \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n}{trend\PYGZus{}line\PYGZus{}asl}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id} \PYG{o}{=} \PYG{n}{recordID}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{o}{.}\PYG{n}{line}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Altimetry Trend}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{n}{palette}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{linestyle}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{} Set the title and labels}
\PYG{n}{title} \PYG{o}{=} \PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Altimetry at }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{sla\PYGZus{}tg}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{+w}{ }\PYG{o}{=}\PYG{+w}{ }\PYG{n}{recordID}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{ (}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{start\PYGZus{}date\PYGZus{}str}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{ to }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{end\PYGZus{}date\PYGZus{}str}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{)}\PYG{l+s+s2}{\PYGZdq{}}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{n}{title}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Height (cm)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set the x limits}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlim}\PYG{p}{(}\PYG{p}{[}\PYG{n}{start\PYGZus{}date}\PYG{p}{,} \PYG{n}{end\PYGZus{}date}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Add a legend}
\PYG{n}{trendmag\PYGZus{}str} \PYG{o}{=} \PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Δ Sea Level: }\PYG{l+s+si}{\PYGZob{}}\PYG{l+m+mi}{100}\PYG{o}{*}\PYG{n}{trend\PYGZus{}mag\PYGZus{}asl}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{recordID}\PYG{p}{)}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ cm, }\PYG{l+s+s1}{\PYGZsq{}}
                \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Trend: }\PYG{l+s+si}{\PYGZob{}}\PYG{l+m+mi}{100}\PYG{o}{*}\PYG{n}{trend\PYGZus{}rate\PYGZus{}asl}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{recordID}\PYG{p}{)}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ cm/year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Add text in a white box to bottom right of plot}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mf}{0.95}\PYG{p}{,} \PYG{l+m+mf}{0.05}\PYG{p}{,} \PYG{n}{trendmag\PYGZus{}str}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{transAxes}\PYG{p}{,} 
        \PYG{n}{verticalalignment}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bottom}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{horizontalalignment}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{right}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} 
        \PYG{n}{bbox}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{facecolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{white}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Text(0.95, 0.05, \PYGZsq{}Δ Sea Level: 6.38 cm, Trend: 0.21 cm/year\PYGZsq{})
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{f068f52af7bbd3b6ad57d85e2af38bf77034e6e07315be8cce7cd34175abe04e}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Calculate rate and magnitude of change}
\label{\detokenize{notebooks/regional_and_local/SL_Trend:calculate-rate-and-magnitude-of-change}}
\sphinxAtStartPar
Calculate values for both the Trend (rate of change) and Magnitude of Change

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rsl\PYGZus{}daily}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 2MB
Dimensions:       (record\PYGZus{}id: 11, time: 10957)
Coordinates:
  * record\PYGZus{}id     (record\PYGZus{}id) int16 22B 140 500 520 570 ... 610 5470 5480 5520
  * time          (time) datetime64[ns] 88kB 1993\PYGZhy{}01\PYGZhy{}01 ... 2022\PYGZhy{}12\PYGZhy{}31
    lat           (record\PYGZus{}id) float32 44B ...
    lon           (record\PYGZus{}id) float32 44B ...
    station\PYGZus{}name  (record\PYGZus{}id) \PYGZlt{}U17 748B ...
    storm\PYGZus{}time    (time) datetime64[ns] 88kB ...
Data variables:
    rsl\PYGZus{}anomaly   (record\PYGZus{}id, time) float32 482kB ...
    rsl\PYGZus{}mhhw      (record\PYGZus{}id, time) float64 964kB ...
Attributes:
    long\PYGZus{}name:  Sea Level Anomaly
    units:      m
    source:     in situ tide gauge water level observations
    platform:   station\PYGZus{}name, station\PYGZus{}country, station\PYGZus{}country\PYGZus{}code, uhslc\PYGZus{}id...
    epoch:      1993\PYGZhy{}2001
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} calculate the rate of change for the tide gauge}
\PYG{n}{trend\PYGZus{}mag\PYGZus{}rsl}\PYG{p}{,} \PYG{n}{trend\PYGZus{}line\PYGZus{}rsl}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate\PYGZus{}rsl} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{rsl\PYGZus{}anomaly}\PYG{p}{)}

\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{The trend magnitude for the tide gauge is }\PYG{l+s+si}{\PYGZob{}}\PYG{l+m+mi}{100}\PYG{o}{*}\PYG{n}{trend\PYGZus{}mag\PYGZus{}rsl}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{recordID}\PYG{p}{)}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ cm.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{The trend rate for the tide gauge is }\PYG{l+s+si}{\PYGZob{}}\PYG{l+m+mi}{100}\PYG{o}{*}\PYG{n}{trend\PYGZus{}rate\PYGZus{}rsl}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{recordID}\PYG{p}{)}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ cm/year.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
The trend magnitude for the tide gauge is 8.09 cm.
The trend rate for the tide gauge is 0.27 cm/year.
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Plot time series}
\label{\detokenize{notebooks/regional_and_local/SL_Trend:rsltimeseries}}\label{\detokenize{notebooks/regional_and_local/SL_Trend:id2}}
\sphinxAtStartPar
Now we’ll combine our daily relative sea level time series, the monthly mean, and a trend line into the same plot. We will label it with the Relative Sea Level Sea Level Change (magnitude in cm) and rate of change (cm/yr) at the Tide Station. The “zero” line is referenced to the {[}1993,2012{]} period, following the altimetry.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} make an rsl monthly mean for plotting}
\PYG{n}{rsl\PYGZus{}monthly} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{resample}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1M}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{squeeze}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set the style of the plot}
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{set\PYGZus{}style}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{whitegrid}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Create a color palette}
\PYG{n}{palette} \PYG{o}{=} \PYG{n}{sns}\PYG{o}{.}\PYG{n}{color\PYGZus{}palette}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Set1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Plot the timeseries}
\PYG{c+c1}{\PYGZsh{} Create the figure and the axes}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} plot data}

\PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{rsl\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{recordID}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Tide Gauge}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{n}{palette}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.2}\PYG{p}{,} \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{)}
\PYG{n}{trend\PYGZus{}line\PYGZus{}rsl}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{recordID}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{o}{.}\PYG{n}{line}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Tide Gauge Trend}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{n}{palette}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{linestyle}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} plot the monthly mean sea level}
\PYG{n}{rsl\PYGZus{}monthly}\PYG{o}{.}\PYG{n}{rsl\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{recordID}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{o}{.}\PYG{n}{line}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Tide Gauge}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{n}{palette}\PYG{p}{[}\PYG{l+m+mi}{3}\PYG{p}{]}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{} Set the title and labels}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Tide Gauge (}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{station\PYGZus{}name}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{recordID}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{) (}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{start\PYGZus{}date\PYGZus{}str}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ to }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{end\PYGZus{}date\PYGZus{}str}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Height (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set the y limits}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{.50}\PYG{p}{,} \PYG{l+m+mf}{.50}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set the x limits}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlim}\PYG{p}{(}\PYG{p}{[}\PYG{n}{start\PYGZus{}date}\PYG{p}{,} \PYG{n}{end\PYGZus{}date}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Add a legend}
\PYG{n}{trendmag\PYGZus{}str} \PYG{o}{=} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Δ Sea Level: }\PYG{l+s+si}{\PYGZob{}}\PYG{l+m+mi}{100}\PYG{o}{*}\PYG{n}{trend\PYGZus{}mag\PYGZus{}rsl}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{recordID}\PYG{p}{)}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ cm, Trend: }\PYG{l+s+si}{\PYGZob{}}\PYG{l+m+mi}{100}\PYG{o}{*}\PYG{n}{trend\PYGZus{}rate\PYGZus{}rsl}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{recordID}\PYG{p}{)}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ cm/year}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{c+c1}{\PYGZsh{} Add text in a white box to bottom right of plot}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mf}{0.95}\PYG{p}{,} \PYG{l+m+mf}{0.05}\PYG{p}{,} \PYG{n}{trendmag\PYGZus{}str}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{transAxes}\PYG{p}{,} 
        \PYG{n}{fontsize}\PYG{o}{=}\PYG{l+m+mi}{14}\PYG{p}{,} \PYG{n}{verticalalignment}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bottom}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{horizontalalignment}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{right}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
        \PYG{n}{bbox}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{facecolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{white}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
/opt/anaconda3/envs/SLI39/lib/python3.9/site\PYGZhy{}packages/xarray/core/groupby.py:668: FutureWarning: \PYGZsq{}M\PYGZsq{} is deprecated and will be removed in a future version, please use \PYGZsq{}ME\PYGZsq{} instead.
  index\PYGZus{}grouper = pd.Grouper(
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
Text(0.95, 0.05, \PYGZsq{}Δ Sea Level: 8.09 cm, Trend: 0.27 cm/year\PYGZsq{})
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{5528aff7678aa34cf0d83a6e5ff5c4f07ab83d727c21f5b56c1696c4611d69f6}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\chapter{Combining both sources}
\label{\detokenize{notebooks/regional_and_local/SL_Trend:combining-both-sources}}

\section{Create a Table}
\label{\detokenize{notebooks/regional_and_local/SL_Trend:create-a-table}}\label{\detokenize{notebooks/regional_and_local/SL_Trend:id3}}
\sphinxAtStartPar
That compares the results of sections \hyperref[\detokenize{notebooks/regional_and_local/SL_Trend:asltimeseries}]{Section \ref{\detokenize{notebooks/regional_and_local/SL_Trend:asltimeseries}}} and \hyperref[\detokenize{notebooks/regional_and_local/SL_Trend:rsltimeseries}]{Section \ref{\detokenize{notebooks/regional_and_local/SL_Trend:rsltimeseries}}}– TABLE

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Constants}
\PYG{n}{DATA\PYGZus{}SOURCE\PYGZus{}ALTIMETRY} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CMEMS SSH L4 0.25 deg (SLA)}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{DATA\PYGZus{}SOURCE\PYGZus{}TIDE\PYGZus{}GAUGE} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{UHSLC RQDS}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{TIME\PYGZus{}PERIOD} \PYG{o}{=} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{start\PYGZus{}date\PYGZus{}str}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ to }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{end\PYGZus{}date\PYGZus{}str}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Calculated values }
\PYG{n}{trend\PYGZus{}mmyr\PYGZus{}altimetry} \PYG{o}{=} \PYG{l+m+mi}{1000} \PYG{o}{*} \PYG{n}{trend\PYGZus{}rate\PYGZus{}asl}\PYG{o}{.}\PYG{n}{values}
\PYG{n}{trend\PYGZus{}mmyr\PYGZus{}tide\PYGZus{}gauge} \PYG{o}{=} \PYG{l+m+mi}{1000} \PYG{o}{*} \PYG{n}{trend\PYGZus{}rate\PYGZus{}rsl}\PYG{o}{.}\PYG{n}{values}
\PYG{n}{delta\PYGZus{}sea\PYGZus{}level\PYGZus{}altimetry} \PYG{o}{=} \PYG{l+m+mi}{100} \PYG{o}{*} \PYG{n}{trend\PYGZus{}mag\PYGZus{}asl}\PYG{o}{.}\PYG{n}{values}
\PYG{n}{delta\PYGZus{}sea\PYGZus{}level\PYGZus{}tide\PYGZus{}gauge} \PYG{o}{=} \PYG{l+m+mi}{100} \PYG{o}{*} \PYG{n}{trend\PYGZus{}mag\PYGZus{}rsl}\PYG{o}{.}\PYG{n}{values}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Initialize DataFrame with station names and calculate UHSLC\PYGZus{}ID directly}
\PYG{n}{SL\PYGZus{}magnitude\PYGZus{}results} \PYG{o}{=} \PYG{p}{(}
    \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Station\PYGZus{}Name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{sla\PYGZus{}tg}\PYG{o}{.}\PYG{n}{station\PYGZus{}name}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{UHSLC\PYGZus{}ID}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{np}\PYG{o}{.}\PYG{n}{int16}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}daily}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values} \PYG{o}{/} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Trend ASL (mm/yr)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{trend\PYGZus{}mmyr\PYGZus{}altimetry}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Trend RSL (mm/yr)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{trend\PYGZus{}mmyr\PYGZus{}tide\PYGZus{}gauge}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Δ Sea Level ASL (cm)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{delta\PYGZus{}sea\PYGZus{}level\PYGZus{}altimetry}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Δ Sea Level RSL (cm)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{delta\PYGZus{}sea\PYGZus{}level\PYGZus{}tide\PYGZus{}gauge}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Latitude ASL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{sla\PYGZus{}tg}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Latitude RSL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{rsl\PYGZus{}daily}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Longitude ASL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{sla\PYGZus{}tg}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Longitude RSL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{rsl\PYGZus{}daily}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Time\PYGZus{}Period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{TIME\PYGZus{}PERIOD}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Data\PYGZus{}Source ASL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{DATA\PYGZus{}SOURCE\PYGZus{}ALTIMETRY}\PYG{p}{,}
        \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Data\PYGZus{}Source RSL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{DATA\PYGZus{}SOURCE\PYGZus{}TIDE\PYGZus{}GAUGE}
    \PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} if Longitude is greater than 180, subtract 360}
\PYG{n}{SL\PYGZus{}magnitude\PYGZus{}results}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Longitude ASL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{SL\PYGZus{}magnitude\PYGZus{}results}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Longitude ASL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{180}\PYG{p}{,} \PYG{n}{SL\PYGZus{}magnitude\PYGZus{}results}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Longitude ASL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{l+m+mi}{360}\PYG{p}{,} \PYG{n}{SL\PYGZus{}magnitude\PYGZus{}results}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Longitude ASL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{SL\PYGZus{}magnitude\PYGZus{}results}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Longitude RSL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{SL\PYGZus{}magnitude\PYGZus{}results}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Longitude RSL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{180}\PYG{p}{,} \PYG{n}{SL\PYGZus{}magnitude\PYGZus{}results}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Longitude RSL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{l+m+mi}{360}\PYG{p}{,} \PYG{n}{SL\PYGZus{}magnitude\PYGZus{}results}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Longitude RSL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{SL\PYGZus{}magnitude\PYGZus{}results}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
         Station\PYGZus{}Name  UHSLC\PYGZus{}ID  Trend ASL (mm/yr)  Trend RSL (mm/yr)  \PYGZbs{}
0      French Frigate        14           1.871329                NaN   
1              Midway        50           4.215143           3.780650   
2            Johnston        52           2.292586           1.802460   
3    Honolulu, Hawaii        57           2.103058           2.696540   
4          Nawiliwili        58           2.263410           3.062466   
5             Kahului        59           2.105416           2.527900   
6        Hilo, Hawaii        60           1.975387           3.298495   
7            Mokuoloe        61           2.103058           2.933727   
8   Barbers Point, HI       547           2.228920                NaN   
9      Kaumalapau, HI       548           2.183053                NaN   
10           Kawaihae       552           2.750707                NaN   

    Δ Sea Level ASL (cm)  Δ Sea Level RSL (cm)  Latitude ASL  Latitude RSL  \PYGZbs{}
0               5.674700                   NaN        23.875     23.867001   
1              12.782183             11.340399        28.125     28.216999   
2               6.952137              5.406640        16.875     16.750000   
3               6.377406              8.088512        21.375     21.306999   
4               6.863662              9.186140        21.875     21.966999   
5               6.384556              7.582662        20.875     20.900000   
6               5.990249              9.894130        19.733     19.733000   
7               6.377406              8.799976        21.375     21.433001   
8               6.759073                   NaN        21.375     21.322001   
9               6.619986                   NaN        20.875     20.783001   
10              8.341365                   NaN        20.125     20.033001   

    Longitude ASL  Longitude RSL               Time\PYGZus{}Period  \PYGZbs{}
0     \PYGZhy{}166.375000    \PYGZhy{}166.289993  1993\PYGZhy{}01\PYGZhy{}01 to 2022\PYGZhy{}12\PYGZhy{}31   
1     \PYGZhy{}177.375000    \PYGZhy{}177.367004  1993\PYGZhy{}01\PYGZhy{}01 to 2022\PYGZhy{}12\PYGZhy{}31   
2     \PYGZhy{}169.625000    \PYGZhy{}169.516998  1993\PYGZhy{}01\PYGZhy{}01 to 2022\PYGZhy{}12\PYGZhy{}31   
3     \PYGZhy{}157.875000    \PYGZhy{}157.867004  1993\PYGZhy{}01\PYGZhy{}01 to 2022\PYGZhy{}12\PYGZhy{}31   
4     \PYGZhy{}159.375000    \PYGZhy{}159.350006  1993\PYGZhy{}01\PYGZhy{}01 to 2022\PYGZhy{}12\PYGZhy{}31   
5     \PYGZhy{}156.375000    \PYGZhy{}156.466995  1993\PYGZhy{}01\PYGZhy{}01 to 2022\PYGZhy{}12\PYGZhy{}31   
6     \PYGZhy{}155.067001    \PYGZhy{}155.067001  1993\PYGZhy{}01\PYGZhy{}01 to 2022\PYGZhy{}12\PYGZhy{}31   
7     \PYGZhy{}157.875000    \PYGZhy{}157.800003  1993\PYGZhy{}01\PYGZhy{}01 to 2022\PYGZhy{}12\PYGZhy{}31   
8     \PYGZhy{}158.125000    \PYGZhy{}158.119995  1993\PYGZhy{}01\PYGZhy{}01 to 2022\PYGZhy{}12\PYGZhy{}31   
9     \PYGZhy{}156.875000    \PYGZhy{}157.000000  1993\PYGZhy{}01\PYGZhy{}01 to 2022\PYGZhy{}12\PYGZhy{}31   
10    \PYGZhy{}155.875000    \PYGZhy{}155.832993  1993\PYGZhy{}01\PYGZhy{}01 to 2022\PYGZhy{}12\PYGZhy{}31   

                Data\PYGZus{}Source ASL Data\PYGZus{}Source RSL  
0   CMEMS SSH L4 0.25 deg (SLA)      UHSLC RQDS  
1   CMEMS SSH L4 0.25 deg (SLA)      UHSLC RQDS  
2   CMEMS SSH L4 0.25 deg (SLA)      UHSLC RQDS  
3   CMEMS SSH L4 0.25 deg (SLA)      UHSLC RQDS  
4   CMEMS SSH L4 0.25 deg (SLA)      UHSLC RQDS  
5   CMEMS SSH L4 0.25 deg (SLA)      UHSLC RQDS  
6   CMEMS SSH L4 0.25 deg (SLA)      UHSLC RQDS  
7   CMEMS SSH L4 0.25 deg (SLA)      UHSLC RQDS  
8   CMEMS SSH L4 0.25 deg (SLA)      UHSLC RQDS  
9   CMEMS SSH L4 0.25 deg (SLA)      UHSLC RQDS  
10  CMEMS SSH L4 0.25 deg (SLA)      UHSLC RQDS  
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Save to CSV}
\PYG{n}{output\PYGZus{}file\PYGZus{}path} \PYG{o}{=} \PYG{n}{output\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SL\PYGZus{}magnitude\PYGZus{}results.csv}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} Use the path for operations, e.g., saving a DataFrame}
\PYG{n}{SL\PYGZus{}magnitude\PYGZus{}results}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{n}{output\PYGZus{}file\PYGZus{}path}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} glue trend\PYGZus{}rates to the notebook}
\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{trend\PYGZus{}rate\PYGZus{}rsl}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate\PYGZus{}rsl}\PYG{p}{,} \PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{trend\PYGZus{}rate\PYGZus{}asl}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate\PYGZus{}asl}\PYG{p}{,} \PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Create a Map}
\label{\detokenize{notebooks/regional_and_local/SL_Trend:create-a-map}}\label{\detokenize{notebooks/regional_and_local/SL_Trend:id4}}
\sphinxAtStartPar
Now we’ll combine a both the tide gauge and altimetry sources into a map that includes the absolute change with the addition of an icon depicting the magnitude of relative change at the tide station.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}
\begin{sphinxuseclass}{tag_hide-input}
\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{e37b9d70b5833c663c670c5647c87c24386d639a8737aa6510af2d68a055c14d}.png}
\caption{Map of absolute and relative sea level change from the altimetry and tide gauge record near the \DUrole{pasted-text}{Hawaiian Islands} stations from \DUrole{pasted-text}{1993\sphinxhyphen{}01\sphinxhyphen{}01} to \DUrole{pasted-text}{2022\sphinxhyphen{}12\sphinxhyphen{}31}.}\label{\detokenize{notebooks/regional_and_local/SL_Trend:fig-mag}}
\begin{sphinxlegend}
\sphinxAtStartPar
\DUrole{xref,download,myst}{Download Image}
\end{sphinxlegend}
\end{figure}


\section{Create a Time series plot}
\label{\detokenize{notebooks/regional_and_local/SL_Trend:create-a-time-series-plot}}\label{\detokenize{notebooks/regional_and_local/SL_Trend:id5}}
\sphinxAtStartPar
Finally we will combine both tide gauge and altimetry sources into a time series plot that includes both {\hyperref[\detokenize{notebooks/regional_and_local/SL_Trend:asltimeseries}]{\sphinxcrossref{\DUrole{std,std-ref}{Absolute}}}}  and {\hyperref[\detokenize{notebooks/regional_and_local/SL_Trend:rsltimeseries}]{\sphinxcrossref{\DUrole{std,std-ref}{Relative}}}} Time Series.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}
\begin{sphinxuseclass}{tag_hide-input}
\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{d1dbe8b3cf3f29a861cc60f4f74f5f1d29433ac295db83015b73413c07f2ab26}.png}
\caption{Absolute sea level trend (red) from altimetry, and relative sea level trend (blue) from the tide gauge record at the \DUrole{pasted-text}{Midway} tide gauge station from \DUrole{pasted-text}{1993\sphinxhyphen{}01\sphinxhyphen{}01} to \DUrole{pasted-text}{2022\sphinxhyphen{}12\sphinxhyphen{}31}.}\label{\detokenize{notebooks/regional_and_local/SL_Trend:trend-fig-station}}\end{figure}

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Set the style of the plot}
\PYG{n}{sns}\PYG{o}{.}\PYG{n}{set\PYGZus{}style}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{whitegrid}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Create a color palette}
\PYG{n}{palette} \PYG{o}{=} \PYG{n}{sns}\PYG{o}{.}\PYG{n}{color\PYGZus{}palette}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Set1}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}



\PYG{c+c1}{\PYGZsh{} find the record\PYGZus{}ids that do not have nan trend\PYGZus{}mag\PYGZus{}rsl}
\PYG{n}{record\PYGZus{}ids} \PYG{o}{=} \PYG{n}{trend\PYGZus{}mag\PYGZus{}rsl}\PYG{o}{.}\PYG{n}{record\PYGZus{}id}\PYG{o}{.}\PYG{n}{values}

\PYG{n}{fig}\PYG{p}{,}\PYG{n}{axes} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,}\PYG{l+m+mi}{15}\PYG{p}{)}\PYG{p}{,} \PYG{n}{sharex}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{sharey}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
\PYG{n}{axes} \PYG{o}{=} \PYG{n}{axes}\PYG{o}{.}\PYG{n}{flatten}\PYG{p}{(}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{record\PYGZus{}ids}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{ax} \PYG{o}{=} \PYG{n}{axes}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}
    \PYG{c+c1}{\PYGZsh{} plot altimetry data}
    \PYG{n}{sla\PYGZus{}tg}\PYG{o}{.}\PYG{n}{sla}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{record\PYGZus{}ids}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{ax} \PYG{o}{=} \PYG{n}{ax}\PYG{p}{,} \PYG{n}{x}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Altimetry}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{n}{palette}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.2}\PYG{p}{,} \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{)}
    \PYG{n}{trend\PYGZus{}line\PYGZus{}asl}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{record\PYGZus{}ids}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{o}{.}\PYG{n}{line}\PYG{p}{(}\PYG{n}{ax} \PYG{o}{=} \PYG{n}{ax}\PYG{p}{,} \PYG{n}{x}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Altimetry Trend}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{n}{palette}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{linestyle}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{rsl\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{record\PYGZus{}ids}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{ax} \PYG{o}{=} \PYG{n}{ax}\PYG{p}{,} \PYG{n}{x}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Tide Gauge}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{n}{palette}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.2}\PYG{p}{,} \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{)}
    \PYG{n}{trend\PYGZus{}line\PYGZus{}rsl}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{record\PYGZus{}ids}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{o}{.}\PYG{n}{line}\PYG{p}{(}\PYG{n}{ax} \PYG{o}{=} \PYG{n}{ax}\PYG{p}{,} \PYG{n}{x}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Tide Gauge Trend}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{n}{palette}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{linestyle}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{title} \PYG{o}{=} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{station\PYGZus{}name}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{record\PYGZus{}ids}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{n}{title}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Height (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{k}{if} \PYG{n}{i} \PYG{o}{\PYGZpc{}} \PYG{l+m+mi}{2} \PYG{o}{==} \PYG{l+m+mi}{0}\PYG{p}{:}
        \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Height (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{k}{if} \PYG{n}{i} \PYG{o}{\PYGZlt{}} \PYG{l+m+mi}{10}\PYG{p}{:}
        \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{n}{x\PYGZus{}pos} \PYG{o}{=} \PYG{l+m+mf}{0.5}
    \PYG{n}{y\PYGZus{}pos} \PYG{o}{=} \PYG{l+m+mf}{0.05}
    \PYG{n}{spacing} \PYG{o}{=} \PYG{l+m+mf}{0.25}  \PYG{c+c1}{\PYGZsh{} Adjust this value as needed for proper spacing}

    \PYG{c+c1}{\PYGZsh{} Create the first part of the text in red}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{n}{x\PYGZus{}pos}\PYG{p}{,} \PYG{n}{y\PYGZus{}pos}\PYG{p}{,} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{l+m+mi}{100}\PYG{o}{*}\PYG{n}{trend\PYGZus{}rate\PYGZus{}asl}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{record\PYGZus{}ids}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ cm/yr}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{n}{palette}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}
            \PYG{n}{verticalalignment}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bottom}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{horizontalalignment}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{transAxes}\PYG{p}{,}
            \PYG{n}{bbox}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{facecolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{white}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Create the second part of the text in blue, separated by a fixed amount}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{n}{x\PYGZus{}pos} \PYG{o}{+} \PYG{n}{spacing}\PYG{p}{,} \PYG{n}{y\PYGZus{}pos}\PYG{p}{,} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{l+m+mi}{100}\PYG{o}{*}\PYG{n}{trend\PYGZus{}rate\PYGZus{}rsl}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{record\PYGZus{}ids}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ cm/yr}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{n}{palette}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,}
            \PYG{n}{verticalalignment}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bottom}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{horizontalalignment}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{transAxes}\PYG{p}{,}
            \PYG{n}{bbox}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{facecolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{white}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}\PYG{p}{)}
    


\PYG{c+c1}{\PYGZsh{} Set the y and x limits}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{.40}\PYG{p}{,} \PYG{l+m+mf}{.40}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlim}\PYG{p}{(}\PYG{p}{[}\PYG{n}{start\PYGZus{}date}\PYG{p}{,} \PYG{n}{end\PYGZus{}date}\PYG{p}{]}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} Adjust overall figure aesthetics}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{suptitle}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Altimetry and Tide Gauge Data Across Locations}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{fontsize}\PYG{o}{=}\PYG{l+m+mi}{16}\PYG{p}{)}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{tight\PYGZus{}layout}\PYG{p}{(}\PYG{n}{rect}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mf}{0.03}\PYG{p}{,} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{l+m+mf}{0.95}\PYG{p}{]}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} Adjust layout to make room for the main title}
\PYG{c+c1}{\PYGZsh{} Add a legend in the last subplot}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{n}{loc}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center left}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{bbox\PYGZus{}to\PYGZus{}anchor}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mf}{1.1}\PYG{p}{,} \PYG{l+m+mf}{0.75}\PYG{p}{)}\PYG{p}{,}\PYG{n}{ncol} \PYG{o}{=} \PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} remove the last subplot}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{delaxes}\PYG{p}{(}\PYG{n}{axes}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}


\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{trend\PYGZus{}fig}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{fig}\PYG{p}{,} \PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save the figure}
\PYG{n}{output\PYGZus{}file\PYGZus{}path} \PYG{o}{=} \PYG{n}{output\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SL\PYGZus{}magnitude\PYGZus{}timeseries.png}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{savefig}\PYG{p}{(}\PYG{n}{output\PYGZus{}file\PYGZus{}path}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{300}\PYG{p}{,} \PYG{n}{bbox\PYGZus{}inches}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tight}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{e8f225b94fb7f185d6a73f7c486490baf3d1d23d003eb80998af80be40a8c1ef}.png}
\caption{Absolute sea level trend (red) from altimetry, and relative sea level trend (blue) from the tide gauge record at the \DUrole{pasted-text}{Hawaiian Islands} stations from \DUrole{pasted-text}{1993\sphinxhyphen{}01\sphinxhyphen{}01} to \DUrole{pasted-text}{2022\sphinxhyphen{}12\sphinxhyphen{}31}.}\label{\detokenize{notebooks/regional_and_local/SL_Trend:trend-fig}}\end{figure}


\bigskip\hrule\bigskip



\chapter{Citations}
\label{\detokenize{notebooks/regional_and_local/SL_Trend:citations}}
\sphinxstepscope


\part{Annual Sea Level Anomalies}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:annual-sea-level-anomalies}}\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual::doc}}
\sphinxAtStartPar
Annual mean sea level anomalies. This page is very much in development!!

\begin{sphinxadmonition}{caution}{Caution:}
\sphinxAtStartPar
Major updates are needed for this page. Don’t look at it too hard…
\end{sphinxadmonition}


\chapter{Setup}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:setup}}
\sphinxAtStartPar
As with previous sections, we first need to import the necessary libraries, establish our input/output directories, and set up some basic plotting rules. We’ll do this by running another notebook called “setup” and “plotting functions,” and then we’ll set our data and output paths. If you have not run the datawrangling notebook, you will need to do this before running this notebook.

\begin{sphinxShadowBox}
\sphinxstylesidebartitle{}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
\sphinxstylestrong{TODO}
\begin{itemize}
\item {} 
\sphinxAtStartPar
Trend dates?

\item {} 
\sphinxAtStartPar
Confirm numbers match

\item {} 
\sphinxAtStartPar
Figure captions

\item {} 
\sphinxAtStartPar
Figure labels

\item {} 
\sphinxAtStartPar
Text

\item {} 
\sphinxAtStartPar
Check with John’s master plan

\item {} 
\sphinxAtStartPar
Clean up code

\item {} 
\sphinxAtStartPar
add commentary

\end{itemize}
\end{sphinxadmonition}
\end{sphinxShadowBox}

\begin{sphinxVerbatim}[commandchars=\\\{\}]

\end{sphinxVerbatim}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{\PYGZpc{}}\PYG{k}{run} ../setup.ipynb
\PYG{o}{\PYGZpc{}}\PYG{k}{run} ../plotting\PYGZus{}functions.ipynb
\PYG{n}{data\PYGZus{}dir} \PYG{o}{=} \PYG{n}{Path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../../data}\PYG{l+s+s1}{\PYGZsq{}} \PYG{p}{)}
\PYG{n}{output\PYGZus{}dir} \PYG{o}{=} \PYG{n}{Path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../../output}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} 

\PYG{c+c1}{\PYGZsh{} check to make sure that data\PYGZus{}dir/rsl\PYGZus{}daily\PYGZus{}hawaii.nc exists, if not, make warning to run datawrangling notebook}
\PYG{k}{if} \PYG{o+ow}{not} \PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{exists}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc not found in ../../data. Please run the data wrangling notebook first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{k}{else}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc found in ../../data. Proceed.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
rsl\PYGZus{}daily\PYGZus{}hawaii.nc found in ../../data. Proceed.
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Import the tide gauge data}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:import-the-tide-gauge-data}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}import rsl\PYGZus{}daily}
\PYG{n}{rsl\PYGZus{}daily} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir}\PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}make rsl\PYGZus{}daily a subset \PYGZhy{} do not include TGs with more than 25\PYGZpc{} NaNs}
\PYG{c+c1}{\PYGZsh{} get percent Nans in rsl\PYGZus{}daily[\PYGZsq{}sea\PYGZus{}level\PYGZsq{}]}

\PYG{n}{rsl\PYGZus{}daily}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 2MB
Dimensions:       (record\PYGZus{}id: 11, time: 10957)
Coordinates:
  * record\PYGZus{}id     (record\PYGZus{}id) int16 22B 140 500 520 570 ... 610 5470 5480 5520
  * time          (time) datetime64[ns] 88kB 1993\PYGZhy{}01\PYGZhy{}01 ... 2022\PYGZhy{}12\PYGZhy{}31
    lat           (record\PYGZus{}id) float32 44B ...
    lon           (record\PYGZus{}id) float32 44B ...
    station\PYGZus{}name  (record\PYGZus{}id) \PYGZlt{}U17 748B ...
    storm\PYGZus{}time    (time) datetime64[ns] 88kB ...
Data variables:
    rsl\PYGZus{}anomaly   (record\PYGZus{}id, time) float32 482kB ...
    rsl\PYGZus{}mhhw      (record\PYGZus{}id, time) float64 964kB ...
Attributes:
    long\PYGZus{}name:  Sea Level Anomaly
    units:      m
    source:     in situ tide gauge water level observations
    platform:   station\PYGZus{}name, station\PYGZus{}country, station\PYGZus{}country\PYGZus{}code, uhslc\PYGZus{}id...
    epoch:      1993\PYGZhy{}2001
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Do some data wrangling again.}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:do-some-data-wrangling-again}}

\subsection{1. Check the data and drop all stations with less than 80\% coverage}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:check-the-data-and-drop-all-stations-with-less-than-80-coverage}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data\PYGZus{}coverage} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{rsl\PYGZus{}mhhw}\PYG{o}{.}\PYG{n}{count}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{/}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{time}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}drop all locations with data\PYGZus{}coverage less than 80\PYGZpc{}}
\PYG{n}{rsl\PYGZus{}subset} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{data\PYGZus{}coverage}\PYG{o}{\PYGZgt{}}\PYG{l+m+mf}{0.80}\PYG{p}{,}\PYG{n}{drop}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{rsl\PYGZus{}subset}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 1MB
Dimensions:       (record\PYGZus{}id: 8, time: 10957)
Coordinates:
  * record\PYGZus{}id     (record\PYGZus{}id) int16 16B 500 520 570 580 590 600 610 5520
  * time          (time) datetime64[ns] 88kB 1993\PYGZhy{}01\PYGZhy{}01 ... 2022\PYGZhy{}12\PYGZhy{}31
    lat           (record\PYGZus{}id) float32 32B 28.22 16.75 21.31 ... 21.43 20.03
    lon           (record\PYGZus{}id) float32 32B 182.6 190.5 202.1 ... 202.2 204.2
    station\PYGZus{}name  (record\PYGZus{}id) \PYGZlt{}U17 544B \PYGZsq{}Midway\PYGZsq{} \PYGZsq{}Johnston\PYGZsq{} ... \PYGZsq{}Kawaihae\PYGZsq{}
    storm\PYGZus{}time    (time) datetime64[ns] 88kB ...
Data variables:
    rsl\PYGZus{}anomaly   (record\PYGZus{}id, time) float32 351kB \PYGZhy{}0.05425 \PYGZhy{}0.022 ... \PYGZhy{}0.1367
    rsl\PYGZus{}mhhw      (record\PYGZus{}id, time) float64 701kB \PYGZhy{}0.2078 \PYGZhy{}0.1756 ... \PYGZhy{}0.446
Attributes:
    long\PYGZus{}name:  Sea Level Anomaly
    units:      m
    source:     in situ tide gauge water level observations
    platform:   station\PYGZus{}name, station\PYGZus{}country, station\PYGZus{}country\PYGZus{}code, uhslc\PYGZus{}id...
    epoch:      1993\PYGZhy{}2001
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\subsection{2. Now we’ll remove the trend (over the entire record) from this subset of stations.}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:now-we-ll-remove-the-trend-over-the-entire-record-from-this-subset-of-stations}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{trend\PYGZus{}mag}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}anomaly}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}anomaly\PYGZus{}detrended}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}anomaly}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\subsection{3. Resample to monthly time series of anomalies.}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:resample-to-monthly-time-series-of-anomalies}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} resample to monthly time series }
\PYG{n}{rsl\PYGZus{}monthly} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{resample}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1M}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{right}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} get climatology (annual cycle) by grouping by month}
\PYG{n}{rsl\PYGZus{}climatology} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}monthly}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.month}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} get anomalies by subtracting climatology from monthly data}
\PYG{n}{rsl\PYGZus{}anomalies} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}monthly}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.month}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{o}{\PYGZhy{}} \PYG{n}{rsl\PYGZus{}climatology}

\PYG{n}{rsl\PYGZus{}anomalies}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
/opt/anaconda3/envs/SLI39/lib/python3.9/site\PYGZhy{}packages/xarray/core/groupby.py:668: FutureWarning: \PYGZsq{}M\PYGZsq{} is deprecated and will be removed in a future version, please use \PYGZsq{}ME\PYGZsq{} instead.
  index\PYGZus{}grouper = pd.Grouper(
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 52kB
Dimensions:                (record\PYGZus{}id: 8, time: 360)
Coordinates:
  * record\PYGZus{}id              (record\PYGZus{}id) int16 16B 500 520 570 ... 600 610 5520
    lat                    (record\PYGZus{}id) float32 32B 28.22 16.75 ... 21.43 20.03
    lon                    (record\PYGZus{}id) float32 32B 182.6 190.5 ... 202.2 204.2
    station\PYGZus{}name           (record\PYGZus{}id) \PYGZlt{}U17 544B \PYGZsq{}Midway\PYGZsq{} ... \PYGZsq{}Kawaihae\PYGZsq{}
  * time                   (time) datetime64[ns] 3kB 1993\PYGZhy{}01\PYGZhy{}31 ... 2022\PYGZhy{}12\PYGZhy{}31
    month                  (time) int64 3kB 1 2 3 4 5 6 7 8 ... 6 7 8 9 10 11 12
Data variables:
    rsl\PYGZus{}anomaly            (time, record\PYGZus{}id) float32 12kB \PYGZhy{}0.09168 ... \PYGZhy{}0.07986
    rsl\PYGZus{}mhhw               (time, record\PYGZus{}id) float64 23kB \PYGZhy{}0.09168 ... \PYGZhy{}0.07986
    rsl\PYGZus{}anomaly\PYGZus{}detrended  (time, record\PYGZus{}id) float32 12kB \PYGZhy{}0.03686 ... \PYGZhy{}0.1795
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\subsection{4. Now sort the subset on “storm year” instead of calendar year for yearly means.}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:now-sort-the-subset-on-storm-year-instead-of-calendar-year-for-yearly-means}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} change the index to be on storm\PYGZus{}time instead of time}
\PYG{n}{rsl\PYGZus{}subset} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{set\PYGZus{}index}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} rename the time dimension to storm\PYGZus{}time}
\PYG{n}{rsl\PYGZus{}subset} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{rename}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{rsl\PYGZus{}subset}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 1MB
Dimensions:                (record\PYGZus{}id: 8, storm\PYGZus{}time: 10957)
Coordinates:
  * record\PYGZus{}id              (record\PYGZus{}id) int16 16B 500 520 570 ... 600 610 5520
  * storm\PYGZus{}time             (storm\PYGZus{}time) datetime64[ns] 88kB 1992\PYGZhy{}01\PYGZhy{}01 ... 20...
    lat                    (record\PYGZus{}id) float32 32B 28.22 16.75 ... 21.43 20.03
    lon                    (record\PYGZus{}id) float32 32B 182.6 190.5 ... 202.2 204.2
    station\PYGZus{}name           (record\PYGZus{}id) \PYGZlt{}U17 544B \PYGZsq{}Midway\PYGZsq{} ... \PYGZsq{}Kawaihae\PYGZsq{}
Data variables:
    rsl\PYGZus{}anomaly            (record\PYGZus{}id, storm\PYGZus{}time) float32 351kB \PYGZhy{}0.05425 ......
    rsl\PYGZus{}mhhw               (record\PYGZus{}id, storm\PYGZus{}time) float64 701kB \PYGZhy{}0.2078 ... ...
    rsl\PYGZus{}anomaly\PYGZus{}detrended  (record\PYGZus{}id, storm\PYGZus{}time) float32 351kB \PYGZhy{}0.01937 ......
Attributes:
    long\PYGZus{}name:  Sea Level Anomaly
    units:      m
    source:     in situ tide gauge water level observations
    platform:   station\PYGZus{}name, station\PYGZus{}country, station\PYGZus{}country\PYGZus{}code, uhslc\PYGZus{}id...
    epoch:      1993\PYGZhy{}2001
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} reorder to that storm\PYGZus{}time is monotonicly increasing}
\PYG{n}{rsl\PYGZus{}subset} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{sortby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Group by storm\PYGZus{}year and record\PYGZus{}id}
\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} give year dimension a name}
\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{o}{.}\PYG{n}{rename}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 5kB
Dimensions:                (storm\PYGZus{}year: 31, record\PYGZus{}id: 8)
Coordinates:
  * record\PYGZus{}id              (record\PYGZus{}id) int16 16B 500 520 570 ... 600 610 5520
    lat                    (record\PYGZus{}id) float32 32B 28.22 16.75 ... 21.43 20.03
    lon                    (record\PYGZus{}id) float32 32B 182.6 190.5 ... 202.2 204.2
    station\PYGZus{}name           (record\PYGZus{}id) \PYGZlt{}U17 544B \PYGZsq{}Midway\PYGZsq{} ... \PYGZsq{}Kawaihae\PYGZsq{}
  * storm\PYGZus{}year             (storm\PYGZus{}year) int64 248B 1992 1993 1994 ... 2021 2022
Data variables:
    rsl\PYGZus{}anomaly            (storm\PYGZus{}year, record\PYGZus{}id) float32 992B \PYGZhy{}0.05539 ... ...
    rsl\PYGZus{}mhhw               (storm\PYGZus{}year, record\PYGZus{}id) float64 2kB \PYGZhy{}0.209 ... \PYGZhy{}0....
    rsl\PYGZus{}anomaly\PYGZus{}detrended  (storm\PYGZus{}year, record\PYGZus{}id) float32 992B \PYGZhy{}0.02112 ... ...
Attributes:
    long\PYGZus{}name:  Sea Level Anomaly
    units:      m
    source:     in situ tide gauge water level observations
    platform:   station\PYGZus{}name, station\PYGZus{}country, station\PYGZus{}country\PYGZus{}code, uhslc\PYGZus{}id...
    epoch:      1993\PYGZhy{}2001
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\chapter{Absolute Value: satellite (trend removed)}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:absolute-value-satellite-trend-removed}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} open the cmems data}
\PYG{n}{cmems} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cmems\PYGZus{}L4\PYGZus{}SSH\PYGZus{}0.25deg\PYGZus{}1993\PYGZus{}2023.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Plot an area\sphinxhyphen{}wide map, with stations}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:plot-an-area-wide-map-with-stations}}
\sphinxAtStartPar
First we’ll need to make sure that our data is detrended properly in order to look at yearly anomalies.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} concentrating on decadal trends}
\PYG{c+c1}{\PYGZsh{} let\PYGZsq{}s look at 1993\PYGZhy{}2003 and 2003\PYGZhy{}2013}

\PYG{n}{trend\PYGZus{}mag}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{cmems}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1993}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2023}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{n}{weighted}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} define vmin and vmax variables}
\PYG{n}{vmin} \PYG{o}{=} \PYG{l+m+mi}{0}
\PYG{n}{vmax} \PYG{o}{=} \PYG{l+m+mf}{0.5}
\PYG{n}{xlims} \PYG{o}{=} \PYG{p}{[}\PYG{n}{cmems}\PYG{o}{.}\PYG{n}{longitude}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmems}\PYG{o}{.}\PYG{n}{longitude}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}
\PYG{n}{ylims} \PYG{o}{=} \PYG{p}{[}\PYG{n}{cmems}\PYG{o}{.}\PYG{n}{latitude}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmems}\PYG{o}{.}\PYG{n}{latitude}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}

\PYG{n}{trend\PYGZus{}rate\PYGZus{}cm} \PYG{o}{=} \PYG{n}{trend\PYGZus{}rate} \PYG{o}{*} \PYG{l+m+mi}{100} \PYG{c+c1}{\PYGZsh{} convert to cm/yr}

\PYG{c+c1}{\PYGZsh{} make ax,fig}
\PYG{n}{crs} \PYG{o}{=} \PYG{n}{ccrs}\PYG{o}{.}\PYG{n}{PlateCarree}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{cmap} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{YlOrRd}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax}\PYG{p}{,} \PYG{n}{crs} \PYG{o}{=} \PYG{n}{plot\PYGZus{}map}\PYG{p}{(}\PYG{n}{vmin}\PYG{p}{,}\PYG{n}{vmax}\PYG{p}{,}\PYG{n}{cmap}\PYG{p}{,}\PYG{n}{xlims}\PYG{p}{,}\PYG{n}{ylims}\PYG{p}{)}
\PYG{n}{trend\PYGZus{}rate\PYGZus{}cm}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{,}
                         \PYG{n}{vmin}\PYG{o}{=}\PYG{n}{vmin}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{n}{vmax}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{cmap}\PYG{p}{,} \PYG{n}{add\PYGZus{}colorbar}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} 
                         \PYG{n}{cbar\PYGZus{}kwargs}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{label}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level Trend rate (cm/yr, 1993\PYGZhy{}2023)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}
\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Call the function to add the zebra frame}
\PYG{n}{plot\PYGZus{}zebra\PYGZus{}frame}\PYG{p}{(}\PYG{n}{ax}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,} \PYG{n}{segment\PYGZus{}length}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{crs}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{498f9bb9acde41e5c3a4f143d6c617e56fc5df5a65e5169d71f91a028b9c8a28}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Area\sphinxhyphen{}weighted average trend}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:area-weighted-average-trend}}
\sphinxAtStartPar
Is this something we want to do for the region? I don’t think so? I suppose we’ll use the entire grid for this? For example:

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{startYear} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1993}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{endYear} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2023}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{trend\PYGZus{}mag}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{cmems}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{n}{startYear}\PYG{p}{,}\PYG{n}{endYear}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{n}{weighted}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{The trend rate for }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{startYear}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZhy{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{endYear}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ in the entire grid is }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{trend\PYGZus{}rate}\PYG{o}{*}\PYG{l+m+mi}{100}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ cm/yr}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
The trend rate for 1993\PYGZhy{}2023 in the entire grid is 0.22 cm/yr
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} concentrating on decadal trends}
\PYG{c+c1}{\PYGZsh{} let\PYGZsq{}s look at 1993\PYGZhy{}2003 and 2003\PYGZhy{}2013}
\PYG{n}{cmems1993\PYGZus{}2003} \PYG{o}{=} \PYG{n}{cmems}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1993}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2003}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} get the overall trend (full time series)}
\PYG{n}{trend\PYGZus{}mag}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{cmems}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{trend\PYGZus{}mag\PYGZus{}area\PYGZus{}weighted}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend\PYGZus{}area\PYGZus{}weighted}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate\PYGZus{}area\PYGZus{}weighted} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{cmems}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}\PYG{n}{weighted}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{}remove the trend from the data}
\PYG{n}{sla\PYGZus{}detrended} \PYG{o}{=} \PYG{n}{cmems1993\PYGZus{}2003}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1993}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2003}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{sla\PYGZus{}detrended\PYGZus{}area\PYGZus{}weighted} \PYG{o}{=} \PYG{n}{cmems1993\PYGZus{}2003}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend\PYGZus{}area\PYGZus{}weighted}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1993}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2003}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
Let’s check this for a random station in our list.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rid} \PYG{o}{=} \PYG{l+m+mi}{3}
\PYG{n}{lat} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{lat}
\PYG{n}{lon} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{lon}
\PYG{n}{sla\PYGZus{}detrended}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{latitude}\PYG{o}{=}\PYG{n}{lat}\PYG{p}{,} \PYG{n}{longitude}\PYG{o}{=}\PYG{n}{lon}\PYG{p}{,} \PYG{n}{method}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nearest}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level Anomaly (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{sla\PYGZus{}detrended\PYGZus{}area\PYGZus{}weighted}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{latitude}\PYG{o}{=}\PYG{n}{lat}\PYG{p}{,} \PYG{n}{longitude}\PYG{o}{=}\PYG{n}{lon}\PYG{p}{,} \PYG{n}{method}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nearest}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Area Weighted Sea Level Anomaly (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} change the title to station name}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{title}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Text(0.5, 1.0, \PYGZsq{}Nawiliwili\PYGZsq{})
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{9870e9f738625fb7781cf5105245471f0d70fa96777afa83ee07f421215723ac}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
There are slight differences between removing the grid\sphinxhyphen{}level trend versus the area\sphinxhyphen{}weighted trend in this plot. Nothing too major here.


\section{Create a map}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:create-a-map}}
\sphinxAtStartPar
Concentrating on decadal trends.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} concentrating on decadal trends}
\PYG{c+c1}{\PYGZsh{} let\PYGZsq{}s look at 1993\PYGZhy{}2003 and 2003\PYGZhy{}2013}

\PYG{n}{yr\PYGZus{}start} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{1993}\PYG{p}{,}\PYG{l+m+mi}{2003}\PYG{p}{,}\PYG{l+m+mi}{2013}\PYG{p}{,}\PYG{l+m+mi}{1993}\PYG{p}{]}
\PYG{n}{yr\PYGZus{}stop} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{2003}\PYG{p}{,}\PYG{l+m+mi}{2013}\PYG{p}{,}\PYG{l+m+mi}{2023}\PYG{p}{,}\PYG{l+m+mi}{2023}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{}do storm year instead of calendar year}

\PYG{n}{yr\PYGZus{}start\PYGZus{}str} \PYG{o}{=} \PYG{p}{[}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{yr}\PYG{p}{)}\PYG{p}{)}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}05\PYGZhy{}01}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{for} \PYG{n}{yr} \PYG{o+ow}{in} \PYG{n}{yr\PYGZus{}start}\PYG{p}{]}
\PYG{n}{yr\PYGZus{}stop\PYGZus{}str} \PYG{o}{=} \PYG{p}{[}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{yr}\PYG{p}{)}\PYG{p}{)}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}04\PYGZhy{}30}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{for} \PYG{n}{yr} \PYG{o+ow}{in} \PYG{n}{yr\PYGZus{}stop}\PYG{p}{]}

\PYG{n}{trend\PYGZus{}mag}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{cmems}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{n}{yr\PYGZus{}start\PYGZus{}str}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,}\PYG{n}{yr\PYGZus{}stop\PYGZus{}str}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{p}{,}\PYG{n}{weighted}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}remove the trend from the data}
\PYG{n}{sla\PYGZus{}detrended} \PYG{o}{=} \PYG{n}{cmems}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}


\PYG{c+c1}{\PYGZsh{} make 4 subplots for each year range}
\PYG{n}{crs} \PYG{o}{=} \PYG{n}{ccrs}\PYG{o}{.}\PYG{n}{PlateCarree}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{8}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{,} \PYG{n}{subplot\PYGZus{}kw}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{projection}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{crs}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Variable to hold the colorbar handle}
\PYG{n}{cbar\PYGZus{}ax} \PYG{o}{=} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}axes}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mf}{0.92}\PYG{p}{,} \PYG{l+m+mf}{0.15}\PYG{p}{,} \PYG{l+m+mf}{0.03}\PYG{p}{,} \PYG{l+m+mf}{0.7}\PYG{p}{]}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} Adjust these values to fit your layout}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{subplots\PYGZus{}adjust}\PYG{p}{(}\PYG{n}{right}\PYG{o}{=}\PYG{l+m+mf}{0.9}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} Make space for the colorbar}
 

\PYG{n}{vmin} \PYG{o}{=} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.03}
\PYG{n}{vmax} \PYG{o}{=} \PYG{l+m+mf}{0.03}
\PYG{c+c1}{\PYGZsh{} Loop through each period}
\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{ax} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{flat}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Select the data for the current period and calculate the mean over time}
    \PYG{n}{sla\PYGZus{}mean} \PYG{o}{=} \PYG{n}{sla\PYGZus{}detrended}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{n}{yr\PYGZus{}start\PYGZus{}str}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,}\PYG{n}{yr\PYGZus{}stop\PYGZus{}str}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{skipna}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
    \PYG{c+c1}{\PYGZsh{} sla\PYGZus{}mean = sla\PYGZus{}mean \PYGZhy{} sea\PYGZus{}level\PYGZus{}trend.sel(time=slice(str(yr\PYGZus{}start[i]), str(yr\PYGZus{}stop[i]))).mean(dim=\PYGZsq{}time\PYGZsq{})}

    \PYG{c+c1}{\PYGZsh{}subtract the}
    
    \PYG{c+c1}{\PYGZsh{} Plot the mean sea level anomaly}
    \PYG{n}{c} \PYG{o}{=} \PYG{n}{sla\PYGZus{}mean}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{,} \PYG{n}{add\PYGZus{}colorbar}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{RdBu\PYGZus{}r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    
    \PYG{c+c1}{\PYGZsh{} Set the title to the current period}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{yr\PYGZus{}start}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZhy{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{yr\PYGZus{}stop}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Add coastlines and land  }
    \PYG{n}{palette} \PYG{o}{=} \PYG{n}{sns}\PYG{o}{.}\PYG{n}{color\PYGZus{}palette}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{RdBu\PYGZus{}r}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{as\PYGZus{}cmap}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
    \PYG{n}{cmap} \PYG{o}{=} \PYG{n}{palette}

    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{add\PYGZus{}feature}\PYG{p}{(}\PYG{n}{cfeature}\PYG{o}{.}\PYG{n}{COASTLINE}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{add\PYGZus{}feature}\PYG{p}{(}\PYG{n}{cfeature}\PYG{o}{.}\PYG{n}{LAND}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lightgrey}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    
    \PYG{c+c1}{\PYGZsh{} Optionally, adjust color limits for consistency across plots}
    \PYG{n}{c}\PYG{o}{.}\PYG{n}{set\PYGZus{}clim}\PYG{p}{(}\PYG{n}{vmin}\PYG{p}{,}\PYG{n}{vmax}\PYG{p}{)}

    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{,} \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{50}\PYG{p}{,}
              \PYG{n}{c}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{white}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{n}{edgecolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{zorder}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{)}
    
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{,} \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,} 
           \PYG{n}{c}\PYG{o}{=}\PYG{n}{rsl\PYGZus{}anomalies}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{n}{yr\PYGZus{}start\PYGZus{}str}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,}\PYG{n}{yr\PYGZus{}stop\PYGZus{}str}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{rsl\PYGZus{}anomaly\PYGZus{}detrended}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{time}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{vmin}\PYG{o}{=}\PYG{n}{vmin}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{n}{vmax}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{n}{cmap}\PYG{p}{,}
           \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{n}{edgecolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{zorder}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{)}
    
    \PYG{c+c1}{\PYGZsh{}add grid}
    \PYG{n}{gl} \PYG{o}{=} \PYG{n}{ax}\PYG{o}{.}\PYG{n}{gridlines}\PYG{p}{(}\PYG{n}{draw\PYGZus{}labels}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{linestyle}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                      \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,}\PYG{n}{xlocs}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{get\PYGZus{}xticks}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}\PYG{n}{ylocs}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{get\PYGZus{}yticks}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
    
    \PYG{k}{if} \PYG{n}{i}\PYG{o}{\PYGZgt{}}\PYG{l+m+mi}{1}\PYG{p}{:}
        \PYG{n}{gl}\PYG{o}{.}\PYG{n}{bottom\PYGZus{}labels} \PYG{o}{=} \PYG{k+kc}{True}

    \PYG{k}{if} \PYG{n}{i}\PYG{o}{==}\PYG{l+m+mi}{0}\PYG{p}{:}
        \PYG{n}{gl}\PYG{o}{.}\PYG{n}{left\PYGZus{}labels} \PYG{o}{=} \PYG{k+kc}{True}

    \PYG{k}{if} \PYG{n}{i}\PYG{o}{==}\PYG{l+m+mi}{2}\PYG{p}{:}
        \PYG{n}{gl}\PYG{o}{.}\PYG{n}{left\PYGZus{}labels} \PYG{o}{=} \PYG{k+kc}{True}

    \PYG{c+c1}{\PYGZsh{}make all labels tiny}
    \PYG{n}{gl}\PYG{o}{.}\PYG{n}{xlabel\PYGZus{}style} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{size}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+m+mi}{8}\PYG{p}{\PYGZcb{}}
    \PYG{n}{gl}\PYG{o}{.}\PYG{n}{ylabel\PYGZus{}style} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{size}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+m+mi}{8}\PYG{p}{\PYGZcb{}}
    



\PYG{c+c1}{\PYGZsh{} Add the colorbar}
\PYG{n}{cbar} \PYG{o}{=} \PYG{n}{fig}\PYG{o}{.}\PYG{n}{colorbar}\PYG{p}{(}\PYG{n}{c}\PYG{p}{,} \PYG{n}{cax}\PYG{o}{=}\PYG{n}{cbar\PYGZus{}ax}\PYG{p}{)}
\PYG{n}{cbar}\PYG{o}{.}\PYG{n}{set\PYGZus{}label}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level Anomaly (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}


\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SL\PYGZus{}YMA\PYGZus{}decadal}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{fig}\PYG{p}{,}\PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{d68ece3b7ef7a584a24f82db05849a0ea01aeb003b5841d417c9cd797b5e0fba}.png}
\caption{Decadal (or bidecadal, is that a word) mean anomalies of the Hawaiian Islands region, background trend (Storm Years 1993\sphinxhyphen{}2023) removed. Note that the sea level is plotted in units of m. The mean anomaly is near zero when using the full timeseries and grid\sphinxhyphen{}level trends (i.e. no area\sphinxhyphen{}weighted averaging). Mean monthly anomalies at the stations are plotted as well, showing similar\sphinxhyphen{}ish patterns, with some weirdness at Kawaihae that I should check on.}\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:sl-yma-decadal}}\end{figure}


\chapter{Relative Value: tide station (trend removed)}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:relative-value-tide-station-trend-removed}}

\section{area\sphinxhyphen{}wide map with stations}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:area-wide-map-with-stations}}

\section{station plots: time series}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:station-plots-time-series}}
\sphinxAtStartPar
These should have ONI/ENSO phase included on them

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{plot\PYGZus{}TG\PYGZus{}rsl\PYGZus{}anomaly\PYGZus{}annual}\PYG{p}{(}\PYG{n}{rid}\PYG{p}{,} \PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}anomalies}\PYG{p}{,}\PYG{n}{oni}\PYG{p}{,} \PYG{n}{oniPlot}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}\PYG{p}{:}

    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlim}\PYG{p}{(}\PYG{l+m+mi}{1993}\PYG{p}{,}\PYG{l+m+mi}{2022}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.3}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{grid}\PYG{p}{(}\PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.2}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lightgray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{k}{if} \PYG{n}{oniPlot}\PYG{p}{:}
        \PYG{n}{ymin}\PYG{p}{,} \PYG{n}{ymax} \PYG{o}{=} \PYG{n}{ax}\PYG{o}{.}\PYG{n}{get\PYGZus{}ylim}\PYG{p}{(}\PYG{p}{)}
        \PYG{c+c1}{\PYGZsh{} Shading El Niño events}
        \PYG{n}{ax}\PYG{o}{.}\PYG{n}{fill\PYGZus{}between}\PYG{p}{(}\PYG{n}{oni}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{n}{ymin}\PYG{p}{,}\PYG{n}{ymax}\PYG{p}{,} 
                        \PYG{n}{where}\PYG{o}{=}\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{El Nino}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{==} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{red}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{El Niño}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
        \PYG{c+c1}{\PYGZsh{} Shading La Niña events}
        \PYG{n}{ax}\PYG{o}{.}\PYG{n}{fill\PYGZus{}between}\PYG{p}{(}\PYG{n}{oni}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,}  \PYG{n}{ymin}\PYG{p}{,}\PYG{n}{ymax}\PYG{p}{,}
                        \PYG{n}{where}\PYG{o}{=}\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{La Nina}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{==} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{blue}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{La Niña}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    
    \PYG{c+c1}{\PYGZsh{} get min and max for each year}
    \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}min} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}max} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{groupby}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{}make a fill from max to min for each month}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{fill\PYGZus{}between}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{o}{.}\PYG{n}{storm\PYGZus{}year}\PYG{o}{+}\PYG{l+m+mf}{0.5}\PYG{p}{,} 
                     \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}min}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}anomaly\PYGZus{}detrended}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{p}{,} 
                     \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}max}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}anomaly\PYGZus{}detrended}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{p}{,} 
                     \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.2}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Range (Annual SLA Min\PYGZhy{}Max)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{o}{.}\PYG{n}{storm\PYGZus{}year}\PYG{o}{+}\PYG{l+m+mf}{0.5}\PYG{p}{,} 
            \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}anomaly\PYGZus{}detrended}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{p}{,} 
            \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Annual Mean Sea Level Anomaly (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} convert rsl\PYGZus{}monthly[\PYGZsq{}time\PYGZsq{}] to float}
    \PYG{n}{storm\PYGZus{}time\PYGZus{}float} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}monthly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{+} \PYG{p}{(}\PYG{n}{rsl\PYGZus{}monthly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time.month}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{5}\PYG{p}{)}\PYG{o}{/}\PYG{l+m+mi}{12} \PYG{c+c1}{\PYGZsh{}subtract 5 months to go with \PYGZsq{}storm year\PYGZsq{} convention (May\PYGZhy{}April)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{storm\PYGZus{}time\PYGZus{}float}\PYG{p}{,} 
            \PYG{n}{rsl\PYGZus{}anomalies}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}anomaly\PYGZus{}detrended}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{p}{,} 
            \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Monthly Mean Sea Level Anomaly (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{gray}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mf}{0.75}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} add rsl\PYGZus{}yearly\PYGZus{}mean[\PYGZsq{}station\PYGZus{}name\PYGZsq{}].isel(record\PYGZus{}id=rid).values to upper center of plot}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+m+mf}{0.9}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{horizontalalignment}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{verticalalignment}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{transAxes}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
First, we’ll plot one gauge

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,}\PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} add ENSO to the plots}
\PYG{c+c1}{\PYGZsh{} import oni.csv}
\PYG{n}{oni} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{read\PYGZus{}csv}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir}\PYG{o}{/}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{oni.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{header}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} change oni index to Date column}
\PYG{n}{oni}\PYG{o}{.}\PYG{n}{index} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}adjust the index to be float value of fractional year}
\PYG{n}{oni}\PYG{o}{.}\PYG{n}{index} \PYG{o}{=} \PYG{n}{oni}\PYG{o}{.}\PYG{n}{index}\PYG{o}{.}\PYG{n}{year} \PYG{o}{+} \PYG{p}{(}\PYG{n}{oni}\PYG{o}{.}\PYG{n}{index}\PYG{o}{.}\PYG{n}{month} \PYG{o}{\PYGZhy{}} \PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{/}\PYG{l+m+mi}{12} \PYG{o}{\PYGZhy{}} \PYG{l+m+mi}{5}\PYG{o}{/}\PYG{l+m+mi}{12}

\PYG{n}{plot\PYGZus{}TG\PYGZus{}rsl\PYGZus{}anomaly\PYGZus{}annual}\PYG{p}{(}\PYG{n}{i}\PYG{p}{,} \PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax}\PYG{p}{,}  \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}anomalies}\PYG{p}{,}\PYG{n}{oni}\PYG{p}{,}\PYG{n}{oniPlot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{n}{loc}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{upper right}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ncol}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{bbox\PYGZus{}to\PYGZus{}anchor}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mf}{1.6}\PYG{p}{,} \PYG{l+m+mf}{1.0}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Save the plot to a file}
\PYG{n}{filename} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SL\PYGZus{}MMA\PYGZus{}annual\PYGZus{}}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{i}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.png}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{savefig}\PYG{p}{(}\PYG{n}{output\PYGZus{}dir} \PYG{o}{/} \PYG{n}{filename}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{300}\PYG{p}{,} \PYG{n}{bbox\PYGZus{}inches}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tight}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{fig}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mf}{0.05}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level Anomaly (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{va}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{rotation}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vertical}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Storm Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ha}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SL\PYGZus{}MMA\PYGZus{}annual\PYGZus{}station}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{fig}\PYG{p}{,}\PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{n}{station} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{i}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}

\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{station}\PYG{p}{,}\PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{01547d97eab36648d2218b1fabbdff4be47ba8ab3da0d7018621b16bcd57f94d}.png}
\caption{Yearly mean anomalies at the \DUrole{pasted-text}{Nawiliwili} tide gauge with background trend removed (blue). The shaded region about the annual mean denotes the annual means of the daily min and max sea level. Note that the sea level is plotted in units of m. The monthly mean anomaly (gray) is calculated with respect to the annual cycle. El Niño and La Niño time periods are derived from the Oceanic Niño Index (ONI), available at \sphinxurl{https://origin.cpc.ncep.noaa.gov/products/analysis\_monitoring/ensostuff/ONI\_v5.php}}\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:sl-mma-annual-station}}\end{figure}


\section{Create a time series plot}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:create-a-time-series-plot}}
\sphinxAtStartPar
Now we will plot all the gauges.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} get axis for the plots}
\PYG{n}{fig}\PYG{p}{,}\PYG{n}{axes} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{4}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,}\PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{,} \PYG{n}{sharex}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{sharey}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
\PYG{n}{axes} \PYG{o}{=} \PYG{n}{axes}\PYG{o}{.}\PYG{n}{flatten}\PYG{p}{(}\PYG{p}{)}



\PYG{n}{record\PYGZus{}ids} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}monthly}\PYG{o}{.}\PYG{n}{record\PYGZus{}id}\PYG{o}{.}\PYG{n}{values}
\PYG{c+c1}{\PYGZsh{} iterate over each axis and plot the monthly mean}
\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{record\PYGZus{}ids}\PYG{p}{)}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{ax} \PYG{o}{=} \PYG{n}{axes}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}
    \PYG{n}{plot\PYGZus{}TG\PYGZus{}rsl\PYGZus{}anomaly\PYGZus{}annual}\PYG{p}{(}\PYG{n}{i}\PYG{p}{,} \PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax}\PYG{p}{,}  \PYG{n}{rsl\PYGZus{}yearly\PYGZus{}mean}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}anomalies}\PYG{p}{,}\PYG{n}{oni}\PYG{p}{,}\PYG{n}{oniPlot}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

    \PYG{k}{if} \PYG{n}{i} \PYG{o}{\PYGZlt{}} \PYG{l+m+mi}{7}\PYG{p}{:}
        \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}    


\PYG{c+c1}{\PYGZsh{}add El Nino and La Nina years}


\PYG{n}{axes}\PYG{p}{[}\PYG{l+m+mi}{7}\PYG{p}{]}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{n}{loc}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lower center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ncol}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{,}\PYG{n}{bbox\PYGZus{}to\PYGZus{}anchor}\PYG{o}{=}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.1}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add y label}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mf}{0.06}\PYG{p}{,} \PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level Anomaly (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{va}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{rotation}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{vertical}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{l+m+mf}{0.06}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Storm Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{ha}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{} Save the plot to a file}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{savefig}\PYG{p}{(}\PYG{n}{output\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SL\PYGZus{}MMA\PYGZus{}annual.png}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{dpi}\PYG{o}{=}\PYG{l+m+mi}{300}\PYG{p}{,} \PYG{n}{bbox\PYGZus{}inches}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tight}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{SL\PYGZus{}MMA\PYGZus{}annual}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}\PYG{n}{fig}\PYG{p}{,}\PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{a8b6d5ef5386f0ca573122c4bdf602b4f7ff85fb77627f77a589918d5aea4180}.png}
\caption{Yearly mean anomalies at the each tide gauge with background trend removed (blue). The shaded region denotes the yearly means of the daily min and max sea level anomalies. Note that the sea level is plotted in units of m, with the epoch daily mean and trend removed. The monthly mean anomaly (orange) is calculated with respect to the annual cycle. This plot is foul looking, it reminds me of a wound, and I will return to it later.}\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:sl-mma-annual}}\end{figure}


\chapter{Make a plot}
\label{\detokenize{notebooks/regional_and_local/SL_anomaly_annual:make-a-plot}}
\sphinxAtStartPar
Which plot? Why did I write this.

\sphinxstepscope


\part{Annual Sea Level Rankings}
\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:annual-sea-level-rankings}}\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual::doc}}
\begin{figure}[htbp]
\centering

\noindent\sphinxincludegraphics[scale=0.8]{{b827930c2a1f087092d409b27247bd84656d3504ee2990e12526b27172528ed7}.png}
\end{figure}

\sphinxAtStartPar
In this notebook, we’ll be creating a {\hyperref[\detokenize{notebooks/regional_and_local/SL_Rankings_annual:sl-rankings-results}]{\sphinxcrossref{\DUrole{std,std-ref}{table}}}}, a {\hyperref[\detokenize{notebooks/regional_and_local/SL_Rankings_annual:SL_rankings_map}]{\sphinxcrossref{\DUrole{xref,myst}{map}}}}, and a time series {\hyperref[\detokenize{notebooks/regional_and_local/SL_Rankings_annual:sl-rankings-timeseries}]{\sphinxcrossref{\DUrole{std,std-ref}{plot}}}} of sea level rankings at Hawaiian Islands tide gauge stations from 1993\sphinxhyphen{}2023.

\sphinxAtStartPar
Download Files:
\DUrole{xref,download,myst}{Map} |
\DUrole{xref,download,myst}{Time Series Plot} |
\DUrole{xref,download,myst}{Table}


\chapter{Setup}
\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:setup}}
\sphinxAtStartPar
As with previous sections, we first need to import the necessary libraries, establish our input/output directories, and set up some basic plotting rules. We’ll do this by running another notebook called “setup” and “plotting functions,” and then we’ll set our data and output paths. If you have not run the datawrangling notebook, you will need to do this before running this notebook. Note that this notebook is also largely a repeat of the anomaly notebook.

\begin{sphinxShadowBox}
\sphinxstylesidebartitle{}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
\sphinxstylestrong{TODO}
\begin{itemize}
\item {} 
\sphinxAtStartPar
Confirm numbers match

\item {} 
\sphinxAtStartPar
Figure captions

\item {} 
\sphinxAtStartPar
Figure labels

\item {} 
\sphinxAtStartPar
Text

\item {} 
\sphinxAtStartPar
Clean up code

\item {} 
\sphinxAtStartPar
add commentary

\end{itemize}
\end{sphinxadmonition}
\end{sphinxShadowBox}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{\PYGZpc{}}\PYG{k}{run} ../setup.ipynb
\PYG{o}{\PYGZpc{}}\PYG{k}{run} ../plotting\PYGZus{}functions.ipynb
\PYG{n}{data\PYGZus{}dir} \PYG{o}{=} \PYG{n}{Path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../../data}\PYG{l+s+s1}{\PYGZsq{}} \PYG{p}{)}
\PYG{n}{output\PYGZus{}dir} \PYG{o}{=} \PYG{n}{Path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../../output}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} 

\PYG{c+c1}{\PYGZsh{} We\PYGZsq{}re going to use plotly here, so we need to import it}
\PYG{k+kn}{import} \PYG{n+nn}{plotly}\PYG{n+nn}{.}\PYG{n+nn}{io} \PYG{k}{as} \PYG{n+nn}{pio}
\PYG{k+kn}{import} \PYG{n+nn}{plotly}\PYG{n+nn}{.}\PYG{n+nn}{express} \PYG{k}{as} \PYG{n+nn}{px}
\PYG{k+kn}{import} \PYG{n+nn}{plotly}\PYG{n+nn}{.}\PYG{n+nn}{offline} \PYG{k}{as} \PYG{n+nn}{py}
\PYG{k+kn}{import} \PYG{n+nn}{plotly}\PYG{n+nn}{.}\PYG{n+nn}{graph\PYGZus{}objects} \PYG{k}{as} \PYG{n+nn}{go}

\PYG{c+c1}{\PYGZsh{} check to make sure that data\PYGZus{}dir/rsl\PYGZus{}daily\PYGZus{}hawaii.nc exists, if not, make warning to run datawrangling notebook}
\PYG{k}{if} \PYG{o+ow}{not} \PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{exists}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}hawaii.nc not found in }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir}\PYG{p}{)} \PYG{o}{+}  \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{. Please run the data wrangling notebook first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{k}{else}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}hawaii.nc found in }\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir}\PYG{p}{)} \PYG{o}{+}  \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{. Proceed.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
rsl\PYGZus{}hawaii.nc found in ../../data. Proceed.
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Import data and Clean}
\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:import-data-and-clean}}
\sphinxAtStartPar
Take only locations with data coverage more than 80\% of the time, and set all sea level measurements relative to local MHHW, rather than station datum.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}import rsl\PYGZus{}daily}
\PYG{n}{rsl\PYGZus{}daily} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir}\PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{rsl\PYGZus{}daily} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1993}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2023}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{data\PYGZus{}coverage} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{count}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{/}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{time}\PYG{p}{)}

\PYG{n}{data\PYGZus{}coverage}
\PYG{c+c1}{\PYGZsh{}drop all locations with data\PYGZus{}coverage less than 80\PYGZpc{}}
\PYG{n}{rsl\PYGZus{}subset} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{data\PYGZus{}coverage}\PYG{o}{\PYGZgt{}}\PYG{l+m+mf}{0.80}\PYG{p}{,}\PYG{n}{drop}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} make sea level relative to MHHW, and convert to m}
\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{/}\PYG{l+m+mi}{1000}

\PYG{c+c1}{\PYGZsh{} rename variable long name to sea level relative to MHHW}
\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea level, MHHW}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m}\PYG{l+s+s1}{\PYGZsq{}}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Resample to monthly}
\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:resample-to-monthly}}
\sphinxAtStartPar
For background plotting purposes. Here we’ll extract the mean, min and max of the monthly MHHW sea level.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} get min and max for each month by resampling}
\PYG{n}{rsl\PYGZus{}monthly\PYGZus{}min} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{resample}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1ME}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{rsl\PYGZus{}monthly\PYGZus{}max} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{resample}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1ME}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{rsl\PYGZus{}monthly\PYGZus{}mean} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{resample}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1ME}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Define functions}
\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:define-functions}}
\sphinxAtStartPar
The first will get us the top 10 high and low hourly sea level values for a given station. To ensure that we are tracking unique high and low water events, we ensure that the hourly maxima and minima are separated by at least 3 days.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}top\PYGZus{}ten}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,} \PYG{n}{rid}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Convert data to a pandas Series}
    \PYG{n}{sea\PYGZus{}level\PYGZus{}series} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{sea\PYGZus{}level}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}series}\PYG{p}{(}\PYG{p}{)}


   \PYG{c+c1}{\PYGZsh{} Select top 100 values based on the mode}
    \PYG{k}{if} \PYG{n}{mode} \PYG{o}{==} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}
        \PYG{n}{top\PYGZus{}values} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}series}\PYG{o}{.}\PYG{n}{nlargest}\PYG{p}{(}\PYG{l+m+mi}{100}\PYG{p}{)}
    \PYG{k}{elif} \PYG{n}{mode} \PYG{o}{==} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{min}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}
        \PYG{n}{top\PYGZus{}values} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}series}\PYG{o}{.}\PYG{n}{nsmallest}\PYG{p}{(}\PYG{l+m+mi}{100}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{k}{raise} \PYG{n+ne}{ValueError}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mode must be either }\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{ or }\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{min}\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Filter to find unique events spaced by at least 3 days}
    \PYG{n}{filtered\PYGZus{}dates} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{Series}\PYG{p}{(}\PYG{p}{)}

    \PYG{k}{for} \PYG{n}{date}\PYG{p}{,} \PYG{n}{value} \PYG{o+ow}{in} \PYG{n}{top\PYGZus{}values}\PYG{o}{.}\PYG{n}{items}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{n+nb}{all}\PYG{p}{(}\PYG{n+nb}{abs}\PYG{p}{(}\PYG{p}{(}\PYG{n}{date} \PYG{o}{\PYGZhy{}} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{added\PYGZus{}date}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{days}\PYG{p}{)} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{3} \PYG{k}{for} \PYG{n}{added\PYGZus{}date} \PYG{o+ow}{in} \PYG{n}{filtered\PYGZus{}dates}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{filtered\PYGZus{}dates}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{date}\PYG{p}{)}
            \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{n}{date}\PYG{p}{]} \PYG{o}{=} \PYG{n}{value}
        \PYG{k}{if} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{filtered\PYGZus{}dates}\PYG{p}{)} \PYG{o}{==} \PYG{l+m+mi}{10}\PYG{p}{:}
            \PYG{k}{break}
    \PYG{n}{rank} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{)}

    \PYG{n}{station\PYGZus{}name} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
    \PYG{n}{record\PYGZus{}id} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}  

    \PYG{n}{top\PYGZus{}10\PYGZus{}values} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rank}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{rank}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea level (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{o}{.}\PYG{n}{values}\PYG{p}{\PYGZcb{}}\PYG{p}{)}  
    \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{station\PYGZus{}name}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{record\PYGZus{}id}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{mode}

    \PYG{c+c1}{\PYGZsh{}round the date to the nearest hour}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{dt}\PYG{o}{.}\PYG{n}{round}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{h}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{top\PYGZus{}10\PYGZus{}values}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\chapter{Make a Table}
\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:make-a-table}}
\sphinxAtStartPar
We’ll use the function we defined above to make a table of the top 10 ranked high and low water events. We’ll add the ONI values to this table, which will come in handy later.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}top\PYGZus{}10\PYGZus{}table}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,}\PYG{n}{rid}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} make a table of the top 10 values, sorted by size and with date}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values\PYGZus{}max} \PYG{o}{=} \PYG{n}{get\PYGZus{}top\PYGZus{}ten}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,} \PYG{n}{rid}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values\PYGZus{}min} \PYG{o}{=} \PYG{n}{get\PYGZus{}top\PYGZus{}ten}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,} \PYG{n}{rid}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{min}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{n}{top\PYGZus{}10\PYGZus{}table} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{concat}\PYG{p}{(}\PYG{p}{[}\PYG{n}{top\PYGZus{}10\PYGZus{}values\PYGZus{}max}\PYG{p}{,}\PYG{n}{top\PYGZus{}10\PYGZus{}values\PYGZus{}min}\PYG{p}{]}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} cross reference the dates with the oni data to see if they are during an El Nino or La Nina event}
    \PYG{n}{oni} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{read\PYGZus{}csv}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{oni.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{index\PYGZus{}col}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{parse\PYGZus{}dates}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} add a new column to oni\PYGZus{}min called mode, where mode is either \PYGZsq{}El Nino\PYGZsq{}, \PYGZsq{}La Nina\PYGZsq{}, or \PYGZsq{}Neutral\PYGZsq{}}
    \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI Mode}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Neutral}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{oni}\PYG{o}{.}\PYG{n}{loc}\PYG{p}{[}\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{La Nina}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{==}\PYG{k+kc}{True}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI Mode}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{La Nina}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{oni}\PYG{o}{.}\PYG{n}{loc}\PYG{p}{[}\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{El Nino}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{==}\PYG{k+kc}{True}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI Mode}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{El Nino}\PYG{l+s+s1}{\PYGZsq{}}

    \PYG{c+c1}{\PYGZsh{}drop the La Nina and El Nino columns}
    \PYG{n}{oni} \PYG{o}{=} \PYG{n}{oni}\PYG{o}{.}\PYG{n}{drop}\PYG{p}{(}\PYG{n}{columns}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{La Nina}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{El Nino}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{}Extract ONI values for the corresponding dates of top\PYGZus{}10\PYGZus{}table}
    \PYG{n}{oni\PYGZus{}val} \PYG{o}{=} \PYG{n}{oni}\PYG{o}{.}\PYG{n}{reindex}\PYG{p}{(}\PYG{n}{top\PYGZus{}10\PYGZus{}table}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{method}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nearest}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} add the oni values to the top\PYGZus{}10\PYGZus{}table}
    \PYG{n}{top\PYGZus{}10\PYGZus{}table} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{merge}\PYG{p}{(}\PYG{n}{top\PYGZus{}10\PYGZus{}table}\PYG{p}{,} \PYG{n}{oni\PYGZus{}val}\PYG{p}{,} \PYG{n}{left\PYGZus{}on}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{right\PYGZus{}index}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{top\PYGZus{}10\PYGZus{}table}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
As a quick example, we can check the top of the table (the “head”) for the 4th record\_id, which is Kahului, Maui.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rid}\PYG{o}{=}\PYG{l+m+mi}{2}
\PYG{n}{top\PYGZus{}10\PYGZus{}table} \PYG{o}{=} \PYG{n}{get\PYGZus{}top\PYGZus{}10\PYGZus{}table}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,}\PYG{n}{rid}\PYG{p}{)}
\PYG{n}{top\PYGZus{}10\PYGZus{}table}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
   rank                date  sea level (m)      station\PYGZus{}name record\PYGZus{}id type  \PYGZbs{}
0     1 2020\PYGZhy{}12\PYGZhy{}15 15:00:00          0.458  Honolulu, Hawaii       570  max   
1     2 2019\PYGZhy{}12\PYGZhy{}25 14:00:00          0.447  Honolulu, Hawaii       570  max   
2     3 2017\PYGZhy{}08\PYGZhy{}21 01:00:00          0.440  Honolulu, Hawaii       570  max   
3     4 2021\PYGZhy{}12\PYGZhy{}05 15:00:00          0.428  Honolulu, Hawaii       570  max   
4     5 2020\PYGZhy{}07\PYGZhy{}20 02:00:00          0.423  Honolulu, Hawaii       570  max   

    ONI ONI Mode  
0 \PYGZhy{}1.19  La Nina  
1  0.55  Neutral  
2 \PYGZhy{}0.11  Neutral  
3 \PYGZhy{}0.98  La Nina  
4 \PYGZhy{}0.41  Neutral  
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Display by rank}
\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:display-by-rank}}
\sphinxAtStartPar
Now we’ll start to make the table a little more presentable by labeling the columns properly, and organizing events by rank.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} subdivide the data into two columns for max and min}
\PYG{c+c1}{\PYGZsh{} Filter out the \PYGZsq{}max\PYGZsq{} and \PYGZsq{}min\PYGZsq{} types into separate DataFrames}
\PYG{n}{max\PYGZus{}top\PYGZus{}10} \PYG{o}{=} \PYG{n}{top\PYGZus{}10\PYGZus{}table}\PYG{p}{[}\PYG{n}{top\PYGZus{}10\PYGZus{}table}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{==} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{reset\PYGZus{}index}\PYG{p}{(}\PYG{n}{drop}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}
\PYG{n}{min\PYGZus{}top\PYGZus{}10} \PYG{o}{=} \PYG{n}{top\PYGZus{}10\PYGZus{}table}\PYG{p}{[}\PYG{n}{top\PYGZus{}10\PYGZus{}table}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{==} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{min}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{reset\PYGZus{}index}\PYG{p}{(}\PYG{n}{drop}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} make table of highest and lowest values by rank, with columns: rank, highest sea level (m), date, lowest sea level (m), date}
\PYG{n}{top\PYGZus{}10\PYGZus{}display} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Rank}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{max\PYGZus{}top\PYGZus{}10}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rank}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                             \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Highest}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{max\PYGZus{}top\PYGZus{}10}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea level (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                             \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Highest Date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{max\PYGZus{}top\PYGZus{}10}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{dt}\PYG{o}{.}\PYG{n}{strftime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{Y\PYGZhy{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{m\PYGZhy{}}\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{H:}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{M}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
                             \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Highest ONI Mode}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{max\PYGZus{}top\PYGZus{}10}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI Mode}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                             \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Lowest}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{min\PYGZus{}top\PYGZus{}10}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea level (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                             \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Lowest Date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{min\PYGZus{}top\PYGZus{}10}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{dt}\PYG{o}{.}\PYG{n}{strftime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{Y\PYGZhy{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{m\PYGZhy{}}\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{ }\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{H:}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{M}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
                             \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Lowest ONI Mode}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{min\PYGZus{}top\PYGZus{}10}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI Mode}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                             \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Zone}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{GMT}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                             \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{max\PYGZus{}top\PYGZus{}10}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,}
                             \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI min}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{n}{min\PYGZus{}top\PYGZus{}10}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{top\PYGZus{}10\PYGZus{}display}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
   Rank  Highest      Highest Date Highest ONI Mode  Lowest       Lowest Date  \PYGZbs{}
0     1    0.458  2020\PYGZhy{}12\PYGZhy{}15 15:00          La Nina  \PYGZhy{}0.831  2011\PYGZhy{}03\PYGZhy{}11 16:00   
1     2    0.447  2019\PYGZhy{}12\PYGZhy{}25 14:00          Neutral  \PYGZhy{}0.768  2011\PYGZhy{}03\PYGZhy{}18 20:00   
2     3    0.440  2017\PYGZhy{}08\PYGZhy{}21 01:00          Neutral  \PYGZhy{}0.765  1994\PYGZhy{}03\PYGZhy{}29 21:00   
3     4    0.428  2021\PYGZhy{}12\PYGZhy{}05 15:00          La Nina  \PYGZhy{}0.748  2010\PYGZhy{}02\PYGZhy{}28 20:00   
4     5    0.423  2020\PYGZhy{}07\PYGZhy{}20 02:00          Neutral  \PYGZhy{}0.745  2009\PYGZhy{}05\PYGZhy{}24 19:00   
5     6    0.415  2020\PYGZhy{}11\PYGZhy{}15 14:00          La Nina  \PYGZhy{}0.744  2002\PYGZhy{}02\PYGZhy{}26 07:00   
6     7    0.411  2020\PYGZhy{}10\PYGZhy{}19 16:00          La Nina  \PYGZhy{}0.743  2010\PYGZhy{}04\PYGZhy{}27 19:00   
7     8    0.410  2017\PYGZhy{}06\PYGZhy{}24 02:00          Neutral  \PYGZhy{}0.739  2011\PYGZhy{}12\PYGZhy{}25 07:00   
8     9    0.406  2020\PYGZhy{}07\PYGZhy{}05 02:00          Neutral  \PYGZhy{}0.739  2013\PYGZhy{}04\PYGZhy{}25 19:00   
9    10    0.401  2019\PYGZhy{}08\PYGZhy{}02 03:00          Neutral  \PYGZhy{}0.738  1998\PYGZhy{}07\PYGZhy{}06 17:00   

  Lowest ONI Mode Zone  ONI max  ONI min  
0         La Nina  GMT    \PYGZhy{}1.19    \PYGZhy{}0.93  
1         La Nina  GMT     0.55    \PYGZhy{}0.93  
2         Neutral  GMT    \PYGZhy{}0.11     0.17  
3         El Nino  GMT    \PYGZhy{}0.98     1.22  
4         Neutral  GMT    \PYGZhy{}0.41     0.01  
5         Neutral  GMT    \PYGZhy{}1.27     0.03  
6         Neutral  GMT    \PYGZhy{}1.17     0.35  
7         La Nina  GMT     0.31    \PYGZhy{}1.04  
8         Neutral  GMT    \PYGZhy{}0.41    \PYGZhy{}0.30  
9         La Nina  GMT     0.14    \PYGZhy{}0.78  
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Style the table}
\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:style-the-table}}\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:sl-rankings-results}}
\sphinxAtStartPar
Now we’ll add some style. The table will be colored by the ONI, if the event is classified as an El Nino or La Nina.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}pandas.io.formats.style.Styler at 0x151bd2f70\PYGZgt{}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\end{sphinxuseclass}

\chapter{Make Timeseries Plots}
\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:make-timeseries-plots}}\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:sl-rankings-timeseries}}
\sphinxAtStartPar
Now we’ll plot this data up in the time domain.


\section{Interactive Plots}
\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:interactive-plots}}
\sphinxAtStartPar
This version is interactive. Bad for making pdf reports though.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{make\PYGZus{}plotlyFigure}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}monthly\PYGZus{}mean}\PYG{p}{,} 
        \PYG{n}{rsl\PYGZus{}monthly\PYGZus{}max}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}monthly\PYGZus{}min}\PYG{p}{,} 
        \PYG{n}{top\PYGZus{}10\PYGZus{}table}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Static Plots}
\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:static-plots}}
\sphinxAtStartPar
Plotting them all so we can decide what to do with them. Click “show code cell output” to see all stations.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\begin{sphinxuseclass}{tag_hide-output}
\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{b827930c2a1f087092d409b27247bd84656d3504ee2990e12526b27172528ed7}.png}
\caption{This is a static version of the previous figure. I am using this static version because there is more control over the printed figure.}\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:sl-rankings}}\end{figure}


\chapter{Create a map}
\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:create-a-map}}\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:sl-rankings-map}}
\sphinxAtStartPar
Now we’ll make a map of this information, using max and min at each station. First we need to organize our data.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-input}
\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
Next, we’ll plot it up.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}
\begin{sphinxuseclass}{tag_hide-input}
\end{sphinxuseclass}
\end{sphinxuseclass}
\end{sphinxuseclass}
\begin{figure}[htbp]
\centering
\capstart

\noindent\sphinxincludegraphics{{cabdbab75cac7ec67da3415e4c6d22ddad712bf817f5be5b9026beeaa5d9552b}.png}
\caption{Lowest and highest observed sea levels, relative to MHHW.}\label{\detokenize{notebooks/regional_and_local/SL_Rankings_annual:id1}}\end{figure}

\sphinxstepscope


\part{Annual Extremes}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:annual-extremes}}\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual::doc}}
\begin{sphinxadmonition}{caution}{Caution:}
\sphinxAtStartPar
IN DEVELOPMENT everywhere.
\end{sphinxadmonition}


\chapter{Setup}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:setup}}
\sphinxAtStartPar
The usual deal.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{\PYGZpc{}}\PYG{k}{run} ../setup.ipynb
\PYG{o}{\PYGZpc{}}\PYG{k}{run} ../plotting\PYGZus{}functions.ipynb
\PYG{n}{data\PYGZus{}dir} \PYG{o}{=} \PYG{n}{Path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../../data}\PYG{l+s+s1}{\PYGZsq{}} \PYG{p}{)}
\PYG{n}{output\PYGZus{}dir} \PYG{o}{=} \PYG{n}{Path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../../output}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} 
\PYG{c+c1}{\PYGZsh{} import utide}
\PYG{k+kn}{from} \PYG{n+nn}{scipy}\PYG{n+nn}{.}\PYG{n+nn}{interpolate} \PYG{k+kn}{import} \PYG{n}{interp1d}


\PYG{c+c1}{\PYGZsh{} check to make sure that data\PYGZus{}dir/rsl\PYGZus{}daily\PYGZus{}hawaii.nc exists, if not, make warning to run datawrangling notebook}
\PYG{k}{if} \PYG{o+ow}{not} \PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{exists}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc not found in ../../data. Please run the data wrangling notebook first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{k}{else}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc found in ../../data. Proceed.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{} check to make sure that data\PYGZus{}dir/rsl\PYGZus{}hawaii.nc exists, if not, make warning to run datawrangling notebook}
\PYG{k}{if} \PYG{o+ow}{not} \PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{exists}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}hawaii.nc not found in ../../data. Please run the data wrangling notebook first}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{k}{else}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}hawaii.nc found in ../../data. Proceed.}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
rsl\PYGZus{}daily\PYGZus{}hawaii.nc found in ../../data. Proceed.
rsl\PYGZus{}hawaii.nc found in ../../data. Proceed.
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\chapter{Obtain Daily and Hourly datasets}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:obtain-daily-and-hourly-datasets}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}import rsl\PYGZus{}daily}
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}all} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir}\PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}make rsl\PYGZus{}daily a subset \PYGZhy{} do not include TGs with more than 25\PYGZpc{} NaNs}
\PYG{n}{data\PYGZus{}coverage} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily\PYGZus{}all}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{count}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{/}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}daily\PYGZus{}all}\PYG{o}{.}\PYG{n}{time}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}drop all locations with data\PYGZus{}coverage less than 80\PYGZpc{}}
\PYG{n}{rsl\PYGZus{}daily} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily\PYGZus{}all}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{data\PYGZus{}coverage}\PYG{o}{\PYGZgt{}}\PYG{l+m+mf}{0.80}\PYG{p}{,}\PYG{n}{drop}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{n}{rsl\PYGZus{}hourly} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir}\PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{rsl\PYGZus{}hourly}

\PYG{c+c1}{\PYGZsh{} \PYGZsh{} make rsl\PYGZus{}hourly have the same time period as rsl\PYGZus{}daily}
\PYG{c+c1}{\PYGZsh{} rsl\PYGZus{}hourly = rsl\PYGZus{}hourly.sel(time = slice(rsl\PYGZus{}daily.time[0], rsl\PYGZus{}daily.time[\PYGZhy{}1]))}

\PYG{c+c1}{\PYGZsh{}include only the TGs that are in rsl\PYGZus{}subset}
\PYG{n}{rsl\PYGZus{}hourly} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}hourly}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{record\PYGZus{}id}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} truncate time period to end at the end of 2022}
\PYG{n}{rsl\PYGZus{}daily} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time} \PYG{o}{=} \PYG{n+nb}{slice}\PYG{p}{(}\PYG{k+kc}{None}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2022\PYGZhy{}12\PYGZhy{}31}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{rsl\PYGZus{}hourly} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}hourly}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time} \PYG{o}{=} \PYG{n+nb}{slice}\PYG{p}{(}\PYG{k+kc}{None}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2022\PYGZhy{}12\PYGZhy{}31}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} check the last time in rsl\PYGZus{}daily and rsl\PYGZus{}hourly}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{time}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{o}{.}\PYG{n}{time}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
2022\PYGZhy{}12\PYGZhy{}31T00:00:00.000000000
2022\PYGZhy{}12\PYGZhy{}31T22:59:59.971200000
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\chapter{Pre\sphinxhyphen{}process the data}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:pre-process-the-data}}

\section{Remove outliers and obtain trend}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:remove-outliers-and-obtain-trend}}
\sphinxAtStartPar
Here we are using the FULL data set, not just from 1993\sphinxhyphen{}onward.

\sphinxAtStartPar
First we’ll nan out the tsunami time period, and then calculate the trend.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{from} \PYG{n+nn}{pyextremes} \PYG{k+kn}{import} \PYG{n}{get\PYGZus{}extremes}\PYG{p}{,} \PYG{n}{get\PYGZus{}return\PYGZus{}periods}\PYG{p}{,} \PYG{n}{plotting}\PYG{p}{,} \PYG{n}{EVA}

\PYG{n}{station\PYGZus{}id} \PYG{o}{=} \PYG{l+m+mi}{570}
\PYG{c+c1}{\PYGZsh{} cut data off at end of 2023}
\PYG{n}{rsl\PYGZus{}hourly} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}hourly}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{k+kc}{None}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2022\PYGZhy{}12\PYGZhy{}31}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mf}{0.001}\PYG{o}{*}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} replace sea level data with nan for tsunami event from 23\PYGZhy{}24 May 1960}
\PYG{n}{tsunamiTimeStart} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1960\PYGZhy{}05\PYGZhy{}23 00:00:00}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{tsunamiTimeEnd} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1960\PYGZhy{}05\PYGZhy{}25 00:00:00}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} nan out the data for the tsunami event}
\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{loc}\PYG{p}{[}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{n}{tsunamiTimeStart}\PYG{p}{,} \PYG{n}{tsunamiTimeEnd}\PYG{p}{)}\PYG{p}{)}\PYG{p}{]} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{nan}


\PYG{c+c1}{\PYGZsh{} get trend, trend\PYGZus{}rate, trend\PYGZus{}mag}
\PYG{n}{trend\PYGZus{}mag}\PYG{p}{,} \PYG{n}{trend\PYGZus{}line}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{n}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
Make a plot to make sure we’re looking at the right thing.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{trend\PYGZus{}line}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
[\PYGZlt{}matplotlib.lines.Line2D at 0x157d6cdc0\PYGZgt{}]
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{b1247326c7a93416da3be40f894a48b8441edcb7af43d2227d695c2f80fcf605}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Now we’ll turn this data into a timeseries and detrend it (remove the trend line calculated above). This now puts everything relative to mean sea level for the calculated time period. We’ll set it back to MHHW (epoch 1993\sphinxhyphen{}2001 values).

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Add in datums correctly for each gauge!!
\end{sphinxadmonition}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} turn sea\PYGZus{}level\PYGZus{}data into a series}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{Series}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{o}{\PYGZhy{}}\PYG{n}{trend\PYGZus{}line}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{index}\PYG{o}{=}\PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{Series}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{index}\PYG{o}{=}\PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}\PYG{p}{)}



\PYG{c+c1}{\PYGZsh{} are there any nan values in the sea\PYGZus{}level\PYGZus{}data}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}\PYG{o}{.}\PYG{n}{isnull}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} fill in the nan values with zeros for now}
\PYG{c+c1}{\PYGZsh{} sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended = sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended.fillna(0)}
\PYG{c+c1}{\PYGZsh{} sea\PYGZus{}level\PYGZus{}data = sea\PYGZus{}level\PYGZus{}data.fillna(0)}

\PYG{c+c1}{\PYGZsh{} drop the nan values}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}\PYG{o}{.}\PYG{n}{dropna}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}data}\PYG{o}{.}\PYG{n}{dropna}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} set everything relative to MHHW from MSL coordinates}
\PYG{c+c1}{\PYGZsh{} At Honolulu this offset is 1.412\PYGZhy{}1.722 = \PYGZhy{}0.31 m}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended} \PYG{o}{\PYGZhy{}} \PYG{l+m+mf}{0.31}

\PYG{c+c1}{\PYGZsh{} plot sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} This should be in MHHW datum, check to see if it makes sense.}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}Axes: \PYGZgt{}
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{827df717a5c008e44a5e084eafe88524c9d8aaa41a3a9e82ef5ca0879a6e3c93}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\chapter{Create the model, and extract the extreme values.}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:create-the-model-and-extract-the-extreme-values}}
\sphinxAtStartPar
Here, we are going to find extremes using the Block Maxima (BM) method. This will find all extreme values by selecting a block size (here we’ve chosen a year for the annual max, and 30 days for the monthly max).

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} label the data}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}\PYG{o}{.}\PYG{n}{name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea level [m MHHW, detrended]}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}\PYG{o}{.}\PYG{n}{index}\PYG{o}{.}\PYG{n}{name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time (GMT)}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{n}{min\PYGZus{}last\PYGZus{}block\PYGZus{}ratio} \PYG{o}{=} \PYG{l+m+mf}{0.9}
\PYG{n}{model} \PYG{o}{=} \PYG{n}{EVA}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}\PYG{p}{)}
\PYG{n}{model}\PYG{o}{.}\PYG{n}{get\PYGZus{}extremes}\PYG{p}{(}\PYG{n}{extremes\PYGZus{}type}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{high}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{method}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{BM}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{block\PYGZus{}size}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{365D}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{min\PYGZus{}last\PYGZus{}block}\PYG{o}{=}\PYG{n}{min\PYGZus{}last\PYGZus{}block\PYGZus{}ratio}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
Take a look at the extreme events, here calculated with BM method.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{plot\PYGZus{}extremes}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Annual Maxima}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
Text(0.5, 1.0, \PYGZsq{}Annual Maxima\PYGZsq{})
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{6398719abed26c752dd754a0623bf0c75b3e474bda6027cabfdd8a6c5b1338be}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\chapter{Fit the model}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:fit-the-model}}
\sphinxAtStartPar
We are going to take our extremes and fit them to a model. The pyextremes package will select the ‘best model’ for this using the Akaike Information Criterion (AIC), with the goal of losing the least amount of information in a given model. Using BM, we could have either a GEV or a Gumbel (specialized case of the GEV) distribution. While we could force it to either distribution, for this case we’ll the AIC play out.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{model}\PYG{o}{.}\PYG{n}{fit\PYGZus{}model}\PYG{p}{(}\PYG{p}{)}

\PYG{n+nb}{print}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{distribution}\PYG{o}{.}\PYG{n}{name}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
genextreme
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Here, we are using the GEV. Now, we’ll print out the shape, location, and scale parameters.

\begin{sphinxuseclass}{cell}
\begin{sphinxuseclass}{tag_hide-output}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{shape} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{distribution}\PYG{o}{.}\PYG{n}{mle\PYGZus{}parameters}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{c}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{scale} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{distribution}\PYG{o}{.}\PYG{n}{mle\PYGZus{}parameters}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{scale}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{loc} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{distribution}\PYG{o}{.}\PYG{n}{mle\PYGZus{}parameters}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{loc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{} Format with two decimal places}
\PYG{n}{shape\PYGZus{}str} \PYG{o}{=} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{shape}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{scale\PYGZus{}str} \PYG{o}{=} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{scale}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{loc\PYGZus{}str} \PYG{o}{=} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{loc}\PYG{l+s+si}{:}\PYG{l+s+s1}{.2f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{shape}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{shape\PYGZus{}str}\PYG{p}{,} \PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{scale}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{scale\PYGZus{}str}\PYG{p}{,} \PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{loc}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{loc\PYGZus{}str}\PYG{p}{,} \PYG{n}{display}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\end{sphinxuseclass}
\sphinxAtStartPar
Here, the shape parameter is positive (\(\xi\) = \DUrole{pasted-text}{0.23}), indicating a heavy\sphinxhyphen{}tailed (Fréchet) distribution of the extremes. The location parameter \(\mu\) tells us that the distribution is centered around \DUrole{pasted-text}{0.27}, and the scale parameter (\(\psi\)  = \DUrole{pasted-text}{0.06}\} shows that the extremes cluster pretty tightly with each other (little dispersion).


\section{Let’s get a closer look at the return level curve}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:let-s-get-a-closer-look-at-the-return-level-curve}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{fig}\PYG{p}{,}\PYG{n}{ax} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{plot\PYGZus{}return\PYGZus{}values}\PYG{p}{(}\PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.95}\PYG{p}{,} \PYG{n}{return\PYGZus{}period}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{l+m+mf}{1.3}\PYG{p}{,}\PYG{l+m+mi}{500}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{,}\PYG{n}{n\PYGZus{}samples}\PYG{o}{=}\PYG{l+m+mi}{1000}\PYG{p}{,} \PYG{n}{plotting\PYGZus{}position}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{weibull}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{l+m+mf}{0.1}\PYG{p}{,}\PYG{l+m+mf}{0.5}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{} add lines for the 2, 5, 10, 50, and 100 year return periods}
\PYG{n}{return\PYGZus{}periods} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{10}\PYG{p}{,}\PYG{l+m+mi}{50}\PYG{p}{,}\PYG{l+m+mi}{100}\PYG{p}{]}

\PYG{n}{colors} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{r}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{g}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{b}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{c}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{return\PYGZus{}period}\PYG{p}{,} \PYG{n}{color} \PYG{o+ow}{in} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{return\PYGZus{}periods}\PYG{p}{,} \PYG{n}{colors}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{axvline}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{n}{return\PYGZus{}period}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{n}{color}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{return\PYGZus{}period}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ year return period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{n}{return\PYGZus{}period}\PYG{p}{,} \PYG{l+m+mf}{0.12}\PYG{p}{,} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{return\PYGZus{}period}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ years}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{rotation}\PYG{o}{=}\PYG{l+m+mi}{90}\PYG{p}{,} 
            \PYG{n}{verticalalignment}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bottom}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{backgroundcolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{w}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{horizontalalignment}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
            \PYG{n}{fontsize}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{)}

\PYG{n}{fig}\PYG{o}{.}\PYG{n}{set\PYGZus{}size\PYGZus{}inches}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{9729975d00313e330df863ac3ae5de53e78d37f01a66c137170c3b2a3d594dbf}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Confidence intervals for the GEV model are shown in shaded blue. Note that the extreme annual maximum (0.45) does not fall neatly on this distribution, suggesting that perhaps we might need to switch to a non\sphinxhyphen{}stationary model to account for the influence of other variables that change with time.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} make new figure with axes 1\PYGZhy{}3}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,}\PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} make pdf of extremes}
\PYG{n}{pdf\PYGZus{}extremes} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{linspace}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{extremes}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{model}\PYG{o}{.}\PYG{n}{extremes}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{l+m+mi}{500}\PYG{p}{)}
\PYG{n}{pdf} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{model}\PYG{o}{.}\PYG{n}{pdf}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{extremes\PYGZus{}transformer}\PYG{o}{.}\PYG{n}{transform}\PYG{p}{(}\PYG{n}{pdf\PYGZus{}extremes}\PYG{p}{)}\PYG{p}{)}

\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{hist}\PYG{p}{(}
            \PYG{n}{model}\PYG{o}{.}\PYG{n}{extremes}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,}
            \PYG{n}{bins}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{histogram\PYGZus{}bin\PYGZus{}edges}\PYG{p}{(}\PYG{n}{a}\PYG{o}{=}\PYG{n}{model}\PYG{o}{.}\PYG{n}{extremes}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{bins}\PYG{o}{=}\PYG{l+m+mi}{20}\PYG{p}{)}\PYG{p}{,}
            \PYG{n}{density}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,}
            \PYG{n}{rwidth}\PYG{o}{=}\PYG{l+m+mf}{0.8}\PYG{p}{,}
            \PYG{n}{facecolor}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}5199FF}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{n}{edgecolor}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{None}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,}
            \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.25}\PYG{p}{,}
            \PYG{n}{zorder}\PYG{o}{=}\PYG{l+m+mi}{5}\PYG{p}{,}
        \PYG{p}{)}

\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{pdf\PYGZus{}extremes}\PYG{p}{,} \PYG{n}{pdf}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZsh{}F85C50}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{n}{ls}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZhy{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,} \PYG{n}{zorder}\PYG{o}{=}\PYG{l+m+mi}{15}\PYG{p}{)}

\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}
            \PYG{n}{model}\PYG{o}{.}\PYG{n}{extremes}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,}
            \PYG{n}{np}\PYG{o}{.}\PYG{n}{full}\PYG{p}{(}\PYG{n}{shape}\PYG{o}{=}\PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{model}\PYG{o}{.}\PYG{n}{extremes}\PYG{p}{)}\PYG{p}{,} \PYG{n}{fill\PYGZus{}value}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{,}
            \PYG{n}{marker}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{|}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{40}\PYG{p}{,}
            \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{k}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
            \PYG{n}{lw}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,}
            \PYG{n}{zorder}\PYG{o}{=}\PYG{l+m+mi}{15}\PYG{p}{,}
        \PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add parameters to the plot}
\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}
    \PYG{l+m+mf}{0.95}\PYG{p}{,}
    \PYG{l+m+mf}{0.95}\PYG{p}{,}
    \PYG{l+s+sa}{f}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZdl{}}\PYG{l+s+se}{\PYGZbs{}\PYGZbs{}}\PYG{l+s+s2}{xi\PYGZdl{}: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{shape\PYGZus{}str}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdl{}}\PYG{l+s+se}{\PYGZbs{}\PYGZbs{}}\PYG{l+s+s2}{psi\PYGZdl{}: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{scale\PYGZus{}str}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+se}{\PYGZbs{}n}\PYG{l+s+s2}{\PYGZdl{}}\PYG{l+s+se}{\PYGZbs{}\PYGZbs{}}\PYG{l+s+s2}{mu\PYGZdl{}: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{loc\PYGZus{}str}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{fontsize}\PYG{o}{=}\PYG{l+m+mi}{11}\PYG{p}{,}
    \PYG{n}{ha}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{right}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{va}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{top}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
    \PYG{n}{transform}\PYG{o}{=}\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{transAxes}  \PYG{c+c1}{\PYGZsh{} Updated to \PYGZsq{}axs.transAxes\PYGZsq{} assuming axs is a single axis object}
\PYG{p}{)}


\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Annual Maxima [m]}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{Probability density}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{)}

\PYG{n}{model}\PYG{o}{.}\PYG{n}{plot\PYGZus{}probability}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{PP}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}
\PYG{n}{model}\PYG{o}{.}\PYG{n}{plot\PYGZus{}probability}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{QQ}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Histogram of Annual Maxima}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Probability Plot: P\PYGZhy{}P}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{]}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Probability Plot: Q\PYGZhy{}Q}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{tight\PYGZus{}layout}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{6d9d5452e73f8c7b1c8588b6cea77509c9abf5c94b5e141fa1d26840d69347a2}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Get return periods of 2, 10, 50 and 100 years}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:get-return-periods-of-2-10-50-and-100-years}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Get summary of the model}
\PYG{n}{return\PYGZus{}periods}\PYG{o}{=}\PYG{p}{[}\PYG{l+m+mi}{2}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{50}\PYG{p}{,} \PYG{l+m+mi}{100}\PYG{p}{]}

\PYG{n}{summary} \PYG{o}{=} \PYG{n}{model}\PYG{o}{.}\PYG{n}{get\PYGZus{}summary}\PYG{p}{(}
    \PYG{n}{return\PYGZus{}period}\PYG{o}{=}\PYG{n}{return\PYGZus{}periods}\PYG{p}{,}
    \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.95}\PYG{p}{,} \PYG{n}{n\PYGZus{}samples}\PYG{o}{=}\PYG{l+m+mi}{1000}
\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}change name \PYGZdq{}return period\PYGZdq{} to \PYGZdq{}return period (yrs)\PYGZdq{}}
\PYG{n}{summary} \PYG{o}{=} \PYG{n}{summary}\PYG{o}{.}\PYG{n}{rename}\PYG{p}{(}\PYG{n}{columns}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{return period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{return period (yrs)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{return value}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lower ci}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Lower CI (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{upper ci}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Upper CI (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{n}{summary}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
               Water Level (m, MHHW)  Lower CI (m, MHHW)  Upper CI (m, MHHW)
return period                                                               
2.0                         0.286112            0.275237            0.340333
10.0                        0.367975            0.353122            0.449248
50.0                        0.415909            0.389049            0.459948
100.0                       0.431348            0.395952            0.460912
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Make an intergrated rankings + return periods table}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:make-an-intergrated-rankings-return-periods-table}}
\sphinxAtStartPar
First, make some functions to get the top 10 ranked recorded water levels. This is copied from the rankings notebook.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}top\PYGZus{}10\PYGZus{}table}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,}\PYG{n}{rid}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} make a table of the top 10 values, sorted by size and with date}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values\PYGZus{}max} \PYG{o}{=} \PYG{n}{get\PYGZus{}top\PYGZus{}ten}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,} \PYG{n}{rid}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values\PYGZus{}min} \PYG{o}{=} \PYG{n}{get\PYGZus{}top\PYGZus{}ten}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,} \PYG{n}{rid}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{min}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{n}{top\PYGZus{}10\PYGZus{}table} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{concat}\PYG{p}{(}\PYG{p}{[}\PYG{n}{top\PYGZus{}10\PYGZus{}values\PYGZus{}max}\PYG{p}{,}\PYG{n}{top\PYGZus{}10\PYGZus{}values\PYGZus{}min}\PYG{p}{]}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{top\PYGZus{}10\PYGZus{}table}

\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}top\PYGZus{}ten}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,} \PYG{n}{rid}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Convert data to a pandas Series}
    \PYG{n}{sea\PYGZus{}level\PYGZus{}series} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{o}{.}\PYG{n}{sea\PYGZus{}level}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}series}\PYG{p}{(}\PYG{p}{)}


   \PYG{c+c1}{\PYGZsh{} Select top 100 values based on the mode}
    \PYG{k}{if} \PYG{n}{mode} \PYG{o}{==} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}
        \PYG{n}{top\PYGZus{}values} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}series}\PYG{o}{.}\PYG{n}{nlargest}\PYG{p}{(}\PYG{l+m+mi}{100}\PYG{p}{)}
    \PYG{k}{elif} \PYG{n}{mode} \PYG{o}{==} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{min}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}
        \PYG{n}{top\PYGZus{}values} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}series}\PYG{o}{.}\PYG{n}{nsmallest}\PYG{p}{(}\PYG{l+m+mi}{100}\PYG{p}{)}
    \PYG{k}{else}\PYG{p}{:}
        \PYG{k}{raise} \PYG{n+ne}{ValueError}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mode must be either }\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{ or }\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{min}\PYG{l+s+s1}{\PYGZdq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Filter to find unique events spaced by at least 3 days}
    \PYG{n}{filtered\PYGZus{}dates} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{Series}\PYG{p}{(}\PYG{p}{)}

    \PYG{k}{for} \PYG{n}{date}\PYG{p}{,} \PYG{n}{value} \PYG{o+ow}{in} \PYG{n}{top\PYGZus{}values}\PYG{o}{.}\PYG{n}{items}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
        \PYG{k}{if} \PYG{n+nb}{all}\PYG{p}{(}\PYG{n+nb}{abs}\PYG{p}{(}\PYG{p}{(}\PYG{n}{date} \PYG{o}{\PYGZhy{}} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{added\PYGZus{}date}\PYG{p}{)}\PYG{p}{)}\PYG{o}{.}\PYG{n}{days}\PYG{p}{)} \PYG{o}{\PYGZgt{}} \PYG{l+m+mi}{3} \PYG{k}{for} \PYG{n}{added\PYGZus{}date} \PYG{o+ow}{in} \PYG{n}{filtered\PYGZus{}dates}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{filtered\PYGZus{}dates}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{date}\PYG{p}{)}
            \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{n}{date}\PYG{p}{]} \PYG{o}{=} \PYG{n}{value}
        \PYG{k}{if} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{filtered\PYGZus{}dates}\PYG{p}{)} \PYG{o}{==} \PYG{l+m+mi}{10}\PYG{p}{:}
            \PYG{k}{break}
    \PYG{n}{rank} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{arange}\PYG{p}{(}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{11}\PYG{p}{)}

    \PYG{n}{station\PYGZus{}name} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
    \PYG{n}{record\PYGZus{}id} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}  

    \PYG{n}{top\PYGZus{}10\PYGZus{}values} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DataFrame}\PYG{p}{(}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rank}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{rank}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea level (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{o}{.}\PYG{n}{values}\PYG{p}{\PYGZcb{}}\PYG{p}{)}  
    \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{station\PYGZus{}name}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{record\PYGZus{}id}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{mode}

    \PYG{c+c1}{\PYGZsh{}round the date to the nearest hour}
    \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{top\PYGZus{}10\PYGZus{}values}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{dt}\PYG{o}{.}\PYG{n}{round}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{h}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{k}{return} \PYG{n}{top\PYGZus{}10\PYGZus{}values}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{First make the rankings list}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:first-make-the-rankings-list}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rid} \PYG{o}{=} \PYG{l+m+mi}{2}
\PYG{n}{rsl\PYGZus{}subset} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}hourly}\PYG{o}{.}\PYG{n}{copy}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}subset}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{SL\PYGZus{}rankings10} \PYG{o}{=} \PYG{n}{get\PYGZus{}top\PYGZus{}10\PYGZus{}table}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}subset}\PYG{p}{,}\PYG{n}{rid}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} take only the max type}
\PYG{n}{SL\PYGZus{}rankings10} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings10}\PYG{p}{[}\PYG{n}{SL\PYGZus{}rankings10}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{type}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{==}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{max}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{SL\PYGZus{}rankings10}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
   rank                date  sea level (m)      station\PYGZus{}name record\PYGZus{}id type
0     1 2020\PYGZhy{}12\PYGZhy{}15 15:00:00          0.458  Honolulu, Hawaii       570  max
1     2 2019\PYGZhy{}12\PYGZhy{}25 14:00:00          0.447  Honolulu, Hawaii       570  max
2     3 2017\PYGZhy{}08\PYGZhy{}21 01:00:00          0.440  Honolulu, Hawaii       570  max
3     4 1968\PYGZhy{}12\PYGZhy{}19 14:00:00          0.436  Honolulu, Hawaii       570  max
4     5 2021\PYGZhy{}12\PYGZhy{}05 15:00:00          0.428  Honolulu, Hawaii       570  max
5     6 1992\PYGZhy{}09\PYGZhy{}12 02:00:00          0.424  Honolulu, Hawaii       570  max
6     7 2020\PYGZhy{}07\PYGZhy{}20 02:00:00          0.423  Honolulu, Hawaii       570  max
7     8 2020\PYGZhy{}11\PYGZhy{}15 14:00:00          0.415  Honolulu, Hawaii       570  max
8     9 2020\PYGZhy{}10\PYGZhy{}19 16:00:00          0.411  Honolulu, Hawaii       570  max
9    10 2017\PYGZhy{}06\PYGZhy{}24 02:00:00          0.410  Honolulu, Hawaii       570  max
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Now we’ll add in the return period table

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} mix this dataframe in with the SL\PYGZus{}rankings table:}
\PYG{n}{station\PYGZus{}name} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} extract only \PYGZsq{}Highest\PYGZsq{} and \PYGZsq{}Highest Date\PYGZsq{} columns}
\PYG{n}{SL\PYGZus{}rankings} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings10}\PYG{p}{[}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea level (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{}rename \PYGZsq{}Highest\PYGZsq{} to sea level (m, MHHW)}
\PYG{n}{SL\PYGZus{}rankings} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings}\PYG{o}{.}\PYG{n}{rename}\PYG{p}{(}\PYG{n}{columns}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea level (m)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Ensure \PYGZsq{}Water Level (m, MHHW)\PYGZsq{} column is numeric for both DataFrames}
\PYG{n}{SL\PYGZus{}rankings}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}numeric}\PYG{p}{(}\PYG{n}{SL\PYGZus{}rankings}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{errors}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{coerce}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{summary}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}numeric}\PYG{p}{(}\PYG{n}{summary}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{errors}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{coerce}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Merge the SL\PYGZus{}rankings DataFrame with the summary DataFrame on \PYGZsq{}water level (m, MHHW)\PYGZsq{}}
\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{merge}\PYG{p}{(}\PYG{n}{SL\PYGZus{}rankings}\PYG{p}{,} \PYG{n}{summary}\PYG{o}{.}\PYG{n}{reset\PYGZus{}index}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{on}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{how}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{outer}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{o}{.}\PYG{n}{sort\PYGZus{}values}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{ascending}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}

\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date or Return Period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{o}{.}\PYG{n}{apply}\PYG{p}{(}
    \PYG{k}{lambda} \PYG{n}{row}\PYG{p}{:} \PYG{n}{row}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{k}{if} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{notnull}\PYG{p}{(}\PYG{n}{row}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)} \PYG{k}{else} \PYG{n}{row}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{return period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{axis}\PYG{o}{=}\PYG{l+m+mi}{1}
\PYG{p}{)}

\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{o}{.}\PYG{n}{drop}\PYG{p}{(}\PYG{n}{columns}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{return period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Lower CI (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Upper CI (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Add a column for feet}
\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (ft, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{*}\PYG{l+m+mf}{3.28084}

\PYG{c+c1}{\PYGZsh{} Rearrange columns to Date or Return Period, water level (m, MHHW), water level (ft, MHHW)}
\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date or Return Period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (ft, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{]}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\section{Format the merged rankings and return period table}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:format-the-merged-rankings-and-return-period-table}}
\sphinxAtStartPar
Format this to match \sphinxhref{https://sealevel.nasa.gov/flooding-analysis-tool/observed-flooding?station-id=1612340\&amp;scenario=int-low\&amp;threshold=061\&amp;map=hide}{https://sealevel.nasa.gov/flooding\sphinxhyphen{}analysis\sphinxhyphen{}tool/observed\sphinxhyphen{}flooding?station\sphinxhyphen{}id=1612340\&scenario=int\sphinxhyphen{}low\&threshold=061\&map=hide}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Format the date to be in the format \PYGZsq{}YYYY\PYGZhy{}MM\PYGZhy{}DD\PYGZsq{} if a date, or \PYGZsq{}10\PYGZhy{}year flood\PYGZsq{} if a return period}
\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date or Return Period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date or Return Period}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{apply}\PYG{p}{(}
    \PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{x}\PYG{o}{.}\PYG{n}{strftime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{Y\PYGZhy{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{m\PYGZhy{}}\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{k}{if} \PYG{n+nb}{isinstance}\PYG{p}{(}\PYG{n}{x}\PYG{p}{,} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{Timestamp}\PYG{p}{)} \PYG{k}{else} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZhy{}year flood}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{if} \PYG{n+nb}{isinstance}\PYG{p}{(}\PYG{n}{x}\PYG{p}{,} \PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{,} \PYG{n+nb}{float}\PYG{p}{)}\PYG{p}{)} \PYG{k}{else} \PYG{n}{x}
\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Format the water level columns to have 2 decimal places}
\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{round}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (ft, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (ft, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{round}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} export the table to a csv file}
\PYG{n}{csvname} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{SL\PYGZus{}extremes\PYGZus{}}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{.csv}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{n}{output\PYGZus{}dir} \PYG{o}{/} \PYG{n}{csvname}\PYG{p}{,} \PYG{n}{index}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}


\PYG{n}{SL\PYGZus{}rankings\PYGZus{}merge}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
   Date or Return Period  Water Level (m, MHHW)  Water Level (ft, MHHW)
13            2020\PYGZhy{}12\PYGZhy{}15                   0.46                    1.50
12            2019\PYGZhy{}12\PYGZhy{}25                   0.45                    1.47
11            2017\PYGZhy{}08\PYGZhy{}21                   0.44                    1.44
10            1968\PYGZhy{}12\PYGZhy{}19                   0.44                    1.43
9         100\PYGZhy{}year flood                   0.43                    1.42
8             2021\PYGZhy{}12\PYGZhy{}05                   0.43                    1.40
7             1992\PYGZhy{}09\PYGZhy{}12                   0.42                    1.39
6             2020\PYGZhy{}07\PYGZhy{}20                   0.42                    1.39
5          50\PYGZhy{}year flood                   0.42                    1.36
4             2020\PYGZhy{}11\PYGZhy{}15                   0.42                    1.36
3             2020\PYGZhy{}10\PYGZhy{}19                   0.41                    1.35
2             2017\PYGZhy{}06\PYGZhy{}24                   0.41                    1.35
1          10\PYGZhy{}year flood                   0.37                    1.21
0           2\PYGZhy{}year flood                   0.29                    0.94
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Note I’m not really sure why the water level values don’t match Phil’s table. My guess is that we’re working off slightly different datums?


\chapter{Make a map}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:make-a-map}}

\section{Plot the Return Periods at each station}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:plot-the-return-periods-at-each-station}}
\sphinxAtStartPar
For now we only have the Honolulu tide gauge.

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
I will work on making this work for each station now.
\end{sphinxadmonition}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{crs} \PYG{o}{=} \PYG{n}{ccrs}\PYG{o}{.}\PYG{n}{PlateCarree}\PYG{p}{(}\PYG{p}{)}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{axs} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{l+m+mi}{2}\PYG{p}{,}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{8}\PYG{p}{)}\PYG{p}{,} \PYG{n}{subplot\PYGZus{}kw}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{projection}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{crs}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} make ax,fig}
\PYG{c+c1}{\PYGZsh{} open the cmems data}
\PYG{n}{cmems} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cmems\PYGZus{}L4\PYGZus{}SSH\PYGZus{}0.25deg\PYGZus{}1993\PYGZus{}2023.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{xlims} \PYG{o}{=} \PYG{p}{[}\PYG{n}{cmems}\PYG{o}{.}\PYG{n}{longitude}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmems}\PYG{o}{.}\PYG{n}{longitude}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}
\PYG{n}{ylims} \PYG{o}{=} \PYG{p}{[}\PYG{n}{cmems}\PYG{o}{.}\PYG{n}{latitude}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{cmems}\PYG{o}{.}\PYG{n}{latitude}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}


\PYG{c+c1}{\PYGZsh{} plt.colorbar(maxplt,ax=axs[0],label=\PYGZsq{}Sea Level (m)\PYGZsq{}, location=\PYGZsq{}bottom\PYGZsq{})           }

\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{ax} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{axs}\PYG{o}{.}\PYG{n}{flat}\PYG{p}{)}\PYG{p}{:}

    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{station\PYGZus{}id}\PYG{p}{)}\PYG{p}{,} \PYG{n}{transform}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{,} \PYG{n}{s}\PYG{o}{=}\PYG{l+m+mi}{100}\PYG{p}{,} 
               \PYG{n}{c}\PYG{o}{=}\PYG{n}{summary}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{loc}\PYG{p}{[}\PYG{n}{return\PYGZus{}periods}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{]}\PYG{p}{,} \PYG{n}{vmin}\PYG{o}{=}\PYG{l+m+mf}{0.4}\PYG{p}{,} \PYG{n}{vmax}\PYG{o}{=}\PYG{l+m+mf}{0.45}\PYG{p}{,} \PYG{n}{cmap}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{YlOrRd}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
               \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{n}{edgecolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{add\PYGZus{}feature}\PYG{p}{(}\PYG{n}{cfeature}\PYG{o}{.}\PYG{n}{COASTLINE}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{add\PYGZus{}feature}\PYG{p}{(}\PYG{n}{cfeature}\PYG{o}{.}\PYG{n}{LAND}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lightgrey}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} set extent}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}extent}\PYG{p}{(}\PYG{p}{[}\PYG{n}{xlims}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{xlims}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ylims}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ylims}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{,} \PYG{n}{crs}\PYG{o}{=}\PYG{n}{crs}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{}add grid}
    \PYG{n}{gl} \PYG{o}{=} \PYG{n}{ax}\PYG{o}{.}\PYG{n}{gridlines}\PYG{p}{(}\PYG{n}{draw\PYGZus{}labels}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{linestyle}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{:}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                      \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,}\PYG{n}{xlocs}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{get\PYGZus{}xticks}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,}\PYG{n}{ylocs}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{get\PYGZus{}yticks}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}
    \PYG{k}{if} \PYG{n}{i}\PYG{o}{\PYGZgt{}}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{:}
        \PYG{n}{gl}\PYG{o}{.}\PYG{n}{bottom\PYGZus{}labels} \PYG{o}{=} \PYG{k+kc}{True}

    \PYG{k}{if} \PYG{n}{i}\PYG{o}{==}\PYG{l+m+mi}{0}\PYG{p}{:}
        \PYG{n}{gl}\PYG{o}{.}\PYG{n}{left\PYGZus{}labels} \PYG{o}{=} \PYG{k+kc}{True}

    \PYG{c+c1}{\PYGZsh{}make all labels tiny}
    \PYG{n}{gl}\PYG{o}{.}\PYG{n}{xlabel\PYGZus{}style} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{size}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+m+mi}{8}\PYG{p}{\PYGZcb{}}
    \PYG{n}{gl}\PYG{o}{.}\PYG{n}{ylabel\PYGZus{}style} \PYG{o}{=} \PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{size}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+m+mi}{8}\PYG{p}{\PYGZcb{}}

    \PYG{c+c1}{\PYGZsh{} add text to top left of plot}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{text}\PYG{p}{(}\PYG{l+m+mf}{0.05}\PYG{p}{,} \PYG{l+m+mf}{0.95}\PYG{p}{,} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{return\PYGZus{}periods}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZhy{}year flood}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{fontsize}\PYG{o}{=}\PYG{l+m+mi}{8}\PYG{p}{,} \PYG{n}{weight}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{bold}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
            \PYG{n}{transform}\PYG{o}{=}\PYG{n}{ax}\PYG{o}{.}\PYG{n}{transAxes}\PYG{p}{,} \PYG{n}{ha}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{left}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{va}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{top}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{zorder}\PYG{o}{=}\PYG{l+m+mi}{10}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add colorbar to the bottom of the plot which follows vmin, vmax and cmap of the scatter plot}
\PYG{c+c1}{\PYGZsh{} colorbar should be }
\PYG{n}{cbar} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{colorbar}\PYG{p}{(}\PYG{n}{axs}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{l+m+mi}{0}\PYG{p}{]}\PYG{o}{.}\PYG{n}{collections}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{ax}\PYG{o}{=}\PYG{n}{axs}\PYG{p}{,} \PYG{n}{orientation}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{horizontal}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{pad}\PYG{o}{=}\PYG{l+m+mf}{0.05}\PYG{p}{,} \PYG{n}{aspect}\PYG{o}{=}\PYG{l+m+mi}{50}\PYG{p}{)}
\PYG{n}{cbar}\PYG{o}{.}\PYG{n}{set\PYGZus{}label}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Meters above MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{529fd770b41c7acb290acdd90fbde325b78c8dcb3ad0d69258b15d6a38c840bb}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\chapter{Plot a timeseries}
\label{\detokenize{notebooks/regional_and_local/SL_Extremes_annual:plot-a-timeseries}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} plot the monthly maxima}
\PYG{n}{monthly\PYGZus{}max} \PYG{o}{=} \PYG{n}{get\PYGZus{}extremes}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}\PYG{p}{,} \PYG{n}{method}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{BM}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} 
                           \PYG{n}{extremes\PYGZus{}type}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{high}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{block\PYGZus{}size}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{30D}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{min\PYGZus{}last\PYGZus{}block}\PYG{o}{=}\PYG{l+m+mf}{0.9}\PYG{p}{,} \PYG{n}{errors}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ignore}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{annual\PYGZus{}max} \PYG{o}{=} \PYG{n}{get\PYGZus{}extremes}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}data\PYGZus{}detrended}\PYG{p}{,} \PYG{n}{method}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{BM}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{extremes\PYGZus{}type}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{high}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{block\PYGZus{}size}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{365.245D}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{min\PYGZus{}last\PYGZus{}block}\PYG{o}{=}\PYG{l+m+mf}{0.9}\PYG{p}{)}


\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{12}\PYG{p}{,}\PYG{l+m+mi}{4}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{monthly\PYGZus{}max}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{n}{monthly\PYGZus{}max}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Monthly Maxima}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{scatter}\PYG{p}{(}\PYG{n}{annual\PYGZus{}max}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{n}{annual\PYGZus{}max}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Annual Maxima}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level [m, MHHW]}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Extreme Water Levels, detrended: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{station\PYGZus{}name}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add the 2, 10, 50, and 100 year return levels in horizontal lines}
\PYG{k}{for} \PYG{n}{i}\PYG{p}{,}\PYG{n}{period} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{return\PYGZus{}periods}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{axhline}\PYG{p}{(}\PYG{n}{summary}\PYG{o}{.}\PYG{n}{loc}\PYG{p}{[}\PYG{n}{period}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{period}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ yr RL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{n}{colors}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,}\PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} add bold black line at 0 for MHHW}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{axhline}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} put the legend at the bottom of the plot in one row}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{n}{loc}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{upper center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{bbox\PYGZus{}to\PYGZus{}anchor}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.2}\PYG{p}{)}\PYG{p}{,} \PYG{n}{ncol}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlim}\PYG{p}{(}\PYG{p}{[}\PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}hourly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
/opt/anaconda3/envs/SLI39/lib/python3.9/site\PYGZhy{}packages/pyextremes/extremes/block\PYGZus{}maxima.py:138: NoDataBlockWarning: 7 blocks contained no data
  warnings.warn(
\end{sphinxVerbatim}

\begin{sphinxVerbatim}[commandchars=\\\{\}]
(\PYGZhy{}23740.583333, 19357.958333)
\end{sphinxVerbatim}

\noindent\sphinxincludegraphics{{c8e6a499c2ac729f5f0631583138d8e5030dd6db983dfdc77212a1c16ff9b91c}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
One takeaway here: Removing the trend shows that we’ve had some significant events in the past (including the large pulse in the 1970s) that do not show up in our rankings.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k+kn}{import} \PYG{n+nn}{plotly}\PYG{n+nn}{.}\PYG{n+nn}{graph\PYGZus{}objects} \PYG{k}{as} \PYG{n+nn}{go}


\PYG{n}{fig} \PYG{o}{=} \PYG{n}{go}\PYG{o}{.}\PYG{n}{Figure}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Add monthly maxima as a line}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}trace}\PYG{p}{(}\PYG{n}{go}\PYG{o}{.}\PYG{n}{Scatter}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{n}{monthly\PYGZus{}max}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{n}{y}\PYG{o}{=}\PYG{n}{monthly\PYGZus{}max}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lines}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Monthly Maxima}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{line}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{width}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{)}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Add annual maxima as scatter points}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}trace}\PYG{p}{(}\PYG{n}{go}\PYG{o}{.}\PYG{n}{Scatter}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{n}{annual\PYGZus{}max}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{n}{y}\PYG{o}{=}\PYG{n}{annual\PYGZus{}max}\PYG{p}{,} \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{markers}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Annual Maxima}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}


\PYG{n}{colors} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}264653}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{} dark cyan}
          \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}2a9d8f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{} teal}
          \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}e9c46a}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{} sandy yellow}
          \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsh{}f4a261}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}  \PYG{c+c1}{\PYGZsh{} sandy orange}


\PYG{c+c1}{\PYGZsh{} Add return levels as labeled lines}
\PYG{k}{for} \PYG{n}{i}\PYG{p}{,} \PYG{n}{period} \PYG{o+ow}{in} \PYG{n+nb}{enumerate}\PYG{p}{(}\PYG{n}{return\PYGZus{}periods}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}trace}\PYG{p}{(}\PYG{n}{go}\PYG{o}{.}\PYG{n}{Scatter}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{p}{[}\PYG{n}{monthly\PYGZus{}max}\PYG{o}{.}\PYG{n}{index}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{monthly\PYGZus{}max}\PYG{o}{.}\PYG{n}{index}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}\PYG{p}{,}
                             \PYG{n}{y}\PYG{o}{=}\PYG{p}{[}\PYG{n}{summary}\PYG{o}{.}\PYG{n}{loc}\PYG{p}{[}\PYG{n}{period}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Water Level (m, MHHW)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{]} \PYG{o}{*} \PYG{l+m+mi}{2}\PYG{p}{,}
                             \PYG{n}{mode}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lines}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                             \PYG{n}{line}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{color}\PYG{o}{=}\PYG{n}{colors}\PYG{p}{[}\PYG{n}{i}\PYG{p}{]}\PYG{p}{,} \PYG{n}{width}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}\PYG{p}{,}
                             \PYG{n}{name}\PYG{o}{=}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{period}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ year RL}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
    
\PYG{c+c1}{\PYGZsh{} Add a bold black line at 0 for MHHW}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{add\PYGZus{}hline}\PYG{p}{(}\PYG{n}{y}\PYG{o}{=}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{line}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{width}\PYG{o}{=}\PYG{l+m+mi}{2}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set titles and labels}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{update\PYGZus{}layout}\PYG{p}{(}\PYG{n}{title}\PYG{o}{=}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Extreme Water Levels, Stationary GEV: }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{station\PYGZus{}name}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                  \PYG{n}{xaxis\PYGZus{}title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                  \PYG{n}{yaxis\PYGZus{}title}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level [m, MHHW, detrended]}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
                  \PYG{n}{legend}\PYG{o}{=}\PYG{n+nb}{dict}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{n}{xanchor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{center}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{y}\PYG{o}{=}\PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.2}\PYG{p}{,} \PYG{n}{orientation}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{h}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{bgcolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rgba(255,255,255,0.8)}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,}
                  \PYG{n}{plot\PYGZus{}bgcolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{white}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}  \PYG{c+c1}{\PYGZsh{} Set plot background to white}
                  \PYG{n}{paper\PYGZus{}bgcolor}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{white}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}  \PYG{c+c1}{\PYGZsh{} Set overall background to white}

\PYG{c+c1}{\PYGZsh{} Set x\PYGZhy{}axis limits if needed}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{update\PYGZus{}xaxes}\PYG{p}{(}\PYG{n+nb}{range}\PYG{o}{=}\PYG{p}{[}\PYG{n}{monthly\PYGZus{}max}\PYG{o}{.}\PYG{n}{index}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{monthly\PYGZus{}max}\PYG{o}{.}\PYG{n}{index}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Show the figure}
\PYG{n}{fig}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxstepscope


\part{Components of Sea Level}
\label{\detokenize{notebooks/regional_and_local/SL_Components_annual:components-of-sea-level}}\label{\detokenize{notebooks/regional_and_local/SL_Components_annual::doc}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Eventually stuff will go here}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
Hi, I am stuff.

\begin{sphinxthebibliography}{CLSFranc}
\bibitem[CLSFrance]{notebooks/regional_and_local/SL_Trend:id10}
\sphinxAtStartPar
CLS (France). Global Ocean Gridded L 4 Sea Surface Heights And Derived Variables Reprocessed 1993 Ongoing. URL: \sphinxurl{https://data.marine.copernicus.eu/product/SEALEVEL\_GLO\_PHY\_L4\_MY\_008\_047/description}, \sphinxhref{https://doi.org/10.48670/moi-00148}{doi:10.48670/moi\sphinxhyphen{}00148}.

\sphinxAtStartPar
CLS (France). Global Ocean Gridded L 4 Sea Surface Heights And Derived Variables Reprocessed 1993 Ongoing. URL: \sphinxurl{https://data.marine.copernicus.eu/product/SEALEVEL\_GLO\_PHY\_L4\_MY\_008\_047/description}, \sphinxhref{https://doi.org/10.48670/moi-00148}{doi:10.48670/moi\sphinxhyphen{}00148}.
\end{sphinxthebibliography}







\renewcommand{\indexname}{Index}
\printindex
\end{document}