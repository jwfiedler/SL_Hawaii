%% Generated by Sphinx.
\def\sphinxdocclass{jupyterBook}
\documentclass[letterpaper,10pt,english]{jupyterBook}
\ifdefined\pdfpxdimen
   \let\sphinxpxdimen\pdfpxdimen\else\newdimen\sphinxpxdimen
\fi \sphinxpxdimen=.75bp\relax
\ifdefined\pdfimageresolution
    \pdfimageresolution= \numexpr \dimexpr1in\relax/\sphinxpxdimen\relax
\fi
%% let collapsible pdf bookmarks panel have high depth per default
\PassOptionsToPackage{bookmarksdepth=5}{hyperref}
%% turn off hyperref patch of \index as sphinx.xdy xindy module takes care of
%% suitable \hyperpage mark-up, working around hyperref-xindy incompatibility
\PassOptionsToPackage{hyperindex=false}{hyperref}
%% memoir class requires extra handling
\makeatletter\@ifclassloaded{memoir}
{\ifdefined\memhyperindexfalse\memhyperindexfalse\fi}{}\makeatother


\PassOptionsToPackage{warn}{textcomp}

\catcode`^^^^00a0\active\protected\def^^^^00a0{\leavevmode\nobreak\ }
\usepackage{cmap}
\usepackage{fontspec}
\defaultfontfeatures[\rmfamily,\sffamily,\ttfamily]{}
\usepackage{amsmath,amssymb,amstext}
\usepackage{polyglossia}
\setmainlanguage{english}



\setmainfont{FreeSerif}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Italic,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldItalic
]
\setsansfont{FreeSans}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]
\setmonofont{FreeMono}[
  Extension      = .otf,
  UprightFont    = *,
  ItalicFont     = *Oblique,
  BoldFont       = *Bold,
  BoldItalicFont = *BoldOblique,
]



\usepackage[Bjarne]{fncychap}
\usepackage[,numfigreset=1,mathnumfig]{sphinx}

\fvset{fontsize=\small}
\usepackage{geometry}


% Include hyperref last.
\usepackage{hyperref}
% Fix anchor placement for figures with captions.
\usepackage{hypcap}% it must be loaded after hyperref.
% Set up styles of URL: it should be placed after hyperref.
\urlstyle{same}


\usepackage{sphinxmessages}



        % Start of preamble defined in sphinx-jupyterbook-latex %
         \usepackage[Latin,Greek]{ucharclasses}
        \usepackage{unicode-math}
        % fixing title of the toc
        \addto\captionsenglish{\renewcommand{\contentsname}{Contents}}
        \hypersetup{
            pdfencoding=auto,
            psdextra
        }
        % End of preamble defined in sphinx-jupyterbook-latex %
        

\title{Getting Started}
\date{Jun 03, 2024}
\release{}
\author{Playground Coordinator}
\newcommand{\sphinxlogo}{\vbox{}}
\renewcommand{\releasename}{}
\makeindex
\begin{document}

\pagestyle{empty}
\sphinxmaketitle
\pagestyle{plain}
\sphinxtableofcontents
\pagestyle{normal}
\phantomsection\label{\detokenize{gettingStarted::doc}}


\sphinxAtStartPar
These sections establish basic libaries that we’ll be using for data handling and plotting, as well as the initial data acquisition and reformatting for analysis.
\begin{itemize}
\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{notebooks/setup::doc}]{\sphinxcrossref{Setup}}}

\item {} 
\sphinxAtStartPar
{\hyperref[\detokenize{notebooks/SL_Data_Wrangling::doc}]{\sphinxcrossref{Data Wrangling}}}

\end{itemize}

\sphinxstepscope


\part{Setup}
\label{\detokenize{notebooks/setup:setup}}\label{\detokenize{notebooks/setup::doc}}
\sphinxAtStartPar
We first need to import the necessary libraries, access the data, and make a quick plot to ensure we will be analyzing the right thing.


\chapter{Import necessary libraries.}
\label{\detokenize{notebooks/setup:import-necessary-libraries}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Standard libraries}
\PYG{k+kn}{import} \PYG{n+nn}{os}\PYG{o}{,} \PYG{n+nn}{io}\PYG{o}{,} \PYG{n+nn}{glob}
\PYG{k+kn}{import} \PYG{n+nn}{datetime} \PYG{k}{as} \PYG{n+nn}{dt}
\PYG{k+kn}{from} \PYG{n+nn}{pathlib} \PYG{k+kn}{import} \PYG{n}{Path}

\PYG{c+c1}{\PYGZsh{} Data manipulation libraries}
\PYG{k+kn}{import} \PYG{n+nn}{numpy} \PYG{k}{as} \PYG{n+nn}{np}
\PYG{k+kn}{import} \PYG{n+nn}{pandas} \PYG{k}{as} \PYG{n+nn}{pd}
\PYG{k+kn}{import} \PYG{n+nn}{xarray} \PYG{k}{as} \PYG{n+nn}{xr}

\PYG{c+c1}{\PYGZsh{} Data retrieval libraries}
\PYG{k+kn}{from} \PYG{n+nn}{urllib}\PYG{n+nn}{.}\PYG{n+nn}{request} \PYG{k+kn}{import} \PYG{n}{urlretrieve}
\PYG{k+kn}{import} \PYG{n+nn}{requests}

\PYG{c+c1}{\PYGZsh{} Data analysis libraries}
\PYG{k+kn}{import} \PYG{n+nn}{scipy}\PYG{n+nn}{.}\PYG{n+nn}{stats} \PYG{k}{as} \PYG{n+nn}{stats}

\PYG{c+c1}{\PYGZsh{} HTML parsing library}
\PYG{k+kn}{from} \PYG{n+nn}{bs4} \PYG{k+kn}{import} \PYG{n}{BeautifulSoup}

\PYG{c+c1}{\PYGZsh{} Visualization libraries}
\PYG{k+kn}{import} \PYG{n+nn}{matplotlib}\PYG{n+nn}{.}\PYG{n+nn}{pyplot} \PYG{k}{as} \PYG{n+nn}{plt}
\PYG{k+kn}{import} \PYG{n+nn}{seaborn} \PYG{k}{as} \PYG{n+nn}{sns}
\PYG{k+kn}{import} \PYG{n+nn}{cartopy}\PYG{n+nn}{.}\PYG{n+nn}{crs} \PYG{k}{as} \PYG{n+nn}{ccrs}
\PYG{k+kn}{import} \PYG{n+nn}{cartopy}\PYG{n+nn}{.}\PYG{n+nn}{feature} \PYG{k}{as} \PYG{n+nn}{cfeature}

\PYG{c+c1}{\PYGZsh{} Miscellaneous}
\PYG{k+kn}{from} \PYG{n+nn}{myst\PYGZus{}nb} \PYG{k+kn}{import} \PYG{n}{glue}  \PYG{c+c1}{\PYGZsh{} used for figure numbering when exporting to LaTeX}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\chapter{Set up Plotting}
\label{\detokenize{notebooks/setup:set-up-plotting}}
\sphinxAtStartPar
Then we’ll establish some basic plotting rules for this notebook to keep everything looking uniform.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}\PYGZsh{} Set up Plotting}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{figure.figsize}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{p}{[}\PYG{l+m+mi}{10}\PYG{p}{,} \PYG{l+m+mi}{4}\PYG{p}{]}  \PYG{c+c1}{\PYGZsh{} Set a default figure size for the notebook}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{figure.dpi}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{100}  \PYG{c+c1}{\PYGZsh{} Set default resolution for inline figures}

\PYG{c+c1}{\PYGZsh{} Set the default font size for axes labels, titles and ticks}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{axes.titlesize}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{16}  \PYG{c+c1}{\PYGZsh{} Set the font size for axes titles}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{axes.labelsize}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{14}  \PYG{c+c1}{\PYGZsh{} Set the font size for x and y labels}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{xtick.labelsize}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{12} \PYG{c+c1}{\PYGZsh{} Set the font size for x\PYGZhy{}axis tick labels}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ytick.labelsize}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{12} \PYG{c+c1}{\PYGZsh{} Set the font size for y\PYGZhy{}axis tick labels}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{rcParams}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{font.size}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{14} \PYG{c+c1}{\PYGZsh{} Set the font size for the text in the figure (can affect legend)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\chapter{Define some functions}
\label{\detokenize{notebooks/setup:define-some-functions}}
\sphinxAtStartPar
These will come up across different notebooks.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{process\PYGZus{}trend\PYGZus{}with\PYGZus{}nan}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{p}{,}\PYG{n}{weighted}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Flatten the data and get a time index}
    \PYG{c+c1}{\PYGZsh{} first ensure time is the first dimension regardless of other dimensions}
    \PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{transpose}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{o}{.}\PYG{o}{.}\PYG{o}{.}\PYG{p}{)}
    \PYG{n}{sla\PYGZus{}flat} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{values}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{,} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{n}{time\PYGZus{}index} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{time}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}julian\PYGZus{}date}\PYG{p}{(}\PYG{p}{)}

    \PYG{n}{detrended\PYGZus{}flat} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{full\PYGZus{}like}\PYG{p}{(}\PYG{n}{sla\PYGZus{}flat}\PYG{p}{,} \PYG{n}{fill\PYGZus{}value}\PYG{o}{=}\PYG{n}{np}\PYG{o}{.}\PYG{n}{nan}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Loop over each grid point}
    \PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{n}{sla\PYGZus{}flat}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{)}\PYG{p}{:}
        \PYG{c+c1}{\PYGZsh{} Get the time series for this grid point}
        \PYG{n}{y} \PYG{o}{=} \PYG{n}{sla\PYGZus{}flat}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{n}{i}\PYG{p}{]}
        \PYG{n}{mask} \PYG{o}{=} \PYG{o}{\PYGZti{}}\PYG{n}{np}\PYG{o}{.}\PYG{n}{isnan}\PYG{p}{(}\PYG{n}{y}\PYG{p}{)}

        \PYG{k}{if} \PYG{n}{np}\PYG{o}{.}\PYG{n}{any}\PYG{p}{(}\PYG{n}{mask}\PYG{p}{)}\PYG{p}{:}
            \PYG{n}{time\PYGZus{}masked} \PYG{o}{=} \PYG{n}{time\PYGZus{}index}\PYG{p}{[}\PYG{n}{mask}\PYG{p}{]}
            \PYG{n}{y\PYGZus{}masked} \PYG{o}{=} \PYG{n}{y}\PYG{p}{[}\PYG{n}{mask}\PYG{p}{]}

            \PYG{n}{slope}\PYG{p}{,} \PYG{n}{intercept}\PYG{p}{,} \PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{n}{\PYGZus{}}\PYG{p}{,} \PYG{n}{\PYGZus{}} \PYG{o}{=} \PYG{n}{stats}\PYG{o}{.}\PYG{n}{linregress}\PYG{p}{(}\PYG{n}{time\PYGZus{}masked}\PYG{p}{,} \PYG{n}{y\PYGZus{}masked}\PYG{p}{)}
            \PYG{n}{trend} \PYG{o}{=} \PYG{n}{slope} \PYG{o}{*} \PYG{n}{time\PYGZus{}index} \PYG{o}{+} \PYG{n}{intercept}

            \PYG{n}{detrended\PYGZus{}flat}\PYG{p}{[}\PYG{p}{:}\PYG{p}{,}\PYG{n}{i}\PYG{p}{]} \PYG{o}{=} \PYG{n}{y} \PYG{o}{\PYGZhy{}} \PYG{n}{trend}

    \PYG{n}{detrended} \PYG{o}{=} \PYG{n}{detrended\PYGZus{}flat}\PYG{o}{.}\PYG{n}{reshape}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{shape}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{} Calculate trend magnitude}
    \PYG{n}{sea\PYGZus{}level\PYGZus{}trend} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly} \PYG{o}{\PYGZhy{}} \PYG{n}{detrended}
    \PYG{n}{trend\PYGZus{}mag} \PYG{o}{=} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}

    \PYG{n}{times} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
    \PYG{n}{time\PYGZus{}mag} \PYG{o}{=} \PYG{p}{(}\PYG{n}{times}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{\PYGZhy{}} \PYG{n}{times}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}\PYG{p}{)}\PYG{o}{.}\PYG{n}{days}\PYG{o}{/}\PYG{l+m+mf}{365.25} \PYG{c+c1}{\PYGZsh{} in years}

    \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{n}{trend\PYGZus{}mag} \PYG{o}{/} \PYG{n}{time\PYGZus{}mag}

    \PYG{k}{if} \PYG{n}{weighted}\PYG{o}{==}\PYG{k+kc}{True}\PYG{p}{:}
        \PYG{c+c1}{\PYGZsh{} Calculate the weights}
        \PYG{n}{weights} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{cos}\PYG{p}{(}\PYG{n}{np}\PYG{o}{.}\PYG{n}{deg2rad}\PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}anomaly}\PYG{o}{.}\PYG{n}{latitude}\PYG{p}{)}\PYG{p}{)}
        \PYG{n}{weights}\PYG{o}{.}\PYG{n}{name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{weights}\PYG{l+s+s1}{\PYGZsq{}}

        \PYG{c+c1}{\PYGZsh{} Calculate the weighted mean}
        \PYG{n}{trend\PYGZus{}mag} \PYG{o}{=} \PYG{p}{(}\PYG{n}{trend\PYGZus{}mag} \PYG{o}{*} \PYG{n}{weights}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{trend\PYGZus{}rate} \PYG{o}{=} \PYG{p}{(}\PYG{n}{trend\PYGZus{}rate} \PYG{o}{*} \PYG{n}{weights}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}
        \PYG{n}{sea\PYGZus{}level\PYGZus{}trend} \PYG{o}{=} \PYG{p}{(}\PYG{n}{sea\PYGZus{}level\PYGZus{}trend} \PYG{o}{*} \PYG{n}{weights}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}



    \PYG{k}{return} \PYG{n}{trend\PYGZus{}mag}\PYG{p}{,} \PYG{n}{sea\PYGZus{}level\PYGZus{}trend}\PYG{p}{,} \PYG{n}{trend\PYGZus{}rate}  
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxstepscope


\part{Data Wrangling}
\label{\detokenize{notebooks/SL_Data_Wrangling:data-wrangling}}\label{\detokenize{notebooks/SL_Data_Wrangling::doc}}
\sphinxAtStartPar
In this notebook we’ll obtain all of our data, arrange it how we want, and store it in the proper directories.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{o}{\PYGZpc{}}\PYG{k}{run} setup.ipynb
\PYG{n}{data\PYGZus{}dir} \PYG{o}{=} \PYG{n}{Path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../data}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{output\PYGZus{}dir} \PYG{o}{=} \PYG{n}{Path}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{../output}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\chapter{Retrieve Tide Gauge Data}
\label{\detokenize{notebooks/SL_Data_Wrangling:retrieve-tide-gauge-data}}
\sphinxAtStartPar
We are interested in getting tide gauge and alitmetry data for the Hawaiian Islands (and surrounds) for 1993 through 2022.
Let’s first establish where the tide gauges are by looking at the tide gauge dataset. We’ll retrieve tide gauge data from the UHSLC (University of Hawaii Sea Level Center) fast\sphinxhyphen{}delivery dataset \{cite:t\}``. The fast\sphinxhyphen{}delivery data are released within 1\sphinxhyphen{}2 months of data collection and are subject only to basic quality control.

\sphinxAtStartPar
We’ll be retrieving the hourly data for our station group at from UHSLC, and saving this to our data directory so we don’t have to download again.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} hawaii stations are: }
\PYG{n}{stationdict} \PYG{o}{=} \PYG{p}{\PYGZob{}}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Hilo}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{060}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Kawaihae}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{552}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Kahului}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{059}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Mokuoloe}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{061}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Honolulu}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{057}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Nawiliwili}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{058}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Johnston Island}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{052}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Midway Island}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{050}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Kaumalapau}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{548}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Barbers Point}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{547}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
    \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{French Frigate Shoals}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{014}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}
\PYG{p}{\PYGZcb{}}
\PYG{n}{stationdict}\PYG{o}{.}\PYG{n}{values}\PYG{p}{(}\PYG{p}{)}

\PYG{n}{station\PYGZus{}group} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Hawaiian Islands}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}group}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{station\PYGZus{}group}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZsq{}Hawaiian Islands\PYGZsq{}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxShadowBox}
\sphinxstylesidebartitle{}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
What about research quality data (RQD)?
RQD undergo thorough and time\sphinxhyphen{}consuming QC, and are usually released 1\sphinxhyphen{}2 years after data is received.
\end{sphinxadmonition}
\end{sphinxShadowBox}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{url} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{https://uhslc.soest.hawaii.edu/data/netcdf/fast/hourly/}\PYG{l+s+s2}{\PYGZdq{}} 
\PYG{n}{uhslc\PYGZus{}ids} \PYG{o}{=} \PYG{n+nb}{list}\PYG{p}{(}\PYG{n}{stationdict}\PYG{o}{.}\PYG{n}{values}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}

\PYG{k}{for} \PYG{n}{uhslc\PYGZus{}id} \PYG{o+ow}{in} \PYG{n}{uhslc\PYGZus{}ids}\PYG{p}{:}
    \PYG{n}{fname} \PYG{o}{=} \PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{h}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{uhslc\PYGZus{}id}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{.nc}\PYG{l+s+s1}{\PYGZsq{}} \PYG{c+c1}{\PYGZsh{} h for hourly, d for daily}

    \PYG{n}{path} \PYG{o}{=} \PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tide\PYGZus{}gauge\PYGZus{}nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{n}{fname}\PYG{p}{)}

    \PYG{k}{if} \PYG{o+ow}{not} \PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{exists}\PYG{p}{(}\PYG{n}{path}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{urlretrieve}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{url}\PYG{p}{,} \PYG{n}{fname}\PYG{p}{)}\PYG{p}{,} \PYG{n}{path}\PYG{p}{)} 
        \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Downloading }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{fname}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ from }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{url}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{ to }\PYG{l+s+si}{\PYGZob{}}\PYG{n}{path}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\sphinxAtStartPar
Now we merge all the datasets. This can take a while.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{data\PYGZus{}dir}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
PosixPath(\PYGZsq{}../data\PYGZsq{})
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Load the data}

\PYG{k+kn}{import} \PYG{n+nn}{glob}        
\PYG{c+c1}{\PYGZsh{} Get a list of all .nc files in the data directory}
\PYG{n}{files} \PYG{o}{=} \PYG{n}{glob}\PYG{o}{.}\PYG{n}{glob}\PYG{p}{(}\PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tide\PYGZus{}gauge\PYGZus{}nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{h*.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Open the datasets}
\PYG{n}{datasets} \PYG{o}{=} \PYG{p}{[}\PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{file}\PYG{p}{)} \PYG{k}{for} \PYG{n}{file} \PYG{o+ow}{in} \PYG{n}{files}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{}merge in batches of 2 to avoid memory issues}
\PYG{n}{batch\PYGZus{}size} \PYG{o}{=} \PYG{l+m+mi}{2}
\PYG{n}{merged\PYGZus{}datasets} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}

\PYG{k}{for} \PYG{n}{i} \PYG{o+ow}{in} \PYG{n+nb}{range}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n+nb}{len}\PYG{p}{(}\PYG{n}{datasets}\PYG{p}{)}\PYG{p}{,} \PYG{n}{batch\PYGZus{}size}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{batch} \PYG{o}{=} \PYG{n}{datasets}\PYG{p}{[}\PYG{n}{i}\PYG{p}{:}\PYG{n}{i}\PYG{o}{+}\PYG{n}{batch\PYGZus{}size}\PYG{p}{]}
    \PYG{n}{merged\PYGZus{}batch} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{merge}\PYG{p}{(}\PYG{n}{batch}\PYG{p}{)}
    \PYG{n}{merged\PYGZus{}datasets}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{merged\PYGZus{}batch}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}merge the merged datasets}
\PYG{n}{rsl} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{merge}\PYG{p}{(}\PYG{n}{merged\PYGZus{}datasets}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} convert byte strings to normal strings}
\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n+nb}{str}\PYG{p}{)}
\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}country}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}country}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n+nb}{str}\PYG{p}{)}
\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ssc\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ssc\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n+nb}{str}\PYG{p}{)}

\PYG{n}{rsl}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 54MB
Dimensions:               (time: 1043870, record\PYGZus{}id: 11)
Coordinates:
  * time                  (time) datetime64[ns] 8MB 1905\PYGZhy{}01\PYGZhy{}01T10:00:00.02880...
  * record\PYGZus{}id             (record\PYGZus{}id) int16 22B 140 500 520 ... 5470 5480 5520
Data variables:
    sea\PYGZus{}level             (record\PYGZus{}id, time) float32 46MB nan nan nan ... nan nan
    lat                   (record\PYGZus{}id) float32 44B 23.87 28.22 ... 20.78 20.03
    lon                   (record\PYGZus{}id) float32 44B 193.7 182.6 ... 203.0 204.2
    station\PYGZus{}name          (record\PYGZus{}id) \PYGZlt{}U17 748B \PYGZsq{}French Frigate\PYGZsq{} ... \PYGZsq{}Kawaihae\PYGZsq{}
    station\PYGZus{}country       (record\PYGZus{}id) \PYGZlt{}U30 1kB \PYGZsq{}United States of America (the...
    station\PYGZus{}country\PYGZus{}code  (record\PYGZus{}id) float32 44B 840.0 840.0 ... 840.0 840.0
    uhslc\PYGZus{}id              (record\PYGZus{}id) float32 44B 14.0 50.0 52.0 ... 548.0 552.0
    gloss\PYGZus{}id              (record\PYGZus{}id) float32 44B 107.0 106.0 109.0 ... nan nan
    ssc\PYGZus{}id                (record\PYGZus{}id) \PYGZlt{}U4 176B \PYGZsq{}fren\PYGZsq{} \PYGZsq{}midx\PYGZsq{} ... \PYGZsq{}kaum\PYGZsq{} \PYGZsq{}kawa\PYGZsq{}
    last\PYGZus{}rq\PYGZus{}date          (record\PYGZus{}id) datetime64[ns] 88B 2018\PYGZhy{}10\PYGZhy{}03T22:59:59....
Attributes:
    title:                  UHSLC Fast Delivery Tide Gauge Data (hourly)
    ncei\PYGZus{}template\PYGZus{}version:  NCEI\PYGZus{}NetCDF\PYGZus{}TimeSeries\PYGZus{}Orthogonal\PYGZus{}Template\PYGZus{}v2.0
    featureType:            timeSeries
    Conventions:            CF\PYGZhy{}1.6, ACDD\PYGZhy{}1.3
    date\PYGZus{}created:           2024\PYGZhy{}03\PYGZhy{}07T14:27:49Z
    publisher\PYGZus{}name:         University of Hawaii Sea Level Center (UHSLC)
    publisher\PYGZus{}email:        philiprt@hawaii.edu, markm@soest.hawaii.edu
    publisher\PYGZus{}url:          http://uhslc.soest.hawaii.edu
    summary:                The UHSLC assembles and distributes the Fast Deli...
    processing\PYGZus{}level:       Fast Delivery (FD) data undergo a level 1 quality...
    acknowledgment:         The UHSLC Fast Delivery database is supported by ...
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}MHHW\PYGZus{}uhslc\PYGZus{}datums}\PYG{p}{(}\PYG{n+nb}{id}\PYG{p}{,} \PYG{n}{datumname}\PYG{p}{)}\PYG{p}{:} 
    
    \PYG{n}{url} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{https://uhslc.soest.hawaii.edu/stations/TIDES\PYGZus{}DATUMS/fd/LST/fd}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n+nb}{id}\PYG{p}{)}\PYG{l+s+si}{:}\PYG{l+s+s1}{03}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{/datumTable\PYGZus{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n+nb}{int}\PYG{p}{(}\PYG{n+nb}{id}\PYG{p}{)}\PYG{l+s+si}{:}\PYG{l+s+s1}{03}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZus{}m.html}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{n}{response} \PYG{o}{=} \PYG{n}{requests}\PYG{o}{.}\PYG{n}{get}\PYG{p}{(}\PYG{n}{url}\PYG{p}{)}
    \PYG{n}{soup} \PYG{o}{=} \PYG{n}{BeautifulSoup}\PYG{p}{(}\PYG{n}{response}\PYG{o}{.}\PYG{n}{text}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{html.parser}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{table} \PYG{o}{=} \PYG{n}{soup}\PYG{o}{.}\PYG{n}{find}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{table}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{table} \PYG{o}{=} \PYG{n}{table}\PYG{o}{.}\PYG{n}{find\PYGZus{}all}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{tr}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{1}\PYG{p}{:}\PYG{p}{]} \PYG{c+c1}{\PYGZsh{} skip header row}
    \PYG{n}{table} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZlt{}table\PYGZgt{}}\PYG{l+s+s1}{\PYGZsq{}} \PYG{o}{+} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{o}{.}\PYG{n}{join}\PYG{p}{(}\PYG{p}{[}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{x}\PYG{p}{)} \PYG{k}{for} \PYG{n}{x} \PYG{o+ow}{in} \PYG{n}{table}\PYG{p}{]}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{} add back the table tag}
    \PYG{n}{table\PYGZus{}io} \PYG{o}{=} \PYG{n}{io}\PYG{o}{.}\PYG{n}{StringIO}\PYG{p}{(}\PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{table}\PYG{p}{)}\PYG{p}{)}
    \PYG{n}{datumtable} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{read\PYGZus{}html}\PYG{p}{(}\PYG{n}{table\PYGZus{}io}\PYG{p}{)}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
    \PYG{n}{datum} \PYG{o}{=} \PYG{n}{datumtable}\PYG{p}{[}\PYG{n}{datumtable}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Datum}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{==} \PYG{n}{datumname}\PYG{p}{]}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Value}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{]}
    \PYG{c+c1}{\PYGZsh{} ensure datum is a float}
    \PYG{n}{datum} \PYG{o}{=} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{datum}\PYG{p}{)}
    \PYG{k}{return} \PYG{n}{datum}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
Should make something to include all datums here as well.
\end{sphinxadmonition}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} add MHHW to the dataset}
\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{DataArray}\PYG{p}{(}\PYG{p}{[}\PYG{l+m+mi}{1000}\PYG{o}{*}\PYG{n}{get\PYGZus{}MHHW\PYGZus{}uhslc\PYGZus{}datums}\PYG{p}{(}\PYG{n+nb}{id}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)} \PYG{k}{for} \PYG{n+nb}{id} \PYG{o+ow}{in} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{uhslc\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{]}\PYG{p}{,} \PYG{n}{dims}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{coords}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{mm}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Mean Higher High Water, rel. to station datum}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{n}{glue}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{datumname}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZsq{}MHHW\PYGZsq{}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}save rsl to the data directory}
\PYG{n}{rsl}\PYG{o}{.}\PYG{n}{to\PYGZus{}netcdf}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\chapter{Retrieve altimetry data}
\label{\detokenize{notebooks/SL_Data_Wrangling:retrieve-altimetry-data}}
\sphinxAtStartPar
We are using the global ocean gridded L4 \sphinxhref{https://doi.org/10.48670/moi-00148}{Sea Surface Heights and Derived Variables} from Copernicus.

\sphinxAtStartPar
To download a subset of the global altimetry data, run get\_CMEMS\_data.py from this directory in a terminal with python >= 3.9 + copernicus\_marine\_client installed OR uncomment out the call to get\_CMEMS\_data and run it in this notebook. To read more about how to download the data from the Copernicus Marine Toolbox (new as of December 2023), visit \sphinxurl{https://help.marine.copernicus.eu/en/articles/7949409-copernicus-marine-toolbox-introduction}.

\begin{sphinxShadowBox}
\sphinxstylesidebartitle{}

\begin{sphinxadmonition}{note}{Note:}
\sphinxAtStartPar
You will need a username and password to access the CMEMS (Copernicus Marine Service) data if this is the first time running the client. To register for data access (free), visit \sphinxurl{https://data.marine.copernicus.eu/register}.
\end{sphinxadmonition}
\end{sphinxShadowBox}

\begin{sphinxadmonition}{note}{Large data download!}

\sphinxAtStartPar
Getting errors on the code block below? Remember to uncomment “get\_CMEMS\_data()” to download. Note that if you change nothing in the function, it will download \textasciitilde{}600 MB of data, which may take a long time!! You will only need to do this once. The dataset will be stored in the data directory you specify (which should be the same data directory we defined above).
\end{sphinxadmonition}

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} get the min and max lat and lon of rsl for altimetry data retrieval}
\PYG{n}{minlat} \PYG{o}{=} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{rsl}\PYG{o}{.}\PYG{n}{lat}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
\PYG{n}{maxlat} \PYG{o}{=} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{rsl}\PYG{o}{.}\PYG{n}{lat}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
\PYG{n}{minlon} \PYG{o}{=} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{rsl}\PYG{o}{.}\PYG{n}{lon}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
\PYG{n}{maxlon} \PYG{o}{=} \PYG{n+nb}{float}\PYG{p}{(}\PYG{n}{rsl}\PYG{o}{.}\PYG{n}{lon}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{k}{def} \PYG{n+nf}{get\PYGZus{}CMEMS\PYGZus{}data}\PYG{p}{(}\PYG{n}{minlat}\PYG{p}{,} \PYG{n}{maxlat}\PYG{p}{,} \PYG{n}{minlon}\PYG{p}{,} \PYG{n}{maxlon}\PYG{p}{,} \PYG{n}{data\PYGZus{}dir}\PYG{o}{=}\PYG{n}{data\PYGZus{}dir}\PYG{p}{)}\PYG{p}{:}
        
    \PYG{c+c1}{\PYGZsh{}maxlat = 15}
    \PYG{c+c1}{\PYGZsh{}minlat = 0}
    \PYG{c+c1}{\PYGZsh{}minlon = 125}
    \PYG{c+c1}{\PYGZsh{}maxlon = 140}
    \PYG{n}{maxlat} \PYG{o}{=} \PYG{n}{maxlat}\PYG{o}{+}\PYG{l+m+mi}{2}
    \PYG{n}{minlat} \PYG{o}{=} \PYG{n}{minlat}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{2}
    \PYG{n}{maxlon} \PYG{o}{=} \PYG{n}{maxlon}\PYG{o}{+}\PYG{l+m+mi}{2}
    \PYG{n}{minlon}  \PYG{o}{=} \PYG{n}{minlon}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{2}
    
    \PYG{n}{start\PYGZus{}date\PYGZus{}str} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{1993\PYGZhy{}01\PYGZhy{}01T00:00:00}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{end\PYGZus{}date\PYGZus{}str} \PYG{o}{=} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{2023\PYGZhy{}04\PYGZhy{}30T23:59:59}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{n}{data\PYGZus{}dir} \PYG{o}{=} \PYG{n}{data\PYGZus{}dir}
\PYG{+w}{    }
\PYG{+w}{    }\PYG{l+s+sd}{\PYGZdq{}\PYGZdq{}\PYGZdq{}}
\PYG{l+s+sd}{    Retrieves Copernicus Marine data for a specified region and time period.}
\PYG{l+s+sd}{    }
\PYG{l+s+sd}{    Args:}
\PYG{l+s+sd}{        minlon (float): Minimum longitude of the region.}
\PYG{l+s+sd}{        maxlon (float): Maximum longitude of the region.}
\PYG{l+s+sd}{        minlat (float): Minimum latitude of the region.}
\PYG{l+s+sd}{        maxlat (float): Maximum latitude of the region.}
\PYG{l+s+sd}{        start\PYGZus{}date\PYGZus{}str (str): Start date of the data in ISO 8601 format.}
\PYG{l+s+sd}{        end\PYGZus{}date\PYGZus{}str (str): End date of the data in ISO 8601 format.}
\PYG{l+s+sd}{        data\PYGZus{}dir (str): Directory to save the retrieved data.}
\PYG{l+s+sd}{    }
\PYG{l+s+sd}{    Returns:}
\PYG{l+s+sd}{        str: The filename of the retrieved data.}
\PYG{l+s+sd}{    \PYGZdq{}\PYGZdq{}\PYGZdq{}}
    \PYG{n}{copernicusmarine}\PYG{o}{.}\PYG{n}{subset}\PYG{p}{(}
        \PYG{n}{dataset\PYGZus{}id}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cmems\PYGZus{}obs\PYGZhy{}sl\PYGZus{}glo\PYGZus{}phy\PYGZhy{}ssh\PYGZus{}my\PYGZus{}allsat\PYGZhy{}l4\PYGZhy{}duacs\PYGZhy{}0.25deg\PYGZus{}P1D}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
        \PYG{n}{dataset\PYGZus{}version}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{202112}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{,}
        \PYG{n}{variables}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{sla}\PYG{l+s+s2}{\PYGZdq{}}\PYG{p}{]}\PYG{p}{,}
        \PYG{n}{minimum\PYGZus{}longitude}\PYG{o}{=}\PYG{n}{minlon}\PYG{p}{,}
        \PYG{n}{maximum\PYGZus{}longitude}\PYG{o}{=}\PYG{n}{maxlon}\PYG{p}{,}
        \PYG{n}{minimum\PYGZus{}latitude}\PYG{o}{=}\PYG{n}{minlat}\PYG{p}{,}
        \PYG{n}{maximum\PYGZus{}latitude}\PYG{o}{=}\PYG{n}{maxlat}\PYG{p}{,}
        \PYG{n}{start\PYGZus{}datetime}\PYG{o}{=}\PYG{n}{start\PYGZus{}date\PYGZus{}str}\PYG{p}{,}
        \PYG{n}{end\PYGZus{}datetime}\PYG{o}{=}\PYG{n}{end\PYGZus{}date\PYGZus{}str}\PYG{p}{,}
        \PYG{n}{output\PYGZus{}directory}\PYG{o}{=}\PYG{n}{data\PYGZus{}dir}\PYG{p}{,}
        \PYG{n}{output\PYGZus{}filename}\PYG{o}{=}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{cmems\PYGZus{}L4\PYGZus{}SSH\PYGZus{}0.25deg\PYGZus{}}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{start\PYGZus{}date\PYGZus{}str}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{]} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{\PYGZus{}}\PYG{l+s+s2}{\PYGZdq{}} \PYG{o}{+} \PYG{n}{end\PYGZus{}date\PYGZus{}str}\PYG{p}{[}\PYG{l+m+mi}{0}\PYG{p}{:}\PYG{l+m+mi}{4}\PYG{p}{]} \PYG{o}{+} \PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{.nc}\PYG{l+s+s2}{\PYGZdq{}}
    \PYG{p}{)}
\PYG{n}{fname\PYGZus{}cmems} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{cmems\PYGZus{}L4\PYGZus{}SSH\PYGZus{}0.25deg\PYGZus{}1993\PYGZus{}2023.nc}\PYG{l+s+s1}{\PYGZsq{}}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} check if the file exists, if not, download it}
\PYG{k}{if} \PYG{o+ow}{not} \PYG{n}{os}\PYG{o}{.}\PYG{n}{path}\PYG{o}{.}\PYG{n}{exists}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{n}{fname\PYGZus{}cmems}\PYG{p}{)}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{You will need to download the CMEMS data in a separate script}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
    \PYG{n}{get\PYGZus{}CMEMS\PYGZus{}data}\PYG{p}{(}\PYG{n}{minlat}\PYG{p}{,} \PYG{n}{maxlat}\PYG{p}{,} \PYG{n}{minlon}\PYG{p}{,} \PYG{n}{maxlon}\PYG{p}{,} \PYG{n}{data\PYGZus{}dir}\PYG{p}{)} \PYG{c+c1}{\PYGZsh{}\PYGZlt{}\PYGZlt{}\PYGZhy{}\PYGZhy{}\PYGZhy{} COMMENT OUT TO AVOID ACCIDENTAL DATA DOWNLOADS.}
\PYG{k}{else}\PYG{p}{:}
    \PYG{n+nb}{print}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CMEMS data already downloaded, good to go!}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
CMEMS data already downloaded, good to go!
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\sphinxAtStartPar
Open up the CMEMS data and take a look. We will want to make an ASL dataset similar in structure to the RSL data so that we can easily compare the two.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} open the CMEMS data}
\PYG{n}{ds} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{open\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{n}{fname\PYGZus{}cmems}\PYG{p}{)}

\PYG{n}{ds}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 577MB
Dimensions:    (time: 11077, latitude: 62, longitude: 105)
Coordinates:
  * latitude   (latitude) float32 248B 14.88 15.12 15.38 ... 29.62 29.88 30.12
  * longitude  (longitude) float32 420B \PYGZhy{}179.1 \PYGZhy{}178.9 \PYGZhy{}178.6 ... \PYGZhy{}153.4 \PYGZhy{}153.1
  * time       (time) datetime64[ns] 89kB 1993\PYGZhy{}01\PYGZhy{}01 1993\PYGZhy{}01\PYGZhy{}02 ... 2023\PYGZhy{}04\PYGZhy{}30
Data variables:
    sla        (time, latitude, longitude) float64 577MB ...
Attributes: (12/45)
    Conventions:                     CF\PYGZhy{}1.6
    Metadata\PYGZus{}Conventions:            Unidata Dataset Discovery v1.0
    cdm\PYGZus{}data\PYGZus{}type:                   Grid
    comment:                         Sea Surface Height measured by Altimetry...
    contact:                         servicedesk.cmems@mercator\PYGZhy{}ocean.eu
    creator\PYGZus{}email:                   servicedesk.cmems@mercator\PYGZhy{}ocean.eu
    ...                              ...
    time\PYGZus{}coverage\PYGZus{}duration:          P1D
    time\PYGZus{}coverage\PYGZus{}end:               1993\PYGZhy{}01\PYGZhy{}01T12:00:00Z
    time\PYGZus{}coverage\PYGZus{}resolution:        P1D
    time\PYGZus{}coverage\PYGZus{}start:             1992\PYGZhy{}12\PYGZhy{}31T12:00:00Z
    title:                           DT merged all satellites Global Ocean Gr...
    copernicusmarine\PYGZus{}version:        1.0.5
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Extract data for the nearest point to the tide gauge location that has data}
\PYG{n}{sla} \PYG{o}{=} \PYG{p}{[}\PYG{p}{]}
\PYG{k}{for} \PYG{n}{lat}\PYG{p}{,} \PYG{n}{lon} \PYG{o+ow}{in} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{,} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}\PYG{p}{:}
    \PYG{n}{sla}\PYG{o}{.}\PYG{n}{append}\PYG{p}{(}\PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}
        \PYG{n}{longitude}\PYG{o}{=}\PYG{n}{lon}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{360}\PYG{p}{,} \PYG{n}{latitude}\PYG{o}{=}\PYG{n}{lat}\PYG{p}{,} \PYG{n}{method}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{nearest}\PYG{l+s+s1}{\PYGZsq{}}
    \PYG{p}{)}\PYG{p}{)}

    \PYG{c+c1}{\PYGZsh{}if the data is null, nan average over the nearest 4 points}
    \PYG{n}{tol} \PYG{o}{=} \PYG{l+m+mf}{0.25}
    \PYG{k}{if} \PYG{n}{sla}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{o}{.}\PYG{n}{isnull}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{all}\PYG{p}{(}\PYG{p}{)}\PYG{p}{:}
        \PYG{n}{sla}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]} \PYG{o}{=} \PYG{n}{ds}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}
            \PYG{n}{longitude}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{n}{lon}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{360}\PYG{o}{\PYGZhy{}}\PYG{n}{tol}\PYG{p}{,} \PYG{n}{lon}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{360}\PYG{o}{+}\PYG{n}{tol}\PYG{p}{)}\PYG{p}{,} 
            \PYG{n}{latitude}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{n}{lat}\PYG{o}{\PYGZhy{}}\PYG{n}{tol}\PYG{p}{,} \PYG{n}{lat}\PYG{o}{+}\PYG{n}{tol}\PYG{p}{)}
        \PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}
        \PYG{n}{sla}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{lat}\PYG{p}{)}
        \PYG{n}{sla}\PYG{p}{[}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1}\PYG{p}{]}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{np}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{lon}\PYG{p}{)}

\PYG{n}{sla} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{concat}\PYG{p}{(}\PYG{n}{sla}\PYG{p}{,} \PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}




\PYG{c+c1}{\PYGZsh{} make sla a dataset with variables from rsl}
\PYG{n}{sla} \PYG{o}{=} \PYG{n}{sla}\PYG{o}{.}\PYG{n}{to\PYGZus{}dataset}\PYG{p}{(}\PYG{n}{name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sla}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{sla}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{} Creating lat\PYGZus{}str and lon\PYGZus{}str arrays with \PYGZsq{}record\PYGZus{}id\PYGZsq{} as their dimension}
\PYG{n}{lat\PYGZus{}str} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{np}\PYG{o}{.}\PYG{n}{abs}\PYG{p}{(}\PYG{n}{lat}\PYG{p}{)}\PYG{l+s+si}{:}\PYG{l+s+s1}{.3f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+se}{\PYGZbs{}u00B0}\PYG{l+s+si}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{N}\PYG{l+s+s2}{\PYGZdq{}}\PYG{+w}{ }\PYG{k}{if}\PYG{+w}{ }\PYG{n}{lat}\PYG{+w}{ }\PYG{o}{\PYGZgt{}}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{+w}{ }\PYG{k}{else}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{S}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{for} \PYG{n}{lat} \PYG{o+ow}{in} \PYG{n}{sla}\PYG{o}{.}\PYG{n}{latitude}\PYG{o}{.}\PYG{n}{values}\PYG{p}{]}
\PYG{n}{lon\PYGZus{}str} \PYG{o}{=} \PYG{p}{[}\PYG{l+s+sa}{f}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+si}{\PYGZob{}}\PYG{n}{np}\PYG{o}{.}\PYG{n}{abs}\PYG{p}{(}\PYG{n}{lon}\PYG{p}{)}\PYG{l+s+si}{:}\PYG{l+s+s1}{.3f}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+se}{\PYGZbs{}u00B0}\PYG{l+s+si}{\PYGZob{}}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{E}\PYG{l+s+s2}{\PYGZdq{}}\PYG{+w}{ }\PYG{k}{if}\PYG{+w}{ }\PYG{n}{lon}\PYG{+w}{ }\PYG{o}{\PYGZgt{}}\PYG{+w}{ }\PYG{l+m+mi}{0}\PYG{+w}{ }\PYG{k}{else}\PYG{+w}{ }\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+s2}{W}\PYG{l+s+s2}{\PYGZdq{}}\PYG{l+s+si}{\PYGZcb{}}\PYG{l+s+s1}{\PYGZsq{}} \PYG{k}{for} \PYG{n}{lon} \PYG{o+ow}{in} \PYG{n}{sla}\PYG{o}{.}\PYG{n}{longitude}\PYG{o}{.}\PYG{n}{values}\PYG{p}{]}  

\PYG{c+c1}{\PYGZsh{} Convert lists to DataArrays with \PYGZsq{}record\PYGZus{}id\PYGZsq{} as their dimension}
\PYG{n}{lat\PYGZus{}str\PYGZus{}da} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{DataArray}\PYG{p}{(}\PYG{n}{lat\PYGZus{}str}\PYG{p}{,} \PYG{n}{dims}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{coords}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{)}
\PYG{n}{lon\PYGZus{}str\PYGZus{}da} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{DataArray}\PYG{p}{(}\PYG{n}{lon\PYGZus{}str}\PYG{p}{,} \PYG{n}{dims}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{,} \PYG{n}{coords}\PYG{o}{=}\PYG{p}{\PYGZob{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{:} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{\PYGZcb{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Assign these DataArrays to the sla dataset}
\PYG{n}{sla}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat\PYGZus{}str}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{lat\PYGZus{}str\PYGZus{}da}
\PYG{n}{sla}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon\PYGZus{}str}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{lon\PYGZus{}str\PYGZus{}da}

\PYG{c+c1}{\PYGZsh{} add original data source to attributes}
\PYG{n}{sla}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{original\PYGZus{}data\PYGZus{}source}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{CMEMS L4 SSH 0.25deg}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{sla}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{title}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{ds}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{title}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{sla}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{source\PYGZus{}file}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n+nb}{str}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{n}{fname\PYGZus{}cmems}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} ensure latitude and longitude are coordinates associated with a location}
\PYG{n}{sla} \PYG{o}{=} \PYG{n}{sla}\PYG{o}{.}\PYG{n}{set\PYGZus{}coords}\PYG{p}{(}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{latitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{longitude}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}



\PYG{n}{sla}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 1MB
Dimensions:       (record\PYGZus{}id: 11, time: 11077)
Coordinates:
    latitude      (record\PYGZus{}id) float32 44B 23.88 28.12 16.88 ... 20.88 20.12
    longitude     (record\PYGZus{}id) float32 44B \PYGZhy{}166.4 \PYGZhy{}177.4 \PYGZhy{}169.6 ... \PYGZhy{}156.9 \PYGZhy{}155.9
  * time          (time) datetime64[ns] 89kB 1993\PYGZhy{}01\PYGZhy{}01 ... 2023\PYGZhy{}04\PYGZhy{}30
  * record\PYGZus{}id     (record\PYGZus{}id) int16 22B 140 500 520 570 ... 610 5470 5480 5520
Data variables:
    sla           (record\PYGZus{}id, time) float64 975kB \PYGZhy{}0.037 \PYGZhy{}0.0404 ... \PYGZhy{}0.0293
    station\PYGZus{}name  (record\PYGZus{}id) \PYGZlt{}U17 748B \PYGZsq{}French Frigate\PYGZsq{} \PYGZsq{}Midway\PYGZsq{} ... \PYGZsq{}Kawaihae\PYGZsq{}
    lat\PYGZus{}str       (record\PYGZus{}id) \PYGZlt{}U8 352B \PYGZsq{}23.875°N\PYGZsq{} \PYGZsq{}28.125°N\PYGZsq{} ... \PYGZsq{}20.125°N\PYGZsq{}
    lon\PYGZus{}str       (record\PYGZus{}id) \PYGZlt{}U9 396B \PYGZsq{}166.375°W\PYGZsq{} \PYGZsq{}177.375°W\PYGZsq{} ... \PYGZsq{}155.875°W\PYGZsq{}
Attributes:
    original\PYGZus{}data\PYGZus{}source:  CMEMS L4 SSH 0.25deg
    title:                 DT merged all satellites Global Ocean Gridded SSAL...
    source\PYGZus{}file:           ../data/cmems\PYGZus{}L4\PYGZus{}SSH\PYGZus{}0.25deg\PYGZus{}1993\PYGZus{}2023.nc
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{}save sla to the data directory}
\PYG{n}{sla}\PYG{o}{.}\PYG{n}{to\PYGZus{}netcdf}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{asl\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}

\chapter{Processing}
\label{\detokenize{notebooks/SL_Data_Wrangling:processing}}

\section{Process the tide gauge data to match CMEMS}
\label{\detokenize{notebooks/SL_Data_Wrangling:process-the-tide-gauge-data-to-match-cmems}}
\sphinxAtStartPar
Now we’ll convert tide gauge data into a daily record for the POR in units of meters to match the CMEMS data.

\sphinxAtStartPar
The next code block:
\begin{itemize}
\item {} 
\sphinxAtStartPar
extracts tide gauge data for the period 1993\sphinxhyphen{}2022

\item {} 
\sphinxAtStartPar
converts it to meters

\item {} 
\sphinxAtStartPar
removes any NaN values

\item {} 
\sphinxAtStartPar
resamples the data to daily mean

\item {} 
\sphinxAtStartPar
and normalizes it relative to the 1993\sphinxhyphen{}2012 epoch.

\end{itemize}

\sphinxAtStartPar
The resulting data is stored in the variable ‘rsl\_daily’ with units in meters.

\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Next, let\PYGZsq{}s establish a period of record from 1993\PYGZhy{}2022.}
\PYG{c+c1}{\PYGZsh{} establish the time period of interest}
\PYG{n}{start\PYGZus{}date} \PYG{o}{=} \PYG{n}{dt}\PYG{o}{.}\PYG{n}{datetime}\PYG{p}{(}\PYG{l+m+mi}{1993}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{,}\PYG{l+m+mi}{1}\PYG{p}{)}
\PYG{n}{end\PYGZus{}date} \PYG{o}{=} \PYG{n}{dt}\PYG{o}{.}\PYG{n}{datetime}\PYG{p}{(}\PYG{l+m+mi}{2022}\PYG{p}{,}\PYG{l+m+mi}{12}\PYG{p}{,}\PYG{l+m+mi}{31}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{}}
\PYG{c+c1}{\PYGZsh{} also save them as strings, for plotting}
\PYG{n}{start\PYGZus{}date\PYGZus{}str} \PYG{o}{=} \PYG{n}{start\PYGZus{}date}\PYG{o}{.}\PYG{n}{strftime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{Y\PYGZhy{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{m\PYGZhy{}}\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{end\PYGZus{}date\PYGZus{}str} \PYG{o}{=} \PYG{n}{end\PYGZus{}date}\PYG{o}{.}\PYG{n}{strftime}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{Y\PYGZhy{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{m\PYGZhy{}}\PYG{l+s+si}{\PYGZpc{}d}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Extract the data for the period of record (POR)}
\PYG{n}{tide\PYGZus{}gauge\PYGZus{}data\PYGZus{}POR} \PYG{o}{=} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{sea\PYGZus{}level}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{n}{start\PYGZus{}date}\PYG{p}{,} \PYG{n}{end\PYGZus{}date}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Convert to meters and drop any NaN values}
\PYG{n}{tide\PYGZus{}gauge\PYGZus{}data\PYGZus{}meters} \PYG{o}{=} \PYG{n}{tide\PYGZus{}gauge\PYGZus{}data\PYGZus{}POR} \PYG{o}{/} \PYG{l+m+mi}{1000}  \PYG{c+c1}{\PYGZsh{} Convert from mm to meters}
\PYG{c+c1}{\PYGZsh{} tide\PYGZus{}gauge\PYGZus{}data\PYGZus{}clean = tide\PYGZus{}gauge\PYGZus{}data\PYGZus{}meters.dropna(dim=\PYGZsq{}time\PYGZsq{})}

\PYG{c+c1}{\PYGZsh{} Resample the tide gauge data to daily mean before subtracting the epoch mean}
\PYG{n}{tide\PYGZus{}gauge\PYGZus{}daily\PYGZus{}avg} \PYG{o}{=} \PYG{n}{tide\PYGZus{}gauge\PYGZus{}data\PYGZus{}meters}\PYG{o}{.}\PYG{n}{resample}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1D}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{tide\PYGZus{}gauge\PYGZus{}daily\PYGZus{}avg}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.DataArray \PYGZsq{}sea\PYGZus{}level\PYGZsq{} (record\PYGZus{}id: 11, time: 10957)\PYGZgt{} Size: 482kB
array([[       nan,        nan,        nan, ..., 0.96316665, 0.91866666,
        0.835     ],
       [0.99616665, 1.0284166 , 1.0202917 , ..., 1.3059167 , 1.2347916 ,
        1.262     ],
       [0.8844583 , 0.88150007, 0.85529166, ..., 1.0427917 , 1.0572916 ,
        1.064     ],
       ...,
       [       nan,        nan,        nan, ..., 3.4656668 , 3.440625  ,
        3.35      ],
       [       nan,        nan,        nan, ...,        nan,        nan,
               nan],
       [       nan,        nan,        nan, ..., 1.0995833 , 1.0876666 ,
        0.96      ]], dtype=float32)
Coordinates:
  * record\PYGZus{}id  (record\PYGZus{}id) int16 22B 140 500 520 570 580 ... 610 5470 5480 5520
  * time       (time) datetime64[ns] 88kB 1993\PYGZhy{}01\PYGZhy{}01 1993\PYGZhy{}01\PYGZhy{}02 ... 2022\PYGZhy{}12\PYGZhy{}31
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\section{Normalize the tide gauge data relative to the 1993\sphinxhyphen{}2012 epoch}
\label{\detokenize{notebooks/SL_Data_Wrangling:normalize-the-tide-gauge-data-relative-to-the-1993-2012-epoch}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{epoch\PYGZus{}start}\PYG{p}{,} \PYG{n}{epoch\PYGZus{}end} \PYG{o}{=} \PYG{n}{start\PYGZus{}date}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2011\PYGZhy{}12\PYGZhy{}31}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{epoch\PYGZus{}daily\PYGZus{}avg} \PYG{o}{=} \PYG{n}{tide\PYGZus{}gauge\PYGZus{}daily\PYGZus{}avg}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{time}\PYG{o}{=}\PYG{n+nb}{slice}\PYG{p}{(}\PYG{n}{epoch\PYGZus{}start}\PYG{p}{,} \PYG{n}{epoch\PYGZus{}end}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{epoch\PYGZus{}daily\PYGZus{}mean} \PYG{o}{=} \PYG{n}{epoch\PYGZus{}daily\PYGZus{}avg}\PYG{o}{.}\PYG{n}{mean}\PYG{p}{(}\PYG{n}{dim}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{tide\PYGZus{}gauge\PYGZus{}data\PYGZus{}POR}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.DataArray \PYGZsq{}sea\PYGZus{}level\PYGZsq{} (record\PYGZus{}id: 11, time: 262945)\PYGZgt{} Size: 12MB
array([[  nan,   nan,   nan, ...,  964.,  904.,  835.],
       [ 925.,  866.,  825., ..., 1365., 1323., 1262.],
       [ 774.,  692.,  655., ..., 1204., 1141., 1064.],
       ...,
       [  nan,   nan,   nan, ..., 3524., 3437., 3350.],
       [  nan,   nan,   nan, ...,   nan,   nan,   nan],
       [  nan,   nan,   nan, ..., 1149., 1061.,  960.]], dtype=float32)
Coordinates:
  * time       (time) datetime64[ns] 2MB 1993\PYGZhy{}01\PYGZhy{}01 ... 2022\PYGZhy{}12\PYGZhy{}31
  * record\PYGZus{}id  (record\PYGZus{}id) int16 22B 140 500 520 570 580 ... 610 5470 5480 5520
Attributes:
    long\PYGZus{}name:  relative sea level
    units:      millimeters
    source:     in situ tide gauge water level observations
    platform:   station\PYGZus{}name, station\PYGZus{}country, station\PYGZus{}country\PYGZus{}code, uhslc\PYGZus{}id...
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Subtract the epoch daily mean from the tide gauge daily average}
\PYG{n}{rsl\PYGZus{}daily} \PYG{o}{=} \PYG{n}{tide\PYGZus{}gauge\PYGZus{}daily\PYGZus{}avg} \PYG{o}{\PYGZhy{}} \PYG{n}{epoch\PYGZus{}daily\PYGZus{}mean}

\PYG{c+c1}{\PYGZsh{} Set the attributes of the rsl\PYGZus{}daily data}
\PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{attrs} \PYG{o}{=} \PYG{n}{tide\PYGZus{}gauge\PYGZus{}data\PYGZus{}POR}\PYG{o}{.}\PYG{n}{attrs}
\PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} add lat and lon to the dataset}
\PYG{n}{rsl\PYGZus{}daily}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{rsl\PYGZus{}daily}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{} add the station name and country}
\PYG{n}{rsl\PYGZus{}daily}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}

\PYG{c+c1}{\PYGZsh{} change the variable name to sea level anomaly}
\PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}anomaly}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} change long name of the variable to sea level anomaly}
\PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Sea Level Anomaly}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{epoch}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1993\PYGZhy{}2001}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{n}{rsl\PYGZus{}daily}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.DataArray \PYGZsq{}rsl\PYGZus{}anomaly\PYGZsq{} (record\PYGZus{}id: 11, time: 10957)\PYGZgt{} Size: 482kB
array([[        nan,         nan,         nan, ...,  0.23562884,
         0.19112885,  0.10746217],
       [\PYGZhy{}0.05424732, \PYGZhy{}0.02199733, \PYGZhy{}0.03012228, ...,  0.2555027 ,
         0.18437767,  0.211586  ],
       [\PYGZhy{}0.01166356, \PYGZhy{}0.01462179, \PYGZhy{}0.04083019, ...,  0.14666986,
         0.16116977,  0.16787815],
       ...,
       [        nan,         nan,         nan, ..., \PYGZhy{}0.02208424,
        \PYGZhy{}0.04712605, \PYGZhy{}0.1377511 ],
       [        nan,         nan,         nan, ...,         nan,
                nan,         nan],
       [        nan,         nan,         nan, ...,  0.00287366,
        \PYGZhy{}0.00904298, \PYGZhy{}0.13670963]], dtype=float32)
Coordinates:
  * record\PYGZus{}id     (record\PYGZus{}id) int16 22B 140 500 520 570 ... 610 5470 5480 5520
  * time          (time) datetime64[ns] 88kB 1993\PYGZhy{}01\PYGZhy{}01 ... 2022\PYGZhy{}12\PYGZhy{}31
    lat           (record\PYGZus{}id) float32 44B 23.87 28.22 16.75 ... 20.78 20.03
    lon           (record\PYGZus{}id) float32 44B 193.7 182.6 190.5 ... 203.0 204.2
    station\PYGZus{}name  (record\PYGZus{}id) \PYGZlt{}U17 748B \PYGZsq{}French Frigate\PYGZsq{} \PYGZsq{}Midway\PYGZsq{} ... \PYGZsq{}Kawaihae\PYGZsq{}
Attributes:
    long\PYGZus{}name:  Sea Level Anomaly
    units:      m
    source:     in situ tide gauge water level observations
    platform:   station\PYGZus{}name, station\PYGZus{}country, station\PYGZus{}country\PYGZus{}code, uhslc\PYGZus{}id...
    epoch:      1993\PYGZhy{}2001
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{g} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{x}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{col}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{record\PYGZus{}id}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{col\PYGZus{}wrap}\PYG{o}{=}\PYG{l+m+mi}{3}\PYG{p}{,} \PYG{n}{sharey}\PYG{o}{=}\PYG{k+kc}{False}\PYG{p}{,} \PYG{n}{sharex}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{,} \PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,} \PYG{l+m+mi}{10}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Use g.axs to iterate over the axes in the FacetGrid}
\PYG{k}{for} \PYG{n}{ax}\PYG{p}{,} \PYG{n}{rid} \PYG{o+ow}{in} \PYG{n+nb}{zip}\PYG{p}{(}\PYG{n}{g}\PYG{o}{.}\PYG{n}{axs}\PYG{o}{.}\PYG{n}{flat}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{record\PYGZus{}id}\PYG{p}{)}\PYG{p}{:}
    \PYG{c+c1}{\PYGZsh{} Accessing the station\PYGZus{}name coordinate for the current record\PYGZus{}id directly}
    \PYG{n}{station\PYGZus{}name} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily}\PYG{o}{.}\PYG{n}{station\PYGZus{}name}\PYG{o}{.}\PYG{n}{sel}\PYG{p}{(}\PYG{n}{record\PYGZus{}id}\PYG{o}{=}\PYG{n}{rid}\PYG{p}{)}\PYG{o}{.}\PYG{n}{item}\PYG{p}{(}\PYG{p}{)}
    \PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{n}{station\PYGZus{}name}\PYG{p}{)}

\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{9b0792f11cfc41e484e606ecc1b4f56865c3b1b12a54e44018628cb3b4c2d531}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Set tide gauge daily average relative to MHHW}
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}mhhw} \PYG{o}{=} \PYG{n}{tide\PYGZus{}gauge\PYGZus{}daily\PYGZus{}avg} \PYG{o}{\PYGZhy{}} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{MHHW}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{/}\PYG{l+m+mi}{1000}

\PYG{c+c1}{\PYGZsh{} Set the attributes of the rsl\PYGZus{}daily data}
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}mhhw}\PYG{o}{.}\PYG{n}{attrs} \PYG{o}{=} \PYG{n}{tide\PYGZus{}gauge\PYGZus{}data\PYGZus{}POR}\PYG{o}{.}\PYG{n}{attrs}
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}mhhw}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{long\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{water level above MHHW}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}mhhw}\PYG{o}{.}\PYG{n}{attrs}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{units}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{m}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{c+c1}{\PYGZsh{} add lat and lon to the dataset}
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}mhhw}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lat}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}mhhw}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{lon}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{c+c1}{\PYGZsh{} add the station name and country}
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}mhhw}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{station\PYGZus{}name}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}

\PYG{n}{rsl\PYGZus{}daily\PYGZus{}mhhw}\PYG{o}{.}\PYG{n}{name} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}mhhw}\PYG{l+s+s1}{\PYGZsq{}}
\PYG{c+c1}{\PYGZsh{} save rsl\PYGZus{}daily to the data directory}
\PYG{c+c1}{\PYGZsh{} rsl\PYGZus{}daily\PYGZus{}mhhw.to\PYGZus{}netcdf(data\PYGZus{}dir / \PYGZsq{}rsl\PYGZus{}daily\PYGZus{}hawaii\PYGZus{}mhhw.nc\PYGZsq{})}


\PYG{c+c1}{\PYGZsh{}combine the two datasets}
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{merge}\PYG{p}{(}\PYG{p}{[}\PYG{n}{rsl\PYGZus{}daily}\PYG{p}{,} \PYG{n}{rsl\PYGZus{}daily\PYGZus{}mhhw}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{DataArray}\PYG{p}{(}
    \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}series}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{apply}\PYG{p}{(}
        \PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{x} \PYG{k}{if} \PYG{n}{x}\PYG{o}{.}\PYG{n}{month} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{5} \PYG{k}{else} \PYG{n}{x} \PYG{o}{\PYGZhy{}} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DateOffset}\PYG{p}{(}\PYG{n}{years}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{p}{)}\PYG{p}{,}
    \PYG{n}{dims}\PYG{o}{=}\PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{dims}\PYG{p}{,}
    \PYG{n}{coords}\PYG{o}{=}\PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{coords}
\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}make storm time a coordinate}
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{o}{.}\PYG{n}{assign\PYGZus{}coords}\PYG{p}{(}\PYG{n}{storm\PYGZus{}time} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{o}{.}\PYG{n}{storm\PYGZus{}time}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save rsl\PYGZus{}daily\PYGZus{}combined to the data directory}
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{o}{.}\PYG{n}{to\PYGZus{}netcdf}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{xr}\PYG{o}{.}\PYG{n}{DataArray}\PYG{p}{(}
    \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{values}\PYG{p}{)}\PYG{o}{.}\PYG{n}{to\PYGZus{}series}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{apply}\PYG{p}{(}
        \PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{n}{x} \PYG{k}{if} \PYG{n}{x}\PYG{o}{.}\PYG{n}{month} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mi}{5} \PYG{k}{else} \PYG{n}{x} \PYG{o}{\PYGZhy{}} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{DateOffset}\PYG{p}{(}\PYG{n}{years}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{)}
    \PYG{p}{)}\PYG{p}{,}
    \PYG{n}{dims}\PYG{o}{=}\PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{dims}\PYG{p}{,}
    \PYG{n}{coords}\PYG{o}{=}\PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{storm\PYGZus{}time}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{coords}
\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}make storm time a coordinate}
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{o}{.}\PYG{n}{assign\PYGZus{}coords}\PYG{p}{(}\PYG{n}{storm\PYGZus{}time} \PYG{o}{=} \PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{o}{.}\PYG{n}{storm\PYGZus{}time}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} save rsl\PYGZus{}daily\PYGZus{}combined to the data directory}
\PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}\PYG{o}{.}\PYG{n}{to\PYGZus{}netcdf}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{rsl\PYGZus{}daily\PYGZus{}hawaii.nc}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{n}{rsl\PYGZus{}daily\PYGZus{}combined}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYGZlt{}xarray.Dataset\PYGZgt{} Size: 2MB
Dimensions:       (record\PYGZus{}id: 11, time: 10957)
Coordinates:
  * record\PYGZus{}id     (record\PYGZus{}id) int16 22B 140 500 520 570 ... 610 5470 5480 5520
  * time          (time) datetime64[ns] 88kB 1993\PYGZhy{}01\PYGZhy{}01 ... 2022\PYGZhy{}12\PYGZhy{}31
    lat           (record\PYGZus{}id) float32 44B 23.87 28.22 16.75 ... 20.78 20.03
    lon           (record\PYGZus{}id) float32 44B 193.7 182.6 190.5 ... 203.0 204.2
    station\PYGZus{}name  (record\PYGZus{}id) \PYGZlt{}U17 748B \PYGZsq{}French Frigate\PYGZsq{} \PYGZsq{}Midway\PYGZsq{} ... \PYGZsq{}Kawaihae\PYGZsq{}
    storm\PYGZus{}time    (time) datetime64[ns] 88kB 1992\PYGZhy{}01\PYGZhy{}01 ... 2022\PYGZhy{}12\PYGZhy{}31
Data variables:
    rsl\PYGZus{}anomaly   (record\PYGZus{}id, time) float32 482kB nan nan ... \PYGZhy{}0.009043 \PYGZhy{}0.1367
    rsl\PYGZus{}mhhw      (record\PYGZus{}id, time) float64 964kB nan nan nan ... \PYGZhy{}0.3183 \PYGZhy{}0.446
Attributes:
    long\PYGZus{}name:  Sea Level Anomaly
    units:      m
    source:     in situ tide gauge water level observations
    platform:   station\PYGZus{}name, station\PYGZus{}country, station\PYGZus{}country\PYGZus{}code, uhslc\PYGZus{}id...
    epoch:      1993\PYGZhy{}2001
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}

\chapter{Retrieve Climate Indices}
\label{\detokenize{notebooks/SL_Data_Wrangling:retrieve-climate-indices}}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} Download ENSO/ Oceanic Niño Index (ONI)}

\PYG{n}{url} \PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{https://psl.noaa.gov/data/correlation/oni.data}\PYG{l+s+s1}{\PYGZsq{}}

\PYG{c+c1}{\PYGZsh{} parse the data into a timeseries}
\PYG{n}{oni} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{read\PYGZus{}csv}\PYG{p}{(}\PYG{n}{url}\PYG{p}{,} \PYG{n}{sep}\PYG{o}{=} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZbs{}}\PYG{l+s+s1}{s+}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{skiprows}\PYG{o}{=}\PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{header}\PYG{o}{=}\PYG{k+kc}{None}\PYG{p}{,} \PYG{n}{names}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{3}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{4}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{5}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{6}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{7}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{8}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{9}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{10}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{11}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{12}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} take only first 74 rows}
\PYG{n}{oni} \PYG{o}{=} \PYG{n}{oni}\PYG{o}{.}\PYG{n}{head}\PYG{p}{(}\PYG{l+m+mi}{74}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Convert the \PYGZsq{}Year\PYGZsq{} column to integer type}
\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} melt the dataframe to long format}
\PYG{n}{oni} \PYG{o}{=} \PYG{n}{oni}\PYG{o}{.}\PYG{n}{melt}\PYG{p}{(}\PYG{n}{id\PYGZus{}vars}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{var\PYGZus{}name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Month}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{value\PYGZus{}name}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Create a datetime column from the \PYGZsq{}Year\PYGZsq{} and \PYGZsq{}Month\PYGZsq{} columns, where month is the middle of the month}
\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Month}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Month}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n+nb}{int}\PYG{p}{)}
\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Day}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{l+m+mi}{15}
\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{to\PYGZus{}datetime}\PYG{p}{(}\PYG{n}{oni}\PYG{p}{[}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Month}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Day}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Set the \PYGZsq{}Date\PYGZsq{} column as the index}
\PYG{n}{oni} \PYG{o}{=} \PYG{n}{oni}\PYG{o}{.}\PYG{n}{set\PYGZus{}index}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Date}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Drop the \PYGZsq{}Year\PYGZsq{}, \PYGZsq{}Month\PYGZsq{}, and \PYGZsq{}Day\PYGZsq{} columns}
\PYG{n}{oni} \PYG{o}{=} \PYG{n}{oni}\PYG{o}{.}\PYG{n}{drop}\PYG{p}{(}\PYG{n}{columns}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Month}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Day}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} make sure ONI is a float}
\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n+nb}{float}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{} sort the index by date}
\PYG{n}{oni} \PYG{o}{=} \PYG{n}{oni}\PYG{o}{.}\PYG{n}{sort\PYGZus{}index}\PYG{p}{(}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} First classify the ONI values as El Niño, La Niña, or Neutral}
\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI\PYGZus{}event}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{apply}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{l+m+mi}{1} \PYG{k}{if} \PYG{n}{x} \PYG{o}{\PYGZgt{}}\PYG{o}{=} \PYG{l+m+mf}{0.5} \PYG{k}{else} \PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{1} \PYG{k}{if} \PYG{n}{x} \PYG{o}{\PYGZlt{}}\PYG{o}{=} \PYG{o}{\PYGZhy{}}\PYG{l+m+mf}{0.5} \PYG{k}{else} \PYG{l+m+mi}{0}\PYG{p}{)}\PYG{p}{)}


\PYG{c+c1}{\PYGZsh{}for all ONI\PYGZus{}events, sum the ONI\PYGZus{}event for the next 5 months. If the sum is 5, it is an El Niño event, if it is \PYGZhy{}5, it is a La Niña event}
\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI\PYGZus{}event\PYGZus{}duration\PYGZus{}start}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI\PYGZus{}event}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{rolling}\PYG{p}{(}\PYG{l+m+mi}{5}\PYG{p}{)}\PYG{o}{.}\PYG{n}{sum}\PYG{p}{(}\PYG{p}{)}\PYG{o}{.}\PYG{n}{shift}\PYG{p}{(}\PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{4}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Note this method will leave NaNs at the end of the series, but that\PYGZsq{}s okay, because we are only interested in the start of the event}
 
\PYG{c+c1}{\PYGZsh{} find the start of the event, defined as the first month with \PYGZhy{}5 in ONI\PYGZus{}event\PYGZus{}duration\PYGZus{}start}
\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{La Nina}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI\PYGZus{}event\PYGZus{}duration\PYGZus{}start}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{apply}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{l+m+mi}{1} \PYG{k}{if} \PYG{n}{x} \PYG{o}{==} \PYG{o}{\PYGZhy{}}\PYG{l+m+mi}{5} \PYG{k}{else} \PYG{l+m+mi}{0}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} get positive zero crossings}
\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{La Nina}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{La Nina}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{La Nina}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{==} \PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{ffill}\PYG{p}{(}\PYG{n}{limit}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}do the same for El Nino}
\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{El Nino}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI\PYGZus{}event\PYGZus{}duration\PYGZus{}start}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{apply}\PYG{p}{(}\PYG{k}{lambda} \PYG{n}{x}\PYG{p}{:} \PYG{l+m+mi}{1} \PYG{k}{if} \PYG{n}{x} \PYG{o}{==} \PYG{l+m+mi}{5} \PYG{k}{else} \PYG{l+m+mi}{0}\PYG{p}{)}
\PYG{c+c1}{\PYGZsh{} get positive zero crossings}
\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{El Nino}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{El Nino}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{where}\PYG{p}{(}\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{El Nino}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{==} \PYG{l+m+mi}{1}\PYG{p}{)}\PYG{o}{.}\PYG{n}{ffill}\PYG{p}{(}\PYG{n}{limit}\PYG{o}{=}\PYG{l+m+mi}{4}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}change the NaNs to 0 and turn Nino and Nina into boolean}
\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{El Nino}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{El Nino}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{fillna}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n+nb}{bool}\PYG{p}{)}
\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{La Nina}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{=} \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{La Nina}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{fillna}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{)}\PYG{o}{.}\PYG{n}{astype}\PYG{p}{(}\PYG{n+nb}{bool}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{}remove the intermediate columns}
\PYG{n}{oni} \PYG{o}{=} \PYG{n}{oni}\PYG{o}{.}\PYG{n}{drop}\PYG{p}{(}\PYG{n}{columns}\PYG{o}{=}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI\PYGZus{}event}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI\PYGZus{}event\PYGZus{}duration\PYGZus{}start}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{p}{)}

\PYG{n}{oni}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
             ONI  La Nina  El Nino
Date                              
1950\PYGZhy{}01\PYGZhy{}15 \PYGZhy{}1.53    False    False
1950\PYGZhy{}02\PYGZhy{}15 \PYGZhy{}0.68    False    False
1950\PYGZhy{}03\PYGZhy{}15 \PYGZhy{}0.43    False    False
1950\PYGZhy{}04\PYGZhy{}15 \PYGZhy{}0.15    False    False
1950\PYGZhy{}05\PYGZhy{}15  0.16    False    False
...          ...      ...      ...
2023\PYGZhy{}08\PYGZhy{}15  1.32    False     True
2023\PYGZhy{}09\PYGZhy{}15  1.56    False     True
2023\PYGZhy{}10\PYGZhy{}15  1.78    False     True
2023\PYGZhy{}11\PYGZhy{}15  1.92    False     True
2023\PYGZhy{}12\PYGZhy{}15  1.95    False     True

[888 rows x 3 columns]
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} plot it to see if we got it right}
\PYG{n}{fig}\PYG{p}{,} \PYG{n}{ax} \PYG{o}{=} \PYG{n}{plt}\PYG{o}{.}\PYG{n}{subplots}\PYG{p}{(}\PYG{n}{figsize}\PYG{o}{=}\PYG{p}{(}\PYG{l+m+mi}{15}\PYG{p}{,} \PYG{l+m+mi}{5}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Plotting the ONI timeseries}
\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{plot}\PYG{p}{(}\PYG{n}{ax}\PYG{o}{=}\PYG{n}{ax}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{black}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{legend}\PYG{o}{=}\PYG{k+kc}{True}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Shading El Niño events}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{fill\PYGZus{}between}\PYG{p}{(}\PYG{n}{oni}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} 
                \PYG{n}{where}\PYG{o}{=}\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{El Nino}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{==} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{red}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.3}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{El Niño}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Shading La Niña events}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{fill\PYGZus{}between}\PYG{p}{(}\PYG{n}{oni}\PYG{o}{.}\PYG{n}{index}\PYG{p}{,} \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} 
                \PYG{n}{where}\PYG{o}{=}\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{La Nina}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]} \PYG{o}{==} \PYG{l+m+mi}{1}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{blue}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{alpha}\PYG{o}{=}\PYG{l+m+mf}{0.3}\PYG{p}{,} \PYG{n}{label}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{La Niña}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Adding labels and title}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Year}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylabel}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}title}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{Oceanic Niño Index (ONI) and El Niño/La Niña Events}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Formatting the date axis to only show the year}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{xaxis}\PYG{o}{.}\PYG{n}{set\PYGZus{}major\PYGZus{}formatter}\PYG{p}{(}\PYG{n}{plt}\PYG{o}{.}\PYG{n}{matplotlib}\PYG{o}{.}\PYG{n}{dates}\PYG{o}{.}\PYG{n}{DateFormatter}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZpc{}}\PYG{l+s+s1}{Y}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Adding horizontal line at ONI = 0 for reference}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{axhline}\PYG{p}{(}\PYG{l+m+mi}{0}\PYG{p}{,} \PYG{n}{color}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{grey}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{,} \PYG{n}{linewidth}\PYG{o}{=}\PYG{l+m+mf}{0.5}\PYG{p}{,} \PYG{n}{linestyle}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{\PYGZhy{}\PYGZhy{}}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Adding a legend}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{legend}\PYG{p}{(}\PYG{n}{loc}\PYG{o}{=}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{upper left}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} set xlim to 1983 to 2023}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}xlim}\PYG{p}{(}\PYG{n}{pd}\PYG{o}{.}\PYG{n}{Timestamp}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{1983\PYGZhy{}01\PYGZhy{}01}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{,} \PYG{n}{pd}\PYG{o}{.}\PYG{n}{Timestamp}\PYG{p}{(}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{2023\PYGZhy{}12\PYGZhy{}31}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}\PYG{p}{)}
\PYG{n}{ax}\PYG{o}{.}\PYG{n}{set\PYGZus{}ylim}\PYG{p}{(}\PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{min}\PYG{p}{(}\PYG{p}{)}\PYG{p}{,} \PYG{n}{oni}\PYG{p}{[}\PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{ONI}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{]}\PYG{o}{.}\PYG{n}{max}\PYG{p}{(}\PYG{p}{)}\PYG{p}{)}

\PYG{c+c1}{\PYGZsh{} Show the plot}
\PYG{n}{plt}\PYG{o}{.}\PYG{n}{show}\PYG{p}{(}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}
\begin{sphinxVerbatimOutput}

\begin{sphinxuseclass}{cell_output}
\noindent\sphinxincludegraphics{{cb946f9e6e90b7df9f3395cec1cc4fbd493037ae4ef22d985226b2e6c18877b6}.png}

\end{sphinxuseclass}\end{sphinxVerbatimOutput}

\end{sphinxuseclass}
\begin{sphinxuseclass}{cell}\begin{sphinxVerbatimInput}

\begin{sphinxuseclass}{cell_input}
\begin{sphinxVerbatim}[commandchars=\\\{\}]
\PYG{c+c1}{\PYGZsh{} save to the data directory}
\PYG{n}{oni}\PYG{o}{.}\PYG{n}{to\PYGZus{}csv}\PYG{p}{(}\PYG{n}{data\PYGZus{}dir} \PYG{o}{/} \PYG{l+s+s1}{\PYGZsq{}}\PYG{l+s+s1}{oni.csv}\PYG{l+s+s1}{\PYGZsq{}}\PYG{p}{)}
\end{sphinxVerbatim}

\end{sphinxuseclass}\end{sphinxVerbatimInput}

\end{sphinxuseclass}






\renewcommand{\indexname}{Index}
\printindex
\end{document}