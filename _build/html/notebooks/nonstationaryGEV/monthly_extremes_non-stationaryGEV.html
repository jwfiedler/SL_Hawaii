

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Nonstationary Extremes &#8212; Hawaii Sea Level Indicators</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.5ea377869091fd0449014c60fc090103.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/nonstationaryGEV/monthly_extremes_non-stationaryGEV';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Minor Flood Frequency and Duration" href="../Flood.html" />
    <link rel="prev" title="Components of Sea Level" href="../regional_and_local/SL_Components_annual.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>
<aside class="bd-header-announcement" aria-label="Announcement">
  <div class="bd-header-announcement__content">In development! Please post issues and suggestions to github.</div>
</aside>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/trend_map.png" class="logo__image only-light" alt="Hawaii Sea Level Indicators - Home"/>
    <script>document.write(`<img src="../../_static/trend_map.png" class="logo__image only-dark" alt="Hawaii Sea Level Indicators - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../gettingStarted.html">Getting Started</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../setup.html">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../SL_Data_Wrangling.html">Data Wrangling</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">ANNUAL</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../SL_annual.html">Sea Level Magnitude</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../regional_and_local/SL_Trend.html">Sea Level Trend</a></li>
<li class="toctree-l2"><a class="reference internal" href="../regional_and_local/SL_anomaly_annual.html">Annual Sea Level Anomalies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../regional_and_local/SL_Rankings_annual.html">Annual Sea Level Rankings</a></li>
<li class="toctree-l2"><a class="reference internal" href="../regional_and_local/SL_Extremes_annual.html">Annual Extremes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../regional_and_local/SL_Components_annual.html">Components of Sea Level</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Nonstationary Extremes</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Flood.html">Minor Flood Frequency and Duration</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../FloodFrequency.html">Minor Flood Frequency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FloodDuration.html">Flood Duration</a></li>
</ul>
</details></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">INTRA-ANNUAL</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../SL_intra-annual.html">Sea Level Magnitude</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../regional_and_local/SL_anomaly_intra-annual.html">Intra-Annual Sea Level Anomalies</a></li>
<li class="toctree-l2"><a class="reference internal" href="../regional_and_local/SL_Extremes_intra-annual.html">Intra-Annual Extremes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../regional_and_local/SL_Components_intra-annual.html">Components of Sea Level</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Flood_intra-annual.html">Minor Flood Frequency and Duration</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../FloodFrequency_intra-annual.html">Minor Flood Frequency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FloodDuration_intra-annual.html">Flood Duration</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/jwfiedler/SL_Hawaii/main?urlpath=tree/notebooks/nonstationaryGEV/monthly_extremes_non-stationaryGEV.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jwfiedler/SL_Hawaii" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jwfiedler/SL_Hawaii/edit/main/notebooks/nonstationaryGEV/monthly_extremes_non-stationaryGEV.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jwfiedler/SL_Hawaii/issues/new?title=Issue%20on%20page%20%2Fnotebooks/nonstationaryGEV/monthly_extremes_non-stationaryGEV.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/nonstationaryGEV/monthly_extremes_non-stationaryGEV.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Nonstationary Extremes</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cumulative-distribution-function-cdf">Cumulative Distribution Function (CDF)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#main-functions">Main Functions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-wise-solver">Step-wise solver</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maximum-likelihood-estimation">Maximum Likelihood Estimation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-search">Parameter Search</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonality-in-location-model">Seasonality in Location Model</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonality-trend-and-covariate-model">Seasonality, Trend, and Covariate Model</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonality-trend-covariate-and-nodal-cycle-model">Seasonality, Trend, Covariate and Nodal cycle Model</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#input-to-the-fitness-function">Input to the fitness function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-seasonality-effect-on-extremes">Plot: Seasonality Effect on Extremes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#format-data-input-to-the-model">Format data input to the model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adjust-data-for-storm-year">Adjust data for storm year</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-the-covariate-data-timeseries">Prepare the covariate data timeseries.</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#first-look-modeling-seasonality">First look: Modeling Seasonality</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-a-timeseries-of-the-time-dependent-return-values">Extract a timeseries of the time-dependent return values</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-monthly-extremes-and-given-year-return-period-with-the-seasonal-model">Plot monthly extremes and given year return period with the seasonal model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-if-we-should-include-a-long-term-trend-mean-sea-level-rise-in-our-location-parameter">Check if we should include a long-term trend (mean sea level rise) in our location parameter</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#check-the-covariate-in-the-location-parameter">Check the covariate in the location parameter.</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-the-covariate-in-scale-parameter">Check the covariate in scale parameter</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-the-nodal-cycle-in-location-parameter">Check the nodal cycle in Location parameter</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-timeseries">Plot the timeseries</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-it-up">Plot it up</a></li>
</ul>
</li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="nonstationary-extremes">
<h1>Nonstationary Extremes<a class="headerlink" href="#nonstationary-extremes" title="Permalink to this heading">#</a></h1>
<p>As with our stationary annual extremes, for the nonstationary extremes we’ll be using the Generalized Extreme Value (GEV) distribution. The GEV is a family of continuous probability distributions developed to combine the Gumbel, Fréchet, and Weibull families, also known as type I, II, and III extreme value distributions, respectively. It is widely used in different fields, particularly for modeling the largest or smallest values among a large set of independent, identically distributed random values (extreme value analysis).</p>
<section id="cumulative-distribution-function-cdf">
<h2>Cumulative Distribution Function (CDF)<a class="headerlink" href="#cumulative-distribution-function-cdf" title="Permalink to this heading">#</a></h2>
<p>The cumulative distribution function of the GEV, which is used to calculate return periods, is given by:</p>
<div class="amsmath math notranslate nohighlight" id="equation-35502452-7e58-45cd-a10e-41cfb8d4ef64">
<span class="eqno">(1)<a class="headerlink" href="#equation-35502452-7e58-45cd-a10e-41cfb8d4ef64" title="Permalink to this equation">#</a></span>\[\begin{align}
F(x; \mu, \sigma, \xi) = \begin{cases} 
\exp\left(-\left(1 + \xi \frac{x - \mu}{\psi}\right)^{-\frac{1}{\xi}}\right) &amp; \text{if } \xi \neq 0, \; 1 + \xi \frac{x - \mu}{\psi} &gt; 0 \\
\exp\left(-\exp\left(-\frac{x - \mu}{\psi}\right)\right) &amp; \text{if } \xi = 0
\end{cases}
\end{align}\]</div>
<p>Where:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\mu \)</span> (location parameter) determines the center of the distribution.</p></li>
<li><p><span class="math notranslate nohighlight">\( \psi \)</span> (scale parameter) is strictly positive and scales the distribution.</p></li>
<li><p><span class="math notranslate nohighlight">\( \xi \)</span> (shape parameter) describes the tail behavior of the distribution. It can be positive (heavy tail, Fréchet), zero (exponential tail, Gumbel), or negative (bounded tail, Weibull).</p></li>
</ul>
<p>Assuming we are not dealing with a random stationary process (as with our stationary annual extremes), each parameter in the above equation can be the combination of one or more time-dependent components. These effects could include annual variability (seasonality), sea level rise (long-term trend and possible acceleration), a long-term trend for the extreme values, long-term climate variability effects explained by climate indices or the 18.61-yr nodal cycle.</p>
<p>The sum total of these covariates on each parameter are:</p>
<div class="amsmath math notranslate nohighlight" id="equation-0cc402ad-b657-40d3-b42f-bf7c08ee33a2">
<span class="eqno">(2)<a class="headerlink" href="#equation-0cc402ad-b657-40d3-b42f-bf7c08ee33a2" title="Permalink to this equation">#</a></span>\[\begin{align}
\mu(t) &amp;= \mu_{SLR}(t) + \mu_S(t)exp^{[\mu_{LT}(t)]} + \mu_N(t) + \mu_{CLI}(t),\\
\psi_t(t) &amp;= \psi_S(t)exp^{[\psi_{LT}(t)]} + \psi_N(t) + \psi_{CLI},\\
\xi_t(t) &amp;= \xi_S(t)exp^{[\xi_{LT}(t)]}
\end{align}\]</div>
<p>Note this includes a nonlinear component to allow for a long-term (LT) variability in the seasonality (S) in the location and scale parameters. The following codes will not include some of these terms - this is a general equation!</p>
<p>This example script explores the following steps:</p>
<ul class="simple">
<li><p>step1: seasonal pattern of extreme events (seasonality on location, scale, and shape parameters remain constant)</p></li>
<li><p>step2: long-term trends in location parameter (linear and a possible acceleration)</p></li>
<li><p>step3: Checking Covariate (ONI index) in the GEV location parameter</p></li>
<li><p>step4: Checking Covariate (ONI index) in the GEV scale parameter</p></li>
<li><p>step5: Checking Nodal cycle (18.6 year period, waves) in the GEV location parameter</p></li>
</ul>
<p>Author: Melisa Menendez, menendezm&#64;unican.es</p>
<p>Updated for Billy &amp; Ayesha SERDP work: 09-March-2017</p>
<p>Updated for Python with some added explanation: July 2024</p>
<p>Further explanation of this code (and writeup) can be found in:
Méndez, F. J., M. Menéndez, A. Luceño, and I. J. Losada, 2007: Analyzing Monthly Extreme Sea Levels with a Time-Dependent GEV Model. J. Atmos. Oceanic Technol., 24, 894–911, https://doi.org/10.1175/JTECH2009.1.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">scipy.io</span>
<span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span><span class="p">,</span> <span class="n">timedelta</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">chi2</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">brentq</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">subprocess</span>
<span class="kn">import</span> <span class="nn">json</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="main-functions">
<h2>Main Functions<a class="headerlink" href="#main-functions" title="Permalink to this heading">#</a></h2>
<p>Here we’ll write our main functions.</p>
<section id="step-wise-solver">
<h3>Step-wise solver<a class="headerlink" href="#step-wise-solver" title="Permalink to this heading">#</a></h3>
<p>This function iteratively improves the model solution by choosing which parameters to use and evaluating if the change leads to a statistically significant improvement using a <span class="math notranslate nohighlight">\(\chi^2\)</span> metric.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">stepwise</span><span class="p">(</span><span class="n">x_inisol</span><span class="p">,</span> <span class="n">modelType</span><span class="o">=</span><span class="s1">&#39;GEV_SeasonalMu&#39;</span><span class="p">):</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x_inisol</span><span class="p">)</span>


    <span class="n">cont</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">x_inisol</span><span class="p">])</span> 
    <span class="c1"># x = x_inisol # Start with initial solution</span>
    <span class="n">f</span><span class="p">,</span> <span class="n">pa</span> <span class="o">=</span> <span class="n">fitness</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cont</span><span class="p">],</span> <span class="n">modelType</span><span class="p">)</span>  <span class="c1"># Compute fitness for initial solution</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">f</span><span class="p">])</span>
    <span class="n">pa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">pa</span><span class="p">])</span>
    
    <span class="n">better</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="n">prob</span> <span class="o">=</span> <span class="mf">0.95</span>
    
    <span class="k">while</span> <span class="n">better</span><span class="p">:</span>

        <span class="n">dum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># Find positions of zeros in the chromosome</span>
        
        <span class="k">if</span> <span class="n">dum</span><span class="o">.</span><span class="n">size</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">x_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cont</span><span class="p">],</span> <span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dum</span><span class="p">),</span> <span class="mi">1</span><span class="p">))</span>
            <span class="n">f_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dum</span><span class="p">))</span>
            <span class="n">pa_temp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dum</span><span class="p">))</span>
            
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">dum</span><span class="p">)):</span>
                <span class="n">x_temp</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">dum</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="mi">1</span>
                <span class="n">f_temp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pa_temp</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitness</span><span class="p">(</span><span class="n">x_temp</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">modelType</span><span class="p">)</span>
            <span class="n">best</span><span class="p">,</span> <span class="n">indi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">f_temp</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">f_temp</span><span class="p">)</span>
            <span class="c1"># Check if the improvement is significant with chi2 test</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">best</span> <span class="o">-</span> <span class="n">f</span><span class="p">[</span><span class="n">cont</span><span class="p">])</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mf">0.5</span> <span class="o">*</span> <span class="n">chi2</span><span class="o">.</span><span class="n">ppf</span><span class="p">(</span><span class="n">prob</span><span class="p">,</span> <span class="n">df</span><span class="o">=</span><span class="p">(</span><span class="n">pa_temp</span><span class="p">[</span><span class="n">indi</span><span class="p">]</span> <span class="o">-</span> <span class="n">pa</span><span class="p">[</span><span class="n">cont</span><span class="p">]))):</span>
                <span class="n">cont</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="p">[</span><span class="n">x_temp</span><span class="p">[</span><span class="n">indi</span><span class="p">]]))</span>
                <span class="n">f</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">f</span><span class="p">,</span> <span class="p">[</span><span class="n">best</span><span class="p">]))</span>
                <span class="n">pa</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">((</span><span class="n">pa</span><span class="p">,</span> <span class="p">[</span><span class="n">pa_temp</span><span class="p">[</span><span class="n">indi</span><span class="p">]]))</span>
                <span class="n">f</span><span class="p">[</span><span class="n">cont</span><span class="p">],</span> <span class="n">pa</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">fitness</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">cont</span><span class="p">],</span> <span class="n">modelType</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">better</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">better</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">return</span> <span class="n">x</span><span class="p">,</span> <span class="n">f</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="maximum-likelihood-estimation">
<h3>Maximum Likelihood Estimation<a class="headerlink" href="#maximum-likelihood-estimation" title="Permalink to this heading">#</a></h3>
<p>Since we are using monthly data, we can define our location parameter as a harmonic series to represent seasonal effects, like so:</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Note that some portions of the original code have a dyadic series, so while our normal series would have n going from 1 to <span class="math notranslate nohighlight">\(\infty\)</span> we will have <span class="math notranslate nohighlight">\(n=1,2,4\)</span>, representing the annual cycle, the seasonal cycle, and the ‘4w’ cycle. (What is that - quarterly?)</p>
</div>
</aside>
<div class="math notranslate nohighlight">
\[
f(t) = A_0 + \sum_{n=1}^{\infty} \left( A_n \cos(2n \pi t) + B_n \sin(2n \pi t) \right),
\]</div>
<p>For example, if we can describe our location, scale and shape parameters in the GEV as:</p>
<div class="amsmath math notranslate nohighlight" id="equation-ff12db81-390d-47ae-8f71-ed636c1adc5a">
<span class="eqno">(3)<a class="headerlink" href="#equation-ff12db81-390d-47ae-8f71-ed636c1adc5a" title="Permalink to this equation">#</a></span>\[\begin{align}
\mu(t) &amp;= \beta_{SLR}(t) + [\beta_0 + \beta_1 cos(2\pi t) + \beta_2 sin(2\pi t) + \beta_3 cos(4\pi t) + \beta_4 sin(4\pi t)]e^{[\beta_{LT}(t)]}\\\
 &amp;+ \beta_{N_1} cos(2\pi t/T_N) + \beta_{N_2} sin(2\pi t/T_N) + \beta_{ONI}ONI(t),\\
\psi(t) &amp;= [\alpha_0 + \alpha_1 cos(2\pi t) + \alpha_2 sin(2\pi t)]e^{[\alpha_{LT}(t)]} \\
\xi(t) &amp;=  [\gamma_0 + \gamma_1 cos(2\pi t) + \gamma_2 sin(2\pi t)]
\end{align}\]</div>
<p>then the vector we’d use for our MLE fit should be</p>
<p><span class="math notranslate nohighlight">\(\theta = (\beta_0,\beta_1,\beta_2,\beta_3,\beta_4,\beta_{N_1},\beta_{N_2},\beta_{LT},\beta_{ONI},\alpha_0, \alpha_1, \alpha_2, \alpha_{LT},\gamma_0,\gamma_1,\gamma_2)\)</span>.</p>
<p>Here, <span class="math notranslate nohighlight">\(\beta_{0,1,2,3,4}\)</span> model the seasonal variation of the location parameter, <span class="math notranslate nohighlight">\(\beta_{N1,N2}\)</span> are the amplitudes of the nodal cycle, <span class="math notranslate nohighlight">\(\beta_{LT}\)</span> is the long term trend of the location parameter, and <span class="math notranslate nohighlight">\(\beta_{ONI}\)</span> is the amplitude (relative influence) of the [ONI] climate index in the location parameter. Similarly, <span class="math notranslate nohighlight">\(\alpha_{0,1,2}\)</span> model the [cyclical] variation of the scale parameter, and <span class="math notranslate nohighlight">\(\alpha_{LT}\)</span> models its long-term trend. For the shape parameter, only the seasonal variation is modeled (<span class="math notranslate nohighlight">\(\gamma_{0,1,2}\)</span>).</p>
<p>We’ll use this vector <span class="math notranslate nohighlight">\(\theta\)</span> to calculate the maximum likelihood function <span class="math notranslate nohighlight">\(L\)</span>,</p>
<p><span class="math notranslate nohighlight">\(L(\theta | t_i,z_i) = \prod_{i=1}^m g[z_i;\mu(t_i),\psi(t_i),\xi(t_i)]\)</span>,</p>
<p>where <span class="math notranslate nohighlight">\(g\)</span> is the CDF of the GEV (equation 1). In other words, this means that the likelihood of observing the entire dataset is the product of the likelihoods of observing each individual time point under the assumed GEV model (Maximum Likelihood Estimation, MLE).</p>
</section>
<section id="parameter-search">
<h3>Parameter Search<a class="headerlink" href="#parameter-search" title="Permalink to this heading">#</a></h3>
<p>The code below takes a varying number of parameters (a differently sized vector of regression parameters) for different models. There are three models we can run: GEV_SeasonalMu, GEV_S_T_Cv, or GEV_S_T_Cv_Nodal. Because there are so many parameters to estimate (a high-dimensional problem), a Shuffled Complex Evolution (SCE-UA,\cite{Duan}) optimization scheme is used to determine the best parameter fits. The SCE-UA is used often in hydrology, engineering, and other environmental sciences, using random clusters for initial starting points in its search algorithm and allowing them to “evolve” to a better solution. Other optimization schemes exist, but for now this is what we’re using.</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Still to do: get these models to run all in a python ecosystem. For right now, they will remain .exe files.</p>
</div>
</aside>
<section id="seasonality-in-location-model">
<h4>Seasonality in Location Model<a class="headerlink" href="#seasonality-in-location-model" title="Permalink to this heading">#</a></h4>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>The series here is n=1,2,4. WHY.</p>
</aside>
<p>Our first step is to look at seasonality only, using the GEV_SeasonalMu model, such that <span class="math notranslate nohighlight">\(\mu(t)\)</span>, <span class="math notranslate nohighlight">\(\psi(t)\)</span>, and <span class="math notranslate nohighlight">\(\xi(t)\)</span> are:</p>
<div class="amsmath math notranslate nohighlight" id="equation-6430b311-56cd-4df6-98f8-fca30322488f">
<span class="eqno">(4)<a class="headerlink" href="#equation-6430b311-56cd-4df6-98f8-fca30322488f" title="Permalink to this equation">#</a></span>\[\begin{align}
\mu(t) &amp;=  \beta_0 + \beta_1 cos(2\pi t) + \beta_2 sin(2\pi t) + \\
&amp;\beta_3 cos(4\pi t) + \beta_4 sin(4\pi t) + \beta_5 cos(8\pi t) + \beta_6 sin(8\pi t),\\
\psi &amp;= \alpha_0, \\
\xi &amp;=  \gamma_0 
\end{align}\]</div>
<p>and we’ll arrange our vector of 9 regression parameters within the fitness function like so:</p>
<p><span class="math notranslate nohighlight">\(\theta = [\beta_0, \alpha_0, \gamma_0, \beta_1, \beta_2, \beta_3, \beta_4, \beta_5, \beta_6].\)</span></p>
<p>In this way we assume that only the location parameter changes within a year, whereas the shape and scale of the GEV distribution are constant.</p>
</section>
<section id="seasonality-trend-and-covariate-model">
<h4>Seasonality, Trend, and Covariate Model<a class="headerlink" href="#seasonality-trend-and-covariate-model" title="Permalink to this heading">#</a></h4>
<p>For the GEV_S_T_Cv model , we’ll allow a long-term trend into the location parameter and a covariate into the scale and location parameter:</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>Note this trend can be approximated as linear if our long-term trend parameter <span class="math notranslate nohighlight">\(\beta_{LT}\)</span> is small.</p>
<p>Mathmematically, as <span class="math notranslate nohighlight">\(\beta_{LT}\)</span> goes to zero, <span class="math notranslate nohighlight">\(e^{\beta_{LT}·t}\)</span> goes to <span class="math notranslate nohighlight">\(1 + \beta_{LT}·t\)</span> and our expression (for the non-cyclical part of the location parameter) simplifies to <span class="math notranslate nohighlight">\(\beta_0 (1 +  \beta_{LT}·t)\)</span>.</p>
<p>That is the equation of a line: <span class="math notranslate nohighlight">\(\beta_0 + \beta_0·\beta_{LT}·t\)</span>, where slope of the line is <span class="math notranslate nohighlight">\(\beta_0·\beta_{LT}\)</span>.</p>
</aside>
<div class="amsmath math notranslate nohighlight" id="equation-5c4e6783-404e-4778-9173-fc48990b7886">
<span class="eqno">(5)<a class="headerlink" href="#equation-5c4e6783-404e-4778-9173-fc48990b7886" title="Permalink to this equation">#</a></span>\[\begin{align}
\mu(t) &amp;= e^{\beta_{LT}t}[\beta_0  + \beta_1 cos(2\pi t) + \beta_2 sin(2\pi t) + \beta_3 cos(4\pi t) + \beta_4 sin(4\pi t) \\
&amp;+ \beta_5 cos(6\pi t) + \beta_6 sin(6\pi t)]   + \beta_{ONI}ONI(t),\\
\psi &amp;= \alpha_0 + \alpha_{ONI}ONI(t), \\
\xi &amp;=  \gamma_0 
\end{align}\]</div>
<p>and we’ll arrange our vector of 12 regression parameters within the fitness function like so:</p>
<p><span class="math notranslate nohighlight">\(\theta = [\beta_0, \alpha_0, \gamma_0, \beta_1, \beta_2, \beta_3, \beta_4, \beta_5, \beta_6,\beta_{LT},\beta_{ONI},\alpha_{ONI}].\)</span></p>
</section>
<section id="seasonality-trend-covariate-and-nodal-cycle-model">
<h4>Seasonality, Trend, Covariate and Nodal cycle Model<a class="headerlink" href="#seasonality-trend-covariate-and-nodal-cycle-model" title="Permalink to this heading">#</a></h4>
<p>For the GEV_S_T_Cv_N model , we’ll add in the nodal cycle:</p>
<div class="amsmath math notranslate nohighlight" id="equation-3a2df456-85a8-427d-bf84-145d3dfe9e51">
<span class="eqno">(6)<a class="headerlink" href="#equation-3a2df456-85a8-427d-bf84-145d3dfe9e51" title="Permalink to this equation">#</a></span>\[\begin{align}
\mu(t) &amp;= e^{\beta_{LT}t}[\beta_0  + \beta_1 cos(2\pi t) + \beta_2 sin(2\pi t) + \beta_3 cos(4\pi t) + \beta_4 sin(4\pi t) \\
&amp;+ \beta_5 cos(6\pi t) + \beta_6 sin(6\pi t)] + \beta_{ONI}ONI(t) + \beta_{N_1} cos(2\pi t/T_N),\\
\psi &amp;= \alpha_0 + \alpha_{ONI}ONI(t), \\
\xi &amp;=  \gamma_0 
\end{align}\]</div>
<p>and we’ll arrange our vector of 14 regression parameters within the fitness function like so:</p>
<p><span class="math notranslate nohighlight">\(\theta = [\beta_0, \alpha_0, \gamma_0, \beta_1, \beta_2, \beta_3, \beta_4, \beta_5, \beta_6,\beta_{LT},\beta_{ONI},\alpha_{ONI},\beta_{N1},\beta_{N2}].\)</span></p>
</section>
</section>
<section id="input-to-the-fitness-function">
<h3>Input to the fitness function<a class="headerlink" href="#input-to-the-fitness-function" title="Permalink to this heading">#</a></h3>
<p>Note that the input “x” to the fitness function works like a switch - if it is a parameter to include, it is 1 (True). If it is not used, it is 0 (False). It is at most 7 elements long.</p>
<ul class="simple">
<li><p>x: [1/0 1/0 1/0 1/0 1/0 1/0 1/0]</p></li>
<li><p>x[0]: annual cycle, location parameter.</p></li>
<li><p>x[1]: semi-annual cycle, location parameter.</p></li>
<li><p>x[2]: quarterly (??) cycle, location parameter.</p></li>
<li><p>x[3]: Trend, location parameter.</p></li>
<li><p>x[4]: Covariate, location parameter.</p></li>
<li><p>x[5]: Covariate, scale parameter.</p></li>
<li><p>x[6]: Nodal cycle, location parameter</p></li>
<li><p>Max number of parameters: 14</p></li>
</ul>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fitness</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">modelType</span><span class="o">=</span><span class="s1">&#39;GEV_SeasonalMu&#39;</span><span class="p">):</span>
    <span class="c1"># Load parameter limits from a file</span>
    <span class="n">aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;limits.txt&#39;</span><span class="p">)</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux</span><span class="p">))</span>  <span class="c1"># Initialize with NaNs</span>
    <span class="n">xmin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">aux</span><span class="p">))</span>
    <span class="c1"># Initialize parameter limits based on the chromosome</span>
    <span class="n">xmin</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
    <span class="n">xmax</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[:</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
    <span class="n">cont</span> <span class="o">=</span> <span class="mi">3</span>
    

    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Annual cycle</span>
        <span class="n">xmin</span><span class="p">[</span><span class="n">cont</span><span class="p">:</span><span class="n">cont</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">aux</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>  <span class="c1"># should use indices 3 and 4 (i.e., aux(4,1) and aux(5,1) in MATLAB)</span>
        <span class="n">xmax</span><span class="p">[</span><span class="n">cont</span><span class="p">:</span><span class="n">cont</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">aux</span><span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="n">cont</span> <span class="o">+=</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Semiannual cycle</span>
        <span class="n">xmin</span><span class="p">[</span><span class="n">cont</span><span class="p">:</span><span class="n">cont</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">aux</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>  <span class="c1"># should use indices 5 and 6 (i.e., aux(6,1) and aux(7,1) in MATLAB)</span>
        <span class="n">xmax</span><span class="p">[</span><span class="n">cont</span><span class="p">:</span><span class="n">cont</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">aux</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="n">cont</span> <span class="o">+=</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Frequency 4w</span>
        <span class="n">xmin</span><span class="p">[</span><span class="n">cont</span><span class="p">:</span><span class="n">cont</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">aux</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>  <span class="c1"># should use indices 5 and 6 (same as Semiannual cycle)</span>
        <span class="n">xmax</span><span class="p">[</span><span class="n">cont</span><span class="p">:</span><span class="n">cont</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">aux</span><span class="p">[</span><span class="mi">6</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
        <span class="n">cont</span> <span class="o">+=</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">modelType</span> <span class="o">==</span> <span class="s1">&#39;GEV_S_T_Cv&#39;</span> <span class="ow">or</span> <span class="n">modelType</span> <span class="o">==</span> <span class="s1">&#39;GEV_S_T_Cv_Nodal&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>  <span class="c1"># Frequency 4w, for some reason the limits change, so we&#39;ll replace them</span>
            <span class="n">cont</span> <span class="o">-=</span> <span class="mi">2</span>
            <span class="n">xmin</span><span class="p">[</span><span class="n">cont</span><span class="p">:</span><span class="n">cont</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">aux</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>  <span class="c1"># </span>
            <span class="n">xmax</span><span class="p">[</span><span class="n">cont</span><span class="p">:</span><span class="n">cont</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">aux</span><span class="p">[</span><span class="mi">8</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="mi">2</span>
        
        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># Trend in location parameter, beta_LT</span>
            <span class="n">xmin</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">xmax</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">9</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="mi">1</span>
        
        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># Covariate in location parameter, beta_CV</span>
            <span class="n">xmin</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">xmax</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">10</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># Covariate in scale parameter, gamma_CV</span>
            <span class="n">xmin</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
            <span class="n">xmax</span><span class="p">[</span><span class="n">cont</span><span class="p">]</span> <span class="o">=</span> <span class="n">aux</span><span class="p">[</span><span class="mi">11</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="mi">1</span>
    
    <span class="k">if</span> <span class="n">modelType</span> <span class="o">==</span> <span class="s1">&#39;GEV_S_T_Cv_Nodal&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">x</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># Nodal component in location, beta_N1, beta_N2</span>
            <span class="n">xmin</span><span class="p">[</span><span class="n">cont</span><span class="p">:</span><span class="n">cont</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">aux</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span> <span class="mi">0</span><span class="p">]]</span>
            <span class="n">xmax</span><span class="p">[</span><span class="n">cont</span><span class="p">:</span><span class="n">cont</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">aux</span><span class="p">[</span><span class="mi">12</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">aux</span><span class="p">[</span><span class="mi">13</span><span class="p">,</span> <span class="mi">1</span><span class="p">]]</span>
            <span class="n">cont</span> <span class="o">+=</span> <span class="mi">2</span>


    <span class="n">xmin</span> <span class="o">=</span> <span class="n">xmin</span><span class="p">[:</span><span class="n">cont</span><span class="p">]</span>
    <span class="n">xmax</span> <span class="o">=</span> <span class="n">xmax</span><span class="p">[:</span><span class="n">cont</span><span class="p">]</span>

    <span class="c1"># Prepare the initial values and parameter configuration file</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xmin</span><span class="p">)</span>
    <span class="n">xini</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">n</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.001</span>
    <span class="n">xini</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.001</span>  <span class="c1"># Specific initialization for third parameter</span>
    
    <span class="c1"># Prepare parameters for the external executable</span>
    <span class="n">maxn</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2000</span> <span class="o">+</span> <span class="mi">1500</span> <span class="o">*</span> <span class="n">n</span> <span class="c1">#number of iterations</span>
    <span class="n">kstop</span> <span class="o">=</span> <span class="mi">3</span> <span class="c1">#number of iterations without improvement allowed</span>
    <span class="n">pcento</span> <span class="o">=</span> <span class="mf">0.001</span>
    <span class="n">ngs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">n</span> <span class="o">/</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">iseed</span> <span class="o">=</span> <span class="mi">955</span>
    <span class="n">ideflt</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">npg</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">nps</span> <span class="o">=</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">nspl</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">mings</span> <span class="o">=</span> <span class="n">ngs</span>
    <span class="n">iniflg</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">iprint</span> <span class="o">=</span> <span class="mi">0</span>
    

    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;scein.dat&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="c1"># Writing header with specified formatting</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">maxn</span><span class="si">:</span><span class="s2">5g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">kstop</span><span class="si">:</span><span class="s2">5g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">pcento</span><span class="si">:</span><span class="s2">5.3g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">ngs</span><span class="si">:</span><span class="s2">5g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">iseed</span><span class="si">:</span><span class="s2">5g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">ideflt</span><span class="si">:</span><span class="s2">5g</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">npg</span><span class="si">:</span><span class="s2">5g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">nps</span><span class="si">:</span><span class="s2">5g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">nspl</span><span class="si">:</span><span class="s2">5g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">mings</span><span class="si">:</span><span class="s2">5g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">iniflg</span><span class="si">:</span><span class="s2">5g</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">iprint</span><span class="si">:</span><span class="s2">5g</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1"># Write chromosome values with better control over formatting</span>
        <span class="n">x_formatted</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="si">:</span><span class="s2">1.0f</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="si">:</span><span class="s2">1.0f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">x_formatted</span><span class="p">)</span>

        <span class="c1"># Writing parameter limits and initial guesses with specified precision</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">xini</span><span class="p">)):</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">xini</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">15.8f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">xmin</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">15.8f</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">xmax</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">:</span><span class="s2">15.8f</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>        

    
    <span class="c1"># Run the external model executable</span>
    <span class="n">modelName</span> <span class="o">=</span> <span class="s1">&#39;Model_&#39;</span> <span class="o">+</span> <span class="n">modelType</span> <span class="o">+</span> <span class="s1">&#39;.exe&#39;</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">([</span><span class="n">modelName</span><span class="p">],</span> <span class="n">check</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    
    <span class="c1"># Read the output</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;best.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">bestf</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">file</span><span class="o">.</span><span class="n">readline</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
    
    <span class="k">return</span> <span class="n">bestf</span><span class="p">,</span> <span class="n">n</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="plot-seasonality-effect-on-extremes">
<h3>Plot: Seasonality Effect on Extremes<a class="headerlink" href="#plot-seasonality-effect-on-extremes" title="Permalink to this heading">#</a></h3>
<p>Next we’ll make an example plot of the seasonality effect on extremes. For each year day, we’ll evaluate the CDF of the GEV at a return period of 50 years to get the the return levels within the year.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plottingExtremeSeasonality</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span> <span class="n">seaLevel</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">ReturnPeriod</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">SampleRate</span><span class="o">=</span><span class="mi">12</span><span class="p">):</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="mf">0.001</span>
    <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.101</span><span class="p">,</span> <span class="n">dx</span><span class="p">)</span>
    
    <span class="c1"># Define the mu using the harmonic series</span>
    <span class="n">mu</span> <span class="o">=</span> <span class="p">(</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">w</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t2</span><span class="p">)</span> <span class="o">+</span> <span class="n">w</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t2</span><span class="p">)</span> <span class="o">+</span>
          <span class="n">w</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t2</span><span class="p">)</span> <span class="o">+</span> <span class="n">w</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t2</span><span class="p">)</span> <span class="o">+</span>
          <span class="n">w</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t2</span><span class="p">)</span> <span class="o">+</span> <span class="n">w</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">t2</span><span class="p">))</span>
    <span class="n">psi</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="c1"># Define the time within the year</span>
    <span class="n">twinthinyear</span> <span class="o">=</span><span class="n">T0</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">T0</span><span class="p">)</span>
    
    <span class="n">T</span> <span class="o">=</span> <span class="n">T0</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">ReturnPeriod</span>
    <span class="n">S</span> <span class="o">=</span> <span class="n">SampleRate</span>

    <span class="c1"># get seaLevelS for all ReturnPeriods</span>
    <span class="c1"># preallocate seaLevelS with Nans for each ReturnPeriod</span>
        <span class="c1"># Preallocate seaLevelS with zeros for each ReturnPeriod</span>
    <span class="n">seaLevelS</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">t2</span><span class="p">)))</span>
    
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">)):</span>
        <span class="n">prob</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">S</span><span class="o">*</span><span class="n">R</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span>
        <span class="n">seaLevelS</span><span class="p">[</span><span class="n">i</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">mu</span> <span class="o">-</span> <span class="p">(</span><span class="n">psi</span><span class="o">/</span><span class="n">xi</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">prob</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="n">xi</span><span class="p">))</span>
    
    
    <span class="n">serieCV</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
    
    <span class="c1"># Find the root of the Quantilentime function</span>
    <span class="k">def</span> <span class="nf">Quantilentime</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">R</span><span class="p">):</span>
        <span class="n">t00</span><span class="p">,</span> <span class="n">t11</span> <span class="o">=</span> <span class="mf">0.00001</span><span class="p">,</span> <span class="mf">1.00001</span>  <span class="c1"># Define the time bounds if not globally available</span>

        <span class="c1"># Variables previously defined as global in MATLAB code, handled here locally</span>
        <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">b4</span><span class="p">,</span> <span class="n">b5</span><span class="p">,</span> <span class="n">b6</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
        <span class="n">a0</span><span class="p">,</span> <span class="n">bLT</span><span class="p">,</span> <span class="n">bCI</span><span class="p">,</span> <span class="n">aCI</span><span class="p">,</span> <span class="n">bN1</span><span class="p">,</span> <span class="n">bN2</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
        <span class="n">km</span> <span class="o">=</span> <span class="mi">12</span>
        <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.001</span>
        <span class="n">ti</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t00</span><span class="p">,</span> <span class="n">t11</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>

        <span class="c1"># Interpolate serieCV at ti points</span>
        <span class="n">serieCV2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">serieCV</span><span class="p">)</span>
        <span class="c1"># Replace NaNs with zero (np.interp does this by default if outside the bounds)</span>
        <span class="n">serieCV2</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">serieCV2</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="c1"># Define mut (location(t)) and other parameters</span>
        <span class="n">mut</span> <span class="o">=</span> <span class="p">(</span><span class="n">b0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">bLT</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span>
               <span class="n">b1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span>
               <span class="n">b3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span> <span class="n">b4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span>
               <span class="n">b5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span> <span class="n">b6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span>
               <span class="n">bN1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">18.61</span><span class="p">)</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span> <span class="n">bN2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">18.61</span><span class="p">)</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span>
               <span class="p">(</span><span class="n">bCI</span> <span class="o">*</span> <span class="n">serieCV2</span><span class="p">))</span>

        <span class="n">psi</span> <span class="o">=</span> <span class="n">a0</span> <span class="o">+</span> <span class="p">(</span><span class="n">aCI</span> <span class="o">*</span> <span class="n">serieCV2</span><span class="p">)</span>
        <span class="n">xit</span> <span class="o">=</span> <span class="n">xi</span>

        <span class="c1"># Calculate factor, equation 10 in Menendez and Woodworth (2009)</span>
        <span class="n">factor</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ti</span><span class="p">)):</span>
            <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">xit</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mut</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">psi</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mf">0.0001</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">xit</span><span class="p">)</span>
            <span class="n">factor</span> <span class="o">+=</span> <span class="n">h</span>

        <span class="n">Pr</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">R</span><span class="p">)</span>
        
        <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">Pr</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">km</span> <span class="o">*</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">y</span>
    
    <span class="n">YY</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">R</span><span class="p">))</span>  <span class="c1"># Preallocate for storing results</span>
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">R</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ReturnPeriod</span><span class="p">):</span>
        <span class="n">x0</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">YY</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">brentq</span><span class="p">(</span><span class="n">Quantilentime</span><span class="p">,</span> <span class="n">x0</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="n">x0</span><span class="o">+</span><span class="mi">5</span><span class="p">,</span> <span class="n">args</span><span class="o">=</span><span class="p">(</span><span class="n">R</span><span class="p">,))</span>  <span class="c1"># using bracketing to find the root of Quantilentime function instead of fsolve</span>
    
   <span class="c1"># Start plotting</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">sss</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

    <span class="n">cmap</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">(</span><span class="s2">&quot;viridis&quot;</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">ReturnPeriod</span><span class="p">))</span>

    
    
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">R</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ReturnPeriod</span><span class="p">):</span>
        <span class="n">sss</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">seaLevelS</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="p">:]</span> <span class="o">-</span> <span class="n">STNDtoMHHW</span><span class="p">,</span> <span class="s1">&#39;-.&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
        <span class="n">sss</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">t2</span><span class="p">))</span> <span class="o">*</span> <span class="n">YY</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">STNDtoMHHW</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;R=</span><span class="si">{</span><span class="n">R</span><span class="si">}</span><span class="s1"> years&#39;</span><span class="p">)</span>
    <span class="n">sss</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">twinthinyear</span><span class="p">,</span> <span class="n">seaLevel</span><span class="o">-</span><span class="n">STNDtoMHHW</span><span class="p">,</span> <span class="s1">&#39;+k&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Monthly maxima&#39;</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">sss</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

    <span class="c1"># arrange yaxis for breathing room</span>
    <span class="n">meanmaxSL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">seaLevel</span><span class="o">-</span><span class="n">STNDtoMHHW</span><span class="p">)</span>
    <span class="n">rangemaxSL</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">seaLevel</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">seaLevel</span><span class="p">)</span> <span class="c1"># Range</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span> <span class="mf">1.001</span><span class="p">,</span> <span class="n">meanmaxSL</span><span class="o">-</span><span class="n">rangemaxSL</span><span class="p">,</span> <span class="n">meanmaxSL</span><span class="o">+</span><span class="n">rangemaxSL</span><span class="p">])</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">0.08333</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="o">/</span><span class="mi">6</span><span class="p">),</span> <span class="p">[</span><span class="s1">&#39;Jan&#39;</span><span class="p">,</span> <span class="s1">&#39;Mar&#39;</span><span class="p">,</span> <span class="s1">&#39;May&#39;</span><span class="p">,</span> <span class="s1">&#39;Jul&#39;</span><span class="p">,</span> <span class="s1">&#39;Sep&#39;</span><span class="p">,</span> <span class="s1">&#39;Nov&#39;</span><span class="p">])</span>
    
    <span class="c1"># add legend</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower center&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">ncol</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">))</span>

    
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Sea level (m, MHHW)&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">cmap</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
</section>
<section id="format-data-input-to-the-model">
<h2>Format data input to the model<a class="headerlink" href="#format-data-input-to-the-model" title="Permalink to this heading">#</a></h2>
<p>Now we’ll take our sea level data, extract the monthly maxima from our timeseries, and format it for input into the model. We need the yearday of each monthly maximum, and if using a covariate model (e.g. SOI, ENSO, wave height), the yearday of that index.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>
<span class="o">%</span><span class="k">run</span> ../setup.ipynb
<span class="o">%</span><span class="k">run</span> ../plotting_functions.ipynb

<span class="n">data_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../../data&#39;</span> <span class="p">)</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../../output/extremes&#39;</span><span class="p">)</span> 
<span class="n">input_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./model_input&#39;</span><span class="p">)</span>
<span class="n">model_output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./model_output&#39;</span><span class="p">)</span>
<span class="n">rsl_hourly</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">data_dir</span><span class="o">/</span> <span class="s1">&#39;rsl_hawaii.nc&#39;</span><span class="p">)</span>

<span class="n">runWithoutModel</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># check if output directory exists, if not create it</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">output_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># check if model output directory exists, if not create it</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">model_output_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="n">model_output_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># make sub-directories for each station in rsl_hourly in model_output_dir</span>
<span class="k">for</span> <span class="n">rid</span> <span class="ow">in</span> <span class="n">rsl_hourly</span><span class="o">.</span><span class="n">record_id</span><span class="p">:</span>
    <span class="n">ridString</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">rid</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="c1"># maybe needs some leading zeros, for now we&#39;ll leave it.</span>
    <span class="n">station_dir</span> <span class="o">=</span> <span class="n">model_output_dir</span> <span class="o">/</span> <span class="n">ridString</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">station_dir</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">station_dir</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\julia\anaconda3\envs\SLI39\lib\site-packages\pyproj\__init__.py:89: UserWarning: pyproj unable to set database path.
  _pyproj_global_context_initialize()
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ValueError</span><span class="g g-Whitespace">                                </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">line</span> <span class="mi">10</span>
<span class="g g-Whitespace">      </span><span class="mi">8</span> <span class="n">input_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./model_input&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">9</span> <span class="n">model_output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;./model_output&#39;</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">10</span> <span class="n">rsl_hourly</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">data_dir</span><span class="o">/</span> <span class="s1">&#39;rsl_hawaii.nc&#39;</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="n">runWithoutModel</span> <span class="o">=</span> <span class="kc">False</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="c1"># check if output directory exists, if not create it</span>

<span class="nn">File ~\anaconda3\envs\SLI39\lib\site-packages\xarray\backends\api.py:552,</span> in <span class="ni">open_dataset</span><span class="nt">(filename_or_obj, engine, chunks, cache, decode_cf, mask_and_scale, decode_times, decode_timedelta, use_cftime, concat_characters, decode_coords, drop_variables, inline_array, chunked_array_type, from_array_kwargs, backend_kwargs, **kwargs)</span>
<span class="g g-Whitespace">    </span><span class="mi">549</span>     <span class="n">kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">backend_kwargs</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">551</span> <span class="k">if</span> <span class="n">engine</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="ne">--&gt; </span><span class="mi">552</span>     <span class="n">engine</span> <span class="o">=</span> <span class="n">plugins</span><span class="o">.</span><span class="n">guess_engine</span><span class="p">(</span><span class="n">filename_or_obj</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">554</span> <span class="k">if</span> <span class="n">from_array_kwargs</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">555</span>     <span class="n">from_array_kwargs</span> <span class="o">=</span> <span class="p">{}</span>

<span class="nn">File ~\anaconda3\envs\SLI39\lib\site-packages\xarray\backends\plugins.py:197,</span> in <span class="ni">guess_engine</span><span class="nt">(store_spec)</span>
<span class="g g-Whitespace">    </span><span class="mi">189</span> <span class="k">else</span><span class="p">:</span>
<span class="g g-Whitespace">    </span><span class="mi">190</span>     <span class="n">error_msg</span> <span class="o">=</span> <span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">191</span>         <span class="s2">&quot;found the following matches with the input file in xarray&#39;s IO &quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">192</span>         <span class="sa">f</span><span class="s2">&quot;backends: </span><span class="si">{</span><span class="n">compatible_engines</span><span class="si">}</span><span class="s2">. But their dependencies may not be installed, see:</span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">193</span>         <span class="s2">&quot;https://docs.xarray.dev/en/stable/user-guide/io.html </span><span class="se">\n</span><span class="s2">&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">194</span>         <span class="s2">&quot;https://docs.xarray.dev/en/stable/getting-started-guide/installing.html&quot;</span>
<span class="g g-Whitespace">    </span><span class="mi">195</span>     <span class="p">)</span>
<span class="ne">--&gt; </span><span class="mi">197</span> <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="n">error_msg</span><span class="p">)</span>

<span class="ne">ValueError</span>: did not find a match in any of xarray&#39;s currently installed IO backends [&#39;netcdf4&#39;, &#39;scipy&#39;]. Consider explicitly selecting one of the installed engines via the ``engine`` parameter, or installing additional IO dependencies, see:
<span class="ne">https</span>://docs.xarray.dev/en/stable/getting-started-guide/installing.html
<span class="ne">https</span>://docs.xarray.dev/en/stable/user-guide/io.html
</pre></div>
</div>
</div>
</div>
<section id="adjust-data-for-storm-year">
<h3>Adjust data for storm year<a class="headerlink" href="#adjust-data-for-storm-year" title="Permalink to this heading">#</a></h3>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Commenting this out for now. Do we want to use storm year?</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># # add storm_time to the dataset</span>

<span class="c1"># storm_time = pd.to_datetime(rsl_hourly[&#39;time&#39;].values).to_series() + pd.DateOffset(months=-4)</span>

<span class="c1"># storm_time_da = xr.DataArray(storm_time.values, dims=rsl_hourly[&#39;time&#39;].dims, coords=rsl_hourly[&#39;time&#39;].coords)</span>

<span class="c1"># # Add &#39;storm_time&#39; as a coordinate to the dataset</span>
<span class="c1"># rsl_hourly = rsl_hourly.assign_coords(storm_time=storm_time_da)</span>

<span class="c1"># # Make &#39;storm_time&#39; a dimension</span>
<span class="c1"># rsl_hourly = rsl_hourly.swap_dims({&#39;time&#39;: &#39;storm_time&#39;})</span>

<span class="c1"># # Sort by &#39;storm_time&#39; to ensure monotonic order</span>
<span class="c1"># rsl_hourly = rsl_hourly.sortby(&#39;storm_time&#39;)</span>

<span class="c1"># rsl_hourly</span>
</pre></div>
</div>
</div>
</div>
<p>Let’s print the station names that correspond to order of the data, because I keep forgetting.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">rsl_hourly</span><span class="o">.</span><span class="n">station_name</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;French Frigate&#39; &#39;Midway&#39; &#39;Johnston&#39; &#39;Honolulu, Hawaii&#39; &#39;Nawiliwili&#39;
 &#39;Kahului&#39; &#39;Hilo, Hawaii&#39; &#39;Mokuoloe&#39; &#39;Barbers Point, HI&#39; &#39;Kaumalapau, HI&#39;
 &#39;Kawaihae&#39;]
</pre></div>
</div>
</div>
</div>
<p>The following function reads in the hourly timeseries for a given station (rid = record id) from the rsl_hourly dataset. It returns a dataframe of monthly max sea level values (in STND datum), and time in decimal years, such that the first year of the record starts at 0, and each subsequent time step is fraction of that year.</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<p>TO DO: Adjust monthly maxima timeseries such that high water levels from the same event are not doubly counted.</p>
</aside>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_monthly_max_time_series</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span><span class="n">rsl_hourly</span><span class="p">):</span>
    <span class="n">station_name</span> <span class="o">=</span> <span class="n">rsl_hourly</span><span class="o">.</span><span class="n">station_name</span><span class="p">[</span><span class="n">rid</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>

    <span class="n">STNDtoMHHW</span> <span class="o">=</span> <span class="mf">0.001</span><span class="o">*</span><span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;MHHW&#39;</span><span class="p">][</span><span class="n">rid</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="n">sea_level_series</span> <span class="o">=</span> <span class="mf">0.001</span><span class="o">*</span><span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">][</span><span class="n">rid</span><span class="p">]</span>

    <span class="c1">#get only data from 1993 to 2023</span>
    <span class="n">sea_level_series</span> <span class="o">=</span> <span class="n">sea_level_series</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;1993&#39;</span><span class="p">,</span> <span class="s1">&#39;2023&#39;</span><span class="p">))</span>

    <span class="c1"># remove nans</span>
    <span class="n">sea_level_series</span> <span class="o">=</span> <span class="n">sea_level_series</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="s1">&#39;time&#39;</span><span class="p">)</span>

    <span class="c1"># Step 1: extract the monthly maxima</span>
    <span class="n">monthly_max</span> <span class="o">=</span> <span class="n">sea_level_series</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1ME&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>

    <span class="c1"># get exact time of the monthly maxima</span>
    <span class="n">t_monthly_max</span> <span class="o">=</span> <span class="n">sea_level_series</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="s1">&#39;1ME&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">argmax</span><span class="p">()])</span>

    <span class="c1"># To ensure it&#39;s in datetime format and to access datetime properties</span>
    <span class="n">t_monthly_max</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">t_monthly_max</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

    <span class="c1"># Now extract the day of the year (using fractional days)</span>
    <span class="n">t_yearDay</span> <span class="o">=</span> <span class="n">t_monthly_max</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">dayofyear</span> <span class="o">+</span> <span class="n">t_monthly_max</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">hour</span><span class="o">/</span><span class="mi">24</span> <span class="o">+</span> <span class="n">t_monthly_max</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">minute</span><span class="o">/</span><span class="mi">1440</span> <span class="o">+</span> <span class="n">t_monthly_max</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">second</span><span class="o">/</span><span class="mi">86400</span>

    <span class="c1"># get year of t_monthly_max</span>
    <span class="n">t_year</span> <span class="o">=</span> <span class="n">t_monthly_max</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">year</span>

    <span class="c1"># convert t_yearDay and monthly_max to float</span>
    <span class="n">t_yearDay</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t_yearDay</span><span class="p">)</span>
    <span class="n">monthly_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">monthly_max</span><span class="p">)</span>
    <span class="n">t_monthly_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t_monthly_max</span><span class="p">)</span>
    <span class="n">t_year</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t_year</span><span class="p">)</span>

    <span class="c1"># get decimal year such that t = year_monthly_max + t_yearDay/366</span>
    <span class="n">t</span> <span class="o">=</span> <span class="p">(</span><span class="n">t_year</span><span class="o">-</span><span class="n">t_year</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">t_yearDay</span><span class="o">/</span><span class="mi">366</span>

    <span class="c1"># save t and monthly_max to data frame</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">t</span><span class="p">,</span> <span class="s1">&#39;monthly_max&#39;</span><span class="p">:</span> <span class="n">monthly_max</span><span class="p">,</span> <span class="s1">&#39;t_monthly_max&#39;</span><span class="p">:</span> <span class="n">t_monthly_max</span><span class="p">})</span>

    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">STNDtoMHHW</span><span class="p">,</span> <span class="n">station_name</span>
</pre></div>
</div>
</div>
</div>
<section id="prepare-the-covariate-data-timeseries">
<h4>Prepare the covariate data timeseries.<a class="headerlink" href="#prepare-the-covariate-data-timeseries" title="Permalink to this heading">#</a></h4>
<p>In this case, we’ll be using the ONI data we downloaded earlier in the datawrangling notebook. We’ll also reindex everything to storm year (May-April).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_covariate</span><span class="p">(</span><span class="n">t_monthly_max</span><span class="p">,</span> <span class="n">data_dir</span><span class="p">):</span>
    <span class="n">ONI_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">/</span> <span class="s1">&#39;ONI.csv&#39;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>

    <span class="c1"># drop last 2 columns</span>
    <span class="n">ONI_df</span> <span class="o">=</span> <span class="n">ONI_df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">ONI_df</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Set the Date as the index for easier slicing and access</span>
    <span class="n">ONI_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Reindex to include all necessary dates from t_monthly_max for interpolation</span>
    <span class="n">all_dates</span> <span class="o">=</span> <span class="n">ONI_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">union</span><span class="p">(</span><span class="n">t_monthly_max</span><span class="p">)</span>

    <span class="c1"># Reindex the DataFrame with the union of dates</span>
    <span class="n">ONI_df</span> <span class="o">=</span> <span class="n">ONI_df</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">all_dates</span><span class="p">)</span>

    <span class="c1"># Now interpolate </span>
    <span class="n">ONI_interp_df</span> <span class="o">=</span> <span class="n">ONI_df</span><span class="o">.</span><span class="n">interpolate</span><span class="p">()</span>

    <span class="c1"># retrieve the ONI value for the monthly maxima</span>
    <span class="n">ONI_interp</span> <span class="o">=</span> <span class="n">ONI_interp_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t_monthly_max</span><span class="p">]</span>

    <span class="c1"># Save ONI_interp as &#39;covariate&#39; as a 1D numpy array</span>
    <span class="n">covariate</span> <span class="o">=</span> <span class="n">ONI_interp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">covariate</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">rid</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">rsl_hourly</span><span class="o">.</span><span class="n">station_name</span><span class="p">)):</span>
    <span class="n">df</span><span class="p">,</span> <span class="n">STNDtoMHHW</span><span class="p">,</span> <span class="n">station_name</span> <span class="o">=</span> <span class="n">get_monthly_max_time_series</span><span class="p">(</span><span class="n">rid</span><span class="p">,</span><span class="n">rsl_hourly</span><span class="p">)</span>

    <span class="c1"># add covariate to the data frame</span>
    <span class="n">covariate</span> <span class="o">=</span> <span class="n">get_covariate</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;t_monthly_max&#39;</span><span class="p">],</span> <span class="n">data_dir</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;ONI&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">covariate</span>
    <span class="c1"># save the data frame to a csv file with station record_id</span>
    <span class="n">savename</span> <span class="o">=</span> <span class="s1">&#39;monthly_max_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rsl_hourly</span><span class="o">.</span><span class="n">record_id</span><span class="p">[</span><span class="n">rid</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>
    
    <span class="n">savepath</span> <span class="o">=</span> <span class="n">input_dir</span> <span class="o">/</span> <span class="n">savename</span>
    <span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ii</span> <span class="o">=</span> <span class="mi">3</span>
<span class="n">df</span><span class="p">,</span> <span class="n">STNDtoMHHW</span><span class="p">,</span> <span class="n">station_name</span> <span class="o">=</span> <span class="n">get_monthly_max_time_series</span><span class="p">(</span><span class="n">ii</span><span class="p">,</span><span class="n">rsl_hourly</span><span class="p">)</span>
<span class="n">covariate</span> <span class="o">=</span> <span class="n">get_covariate</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;t_monthly_max&#39;</span><span class="p">],</span> <span class="n">data_dir</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;station_name&quot;</span><span class="p">,</span> <span class="n">station_name</span><span class="p">)</span>
<span class="n">ridString</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">rsl_hourly</span><span class="o">.</span><span class="n">record_id</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>

<span class="n">savename</span> <span class="o">=</span> <span class="s1">&#39;monthly_max_&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">rsl_hourly</span><span class="o">.</span><span class="n">record_id</span><span class="p">[</span><span class="n">ii</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>
<span class="n">savepath</span> <span class="o">=</span> <span class="n">input_dir</span> <span class="o">/</span> <span class="n">savename</span>

<span class="c1"># write the data in the csv to text file for model input</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">savepath</span><span class="p">)</span>

<span class="n">df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;T.txt&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;monthly_max&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;Y.txt&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;ONI&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;CI.txt&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;Honolulu, Hawaii&#39;
</pre></div>
</div>
</div>
</div>
</section>
</section>
</section>
<section id="first-look-modeling-seasonality">
<h2>First look: Modeling Seasonality<a class="headerlink" href="#first-look-modeling-seasonality" title="Permalink to this heading">#</a></h2>
<p>Here we’ll look at seasonality in the location parameter only.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Initial chromosome setup</span>
<span class="n">x_0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Run stepwise optimization and get the last results from the optimization</span>
<span class="c1"># Check first to see if the results are already saved</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;x_s.txt&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">runWithoutModel</span><span class="p">:</span>
    <span class="n">x_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;x_s.txt&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">x_s</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">stepwise</span><span class="p">(</span><span class="n">x_0</span><span class="p">,</span> <span class="n">modelType</span><span class="o">=</span><span class="s1">&#39;GEV_SeasonalMu&#39;</span><span class="p">)</span>
    <span class="n">x</span><span class="p">,</span> <span class="n">f</span> <span class="o">=</span> <span class="n">fitness</span><span class="p">(</span><span class="n">x_s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">modelType</span><span class="o">=</span><span class="s1">&#39;GEV_SeasonalMu&#39;</span><span class="p">)</span>
    <span class="c1"># save x_s to model_output directory</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;x_s.txt&#39;</span><span class="p">,</span> <span class="n">x_s</span><span class="p">)</span>


<span class="c1"># Check if the results are already saved</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;w_s.txt&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">runWithoutModel</span><span class="p">:</span>
    <span class="n">w_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;w_s.txt&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">w_s</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;best.txt&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="c1"># save results to model_output directory</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;w_s.txt&#39;</span><span class="p">,</span> <span class="n">w_s</span><span class="p">)</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;mios.txt&#39;</span><span class="p">):</span>
    <span class="n">mios</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;mios.txt&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">mios</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;mio.txt&#39;</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;mios.txt&#39;</span><span class="p">,</span> <span class="n">mios</span><span class="p">)</span>

<span class="c1"># Assess standard errors of the parameters</span>
<span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">mios</span><span class="p">)</span>
<span class="n">standard_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">J</span><span class="p">))</span>

<span class="n">icromo</span> <span class="o">=</span> <span class="n">x_s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">w_s</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;mio&#39;</span><span class="p">:</span> <span class="n">mios</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;standard_error&#39;</span><span class="p">:</span> <span class="n">standard_error</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x_s</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
<span class="n">savepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_output_dir</span><span class="p">,</span><span class="n">ridString</span><span class="p">,</span> <span class="s1">&#39;seasonal_params.json&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">adjust_w_for_plotting</span><span class="p">(</span><span class="n">icromo</span><span class="p">,</span> <span class="n">w</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjusts the w array based on the icromo conditions and returns an array with 14 elements.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        icromo (list): A list representing the conditions that influence the adjustment of w.</span>
<span class="sd">        w (array-like): An array of values to be adjusted based on icromo.</span>

<span class="sd">    Returns:</span>
<span class="sd">        np.ndarray: A 14-element array with adjusted values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Initialize the output array with 14 elements set to zero</span>
    <span class="n">w_s_plot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">14</span><span class="p">)</span>

    <span class="c1"># Ensure icromo is 7 elements long</span>
    <span class="n">icromo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">icromo</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">icromo</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">7</span><span class="p">:</span>
        <span class="c1"># Fill the rest with zeros</span>
        <span class="n">icromo</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">icromo</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">7</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">icromo</span><span class="p">)))</span>

    <span class="c1"># Always present terms (mu, psi, xi)</span>
    <span class="n">w_s_plot</span><span class="p">[:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">:</span><span class="mi">4</span><span class="p">]</span>
    
    <span class="c1"># Initialize the index for the input w</span>
    <span class="n">idx</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="c1"># Assign terms based on icromo conditions</span>
    <span class="k">if</span> <span class="n">icromo</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># annual</span>
        <span class="n">w_s_plot</span><span class="p">[</span><span class="mi">3</span><span class="p">:</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>
        
    <span class="k">if</span> <span class="n">icromo</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># semiannual</span>
        <span class="n">w_s_plot</span><span class="p">[</span><span class="mi">5</span><span class="p">:</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">icromo</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1">#triannual</span>
        <span class="n">w_s_plot</span><span class="p">[</span><span class="mi">7</span><span class="p">:</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>

    <span class="k">if</span> <span class="n">icromo</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># long-term trend</span>
        <span class="n">w_s_plot</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">icromo</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1"># covariate, location</span>
        <span class="n">w_s_plot</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">icromo</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1">#covariate, scale</span>
        <span class="n">w_s_plot</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">if</span> <span class="n">icromo</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span> <span class="c1">#nodal</span>
        <span class="n">w_s_plot</span><span class="p">[</span><span class="mi">12</span><span class="p">:</span><span class="mi">14</span><span class="p">]</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="n">idx</span><span class="p">:</span><span class="n">idx</span><span class="o">+</span><span class="mi">2</span><span class="p">]</span>
        <span class="n">idx</span> <span class="o">+=</span> <span class="mi">2</span>

    <span class="c1"># Return the adjusted array with 14 elements</span>
    <span class="k">return</span> <span class="n">w_s_plot</span>
</pre></div>
</div>
</div>
</details>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">w_s_plot</span> <span class="o">=</span> <span class="n">adjust_w_for_plotting</span><span class="p">(</span><span class="n">icromo</span><span class="p">,</span><span class="n">w_s</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="extract-a-timeseries-of-the-time-dependent-return-values">
<h3>Extract a timeseries of the time-dependent return values<a class="headerlink" href="#extract-a-timeseries-of-the-time-dependent-return-values" title="Permalink to this heading">#</a></h3>
<p>For each time in a timeseries, we’ll evaluate the CDF of the time-dependent GEV at a given return period to get the expected return level.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">getTimeDependentReturnValue</span><span class="p">(</span><span class="n">T0</span><span class="p">,</span><span class="n">serieCV0</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">ReturnPeriod</span><span class="p">):</span>
    <span class="n">T</span><span class="o">=</span><span class="n">T0</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">ReturnPeriod</span>
    <span class="n">serieCV</span><span class="o">=</span><span class="n">serieCV0</span>
    <span class="n">dx</span><span class="o">=</span><span class="mf">0.02</span>
    <span class="n">t2</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">T</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span><span class="n">dx</span><span class="p">)</span>
    
    <span class="n">years</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">floor</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">T</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span>

    <span class="n">psi</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">xi</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>


    <span class="n">YR</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">ReturnPeriod</span><span class="p">),</span><span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">ReturnPeriod</span><span class="p">):</span>
        <span class="n">x0</span><span class="o">=</span><span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1">#initial value of return value in the iteraction</span>

        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">years</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
            <span class="n">t00</span><span class="o">=</span><span class="n">years</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
            <span class="n">t11</span><span class="o">=</span><span class="n">years</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>
            <span class="k">def</span> <span class="nf">Quantilentime</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>

                <span class="c1"># Variables previously defined as global in MATLAB, handled here locally</span>
                <span class="n">b0</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">b3</span><span class="p">,</span> <span class="n">b4</span><span class="p">,</span> <span class="n">b5</span><span class="p">,</span> <span class="n">b6</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">4</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">5</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">6</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">7</span><span class="p">],</span> <span class="n">w</span><span class="p">[</span><span class="mi">8</span><span class="p">]</span>
                <span class="n">a0</span> <span class="o">=</span> <span class="n">w</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">km</span> <span class="o">=</span> <span class="mi">12</span>
                <span class="n">dt</span> <span class="o">=</span> <span class="mf">0.001</span>
                <span class="n">ti</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">t00</span><span class="p">,</span> <span class="n">t11</span><span class="p">,</span> <span class="n">dt</span><span class="p">)</span>
                <span class="n">bLT</span><span class="o">=</span> <span class="mi">0</span>
                <span class="n">bCI</span><span class="o">=</span> <span class="mi">0</span>
                <span class="n">aCI</span><span class="o">=</span> <span class="mi">0</span>
                <span class="n">bN1</span><span class="o">=</span><span class="mi">0</span>
                <span class="n">bN2</span><span class="o">=</span><span class="mi">0</span>

                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">10</span><span class="p">:</span>
                    <span class="n">bLT</span><span class="o">=</span><span class="n">w</span><span class="p">[</span><span class="mi">9</span><span class="p">]</span> <span class="c1">#trend in location parameter</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">11</span><span class="p">:</span>    
                    <span class="n">bCI</span><span class="o">=</span><span class="n">w</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="c1">#covariate in location parameter</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">12</span><span class="p">:</span>    
                    <span class="n">aCI</span><span class="o">=</span><span class="n">w</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="c1">#covariate in scale parameter</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">w</span><span class="p">)</span><span class="o">&gt;=</span><span class="mi">13</span><span class="p">:</span>
                    <span class="n">bN1</span><span class="o">=</span><span class="n">w</span><span class="p">[</span><span class="mi">12</span><span class="p">]</span>
                    <span class="n">bN2</span><span class="o">=</span><span class="n">w</span><span class="p">[</span><span class="mi">13</span><span class="p">]</span>

                <span class="c1"># Interpolate serieCV at ti points</span>
                <span class="n">serieCV2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">ti</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">serieCV</span><span class="p">)</span>
                <span class="c1"># Replace NaNs with zero (np.interp does this by default if outside the bounds)</span>
                <span class="n">serieCV2</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">serieCV2</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="c1"># Define mut and other parameters</span>
                <span class="n">mut</span> <span class="o">=</span> <span class="p">(</span><span class="n">b0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">bLT</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span>
                       <span class="n">b1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span> <span class="n">b2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span>
                       <span class="n">b3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span> <span class="n">b4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span>
                       <span class="n">b5</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span> <span class="n">b6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">8</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span>
                       <span class="n">bN1</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">18.61</span><span class="p">)</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span> <span class="n">bN2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">((</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">/</span> <span class="mf">18.61</span><span class="p">)</span> <span class="o">*</span> <span class="n">ti</span><span class="p">)</span> <span class="o">+</span>
                       <span class="p">(</span><span class="n">bCI</span> <span class="o">*</span> <span class="n">serieCV2</span><span class="p">))</span>
                <span class="c1"># mut = ((b0  +</span>
                <span class="c1">#        b1 * np.cos(2 * np.pi * ti) + b2 * np.sin(2 * np.pi * ti) +</span>
                <span class="c1">#        b3 * np.cos(4 * np.pi * ti) + b4 * np.sin(4 * np.pi * ti) +</span>
                <span class="c1">#        b5 * np.cos(8 * np.pi * ti) + b6 * np.sin(8 * np.pi * ti))* np.exp(bLT * ti) + </span>
                <span class="c1">#        bN1 * np.cos((2 * np.pi / 18.61) * ti) + bN2 * np.sin((2 * np.pi / 18.61) * ti) +</span>
                <span class="c1">#        (bCI * serieCV2))</span>
                <span class="n">psi</span> <span class="o">=</span> <span class="n">a0</span> <span class="o">+</span> <span class="p">(</span><span class="n">aCI</span> <span class="o">*</span> <span class="n">serieCV2</span><span class="p">)</span>
                <span class="n">xit</span> <span class="o">=</span> <span class="n">xi</span>

                <span class="c1"># Calculate factor</span>
                <span class="n">factor</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ti</span><span class="p">)):</span>
                    <span class="n">h</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">xit</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">mut</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">/</span> <span class="n">psi</span><span class="p">[</span><span class="n">i</span><span class="p">]),</span> <span class="mf">0.0001</span><span class="p">)</span> <span class="o">**</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="n">xit</span><span class="p">)</span>
                    <span class="n">factor</span> <span class="o">+=</span> <span class="n">h</span>
                <span class="n">Pr</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span>
                <span class="n">y</span> <span class="o">=</span> <span class="o">-</span><span class="n">Pr</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">km</span> <span class="o">*</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">dt</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">y</span>

            <span class="n">YR</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">brentq</span><span class="p">(</span><span class="n">Quantilentime</span><span class="p">,</span><span class="n">x0</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span><span class="n">x0</span><span class="o">+</span><span class="mi">2</span><span class="p">)</span>
            <span class="n">x0</span><span class="o">=</span><span class="n">YR</span><span class="p">[</span><span class="n">idx</span><span class="p">,</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">years</span><span class="p">,</span> <span class="n">YR</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="plot-monthly-extremes-and-given-year-return-period-with-the-seasonal-model">
<h3>Plot monthly extremes and given year return period with the seasonal model<a class="headerlink" href="#plot-monthly-extremes-and-given-year-return-period-with-the-seasonal-model" title="Permalink to this heading">#</a></h3>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">cmap</span> <span class="o">=</span> <span class="n">plottingExtremeSeasonality</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;monthly_max&#39;</span><span class="p">],</span><span class="n">w_s_plot</span><span class="p">,</span><span class="n">ReturnPeriod</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">],</span><span class="n">SampleRate</span><span class="o">=</span><span class="mi">12</span><span class="p">)</span>

<span class="c1"># sss.set_xlabel(&#39;Month in Year&#39;)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Sea level extremes at &#39;</span> <span class="o">+</span> <span class="n">station_name</span><span class="p">)</span>

<span class="c1"># save the figure</span>
<span class="n">savename</span> <span class="o">=</span> <span class="s1">&#39;SeasonalExtremeVariations_&#39;</span><span class="o">+</span> <span class="n">ridString</span> <span class="o">+</span><span class="s1">&#39;.png&#39;</span>
<span class="n">savedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">savename</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savedir</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;seasonal_extreme_variations&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<img alt="../../_images/bc7f74d07b2893ec27c0f4818d3a036d26cab24ce3c73bfc5b30bdfbb21c2065.png" src="../../_images/bc7f74d07b2893ec27c0f4818d3a036d26cab24ce3c73bfc5b30bdfbb21c2065.png" />
</div>
</details>
</div>
<figure class="align-default" id="seasonal-extreme-variations">
<img alt="../../_images/bc7f74d07b2893ec27c0f4818d3a036d26cab24ce3c73bfc5b30bdfbb21c2065.png" src="../../_images/bc7f74d07b2893ec27c0f4818d3a036d26cab24ce3c73bfc5b30bdfbb21c2065.png" />
<figcaption>
<p><span class="caption-number">Fig. 9 </span><span class="caption-text">A climatology of extreme sea levels at the <span class="pasted-text">Honolulu, Hawaii</span> tide gauge. Monthly maxima (+), determined from hourly sea level data, are shown from 1993-2023. The solid line corresponds to projected sea level return levels at 2,10,50 and 100 years, using this 30-year chunk of data. This line uses a nonstationary GEV to take the seasonal variations of sea level into account. The 2, 10, 50 and 100-year return levels are shown to vary throughout the year (dashed line), with the lowest extremes occuring in March, and highest extremes peaking in July. No long-term trend is used in this model, and the scale and location parameters are held constant.</span><a class="headerlink" href="#seasonal-extreme-variations" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
<section id="check-if-we-should-include-a-long-term-trend-mean-sea-level-rise-in-our-location-parameter">
<h3>Check if we should include a long-term trend (mean sea level rise) in our location parameter<a class="headerlink" href="#check-if-we-should-include-a-long-term-trend-mean-sea-level-rise-in-our-location-parameter" title="Permalink to this heading">#</a></h3>
<p>I mean, it’s probably statistically significant, but hey, we should test just in case.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">chi2</span>

<span class="n">x_T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x_s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>  <span class="c1"># Long-term Trend</span>

<span class="c1"># Check if the results are already saved</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;w_T.txt&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">runWithoutModel</span><span class="p">:</span>
    <span class="n">w_T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;w_T.txt&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">f_T</span> <span class="o">=</span> <span class="n">fitness</span><span class="p">(</span><span class="n">x_T</span><span class="p">,</span> <span class="n">modelType</span><span class="o">=</span><span class="s1">&#39;GEV_S_T_Cv&#39;</span><span class="p">)</span>
    <span class="n">w_T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;best.txt&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">mio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;mio.txt&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;w_T.txt&#39;</span><span class="p">,</span> <span class="n">w_T</span><span class="p">)</span>

<span class="n">aux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;limits.txt&#39;</span><span class="p">)</span>
<span class="c1"># check to see if within limits</span>
<span class="n">wT</span> <span class="o">=</span> <span class="n">w_T</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wT</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">wT</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">aux</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">wT</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">aux</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Trend Run: Parameter #</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1"> is at the limit: </span><span class="si">{</span><span class="n">wT</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>


<span class="c1"># Assess standard errors of the parameters</span>
<span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">mio</span><span class="p">)</span>
<span class="n">standard_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">J</span><span class="p">))</span>

<span class="n">diffe</span> <span class="o">=</span> <span class="n">w_T</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">w_s</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">SignifTrend</span> <span class="o">=</span> <span class="n">chi2</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">diffe</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Statistical Significance of Linear Trend: </span><span class="si">{</span><span class="n">SignifTrend</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Estimated Trend on monthly Maxima values is: </span><span class="si">{</span><span class="n">w_T</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">w_T</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="mi">1000</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> mm/year&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x_s is: </span><span class="si">{</span><span class="n">x_s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x_T is: </span><span class="si">{</span><span class="n">x_T</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;w_T is: </span><span class="si">{</span><span class="n">w_T</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">w_T</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;mio&#39;</span><span class="p">:</span> <span class="n">mio</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;standard_error&#39;</span><span class="p">:</span> <span class="n">standard_error</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x_T</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
<span class="n">savepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_output_dir</span><span class="p">,</span><span class="n">ridString</span><span class="p">,</span> <span class="s1">&#39;trend_params.json&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Statistical Significance of Linear Trend: 100.00%
Estimated Trend on monthly Maxima values is: 2.97 mm/year
x_s is: [1 1 0]
x_T is: [1 1 0 1 0 0]
w_T is: [ 4.67039758e+02  1.85962112e+00  6.66646400e-02 -2.22472000e-01
 -4.22099000e-03 -4.67291700e-02  5.26789800e-02 -6.08231000e-03
  1.59690000e-03]
</pre></div>
</div>
</div>
</div>
<section id="check-the-covariate-in-the-location-parameter">
<h4>Check the covariate in the location parameter.<a class="headerlink" href="#check-the-covariate-in-the-location-parameter" title="Permalink to this heading">#</a></h4>
<p>Let’s check if the covariate inclusion in the location parameter is statistically significant.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">SignifTrend</span> <span class="o">&gt;</span> <span class="mf">0.95</span><span class="p">:</span>
    <span class="n">x_cvte1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x_s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>  <span class="c1"># Covariate</span>
    <span class="n">wcomp</span> <span class="o">=</span> <span class="n">w_T</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">x_cvte1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x_s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="n">wcomp</span> <span class="o">=</span> <span class="n">w_s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Check if the results are already saved</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">model_output_dir</span> <span class="o">/</span> <span class="n">ridString</span> <span class="o">/</span><span class="s1">&#39;w_cvte1.txt&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">runWithoutModel</span><span class="p">:</span>
    <span class="n">w_cvte1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="n">model_output_dir</span> <span class="o">/</span> <span class="n">ridString</span> <span class="o">/</span> <span class="s1">&#39;w_cvte1.txt&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">f_cvte1</span> <span class="o">=</span> <span class="n">fitness</span><span class="p">(</span><span class="n">x_cvte1</span><span class="p">,</span> <span class="n">modelType</span><span class="o">=</span><span class="s1">&#39;GEV_S_T_Cv&#39;</span><span class="p">)</span>
    <span class="n">w_cvte1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;best.txt&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">mio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;mio.txt&#39;</span><span class="p">,</span><span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="n">model_output_dir</span> <span class="o">/</span> <span class="n">ridString</span> <span class="o">/</span> <span class="s1">&#39;w_cvte1.txt&#39;</span><span class="p">,</span> <span class="n">w_cvte1</span><span class="p">)</span>

<span class="c1"># Assess standard errors of the parameters</span>
<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">mio</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">mio</span><span class="p">)</span>
    <span class="n">standard_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">J</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">standard_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nans</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w_cvte1</span><span class="p">))</span>

<span class="n">diffe</span> <span class="o">=</span> <span class="n">w_cvte1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">wcomp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">SignifCvte1</span> <span class="o">=</span> <span class="n">chi2</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">diffe</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Statistical Significance of Covariate in location param.: </span><span class="si">{</span><span class="n">SignifCvte1</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x_cvte1 is: </span><span class="si">{</span><span class="n">x_cvte1</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">w_cvte1</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;mio&#39;</span><span class="p">:</span> <span class="n">mio</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;standard_error&#39;</span><span class="p">:</span> <span class="n">standard_error</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x_cvte1</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
<span class="n">savepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_output_dir</span><span class="p">,</span><span class="n">ridString</span><span class="p">,</span> <span class="s1">&#39;cvte_location_params.json&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Statistical Significance of Covariate in location param.: 54.60%
x_cvte1 is: [1 1 0 1 1 0]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="check-the-covariate-in-scale-parameter">
<h3>Check the covariate in scale parameter<a class="headerlink" href="#check-the-covariate-in-scale-parameter" title="Permalink to this heading">#</a></h3>
<p>Let’s check if the covariate inclusion in the scale parameter is statistically significant.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">SignifCvte1</span> <span class="o">&gt;</span> <span class="mf">0.95</span><span class="p">:</span>
    <span class="n">x_cvte2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x_cvte1</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="p">[</span><span class="mi">1</span><span class="p">]))</span>  <span class="c1"># Covariate</span>
    <span class="n">wcomp</span> <span class="o">=</span> <span class="n">w_cvte1</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">x_cvte2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">((</span><span class="n">x_cvte1</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">]))</span>  <span class="c1"># Covariate</span>
    <span class="n">wcomp</span> <span class="o">=</span> <span class="n">wcomp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Check if the results are already saved</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;w_cvte2.txt&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">runWithoutModel</span><span class="p">:</span>
    <span class="n">w_cvte2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;w_cvte2.txt&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">f_cvte2</span> <span class="o">=</span> <span class="n">fitness</span><span class="p">(</span><span class="n">x_cvte2</span><span class="p">,</span> <span class="n">modelType</span><span class="o">=</span><span class="s1">&#39;GEV_S_T_Cv&#39;</span><span class="p">)</span>
    <span class="n">w_cvte2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;best.txt&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">mio</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;mio.txt&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;w_cvte2.txt&#39;</span><span class="p">,</span> <span class="n">w_cvte2</span><span class="p">)</span>

<span class="n">diffe</span> <span class="o">=</span> <span class="n">w_cvte2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">wcomp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">1</span>
<span class="n">SignifCvte2</span> <span class="o">=</span> <span class="n">chi2</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">diffe</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="c1"># Assess standard errors of the parameters</span>
<span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">det</span><span class="p">(</span><span class="n">mio</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
    <span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">mio</span><span class="p">)</span>
    <span class="n">standard_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">J</span><span class="p">))</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">standard_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">w_cvte2</span><span class="p">))</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Statistical Significance of Covariate in scale param.: </span><span class="si">{</span><span class="n">SignifCvte2</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x_cvte2 is: </span><span class="si">{</span><span class="n">x_cvte2</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">w_cvte2</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;mio&#39;</span><span class="p">:</span> <span class="n">mio</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;standard_error&#39;</span><span class="p">:</span> <span class="n">standard_error</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x_cvte2</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
<span class="n">savepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_output_dir</span><span class="p">,</span><span class="n">ridString</span><span class="p">,</span> <span class="s1">&#39;cvte_scale_params.json&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Statistical Significance of Covariate in scale param.: 40.86%
x_cvte2 is: [1 1 0 1 0 1]
</pre></div>
</div>
</div>
</div>
</section>
<section id="check-the-nodal-cycle-in-location-parameter">
<h3>Check the nodal cycle in Location parameter<a class="headerlink" href="#check-the-nodal-cycle-in-location-parameter" title="Permalink to this heading">#</a></h3>
<p>We will only include the nodal cycle in our final model if adding it significantly improves our model thus far. We will add it to the long-term trend model if the long-term trend is significant.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">SignifTrend</span><span class="o">&gt;</span><span class="mf">0.95</span><span class="p">:</span>
    <span class="n">x_N</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_T</span> <span class="p">,</span> <span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">wcomp</span><span class="o">=</span><span class="n">w_T</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The trend is significant! </span><span class="se">\n</span><span class="s1">Include long-term trend and nodal cycle in final model.&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">x_N</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">x_s</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">])</span>
    <span class="n">wcomp</span><span class="o">=</span><span class="n">w_s</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Check if the results are already saved</span>
<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s1">&#39;w_N.txt&#39;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">runWithoutModel</span><span class="p">:</span>
    <span class="n">w_N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;w_N.txt&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">mioN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;mioN.txt&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">f_N</span> <span class="o">=</span> <span class="n">fitness</span><span class="p">(</span><span class="n">x_N</span><span class="p">,</span> <span class="n">modelType</span><span class="o">=</span><span class="s1">&#39;GEV_S_T_Cv_Nodal&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;x_N is: </span><span class="si">{</span><span class="n">x_N</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">w_N</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;best.txt&#39;</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
    <span class="n">mioN</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;mio.txt&#39;</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;w_N.txt&#39;</span><span class="p">,</span> <span class="n">w_N</span><span class="p">)</span>
    <span class="n">np</span><span class="o">.</span><span class="n">savetxt</span><span class="p">(</span><span class="s1">&#39;mioN.txt&#39;</span><span class="p">,</span> <span class="n">mioN</span><span class="p">)</span>


<span class="n">wN</span> <span class="o">=</span> <span class="n">w_N</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">wN</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">wN</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">aux</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span> <span class="ow">or</span> <span class="n">wN</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">==</span> <span class="n">aux</span><span class="p">[</span><span class="n">j</span><span class="p">,</span> <span class="mi">1</span><span class="p">]:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Nodal Run: Parameter #</span><span class="si">{</span><span class="n">j</span><span class="si">}</span><span class="s1"> is at the limit: </span><span class="si">{</span><span class="n">wN</span><span class="p">[</span><span class="n">j</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    

<span class="n">diffe</span> <span class="o">=</span> <span class="n">w_N</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">wcomp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">p</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">SignifN</span> <span class="o">=</span> <span class="n">chi2</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">diffe</span><span class="p">,</span> <span class="n">p</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Statistical Significance of adding Nodal cycle: </span><span class="si">{</span><span class="n">SignifN</span><span class="o">*</span><span class="mi">100</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">%&#39;</span><span class="p">)</span>

<span class="n">xcromo</span> <span class="o">=</span> <span class="n">x_N</span>
<span class="n">wc</span> <span class="o">=</span> <span class="n">w_N</span>

<span class="k">if</span> <span class="n">SignifN</span><span class="o">&lt;</span><span class="mf">0.95</span><span class="p">:</span>
    <span class="n">xcromo</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># set the nodal component to zero</span>
    <span class="n">wc</span> <span class="o">=</span> <span class="n">wcomp</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span> <span class="c1"># use the previous model</span>

<span class="c1"># Assess standard errors of the parameters</span>
<span class="n">J</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">mioN</span><span class="p">)</span>
<span class="n">standard_error</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diag</span><span class="p">(</span><span class="n">J</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;w_N: </span><span class="si">{</span><span class="n">wc</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="c1"># save w_N, mioN, standard_error, x_N as json file</span>
<span class="n">output</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;w&#39;</span><span class="p">:</span> <span class="n">w_N</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;mio&#39;</span><span class="p">:</span> <span class="n">mioN</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;standard_error&#39;</span><span class="p">:</span> <span class="n">standard_error</span><span class="o">.</span><span class="n">tolist</span><span class="p">(),</span> <span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x_N</span><span class="o">.</span><span class="n">tolist</span><span class="p">()}</span>
<span class="n">savepath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">model_output_dir</span><span class="p">,</span><span class="n">ridString</span><span class="p">,</span> <span class="s1">&#39;nodal_params.json&#39;</span><span class="p">)</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">savepath</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">f</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The trend is significant! 
Include long-term trend and nodal cycle in final model.
x_N is: [1 1 0 1 0 0 1]
Statistical Significance of adding Nodal cycle: 99.88%
w_N: [ 4.7373511e+02  1.8658365e+00  6.5572790e-02 -2.2047758e-01
 -3.7349800e-03 -4.6138760e-02  5.3018100e-02 -5.4962600e-03
  1.3941500e-03 -1.5960120e-02 -8.2272200e-03]
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="plot-the-timeseries">
<h2>Plot the timeseries<a class="headerlink" href="#plot-the-timeseries" title="Permalink to this heading">#</a></h2>
<p>We’ll first extract all the relevant return levels for various models.</p>
<aside class="margin sidebar">
<p class="sidebar-title"></p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Still toying with this!</p>
</div>
</aside>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># %%</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="c1"># # Plotting model with only time-dependency within the year (Seasonality only)</span>
<span class="c1"># best_param = np.append(w_s[1:], [0, 0, 0])</span>
<span class="n">best_param</span> <span class="o">=</span> <span class="n">adjust_w_for_plotting</span><span class="p">(</span><span class="n">x_s</span><span class="p">,</span> <span class="n">w_s</span><span class="p">)</span>
<span class="n">ReturnPeriod</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span>
<span class="c1"># years, Yr_s = getTimeDependentReturnValue(t, covariate, best_param,ReturnPeriod)</span>
<span class="c1"># for i in range(len(ReturnPeriod)):</span>
<span class="c1">#     sss.plot(years[:-1]+0.5+year0, Yr_s[i]-STNDtoMHHW, &#39;k&#39;, linewidth=2, label=&#39;S, &#39;+str(ReturnPeriod[i])+&#39;y&#39;)</span>

<span class="c1"># # Plotting model with Seasonality &amp; Trend</span>
<span class="n">best_T</span> <span class="o">=</span> <span class="n">adjust_w_for_plotting</span><span class="p">(</span><span class="n">x_T</span><span class="p">,</span> <span class="n">w_T</span><span class="p">)</span>
<span class="c1"># print(best_param)</span>
<span class="n">years</span><span class="p">,</span> <span class="n">Yr_T</span> <span class="o">=</span> <span class="n">getTimeDependentReturnValue</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">covariate</span><span class="p">,</span> <span class="n">best_T</span><span class="p">,</span><span class="n">ReturnPeriod</span><span class="p">)</span>
<span class="c1"># for i in range(len(ReturnPeriod)):</span>
<span class="c1">#     sss.plot(years[:-1]+0.5+year0, Yr_T[i]-STNDtoMHHW, &#39;b&#39;, linewidth=2, label=&#39;S,T:&#39; + str(ReturnPeriod[i])+&#39;y&#39;)</span>

<span class="c1"># Plotting cvte influence in location</span>
<span class="n">best_smu</span> <span class="o">=</span> <span class="n">adjust_w_for_plotting</span><span class="p">(</span><span class="n">x_cvte1</span><span class="p">,</span><span class="n">w_cvte1</span><span class="p">)</span>
<span class="c1"># years, Yr_sigMu = getTimeDependentReturnValue(t, covariate, best_smu,ReturnPeriod)</span>
<span class="c1"># sss.plot(years[:-1]+0.5+year0, Yr_sigMu[0]-STNDtoMHHW, &#39;g&#39;, linewidth=1, label=&#39;Covariate_location&#39;)</span>

<span class="c1"># Plotting cvte influence in scale</span>
<span class="n">best_spsi</span> <span class="o">=</span> <span class="n">adjust_w_for_plotting</span><span class="p">(</span><span class="n">x_cvte2</span><span class="p">,</span> <span class="n">w_cvte2</span><span class="p">)</span>
<span class="n">years</span><span class="p">,</span> <span class="n">Yr_sigPsi</span> <span class="o">=</span> <span class="n">getTimeDependentReturnValue</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">covariate</span><span class="p">,</span> <span class="n">best_spsi</span><span class="p">,</span><span class="n">ReturnPeriod</span><span class="p">)</span>
<span class="c1"># sss.plot(years[:-1]+0.5+year0, Yr_sigPsi[0]-STNDtoMHHW, &#39;c&#39;, linewidth=1, label=&#39;Covariate_scale&#39;)</span>

<span class="c1"># Plotting nodal cycle in location, will need to add back in the covariate terms as zeros</span>
<span class="n">best_MuN</span> <span class="o">=</span> <span class="n">adjust_w_for_plotting</span><span class="p">(</span><span class="n">x_N</span><span class="p">,</span><span class="n">w_N</span><span class="p">)</span>
<span class="n">years</span><span class="p">,</span> <span class="n">Yr_muN</span> <span class="o">=</span> <span class="n">getTimeDependentReturnValue</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">covariate</span><span class="p">,</span> <span class="n">best_MuN</span><span class="p">,</span><span class="n">ReturnPeriod</span><span class="p">)</span>

<span class="c1"># get error bars</span>
<span class="n">best_MuN</span> <span class="o">=</span> <span class="n">adjust_w_for_plotting</span><span class="p">(</span><span class="n">x_N</span><span class="p">,</span><span class="n">w_N</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">standard_error</span><span class="p">]))</span>
<span class="n">years</span><span class="p">,</span> <span class="n">Yr_muN_low</span> <span class="o">=</span> <span class="n">getTimeDependentReturnValue</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">covariate</span><span class="p">,</span> <span class="n">best_MuN</span><span class="p">,</span><span class="n">ReturnPeriod</span><span class="p">)</span>


<span class="c1"># get error bars</span>
<span class="n">best_MuN</span> <span class="o">=</span> <span class="n">adjust_w_for_plotting</span><span class="p">(</span><span class="n">x_N</span><span class="p">,</span><span class="n">w_N</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">standard_error</span><span class="p">]))</span>
<span class="n">years</span><span class="p">,</span> <span class="n">Yr_muN_high</span> <span class="o">=</span> <span class="n">getTimeDependentReturnValue</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">covariate</span><span class="p">,</span> <span class="n">best_MuN</span><span class="p">,</span><span class="n">ReturnPeriod</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get error bars</span>
<span class="c1"># best_MuN = adjust_w_for_plotting(x_N,w_N-2*[0,standard_error])</span>
<span class="n">w_N_high</span> <span class="o">=</span> <span class="n">w_N</span><span class="o">+</span><span class="mi">2</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span><span class="n">standard_error</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<section id="plot-it-up">
<h3>Plot it up<a class="headerlink" href="#plot-it-up" title="Permalink to this heading">#</a></h3>
<p>For now we’ll use only the nodal + long-term trend + seasonality model.</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input above-output-prompt docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get the first year of t_monthly_max</span>
<span class="n">year0</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;t_monthly_max&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">year</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;year0&quot;</span><span class="p">,</span> <span class="n">year0</span><span class="p">)</span>

<span class="n">year0plot</span> <span class="o">=</span> <span class="mi">1993</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
<span class="n">sss</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="n">sss</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="o">+</span><span class="n">year0</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;monthly_max&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span><span class="o">-</span><span class="n">STNDtoMHHW</span><span class="p">,</span> <span class="s1">&#39;+k&#39;</span><span class="p">,</span> <span class="n">markersize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Monthly Maxima&#39;</span><span class="p">)</span>

<span class="c1"># cmap = plt.get_cmap(&#39;viridis&#39;)</span>

<span class="c1"># Generate a list of colors from the colormap</span>
<span class="c1"># colors = [cmap(i / (len(ReturnPeriod) - 1)) for i in range(len(ReturnPeriod))]</span>


<span class="c1"># Find the indices for 2008 and 2020</span>
<span class="n">idx_2008</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">years</span><span class="o">+</span><span class="n">year0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2008</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">idx_2020</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">years</span><span class="o">+</span><span class="n">year0</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2020</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>

<span class="c1"># Yr_MuN slice it for Year 2008 and 2020</span>
<span class="n">Yr_muN_2008</span> <span class="o">=</span> <span class="n">Yr_muN</span><span class="p">[:,</span><span class="n">idx_2008</span><span class="p">]</span> <span class="o">-</span> <span class="n">STNDtoMHHW</span>
<span class="n">Yr_muN_2020</span> <span class="o">=</span> <span class="n">Yr_muN</span><span class="p">[:,</span><span class="n">idx_2020</span><span class="p">]</span> <span class="o">-</span> <span class="n">STNDtoMHHW</span>

<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ReturnPeriod</span><span class="p">)):</span>
    <span class="c1"># add shaded error bars for Yr_muN_high to Yr_muN_low</span>
    <span class="n">sss</span><span class="o">.</span><span class="n">fill_between</span><span class="p">(</span><span class="n">years</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">+</span><span class="n">year0</span><span class="p">,</span> <span class="n">Yr_muN_low</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">STNDtoMHHW</span><span class="p">,</span> <span class="n">Yr_muN_high</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">STNDtoMHHW</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>



<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ReturnPeriod</span><span class="p">)):</span>
    <span class="c1"># color = cmap(i)</span>
    <span class="n">sss</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">years</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="mf">0.5</span><span class="o">+</span><span class="n">year0</span><span class="p">,</span> <span class="n">Yr_muN</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="n">STNDtoMHHW</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">ReturnPeriod</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">+</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
    
    <span class="n">value_2008</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">Yr_muN_2008</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
    <span class="n">value_2020</span> <span class="o">=</span> <span class="nb">format</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">Yr_muN_2020</span><span class="p">[</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">]),</span> <span class="s1">&#39;.2f&#39;</span><span class="p">)</span>
    <span class="n">sss</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">2008</span><span class="p">,</span> <span class="n">Yr_muN_2008</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;2008: </span><span class="si">{</span><span class="n">value_2008</span><span class="si">}</span><span class="s1"> m&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>
    <span class="n">sss</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="mi">2020</span><span class="p">,</span> <span class="n">Yr_muN_2020</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">cmap</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;2020: </span><span class="si">{</span><span class="n">value_2020</span><span class="si">}</span><span class="s1"> m&#39;</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span>

<span class="n">sss</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Sea level (m, MHHW)&#39;</span><span class="p">)</span>
<span class="c1"># add grid</span>
<span class="n">sss</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>


<span class="c1"># add title of station name</span>
<span class="n">sss</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Nonstationary GEV Return Levels: &#39;</span> <span class="o">+</span> <span class="n">station_name</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="c1"># extract the return levels for 2008 and 2020</span>

<span class="c1"># set the x-axis to be years, with minimum year as year0plot</span>
<span class="n">sss</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="n">year0plot</span><span class="p">,</span> <span class="mi">2023</span><span class="p">)</span>


<span class="c1"># add legend outside the plot</span>
<span class="n">sss</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
<span class="c1"># save the figure</span>
<span class="n">savename</span> <span class="o">=</span> <span class="s1">&#39;TimeDependentReturnValue_&#39;</span><span class="o">+</span> <span class="n">ridString</span> <span class="o">+</span><span class="s1">&#39;.png&#39;</span>
<span class="n">savedir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_dir</span><span class="p">,</span> <span class="n">savename</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">savedir</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

<span class="c1"># glue the figure</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;TimeDependentReturnValue&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<details class="hide below-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell output</span>
<span class="expanded">Hide code cell output</span>
</summary>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>1993
</pre></div>
</div>
<img alt="../../_images/ccfaf6eddc98dd1d2f4f32273e4ce0111d435bb4f1fda15ada6ff3df3883e61e.png" src="../../_images/ccfaf6eddc98dd1d2f4f32273e4ce0111d435bb4f1fda15ada6ff3df3883e61e.png" />
</div>
</details>
</div>
<figure class="align-default" id="timedependentreturnvalue">
<img alt="../../_images/ccfaf6eddc98dd1d2f4f32273e4ce0111d435bb4f1fda15ada6ff3df3883e61e.png" src="../../_images/ccfaf6eddc98dd1d2f4f32273e4ce0111d435bb4f1fda15ada6ff3df3883e61e.png" />
<figcaption>
<p><span class="caption-number">Fig. 10 </span><span class="caption-text">Time series of the nonstationary GEV-based extreme water level return values for <span class="pasted-text">Honolulu, Hawaii</span>. The monthly maxima (+) are displayed spanning data from <span class="pasted-text">1993</span> to 2023. The return levels (at 2, 10, 50, and 100 year levels) are shown in solid lines, with the shaded lines bounding +/- the standard error. Years 2008 and 2020 are highlighted on these curves to show the differences in values when taking seasonality, a long-term trend, and the 18.6 nodal-cycle into account. No covariates are used for this particular best-fit model.</span><a class="headerlink" href="#timedependentreturnvalue" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "jwfiedler/SL_Hawaii",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks\nonstationaryGEV"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="../regional_and_local/SL_Components_annual.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Components of Sea Level</p>
      </div>
    </a>
    <a class="right-next"
       href="../Flood.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Minor Flood Frequency and Duration</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cumulative-distribution-function-cdf">Cumulative Distribution Function (CDF)</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#main-functions">Main Functions</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#step-wise-solver">Step-wise solver</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#maximum-likelihood-estimation">Maximum Likelihood Estimation</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#parameter-search">Parameter Search</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonality-in-location-model">Seasonality in Location Model</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonality-trend-and-covariate-model">Seasonality, Trend, and Covariate Model</a></li>
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#seasonality-trend-covariate-and-nodal-cycle-model">Seasonality, Trend, Covariate and Nodal cycle Model</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#input-to-the-fitness-function">Input to the fitness function</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-seasonality-effect-on-extremes">Plot: Seasonality Effect on Extremes</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#format-data-input-to-the-model">Format data input to the model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#adjust-data-for-storm-year">Adjust data for storm year</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#prepare-the-covariate-data-timeseries">Prepare the covariate data timeseries.</a></li>
</ul>
</li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#first-look-modeling-seasonality">First look: Modeling Seasonality</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#extract-a-timeseries-of-the-time-dependent-return-values">Extract a timeseries of the time-dependent return values</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-monthly-extremes-and-given-year-return-period-with-the-seasonal-model">Plot monthly extremes and given year return period with the seasonal model</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-if-we-should-include-a-long-term-trend-mean-sea-level-rise-in-our-location-parameter">Check if we should include a long-term trend (mean sea level rise) in our location parameter</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#check-the-covariate-in-the-location-parameter">Check the covariate in the location parameter.</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-the-covariate-in-scale-parameter">Check the covariate in scale parameter</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-the-nodal-cycle-in-location-parameter">Check the nodal cycle in Location parameter</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-timeseries">Plot the timeseries</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-it-up">Plot it up</a></li>
</ul>
</li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Playground Coordinator
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>