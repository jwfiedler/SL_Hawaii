

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Annual Extremes &#8212; Hawaii Sea Level Indicators</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.1/css/all.min.css?digest=8d27b9dea8ad943066ae" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.1/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae" />
  <script src="../../_static/vendor/fontawesome/6.5.1/js/all.min.js?digest=8d27b9dea8ad943066ae"></script>

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script async="async" kind="hypothesis" src="https://hypothes.is/embed.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/regional_and_local/SL_Extremes_annual';</script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Components of Sea Level" href="SL_Components_annual.html" />
    <link rel="prev" title="Annual Sea Level Rankings" href="SL_Rankings_annual.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a id="pst-skip-link" class="skip-link" href="#main-content">Skip to main content</a>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>
    Back to top
  </button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>


  <div class="bd-header-announcement container-fluid bd-header-announcement">
    <div class="bd-header-announcement__content">In development! Please post issues and suggestions to github.</div>
  </div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/trend_map.png" class="logo__image only-light" alt="Hawaii Sea Level Indicators - Home"/>
    <script>document.write(`<img src="../../_static/trend_map.png" class="logo__image only-dark" alt="Hawaii Sea Level Indicators - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn navbar-btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../../gettingStarted.html">Getting Started</a><input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-1"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../setup.html">Setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../SL_Data_Wrangling.html">Data Wrangling</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">ANNUAL</span></p>
<ul class="current nav bd-sidenav">
<li class="toctree-l1 current active has-children"><a class="reference internal" href="../SL_annual.html">Sea Level Magnitude</a><input checked="" class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-2"><i class="fa-solid fa-chevron-down"></i></label><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="SL_Trend.html">Sea Level Trend</a></li>
<li class="toctree-l2"><a class="reference internal" href="SL_anomaly_annual.html">Annual Sea Level Anomalies</a></li>
<li class="toctree-l2"><a class="reference internal" href="SL_Rankings_annual.html">Annual Sea Level Rankings</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Annual Extremes</a></li>
<li class="toctree-l2"><a class="reference internal" href="SL_Components_annual.html">Components of Sea Level</a></li>
<li class="toctree-l2"><a class="reference internal" href="../nonstationaryGEV/monthly_extremes_non-stationaryGEV.html">Nonstationary Extremes</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Flood.html">Minor Flood Frequency and Duration</a><input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-3"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../FloodFrequency.html">Minor Flood Frequency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FloodDuration.html">Flood Duration</a></li>
</ul>
</li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">INTRA-ANNUAL</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../SL_intra-annual.html">Sea Level Magnitude</a><input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-4"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="SL_anomaly_intra-annual.html">Intra-Annual Sea Level Anomalies</a></li>
<li class="toctree-l2"><a class="reference internal" href="SL_Extremes_intra-annual.html">Intra-Annual Extremes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../contributions.html">Contributions</a></li>
</ul>
</li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../Flood_intra-annual.html">Minor Flood Frequency and Duration</a><input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/><label class="toctree-toggle" for="toctree-checkbox-5"><i class="fa-solid fa-chevron-down"></i></label><ul>
<li class="toctree-l2"><a class="reference internal" href="../FloodFrequency_intra-annual.html">Minor Flood Frequency</a></li>
<li class="toctree-l2"><a class="reference internal" href="../FloodDuration_intra-annual.html">Flood Duration</a></li>
</ul>
</li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/jwfiedler/SL_Hawaii/main?urlpath=tree/notebooks/regional_and_local/SL_Extremes_annual.ipynb" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch onBinder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/jwfiedler/SL_Hawaii" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jwfiedler/SL_Hawaii/edit/main/notebooks/regional_and_local/SL_Extremes_annual.ipynb" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/jwfiedler/SL_Hawaii/issues/new?title=Issue%20on%20page%20%2Fnotebooks/regional_and_local/SL_Extremes_annual.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/regional_and_local/SL_Extremes_annual.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm navbar-btn theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch nav-link" data-mode="light"><i class="fa-solid fa-sun fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="dark"><i class="fa-solid fa-moon fa-lg"></i></span>
    <span class="theme-switch nav-link" data-mode="auto"><i class="fa-solid fa-circle-half-stroke fa-lg"></i></span>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Annual Extremes</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#obtain-daily-and-hourly-datasets">Obtain Daily and Hourly datasets</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-process-the-data">Pre-process the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-outliers-and-obtain-trend">Remove outliers and obtain trend</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-the-model-and-extract-the-extreme-values">Create the model, and extract the extreme values.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-the-model">Fit the model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-get-a-closer-look-at-the-return-level-curve">Let’s get a closer look at the return level curve</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-return-periods-of-2-10-50-and-100-years">Get return periods of 2, 10, 50 and 100 years</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#make-an-intergrated-rankings-return-periods-table">Make an intergrated rankings + return periods table</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#first-make-the-rankings-list">First make the rankings list</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#format-the-merged-rankings-and-return-period-table">Format the merged rankings and return period table</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#make-a-map">Make a map</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-return-periods-at-each-station">Plot the Return Periods at each station</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-a-timeseries">Plot a timeseries</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="annual-extremes">
<h1>Annual Extremes<a class="headerlink" href="#annual-extremes" title="Permalink to this heading">#</a></h1>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>IN DEVELOPMENT everywhere.</p>
</div>
<section id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this heading">#</a></h2>
<p>The usual deal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">%</span><span class="k">run</span> ../setup.ipynb
<span class="o">%</span><span class="k">run</span> ../plotting_functions.ipynb
<span class="n">data_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../../data&#39;</span> <span class="p">)</span>
<span class="n">output_dir</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="s1">&#39;../../output&#39;</span><span class="p">)</span> 
<span class="c1"># import utide</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">interp1d</span>


<span class="c1"># check to make sure that data_dir/rsl_daily_hawaii.nc exists, if not, make warning to run datawrangling notebook</span>
<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">data_dir</span> <span class="o">/</span> <span class="s1">&#39;rsl_daily_hawaii.nc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;rsl_daily_hawaii.nc not found in ../../data. Please run the data wrangling notebook first&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;rsl_daily_hawaii.nc found in ../../data. Proceed.&#39;</span><span class="p">)</span>


<span class="c1"># check to make sure that data_dir/rsl_hawaii.nc exists, if not, make warning to run datawrangling notebook</span>
<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">data_dir</span> <span class="o">/</span> <span class="s1">&#39;rsl_hawaii.nc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;rsl_hawaii.nc not found in ../../data. Please run the data wrangling notebook first&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;rsl_hawaii.nc found in ../../data. Proceed.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>rsl_daily_hawaii.nc found in ../../data. Proceed.
rsl_hawaii.nc found in ../../data. Proceed.
</pre></div>
</div>
</div>
</div>
</section>
<section id="obtain-daily-and-hourly-datasets">
<h2>Obtain Daily and Hourly datasets<a class="headerlink" href="#obtain-daily-and-hourly-datasets" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rsl_daily</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">line</span> <span class="mi">1</span>
<span class="ne">----&gt; </span><span class="mi">1</span> <span class="n">rsl_daily</span>

<span class="ne">NameError</span>: name &#39;rsl_daily&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#import rsl_daily</span>

<span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">data_dir</span><span class="o">/</span> <span class="s1">&#39;rsl_daily_hawaii.nc&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>

    <span class="c1">#make rsl_daily a subset - do not include TGs with more than 25% NaNs</span>
    <span class="n">data_coverage</span> <span class="o">=</span> <span class="n">ds</span><span class="p">[</span><span class="s1">&#39;rsl_mhhw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">)</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">ds</span><span class="o">.</span><span class="n">time</span><span class="p">)</span>

    <span class="c1">#drop all locations with data_coverage less than 80%</span>
    <span class="n">rsl_daily</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">data_coverage</span><span class="o">&gt;</span><span class="mf">0.80</span><span class="p">,</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="k">with</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">data_dir</span><span class="o">/</span> <span class="s1">&#39;rsl_hawaii.nc&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">ds</span><span class="p">:</span>
    <span class="n">rsl_hourly</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">record_id</span> <span class="o">=</span> <span class="n">rsl_daily</span><span class="o">.</span><span class="n">record_id</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    

<span class="c1"># truncate time period to end at the end of 2022</span>
<span class="n">rsl_daily</span> <span class="o">=</span> <span class="n">rsl_daily</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;2022-12-31&#39;</span><span class="p">))</span>
<span class="n">rsl_hourly</span> <span class="o">=</span> <span class="n">rsl_hourly</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span> <span class="o">=</span> <span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;2022-12-31&#39;</span><span class="p">))</span>

<span class="c1"># check the last time in rsl_daily and rsl_hourly</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rsl_daily</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">rsl_hourly</span><span class="o">.</span><span class="n">time</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2022-12-31T00:00:00.000000000
2022-12-31T22:59:59.971200000
</pre></div>
</div>
</div>
</div>
</section>
<section id="pre-process-the-data">
<h2>Pre-process the data<a class="headerlink" href="#pre-process-the-data" title="Permalink to this heading">#</a></h2>
<section id="remove-outliers-and-obtain-trend">
<h3>Remove outliers and obtain trend<a class="headerlink" href="#remove-outliers-and-obtain-trend" title="Permalink to this heading">#</a></h3>
<p>Here we are using the FULL data set, not just from 1993-onward.</p>
<p>First we’ll nan out the tsunami time period, and then calculate the trend.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Need to insert code from Ayesha here for tsunami removal, which should be 36 hours only.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pyextremes</span> <span class="kn">import</span> <span class="n">get_extremes</span><span class="p">,</span> <span class="n">get_return_periods</span><span class="p">,</span> <span class="n">plotting</span><span class="p">,</span> <span class="n">EVA</span>

<span class="c1"># cut data off at end of 2022</span>
<span class="n">rsl_hourly</span> <span class="o">=</span> <span class="n">rsl_hourly</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;2022-12-31&#39;</span><span class="p">))</span>

<span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;sea_level_mhhw&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.001</span><span class="o">*</span><span class="p">(</span><span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;MHHW&#39;</span><span class="p">])</span>

<span class="c1"># replace sea level data with nan for tsunami event from 23-24 May 1960</span>
<span class="n">tsunamiTimeStart</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;1960-05-23 00:00:00&#39;</span><span class="p">)</span>
<span class="n">tsunamiTimeEnd</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;1960-05-25 00:00:00&#39;</span><span class="p">)</span>

<span class="c1"># nan out the data for the tsunami event</span>
<span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;sea_level_mhhw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="n">tsunamiTimeStart</span><span class="p">,</span> <span class="n">tsunamiTimeEnd</span><span class="p">))]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>


<span class="c1"># get trend, trend_rate, trend_mag</span>
<span class="n">trend_mag</span><span class="p">,</span> <span class="n">trend_line</span><span class="p">,</span> <span class="n">trend_rate</span> <span class="o">=</span> <span class="n">process_trend_with_nan</span><span class="p">(</span><span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;sea_level_mhhw&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Make a plot to make sure we’re looking at the right thing.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">g</span> <span class="o">=</span> <span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;sea_level_mhhw&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;record_id&#39;</span><span class="p">,</span> <span class="n">col_wrap</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>

<span class="c1"># Use g.axs to iterate over the axes in the FacetGrid</span>
<span class="k">for</span> <span class="n">ax</span><span class="p">,</span> <span class="n">rid</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">,</span> <span class="n">rsl_hourly</span><span class="o">.</span><span class="n">record_id</span><span class="p">):</span>
    <span class="c1"># Accessing the station_name coordinate for the current record_id directly</span>
    <span class="n">trend_line</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">record_id</span> <span class="o">=</span> <span class="n">rid</span><span class="p">)</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="n">ax</span><span class="p">)</span>
    <span class="n">station_name</span> <span class="o">=</span> <span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;station_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">record_id</span> <span class="o">=</span> <span class="n">rid</span><span class="p">)</span><span class="o">.</span><span class="n">values</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">station_name</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/9cd3c4c73b2592dc1d794a54956159bafa4c1d4707579757f2740a73f4b68611.png" src="../../_images/9cd3c4c73b2592dc1d794a54956159bafa4c1d4707579757f2740a73f4b68611.png" />
</div>
</div>
<p>Now we’ll turn this data into a timeseries and detrend it (remove the trend line calculated above). This now puts everything relative to mean sea level for the calculated time period. We’ll set it back to MHHW (epoch 1993-2001 values).</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The datum used here is TBD. Ayesha’s code uses 1991-2009 to get MHHW.</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#remove the linear trend, this will put everything at MSL.</span>
<span class="n">rsl_detrended</span> <span class="o">=</span> <span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;sea_level_mhhw&#39;</span><span class="p">]</span><span class="o">-</span><span class="n">trend_line</span>
</pre></div>
</div>
</div>
</div>
<p>Next we’ll create an xarray full of zeros, so that we can later fill it up with values for our return periods at each station:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a zero xarray</span>
<span class="n">z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">8</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
<span class="n">return_periods</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span>
<span class="n">return_period_xr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">DataArray</span><span class="p">(</span><span class="n">z</span><span class="p">,</span> <span class="n">coords</span><span class="o">=</span><span class="p">[</span><span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;record_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">return_periods</span><span class="p">],</span>
                  <span class="n">dims</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;record_id&#39;</span><span class="p">,</span> <span class="s1">&#39;return period&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<p>Next, we’ll turn each detrended sea level record into a pandas dataseries for extreme value analysis. This extra formatting step is necessary to ensure that the timesteps are handled correctly. Then we’ll set everything relative to MHHW again.</p>
<p>For now, we’ll pick a record to highlight (“rid” here stands for Record ID).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Turn each detrended sea level record into a series for EVA </span>
<span class="n">rid</span> <span class="o">=</span> <span class="mi">2</span>
<span class="n">station_name</span> <span class="o">=</span> <span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;station_name&#39;</span><span class="p">][</span><span class="n">rid</span><span class="p">]</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="k">if</span> <span class="n">station_name</span> <span class="o">==</span> <span class="s1">&#39;Honolulu, Hawaii&#39;</span><span class="p">:</span>
    <span class="n">station_name</span> <span class="o">=</span> <span class="s1">&#39;Honolulu&#39;</span>

<span class="n">glue</span><span class="p">(</span><span class="s1">&#39;station_name&#39;</span><span class="p">,</span><span class="n">station_name</span><span class="p">,</span><span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">convert_to_detrendedMHHW</span><span class="p">(</span><span class="n">rid</span><span class="p">):</span>   
    <span class="n">sea_level_data_detrended</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">rsl_detrended</span><span class="p">[</span><span class="n">rid</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
    <span class="n">sea_level_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;sea_level_mhhw&#39;</span><span class="p">][</span><span class="n">rid</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>

    <span class="c1"># drop the nan values</span>
    <span class="n">sea_level_data_detrended</span> <span class="o">=</span> <span class="n">sea_level_data_detrended</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>
    <span class="n">sea_level_data</span> <span class="o">=</span> <span class="n">sea_level_data</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

    <span class="c1"># set everything relative to MHHW from MSL coordinates</span>
    <span class="n">MSLtoMHHW</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;MSL&#39;</span><span class="p">][</span><span class="n">rid</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">/</span><span class="mi">1000</span><span class="o">-</span><span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;MHHW&#39;</span><span class="p">][</span><span class="n">rid</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span><span class="mi">4</span><span class="p">)</span>
    <span class="n">MSLtoMHHW</span>

    <span class="n">sea_level_data_detrended</span> <span class="o">=</span> <span class="n">sea_level_data_detrended</span> <span class="o">+</span> <span class="n">MSLtoMHHW</span>
    <span class="c1"># label the data</span>
    <span class="n">sea_level_data_detrended</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;sea level [m MHHW, detrended]&#39;</span>
    <span class="n">sea_level_data_detrended</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;time (GMT)&#39;</span>
    <span class="k">return</span> <span class="n">sea_level_data_detrended</span>
    <span class="c1"># plot sea_level_data_detrended</span>

<span class="n">sea_level_data_detrended</span> <span class="o">=</span>  <span class="n">convert_to_detrendedMHHW</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>   
<span class="n">ax</span> <span class="o">=</span> <span class="n">sea_level_data_detrended</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span> <span class="c1"># This should be in MHHW datum, check to see if it makes sense.</span>

<span class="c1"># add title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">station_name</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Water Level (m, MHHW)</span><span class="se">\n</span><span class="s1">Linearly Detrended&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0, 0.5, &#39;Water Level (m, MHHW)\nLinearly Detrended&#39;)
</pre></div>
</div>
<img alt="../../_images/a2cef9438fe498871d4afe380fcef62a6eae3cb69ff890b1a4f704b78a868381.png" src="../../_images/a2cef9438fe498871d4afe380fcef62a6eae3cb69ff890b1a4f704b78a868381.png" />
</div>
</div>
</section>
</section>
<section id="create-the-model-and-extract-the-extreme-values">
<h2>Create the model, and extract the extreme values.<a class="headerlink" href="#create-the-model-and-extract-the-extreme-values" title="Permalink to this heading">#</a></h2>
<p>Here, we are going to find extremes using the Block Maxima (BM) method. This will find all extreme values by selecting a block size (here we’ve chosen a year for the annual max, and 30 days for the monthly max).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">min_last_block_ratio</span> <span class="o">=</span> <span class="mf">0.9</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">EVA</span><span class="p">(</span><span class="n">sea_level_data_detrended</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">get_extremes</span><span class="p">(</span><span class="n">extremes_type</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;BM&#39;</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="s1">&#39;365D&#39;</span><span class="p">,</span><span class="n">min_last_block</span><span class="o">=</span><span class="n">min_last_block_ratio</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Take a look at the extreme events, here calculated with BM method.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">plot_extremes</span><span class="p">()</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Annual Maxima: &#39;</span> <span class="o">+</span> <span class="n">station_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Text(0.5, 1.0, &#39;Annual Maxima: Honolulu&#39;)
</pre></div>
</div>
<img alt="../../_images/ca91cae8730f04ee7078f7482dba27855198279f2d05af7d4e6ac6cb82c58339.png" src="../../_images/ca91cae8730f04ee7078f7482dba27855198279f2d05af7d4e6ac6cb82c58339.png" />
</div>
</div>
</section>
<section id="fit-the-model">
<h2>Fit the model<a class="headerlink" href="#fit-the-model" title="Permalink to this heading">#</a></h2>
<p>We are going to take our extremes and fit them to a model. The pyextremes package will select the ‘best model’ for this using the Akaike Information Criterion (AIC), with the goal of losing the least amount of information in a given model. Using BM, we could have either a GEV or a Gumbel (specialized case of the GEV) distribution. While we could force it to either distribution, for this case we’ll the AIC play out.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">model</span><span class="o">.</span><span class="n">fit_model</span><span class="p">()</span>

<span class="n">distribution_name</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">name</span>
<span class="k">if</span> <span class="n">distribution_name</span> <span class="o">==</span> <span class="s1">&#39;genextreme&#39;</span><span class="p">:</span>
    <span class="n">distribution_name</span> <span class="o">=</span> <span class="s1">&#39;GEV&#39;</span>
    
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;distribution name&quot;</span><span class="p">,</span> <span class="n">model</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Here, we are using the <span class="pasted-text">genextreme</span> distribution. Now, we’ll print out the shape, location, and scale parameters.</p>
<p>If we are using the GEV distribution, we’ll have 3 parameters (shape, scale, and location) using the Maximum Likelihood Estimation (MLE).
If we are using the gumbel distribution, there are only 2 free parameters: location and scale (as the GEV approaches Gumbel when the shape parameter goes to zero.)</p>
<div class="cell tag_hide-output docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="s1">&#39;gumbel_r&#39;</span><span class="p">:</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">shape</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">mle_parameters</span><span class="p">[</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
<span class="n">scale</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">mle_parameters</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">]</span>
<span class="n">loc</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">distribution</span><span class="o">.</span><span class="n">mle_parameters</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">]</span>

<span class="c1"># Format with two decimal places</span>
<span class="n">shape_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">shape</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">scale_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">scale</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span>
<span class="n">loc_str</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">loc</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span>

<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;shape&quot;</span><span class="p">,</span> <span class="n">shape_str</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;scale&quot;</span><span class="p">,</span> <span class="n">scale_str</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;loc&quot;</span><span class="p">,</span> <span class="n">loc_str</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Need to fix this explanation, as each gauge is currently different!</p>
</div>
<p>For the <span class="pasted-text">Honolulu</span> tide gauge, the shape parameter <span class="math notranslate nohighlight">\(\xi\)</span> is <span class="pasted-text">0.23</span>, corresponding to a <span class="pasted-text">genextreme</span> distribution of the extremes. The location parameter <span class="math notranslate nohighlight">\(\mu\)</span> tells us that the distribution is centered around <span class="pasted-text">0.27</span>, and the scale parameter (<span class="math notranslate nohighlight">\(\psi\)</span>  = <span class="pasted-text">0.06</span>} shows how tightly the extremes cluster with each other (little dispersion).</p>
<section id="let-s-get-a-closer-look-at-the-return-level-curve">
<h3>Let’s get a closer look at the return level curve<a class="headerlink" href="#let-s-get-a-closer-look-at-the-return-level-curve" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_returnLevelCurve</span><span class="p">(</span><span class="n">rid</span><span class="p">):</span>
    <span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">plot_return_values</span><span class="p">(</span><span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">return_period</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">1.3</span><span class="p">,</span><span class="mi">500</span><span class="p">,</span><span class="mi">2</span><span class="p">),</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">plotting_position</span><span class="o">=</span><span class="s1">&#39;weibull&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="mf">0.1</span><span class="p">,</span><span class="mf">1.25</span><span class="p">)</span>

    <span class="c1"># add lines for the 2, 5, 10, 50, and 100 year return periods</span>
    <span class="n">return_periods</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span><span class="mi">10</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">100</span><span class="p">]</span>

    <span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;r&#39;</span><span class="p">,</span><span class="s1">&#39;g&#39;</span><span class="p">,</span><span class="s1">&#39;b&#39;</span><span class="p">,</span><span class="s1">&#39;c&#39;</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">return_period</span><span class="p">,</span> <span class="n">color</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">return_periods</span><span class="p">,</span> <span class="n">colors</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">return_period</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">color</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">return_period</span><span class="si">}</span><span class="s1"> year return period&#39;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">return_period</span><span class="p">,</span> <span class="mf">0.15</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">return_period</span><span class="si">}</span><span class="s1"> yr&#39;</span><span class="p">,</span> <span class="n">rotation</span><span class="o">=</span><span class="mi">90</span><span class="p">,</span> 
            <span class="n">verticalalignment</span><span class="o">=</span><span class="s1">&#39;bottom&#39;</span><span class="p">,</span><span class="n">backgroundcolor</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span><span class="n">horizontalalignment</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
            <span class="n">fontsize</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="n">station_name</span><span class="p">)</span>
    <span class="c1"># save the figure</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;SL_extremes_return_values_&#39;</span><span class="o">+</span> <span class="n">station_name</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">figname</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">plot_returnLevelCurve</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/99c8e28d2279adf5974e92ea624e7dc79823ef6417634260c835e416ece1d08c.png" src="../../_images/99c8e28d2279adf5974e92ea624e7dc79823ef6417634260c835e416ece1d08c.png" />
</div>
</div>
<p>Confidence intervals for the GEV model are shown in shaded blue. Note that the extreme annual maximum (0.45) does not fall neatly on this distribution, suggesting that perhaps we might need to switch to a non-stationary model to account for the influence of other variables that change with time.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_stats</span><span class="p">(</span><span class="n">rid</span><span class="p">):</span>
    <span class="c1"># make new figure with axes 1-3</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">15</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>

    <span class="c1"># make pdf of extremes</span>
    <span class="n">pdf_extremes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">extremes</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">model</span><span class="o">.</span><span class="n">extremes</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">500</span><span class="p">)</span>
    <span class="n">pdf</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">extremes_transformer</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">pdf_extremes</span><span class="p">))</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span>
                <span class="n">model</span><span class="o">.</span><span class="n">extremes</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="n">bins</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">histogram_bin_edges</span><span class="p">(</span><span class="n">a</span><span class="o">=</span><span class="n">model</span><span class="o">.</span><span class="n">extremes</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">20</span><span class="p">),</span>
                <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
                <span class="n">rwidth</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
                <span class="n">facecolor</span><span class="o">=</span><span class="s2">&quot;#5199FF&quot;</span><span class="p">,</span>
                <span class="n">edgecolor</span><span class="o">=</span><span class="s2">&quot;None&quot;</span><span class="p">,</span>
                <span class="n">lw</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">alpha</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">pdf_extremes</span><span class="p">,</span> <span class="n">pdf</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;#F85C50&quot;</span><span class="p">,</span> <span class="n">lw</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">ls</span><span class="o">=</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">15</span><span class="p">)</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span>
                <span class="n">model</span><span class="o">.</span><span class="n">extremes</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">shape</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">extremes</span><span class="p">),</span> <span class="n">fill_value</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
                <span class="n">marker</span><span class="o">=</span><span class="s2">&quot;|&quot;</span><span class="p">,</span>
                <span class="n">s</span><span class="o">=</span><span class="mi">40</span><span class="p">,</span>
                <span class="n">color</span><span class="o">=</span><span class="s2">&quot;k&quot;</span><span class="p">,</span>
                <span class="n">lw</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
                <span class="n">zorder</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span>
            <span class="p">)</span>

    <span class="c1"># add parameters to the plot</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">text</span><span class="p">(</span>
        <span class="mf">0.95</span><span class="p">,</span>
        <span class="mf">0.95</span><span class="p">,</span>
        <span class="sa">f</span><span class="s2">&quot;$</span><span class="se">\\</span><span class="s2">xi$: </span><span class="si">{</span><span class="n">shape_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">$</span><span class="se">\\</span><span class="s2">psi$: </span><span class="si">{</span><span class="n">scale_str</span><span class="si">}</span><span class="se">\n</span><span class="s2">$</span><span class="se">\\</span><span class="s2">mu$: </span><span class="si">{</span><span class="n">loc_str</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">,</span>
        <span class="n">fontsize</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span>
        <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;right&quot;</span><span class="p">,</span>
        <span class="n">va</span><span class="o">=</span><span class="s2">&quot;top&quot;</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">transAxes</span>  <span class="c1"># Updated to &#39;axs.transAxes&#39; assuming axs is a single axis object</span>
    <span class="p">)</span>


    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Annual Maxima [m]&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s2">&quot;Probability density&quot;</span><span class="p">)</span>

    <span class="n">model</span><span class="o">.</span><span class="n">plot_probability</span><span class="p">(</span><span class="s1">&#39;PP&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">model</span><span class="o">.</span><span class="n">plot_probability</span><span class="p">(</span><span class="s1">&#39;QQ&#39;</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>

    <span class="n">axs</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Histogram of Annual Maxima&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Probability Plot: P-P&#39;</span><span class="p">)</span>
    <span class="n">axs</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Probability Plot: Q-Q&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

    <span class="c1"># add a supertitle??</span>


    <span class="c1"># save the figure</span>
    <span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;SL_extremes_histogram_pp_qq_&#39;</span><span class="o">+</span> <span class="n">station_name</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">figname</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>

<span class="n">plot_stats</span><span class="p">(</span><span class="n">rid</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/6d9d5452e73f8c7b1c8588b6cea77509c9abf5c94b5e141fa1d26840d69347a2.png" src="../../_images/6d9d5452e73f8c7b1c8588b6cea77509c9abf5c94b5e141fa1d26840d69347a2.png" />
</div>
</div>
</section>
<section id="get-return-periods-of-2-10-50-and-100-years">
<h3>Get return periods of 2, 10, 50 and 100 years<a class="headerlink" href="#get-return-periods-of-2-10-50-and-100-years" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Get summary of the model</span>
<span class="n">return_periods</span><span class="o">=</span><span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">]</span>

<span class="n">summary</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_summary</span><span class="p">(</span>
    <span class="n">return_period</span><span class="o">=</span><span class="n">return_periods</span><span class="p">,</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">1000</span>
<span class="p">)</span>

<span class="c1">#change name &quot;return period&quot; to &quot;return period (yrs)&quot;</span>
<span class="n">summary</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;return period&#39;</span><span class="p">:</span> <span class="s1">&#39;return period (yrs)&#39;</span><span class="p">,</span><span class="s1">&#39;return value&#39;</span><span class="p">:</span><span class="s1">&#39;Water Level (m, MHHW)&#39;</span><span class="p">,</span><span class="s1">&#39;lower ci&#39;</span><span class="p">:</span><span class="s1">&#39;Lower CI (m, MHHW)&#39;</span><span class="p">,</span><span class="s1">&#39;upper ci&#39;</span><span class="p">:</span><span class="s1">&#39;Upper CI (m, MHHW)&#39;</span><span class="p">})</span>
<span class="n">summary</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Water Level (m, MHHW)</th>
      <th>Lower CI (m, MHHW)</th>
      <th>Upper CI (m, MHHW)</th>
    </tr>
    <tr>
      <th>return period</th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>2.0</th>
      <td>0.286112</td>
      <td>0.273816</td>
      <td>0.341178</td>
    </tr>
    <tr>
      <th>10.0</th>
      <td>0.367975</td>
      <td>0.351649</td>
      <td>0.449312</td>
    </tr>
    <tr>
      <th>50.0</th>
      <td>0.415909</td>
      <td>0.390001</td>
      <td>0.459957</td>
    </tr>
    <tr>
      <th>100.0</th>
      <td>0.431348</td>
      <td>0.396573</td>
      <td>0.460918</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Need to do some fixing here w.r.t. data gaps</p>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># get return periods (2,10,50,100) for all stations:</span>

<span class="k">if</span> <span class="ow">not</span> <span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s1">&#39;return_period_stationary.nc&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">rec_id</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">sea_level_data_detrended_temp</span> <span class="o">=</span>  <span class="n">convert_to_detrendedMHHW</span><span class="p">(</span><span class="n">rec_id</span><span class="p">)</span>  
        <span class="n">min_last_block_ratio</span> <span class="o">=</span> <span class="mf">0.9</span>
        <span class="n">model</span> <span class="o">=</span> <span class="n">EVA</span><span class="p">(</span><span class="n">sea_level_data_detrended_temp</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">get_extremes</span><span class="p">(</span><span class="n">extremes_type</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;BM&#39;</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="s1">&#39;365D&#39;</span><span class="p">,</span><span class="n">min_last_block</span><span class="o">=</span><span class="n">min_last_block_ratio</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="n">model</span><span class="o">.</span><span class="n">fit_model</span><span class="p">()</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">get_summary</span><span class="p">(</span>
            <span class="n">return_period</span><span class="o">=</span><span class="n">return_periods</span><span class="p">,</span>
            <span class="n">alpha</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">n_samples</span><span class="o">=</span><span class="mi">1000</span>
        <span class="p">)</span>

        <span class="c1">#change name &quot;return period&quot; to &quot;return period (yrs)&quot;</span>
        <span class="n">summary</span> <span class="o">=</span> <span class="n">summary</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;return period&#39;</span><span class="p">:</span> <span class="s1">&#39;return period (yrs)&#39;</span><span class="p">,</span><span class="s1">&#39;return value&#39;</span><span class="p">:</span><span class="s1">&#39;Water Level (m, MHHW)&#39;</span><span class="p">,</span><span class="s1">&#39;lower ci&#39;</span><span class="p">:</span><span class="s1">&#39;Lower CI (m, MHHW)&#39;</span><span class="p">,</span><span class="s1">&#39;upper ci&#39;</span><span class="p">:</span><span class="s1">&#39;Upper CI (m, MHHW)&#39;</span><span class="p">})</span>
        <span class="n">summary</span>

        <span class="n">return_period_xr</span><span class="p">[</span><span class="n">rec_id</span><span class="p">]</span> <span class="o">=</span> <span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Water Level (m, MHHW)&#39;</span><span class="p">]</span>
    <span class="n">return_period_xr</span><span class="o">.</span><span class="n">to_netcdf</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s1">&#39;return_period_stationary.nc&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">return_period_xr</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataarray</span><span class="p">(</span><span class="n">output_dir</span><span class="o">/</span> <span class="s1">&#39;return_period_stationary.nc&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="make-an-intergrated-rankings-return-periods-table">
<h3>Make an intergrated rankings + return periods table<a class="headerlink" href="#make-an-intergrated-rankings-return-periods-table" title="Permalink to this heading">#</a></h3>
<p>First, make some functions to get the top 10 ranked recorded water levels. This is copied from the rankings notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">get_top_10_table</span><span class="p">(</span><span class="n">rsl_subset</span><span class="p">,</span><span class="n">rid</span><span class="p">):</span>
    <span class="c1"># make a table of the top 10 values, sorted by size and with date</span>
    <span class="n">top_10_values_max</span> <span class="o">=</span> <span class="n">get_top_ten</span><span class="p">(</span><span class="n">rsl_subset</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">)</span>
    <span class="n">top_10_values_min</span> <span class="o">=</span> <span class="n">get_top_ten</span><span class="p">(</span><span class="n">rsl_subset</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;min&#39;</span><span class="p">)</span>

    <span class="n">top_10_table</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">top_10_values_max</span><span class="p">,</span><span class="n">top_10_values_min</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">top_10_table</span>

<span class="k">def</span> <span class="nf">get_top_ten</span><span class="p">(</span><span class="n">rsl_subset</span><span class="p">,</span> <span class="n">rid</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;max&#39;</span><span class="p">):</span>
    <span class="c1"># Convert data to a pandas Series</span>
    <span class="n">sea_level_series</span> <span class="o">=</span> <span class="n">rsl_subset</span><span class="o">.</span><span class="n">sea_level</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">record_id</span><span class="o">=</span><span class="n">rid</span><span class="p">)</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span>


   <span class="c1"># Select top 100 values based on the mode</span>
    <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;max&#39;</span><span class="p">:</span>
        <span class="n">top_values</span> <span class="o">=</span> <span class="n">sea_level_series</span><span class="o">.</span><span class="n">nlargest</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;min&#39;</span><span class="p">:</span>
        <span class="n">top_values</span> <span class="o">=</span> <span class="n">sea_level_series</span><span class="o">.</span><span class="n">nsmallest</span><span class="p">(</span><span class="mi">100</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;mode must be either &quot;max&quot; or &quot;min&quot;&#39;</span><span class="p">)</span>

    <span class="c1"># Filter to find unique events spaced by at least 3 days</span>
    <span class="n">filtered_dates</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">top_10_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">()</span>

    <span class="k">for</span> <span class="n">date</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">top_values</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="k">if</span> <span class="nb">all</span><span class="p">(</span><span class="nb">abs</span><span class="p">((</span><span class="n">date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">added_date</span><span class="p">))</span><span class="o">.</span><span class="n">days</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">3</span> <span class="k">for</span> <span class="n">added_date</span> <span class="ow">in</span> <span class="n">filtered_dates</span><span class="p">):</span>
            <span class="n">filtered_dates</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date</span><span class="p">)</span>
            <span class="n">top_10_values</span><span class="p">[</span><span class="n">date</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">filtered_dates</span><span class="p">)</span> <span class="o">==</span> <span class="mi">10</span><span class="p">:</span>
            <span class="k">break</span>
    <span class="n">rank</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">11</span><span class="p">)</span>

    <span class="n">station_name</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">rsl_subset</span><span class="p">[</span><span class="s1">&#39;station_name&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">record_id</span><span class="o">=</span><span class="n">rid</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">record_id</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">rsl_subset</span><span class="p">[</span><span class="s1">&#39;record_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isel</span><span class="p">(</span><span class="n">record_id</span><span class="o">=</span><span class="n">rid</span><span class="p">)</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>  

    <span class="n">top_10_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;rank&#39;</span><span class="p">:</span> <span class="n">rank</span><span class="p">,</span> <span class="s1">&#39;date&#39;</span><span class="p">:</span> <span class="n">top_10_values</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="s1">&#39;sea level (m)&#39;</span><span class="p">:</span> <span class="n">top_10_values</span><span class="o">.</span><span class="n">values</span><span class="p">})</span>  
    <span class="n">top_10_values</span><span class="p">[</span><span class="s1">&#39;station_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">station_name</span>
    <span class="n">top_10_values</span><span class="p">[</span><span class="s1">&#39;record_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">record_id</span>
    <span class="n">top_10_values</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mode</span>

    <span class="c1">#round the date to the nearest hour</span>
    <span class="n">top_10_values</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">top_10_values</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="s1">&#39;h&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">top_10_values</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="first-make-the-rankings-list">
<h3>First make the rankings list<a class="headerlink" href="#first-make-the-rankings-list" title="Permalink to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">rsl_subset</span> <span class="o">=</span> <span class="n">rsl_hourly</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">rsl_subset</span><span class="p">[</span><span class="s1">&#39;sea_level&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">rsl_subset</span><span class="p">[</span><span class="s1">&#39;sea_level_mhhw&#39;</span><span class="p">]</span>
<span class="n">SL_rankings10</span> <span class="o">=</span> <span class="n">get_top_10_table</span><span class="p">(</span><span class="n">rsl_subset</span><span class="p">,</span><span class="n">rid</span><span class="p">)</span>

<span class="c1"># take only the max type</span>
<span class="n">SL_rankings10</span> <span class="o">=</span> <span class="n">SL_rankings10</span><span class="p">[</span><span class="n">SL_rankings10</span><span class="p">[</span><span class="s1">&#39;type&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;max&#39;</span><span class="p">]</span>
<span class="n">SL_rankings10</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>rank</th>
      <th>date</th>
      <th>sea level (m)</th>
      <th>station_name</th>
      <th>record_id</th>
      <th>type</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>2020-12-15 15:00:00</td>
      <td>0.458</td>
      <td>Honolulu, Hawaii</td>
      <td>57</td>
      <td>max</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>2019-12-25 14:00:00</td>
      <td>0.447</td>
      <td>Honolulu, Hawaii</td>
      <td>57</td>
      <td>max</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>2017-08-21 01:00:00</td>
      <td>0.440</td>
      <td>Honolulu, Hawaii</td>
      <td>57</td>
      <td>max</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>1968-12-19 14:00:00</td>
      <td>0.436</td>
      <td>Honolulu, Hawaii</td>
      <td>57</td>
      <td>max</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>2021-12-05 15:00:00</td>
      <td>0.428</td>
      <td>Honolulu, Hawaii</td>
      <td>57</td>
      <td>max</td>
    </tr>
    <tr>
      <th>5</th>
      <td>6</td>
      <td>1992-09-12 02:00:00</td>
      <td>0.424</td>
      <td>Honolulu, Hawaii</td>
      <td>57</td>
      <td>max</td>
    </tr>
    <tr>
      <th>6</th>
      <td>7</td>
      <td>2020-07-20 02:00:00</td>
      <td>0.423</td>
      <td>Honolulu, Hawaii</td>
      <td>57</td>
      <td>max</td>
    </tr>
    <tr>
      <th>7</th>
      <td>8</td>
      <td>2020-11-15 14:00:00</td>
      <td>0.415</td>
      <td>Honolulu, Hawaii</td>
      <td>57</td>
      <td>max</td>
    </tr>
    <tr>
      <th>8</th>
      <td>9</td>
      <td>2020-10-19 16:00:00</td>
      <td>0.411</td>
      <td>Honolulu, Hawaii</td>
      <td>57</td>
      <td>max</td>
    </tr>
    <tr>
      <th>9</th>
      <td>10</td>
      <td>2017-06-24 02:00:00</td>
      <td>0.410</td>
      <td>Honolulu, Hawaii</td>
      <td>57</td>
      <td>max</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<p>Now we’ll add in the return period table</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># mix this dataframe in with the SL_rankings table:</span>
<span class="n">station_name</span> <span class="o">=</span> <span class="n">station_name</span>

<span class="c1"># extract only &#39;Highest&#39; and &#39;Highest Date&#39; columns</span>
<span class="n">SL_rankings</span> <span class="o">=</span> <span class="n">SL_rankings10</span><span class="p">[[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;sea level (m)&#39;</span><span class="p">]]</span>

<span class="c1">#rename &#39;Highest&#39; to sea level (m, MHHW)</span>
<span class="n">SL_rankings</span> <span class="o">=</span> <span class="n">SL_rankings</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;sea level (m)&#39;</span><span class="p">:</span><span class="s1">&#39;Water Level (m, MHHW)&#39;</span><span class="p">})</span>

<span class="c1"># Ensure &#39;Water Level (m, MHHW)&#39; column is numeric for both DataFrames</span>
<span class="n">SL_rankings</span><span class="p">[</span><span class="s1">&#39;Water Level (m, MHHW)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">SL_rankings</span><span class="p">[</span><span class="s1">&#39;Water Level (m, MHHW)&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Water Level (m, MHHW)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_numeric</span><span class="p">(</span><span class="n">summary</span><span class="p">[</span><span class="s1">&#39;Water Level (m, MHHW)&#39;</span><span class="p">],</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="c1"># Merge the SL_rankings DataFrame with the summary DataFrame on &#39;water level (m, MHHW)&#39;</span>
<span class="n">SL_rankings_merge</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">SL_rankings</span><span class="p">,</span> <span class="n">summary</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(),</span> <span class="n">on</span><span class="o">=</span><span class="s1">&#39;Water Level (m, MHHW)&#39;</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;outer&#39;</span><span class="p">)</span>

<span class="n">SL_rankings_merge</span> <span class="o">=</span> <span class="n">SL_rankings_merge</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;Water Level (m, MHHW)&#39;</span><span class="p">,</span><span class="n">ascending</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">SL_rankings_merge</span><span class="p">[</span><span class="s1">&#39;Date or Return Period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SL_rankings_merge</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">pd</span><span class="o">.</span><span class="n">notnull</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">])</span> <span class="k">else</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;return period&#39;</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="n">SL_rankings_merge</span> <span class="o">=</span> <span class="n">SL_rankings_merge</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">,</span><span class="s1">&#39;return period&#39;</span><span class="p">,</span><span class="s1">&#39;Lower CI (m, MHHW)&#39;</span><span class="p">,</span><span class="s1">&#39;Upper CI (m, MHHW)&#39;</span><span class="p">])</span>

<span class="c1"># Add a column for feet</span>
<span class="n">SL_rankings_merge</span><span class="p">[</span><span class="s1">&#39;Water Level (ft, MHHW)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SL_rankings_merge</span><span class="p">[</span><span class="s1">&#39;Water Level (m, MHHW)&#39;</span><span class="p">]</span><span class="o">*</span><span class="mf">3.28084</span>

<span class="c1"># Rearrange columns to Date or Return Period, water level (m, MHHW), water level (ft, MHHW)</span>
<span class="n">SL_rankings_merge</span> <span class="o">=</span> <span class="n">SL_rankings_merge</span><span class="p">[[</span><span class="s1">&#39;Date or Return Period&#39;</span><span class="p">,</span><span class="s1">&#39;Water Level (m, MHHW)&#39;</span><span class="p">,</span><span class="s1">&#39;Water Level (ft, MHHW)&#39;</span><span class="p">]]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="format-the-merged-rankings-and-return-period-table">
<h3>Format the merged rankings and return period table<a class="headerlink" href="#format-the-merged-rankings-and-return-period-table" title="Permalink to this heading">#</a></h3>
<p>Format this to match https://sealevel.nasa.gov/flooding-analysis-tool/observed-flooding?station-id=1612340&amp;scenario=int-low&amp;threshold=061&amp;map=hide</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Format the date to be in the format &#39;YYYY-MM-DD&#39; if a date, or &#39;10-year flood&#39; if a return period</span>
<span class="n">SL_rankings_merge</span><span class="p">[</span><span class="s1">&#39;Date or Return Period&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SL_rankings_merge</span><span class="p">[</span><span class="s1">&#39;Date or Return Period&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span>
    <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">)</span> <span class="k">else</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="s1">-year flood&#39;</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">))</span> <span class="k">else</span> <span class="n">x</span>
<span class="p">)</span>

<span class="c1"># Format the water level columns to have 2 decimal places</span>
<span class="n">SL_rankings_merge</span><span class="p">[</span><span class="s1">&#39;Water Level (m, MHHW)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SL_rankings_merge</span><span class="p">[</span><span class="s1">&#39;Water Level (m, MHHW)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
<span class="n">SL_rankings_merge</span><span class="p">[</span><span class="s1">&#39;Water Level (ft, MHHW)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">SL_rankings_merge</span><span class="p">[</span><span class="s1">&#39;Water Level (ft, MHHW)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>

<span class="c1"># export the table to a csv file</span>
<span class="n">csvname</span> <span class="o">=</span> <span class="s1">&#39;SL_extremes_&#39;</span> <span class="o">+</span> <span class="n">station_name</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span>
<span class="n">SL_rankings_merge</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">csvname</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>


<span class="n">SL_rankings_merge</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Date or Return Period</th>
      <th>Water Level (m, MHHW)</th>
      <th>Water Level (ft, MHHW)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>13</th>
      <td>2020-12-15</td>
      <td>0.46</td>
      <td>1.50</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2019-12-25</td>
      <td>0.45</td>
      <td>1.47</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2017-08-21</td>
      <td>0.44</td>
      <td>1.44</td>
    </tr>
    <tr>
      <th>10</th>
      <td>1968-12-19</td>
      <td>0.44</td>
      <td>1.43</td>
    </tr>
    <tr>
      <th>9</th>
      <td>100-year flood</td>
      <td>0.43</td>
      <td>1.42</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2021-12-05</td>
      <td>0.43</td>
      <td>1.40</td>
    </tr>
    <tr>
      <th>7</th>
      <td>1992-09-12</td>
      <td>0.42</td>
      <td>1.39</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2020-07-20</td>
      <td>0.42</td>
      <td>1.39</td>
    </tr>
    <tr>
      <th>5</th>
      <td>50-year flood</td>
      <td>0.42</td>
      <td>1.36</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-11-15</td>
      <td>0.42</td>
      <td>1.36</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-10-19</td>
      <td>0.41</td>
      <td>1.35</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2017-06-24</td>
      <td>0.41</td>
      <td>1.35</td>
    </tr>
    <tr>
      <th>1</th>
      <td>10-year flood</td>
      <td>0.37</td>
      <td>1.21</td>
    </tr>
    <tr>
      <th>0</th>
      <td>2-year flood</td>
      <td>0.29</td>
      <td>0.94</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make into a table with great_tables</span>
<span class="kn">from</span> <span class="nn">great_tables</span> <span class="kn">import</span> <span class="n">GT</span><span class="p">,</span> <span class="n">html</span><span class="p">,</span> <span class="n">md</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># make a copy of the DataFrame</span>
<span class="n">SL_rankings_merge_copy</span> <span class="o">=</span> <span class="n">SL_rankings_merge</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># replace all spaces with underscores in top_10_display column names</span>
<span class="c1"># SL_rankings_merge_copy.columns = SL_rankings_merge_copy.columns.str.replace(&#39; &#39;, &#39;_&#39;)</span>

<span class="c1"># replace column names </span>
<span class="n">SL_rankings_merge_copy</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Date_or_Return_Period&#39;</span><span class="p">,</span> <span class="s1">&#39;mMHHW&#39;</span><span class="p">,</span> <span class="s1">&#39;ftMHHW&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert the DataFrame to a great_table</span>
<span class="p">(</span>
    <span class="n">GT</span><span class="p">(</span><span class="n">SL_rankings_merge_copy</span><span class="p">)</span>
    <span class="o">.</span><span class="n">tab_header</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s1">&#39;Highest Sea Level Events&#39;</span><span class="p">,</span> <span class="n">subtitle</span><span class="o">=</span><span class="s1">&#39;Station: &#39;</span><span class="o">+</span><span class="n">station_name</span><span class="p">)</span>
    <span class="o">.</span><span class="n">cols_align</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">cols_label</span><span class="p">(</span><span class="n">Date_or_Return_Period</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s2">&quot;Date or &lt;br&gt;Return Period&quot;</span><span class="p">),</span> <span class="n">mMHHW</span><span class="o">=</span><span class="n">html</span><span class="p">(</span><span class="s1">&#39;Water Level &lt;br&gt;(m, MHHW)&#39;</span><span class="p">),</span><span class="n">ftMHHW</span> <span class="o">=</span> <span class="n">html</span><span class="p">(</span><span class="s1">&#39;Water Level &lt;br&gt;(ft, MHHW)&#39;</span><span class="p">))</span>
    <span class="o">.</span><span class="n">tab_source_note</span><span class="p">(</span><span class="n">source_note</span><span class="o">=</span><span class="s1">&#39;Source: UHSLC RQDS&#39;</span><span class="p">)</span>
    <span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s1">&#39;../../output/SL_rankings_merge_&#39;</span><span class="o">+</span> <span class="n">station_name</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span><span class="p">)</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Note I’m not really sure why the water level values don’t match Phil’s table. My guess is that we’re working off slightly different datums?</p>
</section>
</section>
<section id="make-a-map">
<h2>Make a map<a class="headerlink" href="#make-a-map" title="Permalink to this heading">#</a></h2>
<section id="plot-the-return-periods-at-each-station">
<h3>Plot the Return Periods at each station<a class="headerlink" href="#plot-the-return-periods-at-each-station" title="Permalink to this heading">#</a></h3>
<p>Note that we are neglecting the confidence intervals for now.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">crs</span> <span class="o">=</span> <span class="n">ccrs</span><span class="o">.</span><span class="n">PlateCarree</span><span class="p">()</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">axs</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span> <span class="n">subplot_kw</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;projection&#39;</span><span class="p">:</span> <span class="n">crs</span><span class="p">})</span>
<span class="c1"># make ax,fig</span>
<span class="c1"># open the cmems data</span>
<span class="n">cmems</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="n">data_dir</span> <span class="o">/</span> <span class="s1">&#39;cmems_L4_SSH_0.25deg_1993_2023.nc&#39;</span><span class="p">)</span>

<span class="n">xlims</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmems</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">cmems</span><span class="o">.</span><span class="n">longitude</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>
<span class="n">ylims</span> <span class="o">=</span> <span class="p">[</span><span class="n">cmems</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">cmems</span><span class="o">.</span><span class="n">latitude</span><span class="o">.</span><span class="n">max</span><span class="p">()]</span>


<span class="c1"># plt.colorbar(maxplt,ax=axs[0],label=&#39;Sea Level (m)&#39;, location=&#39;bottom&#39;)           </span>

<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">ax</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axs</span><span class="o">.</span><span class="n">flat</span><span class="p">):</span>

    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;lon&#39;</span><span class="p">],</span> <span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;lat&#39;</span><span class="p">],</span> <span class="n">transform</span><span class="o">=</span><span class="n">crs</span><span class="p">,</span> <span class="n">s</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> 
               <span class="n">c</span><span class="o">=</span><span class="n">return_period_xr</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">vmin</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">vmax</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;YlOrRd&#39;</span><span class="p">,</span>
               <span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
    
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">COASTLINE</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_feature</span><span class="p">(</span><span class="n">cfeature</span><span class="o">.</span><span class="n">LAND</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgrey&#39;</span><span class="p">)</span>

    <span class="c1"># set extent</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_extent</span><span class="p">([</span><span class="n">xlims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">xlims</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ylims</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">crs</span><span class="o">=</span><span class="n">crs</span><span class="p">)</span>

    <span class="c1">#add grid</span>
    <span class="n">gl</span> <span class="o">=</span> <span class="n">ax</span><span class="o">.</span><span class="n">gridlines</span><span class="p">(</span><span class="n">draw_labels</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
                      <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span><span class="n">xlocs</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_xticks</span><span class="p">(),</span><span class="n">ylocs</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">get_yticks</span><span class="p">())</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">&gt;=</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">bottom_labels</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">if</span> <span class="n">i</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
        <span class="n">gl</span><span class="o">.</span><span class="n">left_labels</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1">#make all labels tiny</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">xlabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}</span>
    <span class="n">gl</span><span class="o">.</span><span class="n">ylabel_style</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="mi">8</span><span class="p">}</span>

    <span class="c1"># add text to top left of plot</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="mf">0.95</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">return_periods</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s1">-year flood&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">weight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">ax</span><span class="o">.</span><span class="n">transAxes</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>

<span class="c1"># add colorbar to the bottom of the plot which follows vmin, vmax and cmap of the scatter plot</span>
<span class="c1"># colorbar should be </span>
<span class="n">cbar</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">axs</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">collections</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">ax</span><span class="o">=</span><span class="n">axs</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span> <span class="n">aspect</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">cbar</span><span class="o">.</span><span class="n">set_label</span><span class="p">(</span><span class="s1">&#39;Meters above MHHW&#39;</span><span class="p">)</span>

<span class="c1"># save the figure</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="s1">&#39;SL_extremes_map.png&#39;</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../../_images/e7c28342698edf1cd47210a18b3b7424595b9e3547b039306205d137595182be.png" src="../../_images/e7c28342698edf1cd47210a18b3b7424595b9e3547b039306205d137595182be.png" />
</div>
</div>
</section>
</section>
<section id="plot-a-timeseries">
<h2>Plot a timeseries<a class="headerlink" href="#plot-a-timeseries" title="Permalink to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the monthly maxima</span>
<span class="n">monthly_max</span> <span class="o">=</span> <span class="n">get_extremes</span><span class="p">(</span><span class="n">sea_level_data_detrended</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;BM&#39;</span><span class="p">,</span> 
                           <span class="n">extremes_type</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="s1">&#39;30D&#39;</span><span class="p">,</span> <span class="n">min_last_block</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>
<span class="n">annual_max</span> <span class="o">=</span> <span class="n">get_extremes</span><span class="p">(</span><span class="n">sea_level_data_detrended</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;BM&#39;</span><span class="p">,</span> <span class="n">extremes_type</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="s1">&#39;365.245D&#39;</span><span class="p">,</span> <span class="n">min_last_block</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="n">model</span><span class="o">.</span><span class="n">get_extremes</span><span class="p">(</span><span class="n">extremes_type</span><span class="o">=</span><span class="s1">&#39;high&#39;</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;BM&#39;</span><span class="p">,</span> <span class="n">block_size</span><span class="o">=</span><span class="s1">&#39;365D&#39;</span><span class="p">,</span><span class="n">min_last_block</span><span class="o">=</span><span class="n">min_last_block_ratio</span><span class="p">,</span> <span class="n">errors</span><span class="o">=</span><span class="s1">&#39;coerce&#39;</span><span class="p">)</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">monthly_max</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">monthly_max</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Monthly Maxima&#39;</span><span class="p">,</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">annual_max</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">annual_max</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Annual Maxima&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Time&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Sea Level [m, MHHW]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Extreme Water Levels, detrended: </span><span class="si">{</span><span class="n">station_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#264653&#39;</span><span class="p">,</span>  <span class="c1"># dark cyan</span>
          <span class="s1">&#39;#2a9d8f&#39;</span><span class="p">,</span>  <span class="c1"># teal</span>
          <span class="s1">&#39;#e9c46a&#39;</span><span class="p">,</span>  <span class="c1"># sandy yellow</span>
          <span class="s1">&#39;#f4a261&#39;</span><span class="p">]</span>  <span class="c1"># sandy orange</span>

<span class="c1"># add the 2, 10, 50, and 100 year return levels in horizontal lines</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">period</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">return_periods</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">period</span><span class="p">,</span> <span class="s1">&#39;Water Level (m, MHHW)&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s1"> yr RL&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="n">linewidth</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># add bold black line at 0 for MHHW</span>
<span class="n">ax</span><span class="o">.</span><span class="n">axhline</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="c1"># put the legend at the bottom of the plot in one row</span>
<span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper center&#39;</span><span class="p">,</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">rsl_hourly</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]])</span>

<span class="c1"># save the figure</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;SL_extremes_monthly_annual_maxima_&#39;</span> <span class="o">+</span> <span class="n">station_name</span> <span class="o">+</span> <span class="s1">&#39;.png&#39;</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">figname</span><span class="p">,</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">,</span> <span class="n">bbox_inches</span><span class="o">=</span><span class="s1">&#39;tight&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/opt/anaconda3/envs/SLI39/lib/python3.9/site-packages/pyextremes/extremes/block_maxima.py:138: NoDataBlockWarning: 7 blocks contained no data
  warnings.warn(
</pre></div>
</div>
<img alt="../../_images/caf7f133f64998b8237f8b5867eff0a365cf6fd64bbe33c4c5972129300ea3b8.png" src="../../_images/caf7f133f64998b8237f8b5867eff0a365cf6fd64bbe33c4c5972129300ea3b8.png" />
</div>
</div>
<p>One takeaway here: Removing the trend shows that we’ve had some significant events in the past (including the large pulse in the 1970s) that do not show up in our rankings.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">plotly.graph_objects</span> <span class="k">as</span> <span class="nn">go</span>


<span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

<span class="c1"># Add monthly maxima as a line</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">monthly_max</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">monthly_max</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Monthly Maxima&#39;</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)))</span>

<span class="c1"># Add annual maxima as scatter points</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">annual_max</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">annual_max</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;markers&#39;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Annual Maxima&#39;</span><span class="p">))</span>


<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;#264653&#39;</span><span class="p">,</span>  <span class="c1"># dark cyan</span>
          <span class="s1">&#39;#2a9d8f&#39;</span><span class="p">,</span>  <span class="c1"># teal</span>
          <span class="s1">&#39;#e9c46a&#39;</span><span class="p">,</span>  <span class="c1"># sandy yellow</span>
          <span class="s1">&#39;#f4a261&#39;</span><span class="p">]</span>  <span class="c1"># sandy orange</span>


<span class="c1"># Add return levels as labeled lines</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">period</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">return_periods</span><span class="p">):</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="n">monthly_max</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">monthly_max</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()],</span>
                             <span class="n">y</span><span class="o">=</span><span class="p">[</span><span class="n">summary</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">period</span><span class="p">,</span> <span class="s1">&#39;Water Level (m, MHHW)&#39;</span><span class="p">]]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span>
                             <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;lines&#39;</span><span class="p">,</span>
                             <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="n">colors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
                             <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">period</span><span class="si">}</span><span class="s1"> year RL&#39;</span><span class="p">))</span>
    
<span class="c1"># Add a bold black line at 0 for MHHW</span>
<span class="n">fig</span><span class="o">.</span><span class="n">add_hline</span><span class="p">(</span><span class="n">y</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">line</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">))</span>

<span class="c1"># Set titles and labels</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Extreme Water Levels, Stationary GEV: </span><span class="si">{</span><span class="n">station_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                  <span class="n">xaxis_title</span><span class="o">=</span><span class="s1">&#39;Time&#39;</span><span class="p">,</span>
                  <span class="n">yaxis_title</span><span class="o">=</span><span class="s1">&#39;Sea Level [m, MHHW, detrended]&#39;</span><span class="p">,</span>
                  <span class="n">legend</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">xanchor</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=-</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;h&#39;</span><span class="p">,</span> <span class="n">bgcolor</span><span class="o">=</span><span class="s1">&#39;rgba(255,255,255,0.8)&#39;</span><span class="p">),</span>
                  <span class="n">plot_bgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>  <span class="c1"># Set plot background to white</span>
                  <span class="n">paper_bgcolor</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">)</span>  <span class="c1"># Set overall background to white</span>

<span class="c1"># Set x-axis limits if needed</span>
<span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="nb">range</span><span class="o">=</span><span class="p">[</span><span class="n">monthly_max</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">monthly_max</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">max</span><span class="p">()])</span>

<span class="c1"># Show the figure</span>
<span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># save the figure</span>
<span class="n">figname</span> <span class="o">=</span> <span class="s1">&#39;SL_extremes_monthly_annual_maxima_&#39;</span> <span class="o">+</span> <span class="n">station_name</span> <span class="o">+</span> <span class="s1">&#39;.html&#39;</span>

<span class="n">fig</span><span class="o">.</span><span class="n">write_html</span><span class="p">(</span><span class="n">output_dir</span> <span class="o">/</span> <span class="n">figname</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
</div>
</div>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "jwfiedler/SL_Hawaii",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/regional_and_local"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="SL_Rankings_annual.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Annual Sea Level Rankings</p>
      </div>
    </a>
    <a class="right-next"
       href="SL_Components_annual.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Components of Sea Level</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setup">Setup</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#obtain-daily-and-hourly-datasets">Obtain Daily and Hourly datasets</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pre-process-the-data">Pre-process the data</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#remove-outliers-and-obtain-trend">Remove outliers and obtain trend</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#create-the-model-and-extract-the-extreme-values">Create the model, and extract the extreme values.</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#fit-the-model">Fit the model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#let-s-get-a-closer-look-at-the-return-level-curve">Let’s get a closer look at the return level curve</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#get-return-periods-of-2-10-50-and-100-years">Get return periods of 2, 10, 50 and 100 years</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#make-an-intergrated-rankings-return-periods-table">Make an intergrated rankings + return periods table</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#first-make-the-rankings-list">First make the rankings list</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#format-the-merged-rankings-and-return-period-table">Format the merged rankings and return period table</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#make-a-map">Make a map</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-the-return-periods-at-each-station">Plot the Return Periods at each station</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-a-timeseries">Plot a timeseries</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Playground Coordinator
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2024.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=8d27b9dea8ad943066ae"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=8d27b9dea8ad943066ae"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>